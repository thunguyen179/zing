!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.zPlayer=t():e.zPlayer=t()}(window,function(){return function(e){function t(t){for(var n,i,o=t[0],a=t[1],s=0,l=[];s<o.length;s++)i=o[s],r[i]&&l.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(u&&u(t);l.length;)l.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise(function(t,i){n=r[e]=[t,i]});t.push(n[2]=o);var a,s=document.getElementsByTagName("head")[0],u=document.createElement("script");u.charset="utf-8",u.timeout=120,i.nc&&u.setAttribute("nonce",i.nc),u.src=function(e){return i.p+""+({}[e]||e)+".min.js"}(e),a=function(t){u.onerror=u.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+i+": "+o+")");a.type=i,a.request=o,n[1](a)}r[e]=void 0}};var l=setTimeout(function(){a({type:"timeout",target:u})},12e4);u.onerror=u.onload=a,s.appendChild(u)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://zjs-znews.zingcdn.me/zplayer/releases/v1.1.5/",i.oe=function(e){throw console.error(e),e};var o=window.webpackJsonpzPlayer=window.webpackJsonpzPlayer||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var u=a;return i(i.s=32)}([function(e,t,n){var r;"undefined"!=typeof window&&(r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function l(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,l=[],c=a.length;s<c;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&l.push(a[s]);l.length?this._events[o]=1===l.length?l[0]:l:u(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,o,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=i.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var l={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var c=a.path,f=c.substring(0,c.lastIndexOf("/")+1)+o.path;l.path=s.normalizePath(f)}else l.path=a.path,o.params||(l.params=a.params,o.query||(l.query=a.query));return null===l.path&&(l.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var u=t.toString(),l=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var c,f=l[1],h=new RegExp("(\\\\n|\\W)"+a(f)+o,"g");c=h.exec(u);)"dll-reference"!==c[3]&&s[r].push(c[3]);for(h=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");c=h.exec(u);)e[c[2]]||(s[r].push(c[1]),e[c[2]]=n(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var d,p=Object.keys(s),v=0;v<p.length;v++)for(var g=0;g<s[p[v]].length;g++)d=s[p[v]][g],isNaN(1*d)||(s[p[v]][g]=1*s[p[v]][g]);return s}function u(e){return Object.keys(e).reduce(function(t,n){return t||e[n].length>0},!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},o=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};u(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a],c=n[l].pop();if(i[l]=i[l]||{},!i[l][c]&&e[l][c]){i[l][c]=!0,r[l]=r[l]||[],r[l].push(c);for(var f=s(e,e[l][c],l),h=Object.keys(f),d=0;d<h.length;d++)n[h[d]]=n[h[d]]||[],n[h[d]]=n[h[d]].concat(f[h[d]])}}return r}(i,e),a="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"}))(self);";var l=new window.Blob([a],{type:"text/javascript"});if(t.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),f=new window.Worker(c);return f.objectURL=c,f}},"./src/config.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"hlsDefaultConfig",function(){return k}),n.d(t,"mergeConfig",function(){return A}),n.d(t,"enableStreamingMode",function(){return S});var r=n("./src/controller/abr-controller.ts"),i=n("./src/controller/audio-stream-controller.ts"),o=n("./src/controller/audio-track-controller.ts"),a=n("./src/controller/subtitle-stream-controller.ts"),s=n("./src/controller/subtitle-track-controller.ts"),u=n("./src/controller/buffer-controller.ts"),l=n("./src/controller/timeline-controller.ts"),c=n("./src/controller/cap-level-controller.ts"),f=n("./src/controller/fps-controller.ts"),h=n("./src/controller/eme-controller.ts"),d=n("./src/controller/cmcd-controller.ts"),p=n("./src/utils/xhr-loader.ts"),v=n("./src/utils/fetch-loader.ts"),g=n("./src/utils/cues.ts"),y=n("./src/utils/mediakeys-helper.ts"),m=n("./src/utils/logger.ts");function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){T(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=_(_({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:r.default,bufferController:u.default,capLevelController:c.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:y.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:g.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:a.SubtitleStreamController,subtitleTrackController:s.default,timelineController:l.TimelineController,audioStreamController:i.default,audioTrackController:o.default,emeController:h.default,cmcdController:d.default});function A(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return b({},e,t)}function S(e){var t=e.loader;t!==v.default&&t!==p.default?(m.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):Object(v.fetchSupported)()&&(e.loader=v.default,e.progressive=!0,e.enableSoftwareAES=!0,m.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/polyfills/number.ts"),i=n("./src/utils/ewma-bandwidth-estimator.ts"),o=n("./src/events.ts"),a=n("./src/utils/buffer-helper.ts"),s=n("./src/errors.ts"),u=n("./src/types/loader.ts"),l=n("./src/utils/logger.ts");function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new i.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t,n,f,h=e.prototype;return h.registerListeners=function(){var e=this.hls;e.on(o.Events.FRAG_LOADING,this.onFragLoading,this),e.on(o.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(o.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(o.Events.FRAG_LOADING,this.onFragLoading,this),e.off(o.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(o.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},h.onFragLoading=function(e,t){var n,r=t.frag;r.type===u.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(n=t.part)?n:null,this.timer=self.setInterval(this.onCheck,100)))},h.onLevelLoaded=function(e,t){var n=this.hls.config;t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},h._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,n=this.hls,i=n.autoLevelEnabled,s=n.config,u=n.media;if(e&&u){var c=t?t.stats:e.stats,f=t?t.duration:e.duration;if(c.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!u.paused&&u.playbackRate&&u.readyState){var h=performance.now()-c.loading.start,d=Math.abs(u.playbackRate);if(!(h<=500*f/d)){var p=n.levels,v=n.minAutoLevel,g=p[e.level],y=c.total||Math.max(c.loaded,Math.round(f*g.maxBitrate/8)),m=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/h),b=(y-c.loaded)/m,E=u.currentTime,_=(a.BufferHelper.bufferInfo(u,E,s.maxBufferHole).end-E)/d;if(!(_>=2*f/d||b<=_)){var T,k=Number.POSITIVE_INFINITY;for(T=e.level-1;T>v;T--){if((k=f*p[T].maxBitrate/(6.4*m))<_)break}if(!(k>=b)){var A=this.bwEstimator.getEstimate();l.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+T+"\n      Current BW estimate: "+(Object(r.isFiniteNumber)(A)?(A/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+b.toFixed(3)+" s\n      Estimated load time for the next fragment: "+k.toFixed(3)+" s\n      Time to underbuffer: "+_.toFixed(3)+" s"),n.nextLoadLevel=T,this.bwEstimator.sample(h,c.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),n.trigger(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:c})}}}}}},h.onFragLoaded=function(e,t){var n=t.frag,i=t.part;if(n.type===u.PlaylistLevelType.MAIN&&Object(r.isFiniteNumber)(n.sn)){var a=i?i.stats:n.stats,s=i?i.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[n.level],c=(l.loaded?l.loaded.bytes:0)+a.loaded,f=(l.loaded?l.loaded.duration:0)+s;l.loaded={bytes:c,duration:f},l.realBitrate=Math.round(8*c/f)}if(n.bitrateTest){var h={stats:a,frag:n,part:i,id:n.type};this.onFragBuffered(o.Events.FRAG_BUFFERED,h),n.bitrateTest=!1}}},h.onFragBuffered=function(e,t){var n=t.frag,r=t.part,i=r?r.stats:n.stats;if(!i.aborted&&n.type===u.PlaylistLevelType.MAIN&&"initSegment"!==n.sn){var o=i.parsing.end-i.loading.start;this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},h.onError=function(e,t){switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},h.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},h.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,n=this.hls,r=n.maxAutoLevel,i=n.config,o=n.minAutoLevel,s=n.media,u=t?t.duration:e?e.duration:0,c=s?s.currentTime:0,f=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,d=(a.BufferHelper.bufferInfo(s,c,i.maxBufferHole).end-c)/f,p=this.findBestLevel(h,o,r,d,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(p>=0)return p;l.logger.trace((d?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=u?Math.min(u,i.maxStarvationDelay):i.maxStarvationDelay,g=i.abrBandWidthFactor,y=i.abrBandWidthUpFactor;if(!d){var m=this.bitrateTestDelay;if(m)v=(u?Math.min(u,i.maxLoadingDelay):i.maxLoadingDelay)-m,l.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=y=1}return p=this.findBestLevel(h,o,r,d+v,g,y),Math.max(p,0)},h.findBestLevel=function(e,t,n,r,i,o){for(var a,s=this.fragCurrent,u=this.partCurrent,c=this.lastLoadedFragLevel,f=this.hls.levels,h=f[c],d=!(null==h||null===(a=h.details)||void 0===a||!a.live),p=null==h?void 0:h.codecSet,v=u?u.duration:s?s.duration:0,g=n;g>=t;g--){var y=f[g];if(y&&(!p||y.codecSet===p)){var m=y.details,b=(u?null==m?void 0:m.partTarget:null==m?void 0:m.averagetargetduration)||v,E=void 0;E=g<=c?i*e:o*e;var _=f[g].maxBitrate,T=_*b/E;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(E)+"/"+_+"/"+b+"/"+r+"/"+T),E>_&&(!T||d&&!this.bitrateTestDelay||T<r))return g}}return-1},t=e,(n=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this.getNextABRAutoLevel();return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}}])&&c(t.prototype,n),f&&c(t,f),e}();t.default=f},"./src/controller/audio-stream-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),o=n("./src/events.ts"),a=n("./src/utils/buffer-helper.ts"),s=n("./src/controller/fragment-tracker.ts"),u=n("./src/types/level.ts"),l=n("./src/types/loader.ts"),c=n("./src/loader/fragment.ts"),f=n("./src/demux/chunk-cache.ts"),h=n("./src/demux/transmuxer-interface.ts"),d=n("./src/types/transmuxer.ts"),p=n("./src/controller/fragment-finders.ts"),v=n("./src/utils/discontinuities.ts"),g=n("./src/errors.ts"),y=n("./src/utils/logger.ts");function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){var t,n;function E(t,n){var r;return(r=e.call(this,t,n,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r._registerListeners(),r}n=e,(t=E).prototype=Object.create(n.prototype),t.prototype.constructor=t,b(t,n);var _=E.prototype;return _.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},_._registerListeners=function(){var e=this.hls;e.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(o.Events.ERROR,this.onError,this),e.on(o.Events.BUFFER_RESET,this.onBufferReset,this),e.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function(){var e=this.hls;e.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(o.Events.ERROR,this.onError,this),e.off(o.Events.BUFFER_RESET,this.onBufferReset,this),e.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onInitPtsFound=function(e,t){var n=t.frag,r=t.id,o=t.initPTS;if("main"===r){var a=n.cc;this.initPTS[n.cc]=o,this.log("InitPTS for cc: "+a+" found from main: "+o),this.videoTrackCC=a,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},_.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=i.State.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},_.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var t,n=this.levels,r=this.trackId,o=null==n?void 0:null===(t=n[r])||void 0===t?void 0:t.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var s,u=performance.now(),l=this.retryDate;(!l||u>=l||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var c=this.waitingData;if(c){var f=c.frag,h=c.part,d=c.cache,v=c.complete;if(void 0!==this.initPTS[f.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var g={frag:f,part:h,payload:d.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&e.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)y.logger.log("Waiting fragment cc ("+f.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var m=this.getLoadPosition(),b=a.BufferHelper.bufferInfo(this.mediaBuffer,m,this.config.maxBufferHole);Object(p.fragmentWithinToleranceTest)(b.end,this.config.maxFragLookUpTolerance,f)<0&&(y.logger.log("Waiting fragment cc ("+f.cc+") @ "+f.start+" cancelled because another fragment at "+b.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},_.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},_.onTickEnd=function(){var e=this.media;if(e&&e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length&&(this.loadedmetadata=!0),this.lastCurrentTime=e.currentTime}},_.doTickIdle=function(){var e,t,n=this.hls,r=this.levels,a=this.media,s=this.trackId,u=n.config;if(r&&r[s]&&(a||!this.startFragRequested&&u.startFragPrefetch)){var f=r[s].details;if(!f||f.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(f))this.state=i.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,l.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,l.PlaylistLevelType.AUDIO);if(null!==h){var d=h.len,p=this.getMaxBufferLength(),v=this.audioSwitch;if(!(d>=p)||v){if(!v&&this._streamEnded(h,f))return n.trigger(o.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var g=f.fragments[0].start,y=h.end;if(v){var m=this.getLoadPosition();y=m,f.PTSKnown&&m<g&&(h.end>g||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=g+.05)}var b=this.getNextFragment(y,f);b?"identity"!==(null===(e=b.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=b.decryptdata)&&void 0!==t&&t.key?this.loadFragment(b,f,y):this.loadKey(b,f):this.bufferFlushed=!0}}}}},_.getMaxBufferLength=function(){var t=e.prototype.getMaxBufferLength.call(this),n=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,l.PlaylistLevelType.MAIN);return null===n?t:Math.max(t,n.len)},_.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},_.onAudioTracksUpdated=function(e,t){var n=t.audioTracks;this.resetTransmuxer(),this.levels=n.map(function(e){return new u.Level(e)})},_.onAudioTrackSwitching=function(e,t){var n=!!t.url;this.trackId=t.id;var r=this.fragCurrent;null!=r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},_.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},_.onLevelLoaded=function(e,t){this.mainDetails=t.details},_.onAudioTrackLoaded=function(e,t){var n,r=this.levels,o=t.details,a=t.id;if(r){this.log("Track "+a+" loaded ["+o.startSN+","+o.endSN+"],duration:"+o.totalduration);var s=r[a],u=0;if(o.live||null!==(n=s.details)&&void 0!==n&&n.live){var l=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!l)return;!s.details&&o.hasProgramDateTime&&l.hasProgramDateTime?(Object(v.alignMediaPlaylistByPDT)(o,l),u=o.fragments[0].start):u=this.alignPlaylists(o,s.details)}s.details=o,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(s.details,u),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(o)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+a)},_._handleFragmentLoadProgress=function(e){var t,n=e.frag,r=e.part,o=e.payload,a=this.config,s=this.trackId,u=this.levels;if(u){var c=u[s];console.assert(c,"Audio track is defined on fragment load progress");var p=c.details;console.assert(p,"Audio track details are defined on fragment load progress");var v=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new h.default(this.hls,l.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[n.cc],b=null===(t=n.initSegment)||void 0===t?void 0:t.data;if(void 0!==m){var E=r?r.index:-1,_=-1!==E,T=new d.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,o.byteLength,E,_);g.push(o,b,v,"",n,r,p.totalduration,!1,T,m)}else{y.logger.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+s),(this.waitingData=this.waitingData||{frag:n,part:r,cache:new f.default,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},_._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},_.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_.onBufferCreated=function(e,t){var n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},_.onFragBuffered=function(e,t){var n=t.frag,r=t.part;n.type===l.PlaylistLevelType.AUDIO&&(this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,r)))},_.onError=function(t,n){switch(n.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.AUDIO,n);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=n.fatal?i.State.ERROR:i.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===n.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var r=!0,o=this.getFwdBufferInfo(this.mediaBuffer,l.PlaylistLevelType.AUDIO);o&&o.len>.5&&(r=!this.reduceMaxBufferLength(o.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},_.onBufferFlushed=function(e,t){t.type===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},_._handleTransmuxComplete=function(e){var t,n="audio",r=this.hls,a=e.remuxResult,s=e.chunkMeta,u=this.getCurrentContext(s);if(!u)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(s.level);var l=u.frag,f=u.part,h=a.audio,d=a.text,p=a.id3,v=a.initSegment;if(!this.fragContextChanged(l)){if(this.state=i.State.PARSING,this.audioSwitch&&h&&this.completeAudioSwitch(),null!=v&&v.tracks&&(this._bufferInitSegment(v.tracks,l,s),r.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:n,tracks:v.tracks})),h){var g=h.startPTS,y=h.endPTS,b=h.startDTS,E=h.endDTS;f&&(f.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:g,endPTS:y,startDTS:b,endDTS:E}),l.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,g,y,b,E),this.bufferFragmentData(h,l,f,s)}if(null!=p&&null!==(t=p.samples)&&void 0!==t&&t.length){var _=m({frag:l,id:n},p);r.trigger(o.Events.FRAG_PARSING_METADATA,_)}if(d){var T=m({frag:l,id:n},d);r.trigger(o.Events.FRAG_PARSING_USERDATA,T)}}},_._bufferInitSegment=function(e,t,n){if(this.state===i.State.PARSING){e.video&&delete e.video;var r=e.audio;if(r){r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,e);var a=r.initSegment;if(null!=a&&a.byteLength){var s={type:"audio",frag:t,part:null,chunkMeta:n,parent:t.type,data:a};this.hls.trigger(o.Events.BUFFER_APPENDING,s)}this.tick()}}},_.loadFragment=function(t,n,o){var a=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||a===s.FragmentState.NOT_LOADED||a===s.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t):n.live&&!Object(r.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,o)))},_.completeAudioSwitch=function(){var t=this.hls,n=this.media,r=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:r})},E}(i.default);t.default=E},"./src/controller/audio-track-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts"),i=n("./src/errors.ts"),o=n("./src/controller/base-playlist-controller.ts"),a=n("./src/types/loader.ts");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){var t,n;function o(t){var n;return(n=e.call(this,t,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n);var l,c,f,h=o.prototype;return h.registerListeners=function(){var e=this.hls;e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(r.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(r.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,e.prototype.destroy.call(this)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},h.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},h.onAudioTrackLoaded=function(e,t){var n=t.id,r=t.details,i=this.tracksInGroup[n];if(i){var o=i.details;i.details=t.details,this.log("audioTrack "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,o))}else this.warn("Invalid audio track id "+n)},h.onLevelLoading=function(e,t){this.switchLevel(t.level)},h.onLevelSwitching=function(e,t){this.switchLevel(t.level)},h.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n;var i=this.tracks.filter(function(e){return!n||e.groupId===n});this.selectDefaultTrack&&!i.some(function(e){return e.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var o={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}}},h.onError=function(t,n){e.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===a.PlaylistContextType.AUDIO_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},h.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=t[this.trackId];this.log("Now switching to audio-track index "+e);var i=t[e],o=i.id,a=i.groupId,s=void 0===a?"":a,u=i.name,l=i.type,c=i.url;if(this.trackId=e,this.trackName=u,this.selectDefaultTrack=!1,this.hls.trigger(r.Events.AUDIO_TRACK_SWITCHING,{id:o,groupId:s,name:u,type:l,url:c}),!i.details||i.details.live){var f=this.switchParams(i.url,null==n?void 0:n.details);this.loadPlaylist(f)}}},h.selectInitialTrack=function(){var e=this.tracksInGroup;console.assert(e.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,n=this.findTrackId(t)||this.findTrackId();-1!==n?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},h.findTrackId=function(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1},h.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var n=t.id,i=t.groupId,o=t.url;if(e)try{o=e.addDirectives(o)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(r.Events.AUDIO_TRACK_LOADING,{url:o,id:n,groupId:i,deliveryDirectives:e||null})}},l=o,(c=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])&&s(l.prototype,c),f&&s(l,f),o}(o.default);t.default=l},"./src/controller/base-playlist-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return u});var r=n("./src/polyfills/number.ts"),i=n("./src/types/level.ts"),o=n("./src/controller/level-helper.ts"),a=n("./src/utils/logger.ts"),s=n("./src/errors.ts"),u=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=a.logger.log.bind(a.logger,t+":"),this.warn=a.logger.warn.bind(a.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){t.fatal&&t.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var n=null==t?void 0:t.renditionReports;if(n)for(var o=0;o<n.length;o++){var a=n[o],s=""+a.URI;if(s===e.substr(-s.length)){var u=parseInt(a["LAST-MSN"]),l=parseInt(a["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);void 0!==l&&c>t.partTarget&&(l+=1)}if(Object(r.isFiniteNumber)(u))return new i.HlsUrlParameters(u,Object(r.isFiniteNumber)(l)?l:void 0,i.HlsSkip.No)}}},t.loadPlaylist=function(e){},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,n){var r=this,i=t.details,a=t.stats,s=a.loading.end?Math.max(0,self.performance.now()-a.loading.end):0;if(i.advancedDateTime=Date.now()-s,i.live||null!=n&&n.live){if(i.reloaded(n),n&&this.log("live playlist "+e+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),n&&i.fragments.length>0&&Object(o.mergeDetails)(n,i),!this.canLoad||!i.live)return;var u,l=void 0,c=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var f=this.hls.config.lowLatencyMode,h=i.lastPartSn,d=i.endSN,p=i.lastPartIndex,v=h===d;-1!==p?(l=v?d+1:h,c=v?f?0:p:p+1):l=d+1;var g=i.age,y=g+i.ageHeader,m=Math.min(y-i.partTarget,1.5*i.targetduration);if(m>0){if(n&&m>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+m+" with playlist age: "+i.age),m=0;else{var b=Math.floor(m/i.targetduration);if(l+=b,void 0!==c)c+=Math.round(m%i.targetduration/i.partTarget);this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+m+" skip sn "+b+" to part "+c)}i.tuneInGoal=m}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,l,c),f||!v)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(i,t.deliveryDirectives,l,c);var E=Object(o.computeReloadInterval)(i,a);void 0!==l&&i.canBlockReload&&(E-=i.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(E)+" ms"),this.timer=self.setTimeout(function(){return r.loadPlaylist(u)},E)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,n,r){var o=Object(i.getSkipValue)(e,n);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,o=i.HlsSkip.No),new i.HlsUrlParameters(n,r,o)},t.retryLoadingOrFail=function(e){var t,n=this,r=this.hls.config,i=this.retryCount<r.levelLoadingMaxRetry;if(i)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var o=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return n.loadPlaylist()},o),this.warn("retry playlist loading #"+this.retryCount+" in "+o+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return i},e}()},"./src/controller/base-stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"State",function(){return _}),n.d(t,"default",function(){return T});var r=n("./src/polyfills/number.ts"),i=n("./src/task-loop.ts"),o=n("./src/controller/fragment-tracker.ts"),a=n("./src/utils/buffer-helper.ts"),s=n("./src/utils/logger.ts"),u=n("./src/events.ts"),l=n("./src/errors.ts"),c=n("./src/types/transmuxer.ts"),f=n("./src/utils/mp4-tools.ts"),h=n("./src/utils/discontinuities.ts"),d=n("./src/controller/fragment-finders.ts"),p=n("./src/controller/level-helper.ts"),v=n("./src/loader/fragment-loader.ts"),g=n("./src/crypt/decrypter.ts"),y=n("./src/utils/time-ranges.ts"),m=n("./src/types/loader.ts");function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},T=function(e){var t,n;function i(t,n,r){var i;return(i=e.call(this)||this).hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=_.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=r,i.log=s.logger.log.bind(s.logger,r+":"),i.warn=s.logger.warn.bind(s.logger,r+":"),i.hls=t,i.fragmentLoader=new v.default(t.config),i.fragmentTracker=n,i.config=t.config,i.decrypter=new g.default(t,t.config),t.on(u.Events.KEY_LOADED,i.onKeyLoaded,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,E(t,n);var T,k,A,S=i.prototype;return S.doTick=function(){this.onTickEnd()},S.onTickEnd=function(){},S.startLoad=function(e){},S.stopLoad=function(){this.fragmentLoader.abort();var e=this.fragCurrent;e&&this.fragmentTracker.removeFragment(e),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=_.STOPPED},S._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&n.sn>=t.endSN&&!e.nextStart){var i=t.partList;if(null!=i&&i.length){var s=i[i.length-1];return a.BufferHelper.isBuffered(this.media,s.start+s.duration/2)}var u=r.getState(n);return u===o.FragmentState.PARTIAL||u===o.FragmentState.OK}return!1},S.onMediaAttached=function(e,t){var n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.state===_.STOPPED&&this.startLoad(r.startPosition)},S.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},S.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,n=this.media,i=this.mediaBuffer,o=this.state,s=n?n.currentTime:0,u=a.BufferHelper.bufferInfo(i||n,s,e.maxBufferHole);if(this.log("media seeking to "+(Object(r.isFiniteNumber)(s)?s.toFixed(3):s)+", state: "+o),o===_.ENDED)this.resetLoadingState();else if(t&&!u.len){var l=e.maxFragLookUpTolerance,c=t.start-l,f=s>t.start+t.duration+l;(s<c||f)&&(f&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.resetLoadingState())}n&&(this.lastCurrentTime=s),this.loadedmetadata||u.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()},S.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},S.onKeyLoaded=function(e,t){if(this.state===_.KEY_LOADING&&t.frag===this.fragCurrent&&this.levels){this.state=_.IDLE;var n=this.levels[t.frag.level].details;n&&this.loadFragment(t.frag,n,t.frag.start)}},S.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},S.onHandlerDestroyed=function(){this.state=_.STOPPED,this.hls.off(u.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},S.loadKey=function(e,t){this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=_.KEY_LOADING,this.fragCurrent=e,this.hls.trigger(u.Events.KEY_LOADING,{frag:e})},S.loadFragment=function(e,t,n){this._loadFragForPlayback(e,t,n)},S._loadFragForPlayback=function(e,t,n){var r=this;this._doFragLoad(e,t,n,function(t){if(r.fragContextChanged(e))return r.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void r.fragmentTracker.removeFragment(e);e.stats.chunkCount++,r._handleFragmentLoadProgress(t)}).then(function(t){if(t){r.fragLoadError=0;var n=r.state;if(!r.fragContextChanged(e))return"payload"in t&&(r.log("Loaded fragment "+e.sn+" of level "+e.level),r.hls.trigger(u.Events.FRAG_LOADED,t),r.state===_.BACKTRACKING)?(r.fragmentTracker.backtrack(e,t),void r.resetFragmentLoading(e)):void r._handleFragmentLoadComplete(t);(n===_.FRAG_LOADING||n===_.BACKTRACKING||!r.fragCurrent&&n===_.PARSING)&&(r.fragmentTracker.removeFragment(e),r.state=_.IDLE)}}).catch(function(t){r.warn(t),r.resetFragmentLoading(e)})},S.flushMainBuffer=function(e,t,n){if(void 0===n&&(n=null),e-t){var r={startOffset:e,endOffset:t,type:n};this.fragLoadError=0,this.hls.trigger(u.Events.BUFFER_FLUSHING,r)}},S._loadInitSegment=function(e){var t=this;this._doFragLoad(e).then(function(n){if(!n||t.fragContextChanged(e)||!t.levels)throw new Error("init load aborted");return n}).then(function(n){var r=t.hls,i=n.payload,o=e.decryptdata;if(i&&i.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){var a=self.performance.now();return t.decrypter.webCryptoDecrypt(new Uint8Array(i),o.key.buffer,o.iv.buffer).then(function(t){var i=self.performance.now();return r.trigger(u.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:a,tdecrypt:i}}),n.payload=t,n})}return n}).then(function(n){var r=t.fragCurrent,i=t.hls,o=t.levels;if(!o)throw new Error("init load aborted, missing levels");var a=o[e.level].details;console.assert(a,"Level details are defined when init segment is loaded");var s=e.stats;t.state=_.IDLE,t.fragLoadError=0,e.data=new Uint8Array(n.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),n.frag===r&&i.trigger(u.Events.FRAG_BUFFERED,{stats:s,frag:r,part:null,id:e.type}),t.tick()}).catch(function(n){t.warn(n),t.resetFragmentLoading(e)})},S.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},S.fragBufferedComplete=function(e,t){var n=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" "+y.default.toString(a.BufferHelper.getBuffered(n))),this.state=_.IDLE,this.tick()},S._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var n=e.frag,r=e.part,i=e.partsLoaded,o=!i||0===i.length||i.some(function(e){return!e}),a=new c.ChunkMetadata(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}},S._handleFragmentLoadProgress=function(e){},S._doFragLoad=function(e,t,n,i){var o=this;if(void 0===n&&(n=null),!this.levels)throw new Error("frag load aborted, missing levels");if(n=Math.max(e.start,n||0),this.config.lowLatencyMode&&t){var a=t.partList;if(a&&i){n>e.end&&t.fragmentHint&&(e=t.fragmentHint);var s=this.getNextPart(a,e,n);if(s>-1){var l=a[s];return this.log("Loading part sn: "+e.sn+" p: "+l.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+s+"-"+(a.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=l.start+l.duration,this.state=_.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,part:a[s],targetBufferTime:n}),this.doFragPartsLoad(e,a,s,i).catch(function(e){return o.handleFragLoadError(e)})}if(!e.url||this.loadedEndOfParts(a,n))return Promise.resolve(null)}}return this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(n.toFixed(3))),Object(r.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=_.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragmentLoader.load(e,i).catch(function(e){return o.handleFragLoadError(e)})},S.doFragPartsLoad=function(e,t,n,r){var i=this;return new Promise(function(o,a){var s=[];!function n(l){var c=t[l];i.fragmentLoader.loadPart(e,c,r).then(function(r){s[c.index]=r;var a=r.part;i.hls.trigger(u.Events.FRAG_LOADED,r);var f=t[l+1];if(!f||f.fragment!==e)return o({frag:e,part:a,partsLoaded:s});n(l+1)}).catch(a)}(n)})},S.handleFragLoadError=function(e){var t=e.data;return t&&t.details===l.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(u.Events.ERROR,t),null},S._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===_.PARSING){var n=t.frag,r=t.part,i=t.level,o=self.performance.now();n.stats.parsing.end=o,r&&(r.stats.parsing.end=o),this.updateLevelTiming(n,r,i,e.partial)}else this.fragCurrent||(this.state=_.IDLE)},S.getCurrentContext=function(e){var t=this.levels,n=e.level,r=e.sn,i=e.part;if(!t||!t[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var o=t[n],a=i>-1?Object(p.getPartWith)(o,r,i):null,s=a?a.fragment:Object(p.getFragmentWithSN)(o,r,this.fragCurrent);return s?{frag:s,part:a,level:o}:null},S.bufferFragmentData=function(e,t,n,r){if(e&&this.state===_.PARSING){var i=e.data1,o=e.data2,a=i;if(i&&o&&(a=Object(f.appendUint8Array)(i,o)),a&&a.length){var s={type:e.type,frag:t,part:n,chunkMeta:r,parent:t.type,data:a};this.hls.trigger(u.Events.BUFFER_APPENDING,s),e.dropped&&e.independent&&!n&&this.flushBufferGap(t)}}},S.flushBufferGap=function(e){var t=this.media;if(t)if(a.BufferHelper.isBuffered(t,t.currentTime)){var n=t.currentTime,r=a.BufferHelper.bufferInfo(t,n,0),i=e.duration,o=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),s=Math.max(Math.min(e.start-o,r.end-o),n+o);e.start-s>o&&this.flushMainBuffer(s,e.start)}else this.flushMainBuffer(0,e.start)},S.getFwdBufferInfo=function(e,t){var n=this.config,i=this.getLoadPosition();if(!Object(r.isFiniteNumber)(i))return null;var o=a.BufferHelper.bufferInfo(e,i,n.maxBufferHole);if(0===o.len&&void 0!==o.nextStart){var s=this.fragmentTracker.getBufferedFrag(i,t);if(s&&o.nextStart<s.end)return a.BufferHelper.bufferInfo(e,i,Math.max(o.nextStart,n.maxBufferHole))}return o},S.getMaxBufferLength=function(e){var t,n=this.config;return t=e?Math.max(8*n.maxBufferSize/e,n.maxBufferLength):n.maxBufferLength,Math.min(t,n.maxMaxBufferLength)},S.reduceMaxBufferLength=function(e){var t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},S.getNextFragment=function(e,t){var n,r,i=t.fragments,o=i.length;if(!o)return null;var a,s=this.config,u=i[0].start;if(t.live){var l=s.initialLiveManifestSize;if(o<l)return this.warn("Not enough fragments to start playback (have: "+o+", need: "+l+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(a=this.getInitialLiveFragment(t,i),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=u&&(a=i[0]);if(!a){var c=s.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,c,t)}return null===(n=a)||void 0===n||!n.initSegment||null!==(r=a)&&void 0!==r&&r.initSegment.data||this.bitrateTest||(a=a.initSegment),a},S.getNextPart=function(e,t,n){for(var r=-1,i=!1,o=!0,a=0,s=e.length;a<s;a++){var u=e[a];if(o=o&&!u.independent,r>-1&&n<u.start)break;var l=u.loaded;!l&&(i||u.independent||o)&&u.fragment===t&&(r=a),i=l}return r},S.loadedEndOfParts=function(e,t){var n=e[e.length-1];return n&&t>n.start&&n.loaded},S.getInitialLiveFragment=function(e,t){var n=this.fragPrevious,r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),r=Object(d.findFragmentByPDT)(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){var i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){var o=t[i-e.startSN];n.cc===o.cc&&(r=o,this.log("Live playlist, switching playlist, load frag with next SN: "+r.sn))}r||(r=Object(d.findFragWithCC)(t,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+r.sn)}}else{var a=this.hls.liveSyncPosition;null!==a&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r},S.getFragmentAtPosition=function(e,t,n){var r,i=this.config,a=this.fragPrevious,s=n.fragments,u=n.endSN,l=n.fragmentHint,c=i.maxFragLookUpTolerance,f=!!(i.lowLatencyMode&&n.partList&&l);if(f&&l&&!this.bitrateTest&&(s=s.concat(l),u=l.sn),e<t){var h=e>t-c?0:c;r=Object(d.findFragmentByPTS)(a,s,e,h)}else r=s[s.length-1];if(r){var p=r.sn-n.startSN,v=a&&r.level===a.level,g=s[p+1];if(this.fragmentTracker.getState(r)===o.FragmentState.BACKTRACKED){r=null;for(var y=p;s[y]&&this.fragmentTracker.getState(s[y])===o.FragmentState.BACKTRACKED;)r=a?s[y--]:s[--y];r||(r=g)}else a&&r.sn===a.sn&&!f&&v&&(r.sn<u&&this.fragmentTracker.getState(g)!==o.FragmentState.OK?(this.log("SN "+r.sn+" just loaded, load next one: "+g.sn),r=g):r=null)}return r},S.synchronizeToLiveEdge=function(e){var t=this.config,n=this.media;if(n){var r=this.hls.liveSyncPosition,i=n.currentTime,o=e.fragments[0].start,a=e.edge,s=i>=o-t.maxFragLookUpTolerance&&i<=a;if(null!==r&&n.duration>r&&(i<r||!s)){var u=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!s&&n.readyState<4||i<a-u)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+r.toFixed(3)),n.currentTime=r))}}},S.alignPlaylists=function(e,t){var n=this.levels,i=this.levelLastLoaded,o=this.fragPrevious,a=null!==i?n[i]:null,s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var u=e.fragments[0].start,l=!t,c=e.alignedSliding&&Object(r.isFiniteNumber)(u);if(l||!c&&!u){Object(h.alignStream)(o,a,e);var f=e.fragments[0].start;return this.log("Live playlist sliding: "+f.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+s),f}return u},S.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},S.setStartPosition=function(e,t){var n=this.startPosition;if(n<t&&(n=-1),-1===n||-1===this.lastCurrentTime){var i=e.startTimeOffset;Object(r.isFiniteNumber)(i)?(n=t+i,i<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+n),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},S.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},S.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},S.resetFragmentLoading=function(e){this.fragCurrent&&this.fragContextChanged(e)||(this.state=_.IDLE)},S.onFragmentOrKeyLoadError=function(e,t){if(!t.fatal){var n=t.frag;if(n&&n.type===e){var r=this.fragCurrent;console.assert(r&&n.sn===r.sn&&n.level===r.level&&n.urlId===r.urlId,"Frag load error must match current frag to retry");var i=this.config;if(this.fragLoadError+1<=i.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(n.level))return;var o=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);this.warn("Fragment "+n.sn+" of "+e+" "+n.level+" failed to load, retrying in "+o+"ms"),this.retryDate=self.performance.now()+o,this.fragLoadError++,this.state=_.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===m.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=_.IDLE):(s.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=_.ERROR)}}},S.afterBufferFlushed=function(e,t,n){if(e){var r=a.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===_.ENDED&&this.resetLoadingState()}},S.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=_.IDLE},S.resetLiveStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},S.updateLevelTiming=function(e,t,n,r){var i=this,o=n.details;console.assert(!!o,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce(function(t,a){var s=e.elementaryStreams[a];if(s){var l=s.endPTS-s.startPTS;if(l<=0)return i.warn("Could not parse fragment "+e.sn+" "+a+" duration reliably ("+l+") resetting transmuxer to fallback to playlist timing"),i.resetTransmuxer(),t||!1;var c=r?0:Object(p.updateFragPTSDTS)(o,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return i.hls.trigger(u.Events.LEVEL_PTS_UPDATED,{details:o,level:n,drift:c,type:a,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t},!1)?(this.state=_.PARSED,this.hls.trigger(u.Events.FRAG_PARSED,{frag:e,part:t})):this.resetLoadingState()},S.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},T=i,(k=[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])&&b(T.prototype,k),A&&b(T,A),i}(i.default)},"./src/controller/buffer-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),o=n("./src/utils/logger.ts"),a=n("./src/errors.ts"),s=n("./src/utils/buffer-helper.ts"),u=n("./src/utils/mediasource-helper.ts"),l=n("./src/loader/fragment.ts"),c=n("./src/controller/buffer-operation-queue.ts"),f=Object(u.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,d=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.hls,n=t.media,r=t.mediaSource;o.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),e.trigger(i.Events.MEDIA_ATTACHED,{media:n})),r&&r.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){o.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){o.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null},t.registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.BUFFER_RESET,this.onBufferReset,this),e.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(i.Events.BUFFER_EOS,this.onBufferEos,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(i.Events.FRAG_PARSED,this.onFragParsed,this),e.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.BUFFER_RESET,this.onBufferReset,this),e.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(i.Events.BUFFER_EOS,this.onBufferEos,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(i.Events.FRAG_PARSED,this.onFragParsed,this),e.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},t.onManifestParsed=function(e,t){var n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,o.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var n=this.media=t.media;if(n&&f){var r=this.mediaSource=new f;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,n=this._objectUrl;if(t){if(o.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){o.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):o.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var n=e.sourceBuffer[t];try{n&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(n),e.sourceBuffer[t]=void 0)}catch(e){o.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",e)}}),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var n=this,r=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(e){if(r){var i=n.tracks[e];if(i&&"function"==typeof i.buffer.changeType){var o=t[e],a=o.codec,s=o.levelCodec,u=o.container;if((i.levelCodec||i.codec).replace(h,"$1")!==(s||a).replace(h,"$1")){var l=u+";codecs="+(s||a);n.appendChangeType(e,l)}}}else n.pendingTracks[e]=t[e]}),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var n=this,r=this.operationQueue,i={execute:function(){var i=n.sourceBuffer[e];i&&(o.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),i.changeType(t)),r.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){o.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};r.append(i,e)},t.onBufferAppending=function(e,t){var n=this,r=this.hls,u=this.operationQueue,l=this.tracks,c=t.data,f=t.type,h=t.frag,d=t.part,p=t.chunkMeta,v=p.buffering[f],g=self.performance.now();v.start=g;var y=h.stats.buffering,m=d?d.stats.buffering:null;0===y.start&&(y.start=g),m&&0===m.start&&(m.start=g);var b=l.audio,E="audio"===f&&1===p.id&&"audio/mpeg"===(null==b?void 0:b.container),_={execute:function(){if(v.executeStart=self.performance.now(),E){var e=n.sourceBuffer[f];if(e){var t=h.start-e.timestampOffset;Math.abs(t)>=.1&&(o.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+t+") sn: "+h.sn+")"),e.timestampOffset=h.start)}}n.appendExecutor(c,f)},onStart:function(){},onComplete:function(){var e=self.performance.now();v.executeEnd=v.end=e,0===y.first&&(y.first=e),m&&0===m.first&&(m.first=e);var t=n.sourceBuffer,r={};for(var o in t)r[o]=s.BufferHelper.getBuffered(t[o]);n.appendError=0,n.hls.trigger(i.Events.BUFFER_APPENDED,{type:f,frag:h,part:d,chunkMeta:p,parent:h.type,timeRanges:r})},onError:function(e){o.logger.error("[buffer-controller]: Error encountered while trying to append to the "+f+" SourceBuffer",e);var t={type:a.ErrorTypes.MEDIA_ERROR,parent:h.type,details:a.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=a.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,t.details=a.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(o.logger.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),r.trigger(i.Events.ERROR,t)}};u.append(_,f)},t.onBufferFlushing=function(e,t){var n=this,r=this.operationQueue,a=function(e){return{execute:n.removeExecutor.bind(n,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(i.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){o.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?r.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(function(e){r.append(a(e),e)})},t.onFragParsed=function(e,t){var n=this,r=t.frag,a=t.part,s=[],u=a?a.elementaryStreams:r.elementaryStreams;u[l.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(u[l.ElementaryStreamTypes.AUDIO]&&s.push("audio"),u[l.ElementaryStreamTypes.VIDEO]&&s.push("video"));0===s.length&&o.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers(function(){var e=self.performance.now();r.stats.buffering.end=e,a&&(a.stats.buffering.end=e);var t=a?a.stats:r.stats;n.hls.trigger(i.Events.FRAG_BUFFERED,{frag:r,part:a,stats:t,id:r.type})},s)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var n=this;this.getSourceBufferTypes().reduce(function(e,r){var i=n.sourceBuffer[r];return t.type&&t.type!==r||i&&!i.ended&&(i.ended=!0,o.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),e&&!(i&&!i.ended)},!0)&&this.blockBuffers(function(){var e=n.mediaSource;e&&"open"===e.readyState&&e.endOfStream()})},t.onLevelUpdated=function(e,t){var n=t.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,n=this.media,o=this.sourceBuffer;if(n&&null!==t){var a=this.getSourceBufferTypes();if(a.length){var u=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(r.isFiniteNumber)(u)&&!(u<0)){var l=n.currentTime,c=t.levelTargetDuration,f=Math.max(u,c),h=Math.floor(l/c)*c-f;a.forEach(function(n){var r=o[n];if(r){var a=s.BufferHelper.getBuffered(r);a.length>0&&h>a.start(0)&&(e.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live&&e.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),e.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:n}))}})}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,n=this.media,i=this.mediaSource,a=e.fragments[0].start+e.totalduration,s=n.duration,u=Object(r.isFiniteNumber)(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(o.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(a>u&&a>s||!Object(r.isFiniteNumber)(s))&&(o.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),i.duration=a)}},t.updateSeekableRange=function(e){var t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&null!=t&&t.setLiveSeekableRange){var r=Math.max(0,n[0].start),i=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,i)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,n=this.pendingTracks,r=Object.keys(n).length;if(r&&!e||2===r){this.createSourceBuffers(n),this.pendingTracks={};var o=this.getSourceBufferTypes();if(0===o.length)return void this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});o.forEach(function(e){t.executeNext(e)})}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var s in e)if(!t[s]){var u=e[s];if(!u)throw Error("source buffer exists for track "+s+", however track does not");var l=u.levelCodec||u.codec,c=u.container+";codecs="+l;o.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var f=t[s]=n.addSourceBuffer(c),h=s;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[s]={buffer:f,codec:l,container:u.container,levelCodec:u.levelCodec,id:u.id},r++}catch(e){o.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:c})}}r&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){o.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(e);n&&n.onError(t)},t.removeExecutor=function(e,t,n){var i=this.media,a=this.mediaSource,s=this.operationQueue,u=this.sourceBuffer[e];if(!i||!a||!u)return o.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void s.shiftAndExecuteNext(e);var l=Object(r.isFiniteNumber)(i.duration)?i.duration:1/0,c=Object(r.isFiniteNumber)(a.duration)?a.duration:1/0,f=Math.max(0,t),h=Math.min(n,l,c);h>f?(o.logger.log("[buffer-controller]: Removing ["+f+","+h+"] from the "+e+" SourceBuffer"),console.assert(!u.updating,e+" sourceBuffer must not be updating"),u.remove(f,h)):s.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var n=this.operationQueue,r=this.sourceBuffer[t];if(!r)return o.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(t);r.ended=!1,console.assert(!r.updating,t+" sourceBuffer must not be updating"),r.appendBuffer(e)},t.blockBuffers=function(e,t){var n=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return o.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var r=this.operationQueue,i=t.map(function(e){return r.appendBlocker(e)});Promise.all(i).then(function(){e(),t.forEach(function(e){var t=n.sourceBuffer[e];t&&t.updating||r.shiftAndExecuteNext(e)})})},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,n){var r=this.sourceBuffer[e];if(r){var i=n.bind(this,e);this.listeners[e].push({event:t,listener:i}),r.addEventListener(t,i)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(e){t.removeEventListener(e.event,e.listener)})},e}()},"./src/controller/buffer-operation-queue.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return i});var r=n("./src/utils/logger.ts"),i=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var n=this.queues[t];n.push(e),1===n.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,n=new Promise(function(e){t=e}),r={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,e),n},t.executeNext=function(e){var t=this.buffers,n=this.queues,i=t[e],o=n[e];if(o.length){var a=o[0];try{a.execute()}catch(t){r.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(t),i&&i.updating||(o.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t,n,o,a=e.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(t,n){e.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},a.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null},a.onManifestParsed=function(e,t){var n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(t){var n=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(r,i){return e.isLevelAllowed(i,n.restrictedLevels)&&i<=t});return this.clientRect=null,e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,n){if(!e||!e.length)return-1;for(var r,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=n)&&(r=s,!(i=e[a+1])||r.width!==i.width||r.height!==i.height)){o=a;break}}return o},t=e,o=[{key:"contentScaleFactor",get:function(){var e=1;try{e=self.devicePixelRatio}catch(e){}return e}}],(n=[{key:"mediaWidth",get:function(){return this.getDimensions().width*e.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*e.contentScaleFactor}}])&&i(t.prototype,n),o&&i(t,o),e}();t.default=o},"./src/controller/cmcd-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return h});var r=n("./src/events.ts"),i=n("./src/types/cmcd.ts"),o=n("./src/utils/buffer-helper.ts"),a=n("./src/utils/logger.ts");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var h=function(){function e(t){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(e){try{n.apply(e,{ot:i.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(e){a.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,r=n.hls.levels[t.level],o=n.getObjectType(t),s={d:1e3*t.duration,ot:o};o!==i.CMCDObjectType.VIDEO&&o!==i.CMCDObjectType.AUDIO&&o!=i.CMCDObjectType.MUXED||(s.br=r.bitrate/1e3,s.tb=n.getTopBandwidth(o)/1e3,s.bl=n.getBufferLength(o)),n.apply(e,s)}catch(e){a.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var r=this.config=t.config,o=r.cmcd;null!=o&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=o.sessionId||e.uuid(),this.cid=o.contentId,this.useHeaders=!0===o.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(r.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(r.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var n,r;this.audioBuffer=null===(n=t.tracks.audio)||void 0===n?void 0:n.buffer,this.videoBuffer=null===(r=t.tracks.video)||void 0===r?void 0:r.buffer},t.createData=function(){var e;return{v:i.CMCDVersion,sf:i.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,n){void 0===n&&(n={}),f(n,this.createData());var r=n.ot===i.CMCDObjectType.INIT||n.ot===i.CMCDObjectType.VIDEO||n.ot===i.CMCDObjectType.MUXED;if(this.starved&&r&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering),this.useHeaders){var o=e.toHeaders(n);if(!Object.keys(o).length)return;t.headers||(t.headers={}),f(t.headers,o)}else{var a=e.toQuery(n);if(!a)return;t.url=e.appendQueryToUri(t.url,a)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?i.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?i.CMCDObjectType.INIT:"audio"===t?i.CMCDObjectType.AUDIO:"main"===t?this.hls.audioTracks.length?i.CMCDObjectType.VIDEO:i.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(e){var t,n=0,r=this.hls;if(e===i.CMCDObjectType.AUDIO)t=r.audioTracks;else{var o=r.maxAutoLevel,a=o>-1?o+1:r.levels.length;t=r.levels.slice(0,a)}for(var s,u=l(t);!(s=u()).done;){var c=s.value;c.bitrate>n&&(n=c.bitrate)}return n>0?n:NaN},t.getBufferLength=function(e){var t=this.hls.media,n=e===i.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return n&&t?1e3*o.BufferHelper.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,n=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new n(e)}var r=e.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(e,n,r){t(e),this.loader.load(e,n,r)},u(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,n=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new n(e)}var r=e.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(e,n,r){t(e),this.loader.load(e,n,r)},u(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,n=[],r=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},i=function(e){return Math.round(e)},o=function(e){return 100*i(e/100)},a={br:i,d:i,bl:o,dl:o,mtp:o,nor:function(e){return encodeURIComponent(e)},rtp:o,tb:i},s=l(Object.keys(e||{}).sort());!(t=s()).done;){var u=t.value,c=e[u];if(r(c)&&!("v"===u&&1===c||"pr"==u&&1===c)){var f=a[u];f&&(c=f(c));var h=typeof c,d=void 0;d="ot"===u||"sf"===u||"st"===u?u+"="+c:"boolean"===h?u:"number"===h?u+"="+c:u+"="+JSON.stringify(c),n.push(d)}}return n.join(",")},e.toHeaders=function(t){for(var n={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=0,s=Object.keys(t);a<s.length;a++){var u=s[a];i[null!=o[u]?o[u]:1][u]=t[u]}for(var l=0;l<i.length;l++){var c=e.serialize(i[l]);c&&(n["CMCD-"+r[l]]=c)}return n},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var n=e.includes("?")?"&":"?";return""+e+n+t},e}()},"./src/controller/eme-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts"),i=n("./src/errors.ts"),o=n("./src/utils/logger.ts"),a=n("./src/utils/mediakeys-helper.ts");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(e){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=e,this._config=e.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var t,n,u,l=e.prototype;return l.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},l._registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this)},l._unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this)},l.getLicenseServerUrl=function(e){switch(e){case a.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},l._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n,r){switch(e){case a.KeySystems.WIDEVINE:return function(e,t,n){var r={audioCapabilities:[],videoCapabilities:[]};return e.forEach(function(e){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:n.audioRobustness||""})}),t.forEach(function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:n.videoRobustness||""})}),[r]}(t,n,r);default:throw new Error("Unknown key-system: "+e)}}(e,t,n,this._drmSystemOptions);o.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=s.then(function(t){return r._onMediaKeySystemAccessObtained(e,t)}),s.catch(function(t){o.logger.error('Failed to obtain key-system "'+e+'" access:',t)})},l._onMediaKeySystemAccessObtained=function(e,t){var n=this;o.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(t){return r.mediaKeys=t,o.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t});return i.catch(function(e){o.logger.error("Failed to create media-keys:",e)}),i},l._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},l._onNewMediaKeySession=function(e){var t=this;o.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(n){t._onKeySessionMessage(e,n.message)},!1)},l._onKeySessionMessage=function(e,t){o.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){o.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)})},l.onMediaEncrypted=function(e){var t=this;if(o.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!this.mediaKeysPromise)return o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var n=function(n){t._media&&(t._attemptSetMediaKeys(n),t._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};this.mediaKeysPromise.then(n).catch(n)},l._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});o.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},l._generateRequestWithPreferredKeySession=function(e,t){var n=this,a=this._mediaKeysList[0];if(!a)return o.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(a.mediaKeysSessionInitialized)o.logger.warn("Key-Session already initialized but requested again");else{var s=a.mediaKeysSession;if(!s)return o.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return o.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});o.logger.log('Generating key-session request for "'+e+'" init data type'),a.mediaKeysSessionInitialized=!0,s.generateRequest(e,t).then(function(){o.logger.debug("Key-session generation succeeded")}).catch(function(e){o.logger.error("Error generating key-session request:",e),n.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},l._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,r,e),i=void 0}catch(e){o.logger.error(e)}try{r.readyState||r.open("POST",e,!0),i&&i.call(this.hls,r,e)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r},l._onLicenseRequestReadyStageChange=function(e,t,n,a){switch(e.readyState){case 4:if(200===e.status){this._requestLicenseFailureCount=0,o.logger.log("License request succeeded");var s=e.response,u=this._licenseResponseCallback;if(u)try{s=u.call(this.hls,e,t)}catch(e){o.logger.error(e)}a(s)}else{if(o.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var l=3-this._requestLicenseFailureCount+1;o.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(n,a)}}},l._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case a.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},l._requestLicense=function(e,t){o.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return o.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var a=this.getLicenseServerUrl(n.mediaKeySystemDomain),s=this._createLicenseXhr(a,e,t);o.logger.log("Sending license request to URL: "+a);var u=this._generateLicenseRequestChallenge(n,e);s.send(u)}catch(e){o.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},l.onMediaAttached=function(e,t){if(this._emeEnabled){var n=t.media;this._media=n,n.addEventListener("encrypted",this._onMediaEncrypted)}},l.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},l.onManifestParsed=function(e,t){if(this._emeEnabled){var n=t.levels.map(function(e){return e.audioCodec}).filter(function(e){return!!e}),r=t.levels.map(function(e){return e.videoCodec}).filter(function(e){return!!e});this._attemptKeySystemAccess(a.KeySystems.WIDEVINE,n,r)}},t=e,(n=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&s(t.prototype,n),u&&s(t,u),e}();t.default=u},"./src/controller/fps-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts"),i=n("./src/utils/logger.ts"),o=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var n=this.hls.config;if(n.capLevelOnFPSDrop){var r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,n){var o=performance.now();if(t){if(this.lastTime){var a=o-this.lastTime,s=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,l=1e3*s/a,c=this.hls;if(c.trigger(r.Events.FPS_DROP,{currentDropped:s,currentDecoded:u,totalDroppedFrames:n}),l>0&&s>c.config.fpsDroppedMonitoringThreshold*u){var f=c.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=f)&&(f-=1,c.trigger(r.Events.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:c.currentLevel}),c.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=o,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}();t.default=o},"./src/controller/fragment-finders.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"findFragmentByPDT",function(){return o}),n.d(t,"findFragmentByPTS",function(){return a}),n.d(t,"fragmentWithinToleranceTest",function(){return s}),n.d(t,"pdtWithinToleranceTest",function(){return u}),n.d(t,"findFragWithCC",function(){return l});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/binary-search.ts");function o(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(r.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var i=0;i<e.length;++i){var o=e[i];if(u(t,n,o))return o}return null}function a(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var o=null;if(e?o=t[e.sn-t[0].sn+1]||null:0===n&&0===t[0].start&&(o=t[0]),o&&0===s(n,r,o))return o;var a=i.default.search(t,s.bind(null,n,r));return a||o}function s(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function u(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function l(e,t){return i.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}},"./src/controller/fragment-tracker.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"FragmentState",function(){return r}),n.d(t,"FragmentTracker",function(){return a});var r,i=n("./src/events.ts"),o=n("./src/types/loader.ts");!function(e){e.NOT_LOADED="NOT_LOADED",e.BACKTRACKED="BACKTRACKED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK"}(r||(r={}));var a=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){if(t===o.PlaylistLevelType.MAIN){var n=this.activeFragment,r=this.activeParts;if(!n)return null;if(r)for(var i=r.length;i--;){var a=r[i],s=a?a.end:n.appendedPTS;if(a.start<=e&&void 0!==s&&e<=s)return i>9&&(this.activeParts=r.slice(i-9)),a}else if(n.start<=e&&void 0!==n.appendedPTS&&e<=n.appendedPTS)return n}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var n=this.fragments,r=Object.keys(n),i=r.length;i--;){var o=n[r[i]];if((null==o?void 0:o.body.type)===t&&o.buffered){var a=o.body;if(a.start<=e&&e<=a.end)return a}}return null},t.detectEvictedFragments=function(e,t,n){var r=this;Object.keys(this.fragments).forEach(function(i){var o=r.fragments[i];if(o)if(o.buffered){var a=o.range[e];a&&a.time.some(function(e){var n=!r.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&r.removeFragment(o.body),n})}else o.body.type===n&&r.removeFragment(o.body)})},t.detectPartialFragments=function(e){var t=this,n=this.timeRanges,r=e.frag,i=e.part;if(n&&"initSegment"!==r.sn){var o=u(r),a=this.fragments[o];a&&(Object.keys(n).forEach(function(e){var o=r.elementaryStreams[e];if(o){var s=n[e],u=null!==i||!0===o.partial;a.range[e]=t.getBufferedTimes(r,i,u,s)}}),a.backtrack=a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},t.fragBuffered=function(e){var t=u(e),n=this.fragments[t];n&&(n.backtrack=n.loaded=null,n.buffered=!0)},t.getBufferedTimes=function(e,t,n,r){for(var i={time:[],partial:n},o=t?t.start:e.start,a=t?t.end:e.end,s=e.minEndPTS||a,u=e.maxStartPTS||o,l=0;l<r.length;l++){var c=r.start(l)-this.bufferPadding,f=r.end(l)+this.bufferPadding;if(u>=c&&s<=f){i.time.push({startPTS:Math.max(o,r.start(l)),endPTS:Math.min(a,r.end(l))});break}if(o<f&&a>c)i.partial=!0,i.time.push({startPTS:Math.max(o,r.start(l)),endPTS:Math.min(a,r.end(l))});else if(a<=c)break}return i},t.getPartialFragment=function(e){var t,n,r,i=null,o=0,a=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(l){var c=u[l];c&&s(c)&&(n=c.body.start-a,r=c.body.end+a,e>=n&&e<=r&&(t=Math.min(e-n,r-e),o<=t&&(i=c.body,o=t)))}),i},t.getState=function(e){var t=u(e),n=this.fragments[t];return n?n.buffered?s(n)?r.PARTIAL:r.OK:n.backtrack?r.BACKTRACKED:r.APPENDING:r.NOT_LOADED},t.backtrack=function(e,t){var n=u(e),r=this.fragments[n];if(!r||r.backtrack)return null;var i=r.backtrack=t||r.loaded;return r.loaded=null,i},t.getBacktrackData=function(e){var t=u(e),n=this.fragments[t];if(n){var r,i=n.backtrack;if(null!=i&&null!==(r=i.payload)&&void 0!==r&&r.byteLength)return i;this.removeFragment(e)}return null},t.isTimeBuffered=function(e,t,n){for(var r,i,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},t.onFragLoaded=function(e,t){var n=t.frag,r=t.part;if("initSegment"!==n.sn&&!n.bitrateTest&&!r){var i=u(n);this.fragments[i]={body:n,loaded:t,backtrack:null,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var n=this,r=t.frag,i=t.part,a=t.timeRanges;if(r.type===o.PlaylistLevelType.MAIN)if(this.activeFragment=r,i){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(i)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(e){var t=a[e];if(n.detectEvictedFragments(e,t),!i)for(var o=0;o<t.length;o++)r.appendedPTS=Math.max(t.end(o),r.appendedPTS||0)})},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=u(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,n){var r=this;Object.keys(this.fragments).forEach(function(i){var o=r.fragments[i];if(o&&o.buffered){var a=o.body;a.type===n&&a.start<t&&a.end>e&&r.removeFragment(a)}})},t.removeFragment=function(e){var t=u(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function s(e){var t,n;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(n=e.range.audio)||void 0===n?void 0:n.partial))}function u(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"STALL_MINIMUM_DURATION_MS",function(){return s}),n.d(t,"MAX_START_GAP_JUMP",function(){return u}),n.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return l}),n.d(t,"SKIP_BUFFER_RANGE_START",function(){return c}),n.d(t,"default",function(){return f});var r=n("./src/utils/buffer-helper.ts"),i=n("./src/errors.ts"),o=n("./src/events.ts"),a=n("./src/utils/logger.ts"),s=250,u=2,l=.1,c=.05,f=function(){function e(e,t,n,r){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r}var t=e.prototype;return t.destroy=function(){this.hls=this.fragmentTracker=this.media=null},t.poll=function(e){var t=this.config,n=this.media,i=this.stalled,o=n.currentTime,l=n.seeking,c=this.seeking&&!l,f=!this.seeking&&l;if(this.seeking=l,o===e){if((f||c)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&r.BufferHelper.getBuffered(n).length){var h=r.BufferHelper.bufferInfo(n,o,0),d=h.len>0,p=h.nextStart||0;if(d||p){if(l){var v=h.len>u,g=!p||p-o>u&&!this.fragmentTracker.getPartialFragment(o);if(v||g)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var y,m=Math.max(p,h.start||0)-o,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,E=(null==b?void 0:null===(y=b.details)||void 0===y?void 0:y.live)?2*b.details.targetduration:u;if(m>0&&m<=E)return void this._trySkipBufferHole(null)}var _=self.performance.now();if(null!==i){var T=_-i;!l&&T>=s&&this._reportStall(h.len);var k=r.BufferHelper.bufferInfo(n,o,t.maxBufferHole);this._tryFixBufferStall(k,T)}else this.stalled=_}}}else if(this.moved=!0,null!==i){if(this.stallReported){var A=self.performance.now()-i;a.logger.warn("playback not stuck anymore @"+o+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);if(o&&this._trySkipBufferHole(o))return;e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(a.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,a.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(o.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,s=this.media,u=s.currentTime,f=0,h=r.BufferHelper.getBuffered(s),d=0;d<h.length;d++){var p=h.start(d);if(u+t.maxBufferHole>=f&&u<p){var v=Math.max(p+c,s.currentTime+l);return a.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+v),this.moved=!0,this.stalled=null,s.currentTime=v,e&&n.trigger(o.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+v,frag:e}),v}f=h.end(d)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<e.nudgeMaxRetry){var u=r+s*e.nudgeOffset;a.logger.warn("Nudging 'currentTime' from "+r+" to "+u),n.currentTime=u,t.trigger(o.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else a.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(o.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}()},"./src/controller/id3-track-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts"),i=n("./src/utils/texttrack-utils.ts"),o=n("./src/demux/id3.ts"),a=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners()},t._registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t._unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(Object(i.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Object(i.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var n=t.frag,r=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,a=0;a<r.length;a++){var s=o.getID3Frames(r[a].data);if(s){var u=r[a].pts,l=a<r.length-1?r[a+1].pts:n.end;l-u<=0&&(l=u+.25);for(var c=0;c<s.length;c++){var f=s[c];if(!o.isTimeStampFrame(f)){var h=new i(u,l,"");h.value=f,this.id3Track.addCue(h)}}}}}},t.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset,o=t.type;if(!o||"audio"===o){var a=this.id3Track;a&&Object(i.removeCuesInRange)(a,n,r)}},e}();t.default=a},"./src/controller/latency-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return s});var r=n("./src/errors.ts"),i=n("./src/events.ts"),o=n("./src/utils/logger.ts");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t,n,s,u=e.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},u.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(e,t){var n=t.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(e,t){t.details===r.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,o.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var r=this.config,i=r.lowLatencyMode,o=r.maxLiveSyncPlaybackRate;if(i&&1!==o){var a=this.targetLatency;if(null!==a){var s=n-a,u=s<Math.min(this.maxLatency,a+t.targetduration);if(t.live&&u&&s>.05&&this.forwardBufferLength>1){var l=Math.min(2,Math.max(1,o)),c=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;e.playbackRate=Math.min(l,Math.max(1,c))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},u.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},t=e,(n=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,n=e.partHoldBack,r=e.targetduration,i=this.config,o=i.liveSyncDuration,a=i.liveSyncDurationCount,s=i.lowLatencyMode,u=this.hls.userConfig,l=s&&n||t;(u.liveSyncDuration||u.liveSyncDurationCount||0===l)&&(l=void 0!==o?o:a*r);var c=r;return l+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(null===e||null===t||null===n)return null;var r=n.edge,i=e-t-this.edgeStalled,o=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,i),a)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var n=e.buffered.length;return n?e.buffered.end(n-1):t.edge-this.currentTime}}])&&a(t.prototype,n),s&&a(t,s),e}()},"./src/controller/level-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return p});var r=n("./src/types/level.ts"),i=n("./src/events.ts"),o=n("./src/errors.ts"),a=n("./src/utils/codecs.ts"),s=n("./src/controller/level-helper.ts"),u=n("./src/controller/base-playlist-controller.ts"),l=n("./src/types/loader.ts");function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),p=function(e){var t,n;function u(t){var n;return(n=e.call(this,t,"[level-controller]")||this)._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}n=e,(t=u).prototype=Object.create(n.prototype),t.prototype.constructor=t,h(t,n);var p,v,g,y=u.prototype;return y._registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.ERROR,this.onError,this)},y._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.ERROR,this.onError,this)},y.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},y.startLoad=function(){this._levels.forEach(function(e){e.loadError=0}),e.prototype.startLoad.call(this)},y.onManifestLoaded=function(e,t){var n,u,l=[],c=[],f=[],h={},p=!1,v=!1,g=!1;if(t.levels.forEach(function(e){var t=e.attrs;p=p||!(!e.width||!e.height),v=v||!!e.videoCodec,g=g||!!e.audioCodec,d&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var n=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(u=h[n])?u.url.push(e.url):(u=new r.Level(e),h[n]=u,l.push(u)),t&&(t.AUDIO&&Object(s.addGroupId)(u,"audio",t.AUDIO),t.SUBTITLES&&Object(s.addGroupId)(u,"text",t.SUBTITLES))}),(p||v)&&g&&(l=l.filter(function(e){var t=e.videoCodec,n=e.width,r=e.height;return!!t||!(!n||!r)})),l=l.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||Object(a.isCodecSupportedInMp4)(t,"audio"))&&(!n||Object(a.isCodecSupportedInMp4)(n,"video"))}),t.audioTracks&&(c=t.audioTracks.filter(function(e){return!e.audioCodec||Object(a.isCodecSupportedInMp4)(e.audioCodec,"audio")}),Object(s.assignTrackIdsByGroup)(c)),t.subtitles&&(f=t.subtitles,Object(s.assignTrackIdsByGroup)(f)),l.length>0){n=l[0].bitrate,l.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=l;for(var y=0;y<l.length;y++)if(l[y].bitrate===n){this._firstLevel=y,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+n);break}var m=g&&!v,b={levels:l,audioTracks:c,subtitleTracks:f,firstLevel:this._firstLevel,stats:t.stats,audio:g,video:v,altAudio:!m&&c.some(function(e){return!!e.url})};this.hls.trigger(i.Events.MANIFEST_PARSED,b),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},y.onError=function(t,n){if(e.prototype.onError.call(this,t,n),!n.fatal){var r=n.context,i=this._levels[this.currentLevelIndex];if(r&&(r.type===l.PlaylistContextType.AUDIO_TRACK&&i.audioGroupIds&&r.groupId===i.audioGroupIds[i.urlId]||r.type===l.PlaylistContextType.SUBTITLE_TRACK&&i.textGroupIds&&r.groupId===i.textGroupIds[i.urlId]))this.redundantFailover(this.currentLevelIndex);else{var a,s=!1,u=!0;switch(n.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var c=this._levels[n.frag.level];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=n.frag.level)):a=n.frag.level}break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:r&&(r.deliveryDirectives&&(u=!1),a=r.level),s=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:a=n.level,s=!0}void 0!==a&&this.recoverLevel(n,a,s,u)}}},y.recoverLevel=function(e,t,n,r){var i=e.details,o=this._levels[t];if(o.loadError++,n){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(r){var a=o.url.length;if(a>1&&o.loadError<a)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){var s=0===t?this._levels.length-1:t-1;this.currentLevelIndex!==s&&0===this._levels[s].loadError&&(this.warn(i+": switch to "+s),e.levelRetry=!0,this.hls.nextAutoLevel=s)}}},y.redundantFailover=function(e){var t=this._levels[e],n=t.url.length;if(n>1){var r=(t.urlId+1)%n;this.warn("Switching to redundant URL-id "+r),this._levels.forEach(function(e){e.urlId=r}),this.level=e}},y.onFragLoaded=function(e,t){var n=t.frag;if(void 0!==n&&n.type===l.PlaylistLevelType.MAIN){var r=this._levels[n.level];void 0!==r&&(r.fragmentError=0,r.loadError=0)}},y.onLevelLoaded=function(e,t){var n,r,i=t.level,o=t.details,a=this._levels[i];if(!a)return this.warn("Invalid level index "+i),void(null!==(r=t.deliveryDirectives)&&void 0!==r&&r.skip&&(o.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0,this.retryCount=0),this.playlistLoaded(i,t,a.details)):null!==(n=t.deliveryDirectives)&&void 0!==n&&n.skip&&(o.deltaUpdateFailed=!0)},y.onAudioTrackSwitched=function(e,t){var n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=this.hls.audioTracks[t.id].groupId,o=0;o<n.audioGroupIds.length;o++)if(n.audioGroupIds[o]===i){r=o;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},y.loadPlaylist=function(e){var t=this.currentLevelIndex,n=this._levels[t];if(this.canLoad&&n&&n.url.length>0){var r=n.urlId,o=n.url[r];if(e)try{o=e.addDirectives(o)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+r+" "+o),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:o,level:t,id:r,deliveryDirectives:e||null})}},y.removeLevel=function(e,t){var n=function(e,n){return n!==t},r=this._levels.filter(function(r,i){return i!==e||r.url.length>1&&void 0!==t&&(r.url=r.url.filter(n),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(n)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(n)),r.urlId=0,!0)}).map(function(e,t){var n=e.details;return null!=n&&n.fragments&&n.fragments.forEach(function(e){e.level=t}),e});this._levels=r,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:r})},p=u,(v=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,n=this._levels;if(0!==n.length&&(this.currentLevelIndex!==e||null===(t=n[e])||void 0===t||!t.details)){if(e<0||e>=n.length){var r=e<0;if(this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:r,reason:"invalid level idx"}),r)return;e=Math.min(e,n.length-1)}this.clearTimer();var a=this.currentLevelIndex,s=n[a],u=n[e];this.log("switching to level "+e+" from "+a),this.currentLevelIndex=e;var l=c({},u,{level:e,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete l._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,l);var f=u.details;if(!f||f.live){var h=this.switchParams(u.uri,null==s?void 0:s.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&f(p.prototype,v),g&&f(p,g),u}(u.default)},"./src/controller/level-helper.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"addGroupId",function(){return o}),n.d(t,"assignTrackIdsByGroup",function(){return a}),n.d(t,"updatePTS",function(){return s}),n.d(t,"updateFragPTSDTS",function(){return l}),n.d(t,"mergeDetails",function(){return c}),n.d(t,"mapPartIntersection",function(){return f}),n.d(t,"mapFragmentIntersection",function(){return h}),n.d(t,"adjustSliding",function(){return d}),n.d(t,"addSliding",function(){return p}),n.d(t,"computeReloadInterval",function(){return v}),n.d(t,"getFragmentWithSN",function(){return g}),n.d(t,"getPartWith",function(){return y});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts");function o(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function a(e){var t={};e.forEach(function(e){var n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function s(e,t,n){u(e[t],e[n])}function u(e,t){var n=t.startPTS;if(Object(r.isFiniteNumber)(n)){var i,o=0;t.sn>e.sn?(o=n-e.start,i=e):(o=e.start-n,i=t),i.duration!==o&&(i.duration=o)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function l(e,t,n,o,a,s){o-n<=0&&(i.logger.warn("Fragment should have a positive duration",t),o=n+t.duration,s=a+t.duration);var l=n,c=o,f=t.startPTS,h=t.endPTS;if(Object(r.isFiniteNumber)(f)){var d=Math.abs(f-n);Object(r.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,l=Math.max(n,f),n=Math.min(n,f),a=Math.min(a,t.startDTS),c=Math.min(o,h),o=Math.max(o,h),s=Math.max(s,t.endDTS)}t.duration=o-n;var p=n-t.start;t.appendedPTS=o,t.start=t.startPTS=n,t.maxStartPTS=l,t.startDTS=a,t.endPTS=o,t.minEndPTS=c,t.endDTS=s;var v,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;var y=g-e.startSN,m=e.fragments;for(m[y]=t,v=y;v>0;v--)u(m[v],m[v-1]);for(v=y;v<m.length-1;v++)u(m[v],m[v+1]);return e.fragmentHint&&u(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,p}function c(e,t){for(var n=null,o=e.fragments,a=o.length-1;a>=0;a--){var s=o[a].initSegment;if(s){n=s;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var u,c=0;(h(e,t,function(e,i){e.relurl&&(c=e.cc-i.cc),Object(r.isFiniteNumber)(e.startPTS)&&Object(r.isFiniteNumber)(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.appendedPTS=e.appendedPTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(u=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,i.urlId=e.urlId,e.initSegment&&(i.initSegment=e.initSegment,n=e.initSegment)}),n)&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(function(e){var t;e.initSegment&&e.initSegment.relurl!==(null===(t=n)||void 0===t?void 0:t.relurl)||(e.initSegment=n)});if(t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some(function(e){return!e}),t.deltaUpdateFailed)){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=t.skippedSegments;p--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var v=t.fragments;if(c){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<v.length;g++)v[g].cc+=c}t.skippedSegments&&(t.startCC=t.fragments[0].cc),f(e.partList,t.partList,function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),u?l(t,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):d(e,t),v.length&&(t.totalduration=t.edge-v[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var y=t.advancedDateTime;if(t.advanced&&y){var m=t.edge;t.driftStart||(t.driftStartTime=y,t.driftStart=m),t.driftEndTime=y,t.driftEnd=m}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function f(e,t,n){if(e&&t)for(var r=0,i=0,o=e.length;i<=o;i++){var a=e[i],s=t[i+r];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?n(a,s):r--}}function h(e,t,n){for(var r=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,o=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i;l<=o;l++){var c=u[a+l],f=s[l];r&&!f&&l<r&&(f=t.fragments[l]=c),c&&f&&n(c,f)}}function d(e,t){var n=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;n<0||n>=r.length||p(t,r[n].start)}function p(e,t){if(t){for(var n=e.fragments,r=e.skippedSegments;r<n.length;r++)n[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function v(e,t){var n,r=1e3*e.levelTargetDuration,i=r/2,o=e.age,a=o>0&&o<3*r,s=t.loading.end-t.loading.start,u=e.availabilityDelay;if(!1===e.updated)if(a){var l=333*e.misses;n=Math.max(Math.min(i,2*s),l),e.availabilityDelay=(e.availabilityDelay||0)+n}else n=i;else a?(u=Math.min(u||r/2,o),e.availabilityDelay=u,n=u+r-o):n=r-s;return Math.round(n)}function g(e,t,n){if(!e||!e.details)return null;var r=e.details,i=r.fragments[t-r.startSN];return i||((i=r.fragmentHint)&&i.sn===t?i:t<r.startSN&&n&&n.sn===t?n:null)}function y(e,t,n){if(!e||!e.details)return null;var r=e.details.partList;if(r)for(var i=r.length;i--;){var o=r[i];if(o.index===n&&o.fragment.sn===t)return o}return null}},"./src/controller/stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return m});var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),o=n("./src/is-supported.ts"),a=n("./src/events.ts"),s=n("./src/utils/buffer-helper.ts"),u=n("./src/controller/fragment-tracker.ts"),l=n("./src/types/loader.ts"),c=n("./src/loader/fragment.ts"),f=n("./src/demux/transmuxer-interface.ts"),h=n("./src/types/transmuxer.ts"),d=n("./src/controller/gap-controller.ts"),p=n("./src/errors.ts"),v=n("./src/utils/logger.ts");function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){var t,n;function m(t,n){var r;return(r=e.call(this,t,n,"[stream-controller]")||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}n=e,(t=m).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n);var b,E,_,T=m.prototype;return T._registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(a.Events.ERROR,this.onError,this),e.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(a.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(a.Events.ERROR,this.onError,this),e.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(a.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},T.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},T.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},T.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var e,t=this.levels,n=this.level,r=null==t?void 0:null===(e=t[n])||void 0===e?void 0:e.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var o,a=self.performance.now(),s=this.retryDate;(!s||a>=s||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},T.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},T.doTickIdle=function(){var e,t,n=this.hls,r=this.levelLastLoaded,o=this.levels,s=this.media,f=n.config,h=n.nextLoadLevel;if(null!==r&&(s||!this.startFragRequested&&f.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&o&&o[h]){var d=o[h];this.level=n.nextLoadLevel=h;var p=d.details;if(!p||this.state===i.State.WAITING_LEVEL||p.live&&this.levelLastLoaded!==h)this.state=i.State.WAITING_LEVEL;else{var v=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:s,l.PlaylistLevelType.MAIN);if(null!==v)if(!(v.len>=this.getMaxBufferLength(d.maxBitrate))){if(this._streamEnded(v,p)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(a.Events.BUFFER_EOS,g),void(this.state=i.State.ENDED)}var y=v.end,m=this.getNextFragment(y,p);if(this.couldBacktrack&&!this.fragPrevious&&m&&"initSegment"!==m.sn){var b=m.sn-p.startSN;b>1&&(m=p.fragments[b-1],this.fragmentTracker.removeFragment(m))}if(m&&this.fragmentTracker.getState(m)===u.FragmentState.OK&&this.nextLoadPosition>y){var E=this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(s,E,l.PlaylistLevelType.MAIN),m=this.getNextFragment(this.nextLoadPosition,p)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),"identity"!==(null===(e=m.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=m.decryptdata)&&void 0!==t&&t.key?this.loadFragment(m,p,y):this.loadKey(m,p))}}}},T.loadFragment=function(t,n,r){var i,o=this.fragmentTracker.getState(t);if(this.fragCurrent=t,o===u.FragmentState.BACKTRACKED){var a=this.fragmentTracker.getBacktrackData(t);if(a)return this._handleFragmentLoadProgress(a),void this._handleFragmentLoadComplete(a);o=u.FragmentState.NOT_LOADED}o===u.FragmentState.NOT_LOADED||o===u.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,r)):o===u.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(i=this.media)||void 0===i?void 0:i.buffered.length)&&this.fragmentTracker.removeAllFragments()},T.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,l.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},T.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,l.PlaylistLevelType.MAIN)},T.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},T.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},T.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var n,r=this.getAppendedFrag(t.currentTime);if(r&&r.start>1&&this.flushMainBuffer(0,r.start-1),!t.paused&&e){var i=e[this.hls.nextLoadLevel],o=this.fragLastKbps;n=o&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*o)+1:0}else n=0;var a=this.getBufferedFrag(t.currentTime+n);if(a){var s=this.followingBufferedFrag(a);if(s){this.abortCurrentFrag();var u=s.maxStartPTS?s.maxStartPTS:s.start,l=s.duration,c=Math.max(a.end,u+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,.5*l),.75*l));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}},T.abortCurrentFrag=function(){var e=this.fragCurrent;this.fragCurrent=null,null!=e&&e.loader&&e.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},T.flushMainBuffer=function(t,n){e.prototype.flushMainBuffer.call(this,t,n,this.altAudio?"video":null)},T.onMediaAttached=function(t,n){e.prototype.onMediaAttached.call(this,t,n);var r=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new d.default(this.config,r,this.fragmentTracker,this.hls)},T.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},T.onMediaPlaying=function(){this.tick()},T.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;Object(r.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},T.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(a.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},T.onManifestParsed=function(e,t){var n,r=!1,i=!1;t.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(r=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i&&!Object(o.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},T.onLevelLoading=function(e,t){var n=this.levels;if(n&&this.state===i.State.IDLE){var r=n[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=i.State.WAITING_LEVEL)}},T.onLevelLoaded=function(e,t){var n,r=this.levels,o=t.level,s=t.details,u=s.totalduration;if(r){this.log("Level "+o+" loaded ["+s.startSN+","+s.endSN+"], cc ["+s.startCC+", "+s.endCC+"] duration:"+u);var l=this.fragCurrent;!l||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||l.level!==t.level&&l.loader&&(this.state=i.State.IDLE,l.loader.abort());var c=r[o],f=0;if(s.live||null!==(n=c.details)&&void 0!==n&&n.live){if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed)return;f=this.alignPlaylists(s,c.details)}if(c.details=s,this.levelLastLoaded=o,this.hls.trigger(a.Events.LEVEL_UPDATED,{details:s,level:o}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(s))return;this.state=i.State.IDLE}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,f),this.tick()}else this.warn("Levels were reset while loading level "+o)},T._handleFragmentLoadProgress=function(e){var t,n=e.frag,r=e.part,i=e.payload,o=this.levels;if(o){var a=o[n.level],s=a.details;if(s){var u=a.videoCodec,c=s.PTSKnown||!s.live,d=null===(t=n.initSegment)||void 0===t?void 0:t.data,p=this._getAudioCodec(a),v=this.transmuxer=this.transmuxer||new f.default(this.hls,l.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,y=-1!==g,m=new h.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,i.byteLength,g,y),b=this.initPTS[n.cc];v.push(i,d,p,u,n,r,s.totalduration,c,m,b)}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},T.onAudioTrackSwitching=function(e,t){var n=this.altAudio,r=!!t.url,i=t.id;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var o=this.fragCurrent;null!=o&&o.loader&&(this.log("Switching to main audio track, cancel main fragment load"),o.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var s=this.hls;n&&s.trigger(a.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),s.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:i})}},T.onAudioTrackSwitched=function(e,t){var n=t.id,r=!!this.hls.audioTracks[n].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},T.onBufferCreated=function(e,t){var n,r,i=t.tracks,o=!1;for(var a in i){var s=i[a];if("main"===s.id){if(r=a,n=s,"video"===a){var u=i[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&n?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},T.onFragBuffered=function(e,t){var n=t.frag,r=t.part;if(!n||n.type===l.PlaylistLevelType.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var o=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}},T.onError=function(e,t){switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.MAIN,t);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=i.State.ERROR):t.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var n=!0,r=this.getFwdBufferInfo(this.media,l.PlaylistLevelType.MAIN);r&&r.len>.5&&(n=!this.reduceMaxBufferLength(r.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},T.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){var n=s.BufferHelper.getBuffered(e);!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this.seekToStartPos()):t.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime}},T.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},T.onBufferFlushed=function(e,t){var n=t.type;if(n!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var r=(n===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,n,l.PlaylistLevelType.MAIN)}},T.onLevelsUpdated=function(e,t){this.levels=t.levels},T.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},T.seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void v.logger.log("could not seek to "+n+", already seeking at "+t);var r=s.BufferHelper.getBuffered(e),i=(r.length?r.start(0):0)-n;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(v.logger.log("adjusting start position by "+i+" to match buffer start"),n+=i,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+t),e.currentTime=n}},T._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},T._loadBitrateTestFrag=function(e){var t=this;this._doFragLoad(e).then(function(n){var r=t.hls;if(n&&!r.nextLoadLevel&&!t.fragContextChanged(e)){t.fragLoadError=0,t.state=i.State.IDLE,t.startFragRequested=!1,t.bitrateTest=!1;var o=e.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(a.Events.FRAG_LOADED,n)}})},T._handleTransmuxComplete=function(e){var t,n="main",o=this.hls,s=e.remuxResult,u=e.chunkMeta,l=this.getCurrentContext(u);if(!l)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var f=l.frag,h=l.part,d=l.level,p=s.video,v=s.text,g=s.id3,y=s.initSegment,m=this.altAudio?void 0:s.audio;if(!this.fragContextChanged(f)){if(this.state=i.State.PARSING,y){y.tracks&&(this._bufferInitSegment(d,y.tracks,f,u),o.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:f,id:n,tracks:y.tracks}));var b=y.initPTS,E=y.timescale;Object(r.isFiniteNumber)(b)&&(this.initPTS[f.cc]=b,o.trigger(a.Events.INIT_PTS_FOUND,{frag:f,id:n,initPTS:b,timescale:E}))}if(p&&!1!==s.independent){if(d.details){var _=p.startPTS,T=p.endPTS,k=p.startDTS,A=p.endDTS;if(h)h.elementaryStreams[p.type]={startPTS:_,endPTS:T,startDTS:k,endDTS:A};else if(p.firstKeyFrame&&p.independent&&(this.couldBacktrack=!0),p.dropped&&p.independent){if(this.getLoadPosition()+this.config.maxBufferHole<_)return void this.backtrack(f);f.setElementaryStreamInfo(p.type,f.start,T,f.start,A,!0)}f.setElementaryStreamInfo(p.type,_,T,k,A),this.bufferFragmentData(p,f,h,u)}}else if(!1===s.independent)return void this.backtrack(f);if(m){var S=m.startPTS,w=m.endPTS,L=m.startDTS,P=m.endDTS;h&&(h.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:S,endPTS:w,startDTS:L,endDTS:P}),f.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,S,w,L,P),this.bufferFragmentData(m,f,h,u)}if(null!=g&&null!==(t=g.samples)&&void 0!==t&&t.length){var O={frag:f,id:n,samples:g.samples};o.trigger(a.Events.FRAG_PARSING_METADATA,O)}if(v){var C={frag:f,id:n,samples:v.samples};o.trigger(a.Events.FRAG_PARSING_USERDATA,C)}}},T._bufferInitSegment=function(e,t,n,r){var o=this;if(this.state===i.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var s=t.audio,u=t.video,l=t.audiovideo;if(s){var c=e.audioCodec,f=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===f.indexOf("firefox")&&(c="mp4a.40.5")),-1!==f.indexOf("android")&&"audio/mpeg"!==s.container&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),e.audioCodec&&e.audioCodec!==c&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+c+'"'),s.levelCodec=c,s.id="main",this.log("Init audio buffer, container:"+s.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(e.audioCodec||"")+"/"+s.codec+"]")}u&&(u.levelCodec=e.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+u.codec+"]")),l&&this.log("Init audiovideo buffer, container:"+l.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+l.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,t),Object.keys(t).forEach(function(e){var i=t[e].initSegment;null!=i&&i.byteLength&&o.hls.trigger(a.Events.BUFFER_APPENDING,{type:e,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})}),this.tick()}},T.backtrack=function(e){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(e);var t=this.fragmentTracker.backtrack(e);this.fragPrevious=null,this.nextLoadPosition=e.start,t?this.resetFragmentLoading(e):this.state=i.State.BACKTRACKING},T.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var n=e.currentTime;if(s.BufferHelper.isBuffered(e,n)?t=this.getAppendedFrag(n):s.BufferHelper.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){var r=this.fragPlaying,i=t.level;r&&t.sn===r.sn&&r.level===i&&t.urlId===r.urlId||(this.hls.trigger(a.Events.FRAG_CHANGED,{frag:t}),r&&r.level===i||this.hls.trigger(a.Events.LEVEL_SWITCHED,{level:i}),this.fragPlaying=t)}}},b=m,(E=[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&g(b.prototype,E),_&&g(b,_),m}(i.default)},"./src/controller/subtitle-stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"SubtitleStreamController",function(){return p});var r=n("./src/events.ts"),i=n("./src/utils/buffer-helper.ts"),o=n("./src/controller/fragment-finders.ts"),a=n("./src/utils/discontinuities.ts"),s=n("./src/controller/level-helper.ts"),u=n("./src/controller/fragment-tracker.ts"),l=n("./src/controller/base-stream-controller.ts"),c=n("./src/types/loader.ts"),f=n("./src/types/level.ts");function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){var t,n;function p(t,n){var r;return(r=e.call(this,t,n,"[subtitle-stream-controller]")||this).levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}n=e,(t=p).prototype=Object.create(n.prototype),t.prototype.constructor=t,d(t,n);var v,g,y,m=p.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r.Events.ERROR,this.onError,this),e.on(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r.Events.ERROR,this.onError,this),e.off(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.startLoad=function(){this.stopLoad(),this.state=l.State.IDLE,this.setInterval(500),this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},m.onLevelLoaded=function(e,t){this.mainDetails=t.details},m.onSubtitleFragProcessed=function(e,t){var n=t.frag,r=t.success;if(this.fragPrevious=n,this.state=l.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var o,a=n.start,s=0;s<i.length;s++)if(a>=i[s].start&&a<=i[s].end){o=i[s];break}var u=n.start+n.duration;o?o.end=u:(o={start:a,end:u},i.push(o)),this.fragmentTracker.fragBuffered(n)}}},m.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset;if(0===n&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,o=this.levels;if(!o.length||!o[i]||!o[i].details)return;var a=r-o[i].details.targetduration;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(function(e){for(var t=0;t<e.length;)if(e[t].end<=a)e.shift();else{if(!(e[t].start<a))break;e[t].start=a,t++}}),this.fragmentTracker.removeFragmentsInRange(n,a,c.PlaylistLevelType.SUBTITLE)}},m.onError=function(e,t){var n,r=t.frag;r&&r.type===c.PlaylistLevelType.SUBTITLE&&(null!==(n=this.fragCurrent)&&void 0!==n&&n.loader&&this.fragCurrent.loader.abort(),this.state=l.State.IDLE)},m.onSubtitleTracksUpdated=function(e,t){var n=this,r=t.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(e){return new f.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){n.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},m.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}else this.clearInterval()},m.onSubtitleTrackLoaded=function(e,t){var n,r=t.details,i=t.id,u=this.currentTrackId,c=this.levels;if(c.length){var f=c[u];if(!(i>=c.length||i!==u)&&f){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||null!==(n=f.details)&&void 0!==n&&n.live){var h=this.mainDetails;if(r.deltaUpdateFailed||!h)return;var d=h.fragments[0];if(f.details)0===this.alignPlaylists(r,f.details)&&d&&Object(s.addSliding)(r,d.start);else r.hasProgramDateTime&&h.hasProgramDateTime?Object(a.alignMediaPlaylistByPDT)(r,h):d&&Object(s.addSliding)(r,d.start)}if(f.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===l.State.IDLE)Object(o.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)}}},m._handleFragmentLoadComplete=function(e){var t=e.frag,n=e.payload,i=t.decryptdata,o=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){var a=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).then(function(e){var n=performance.now();o.trigger(r.Events.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:a,tdecrypt:n}})})}},m.doTick=function(){if(this.media){if(this.state===l.State.IDLE){var e,t=this.currentTrackId,n=this.levels;if(!n.length||!n[t]||!n[t].details)return;var r=n[t].details,a=r.targetduration,s=this.config,c=this.media,f=i.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,c.currentTime-a,s.maxBufferHole),h=f.end;if(f.len>this.getMaxBufferLength()+a)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var d,p=r.fragments,v=p.length,g=r.edge,y=this.fragPrevious;if(h<g){var m=s.maxFragLookUpTolerance;!(d=Object(o.findFragmentByPTS)(y,p,h,m))&&y&&y.start<p[0].start&&(d=p[0])}else d=p[v-1];null!==(e=d)&&void 0!==e&&e.encrypted?this.loadKey(d,r):d&&this.fragmentTracker.getState(d)===u.FragmentState.NOT_LOADED&&this.loadFragment(d,r,h)}}else this.state=l.State.IDLE},m.loadFragment=function(t,n,r){this.fragCurrent=t,e.prototype.loadFragment.call(this,t,n,r)},v=p,(g=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&h(v.prototype,g),y&&h(v,y),p}(l.default)},"./src/controller/subtitle-track-controller.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.ts"),i=n("./src/utils/texttrack-utils.ts"),o=n("./src/controller/base-playlist-controller.ts"),a=n("./src/types/loader.ts");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){var t,n;function o(t){var n;return(n=e.call(this,t,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n);var l,f,h,d=o.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},d.registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r.Events.ERROR,this.onError,this)},d.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},d.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),c(this.media.textTracks).forEach(function(e){Object(i.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null)},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},d.onSubtitleTrackLoaded=function(e,t){var n=t.id,r=t.details,i=this.trackId,o=this.tracksInGroup[i];if(o){var a=o.details;o.details=t.details,this.log("subtitle track "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,a))}else this.warn("Invalid subtitle track id "+n)},d.onLevelLoading=function(e,t){this.switchLevel(t.level)},d.onLevelSwitching=function(e,t){this.switchLevel(t.level)},d.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var n=t.textGroupIds[t.urlId];if(this.groupId!==n){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,o=this.tracks.filter(function(e){return!n||e.groupId===n});this.tracksInGroup=o;var a=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=n;var s={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.SUBTITLE_TRACKS_UPDATED,s),-1!==a&&this.setSubtitleTrack(a,i)}}},d.findTrackId=function(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1},d.onError=function(t,n){e.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===a.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},d.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var n=t.id,i=t.groupId,o=t.url;if(e)try{o=e.addDirectives(o)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+n),this.hls.trigger(r.Events.SUBTITLE_TRACK_LOADING,{url:o,id:n,groupId:i,deliveryDirectives:e||null})}},d.toggleTrackModes=function(e){var t=this,n=this.media,r=this.subtitleDisplay,i=this.trackId;if(n){var o=c(n.textTracks),a=o.filter(function(e){return e.groupId===t.groupId});if(-1===e)[].slice.call(o).forEach(function(e){e.mode="disabled"});else{var s=a[i];s&&(s.mode="disabled")}var u=a[e];u&&(u.mode=r?"showing":"hidden")}},d.setSubtitleTrack=function(e,t){var n,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(n=i[e])&&void 0!==n&&n.details)||e<-1||e>=i.length)){this.clearTimer();var o=i[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,o){var a=o.id,s=o.groupId,u=void 0===s?"":s,l=o.name,c=o.type,f=o.url;this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:u,name:l,type:c,url:f});var h=this.switchParams(o.url,null==t?void 0:t.details);this.loadPlaylist(h)}else this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=c(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},l=o,(f=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}])&&s(l.prototype,f),h&&s(l,h),o}(o.default);function c(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}t.default=l},"./src/controller/timeline-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"TimelineController",function(){return h});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),o=n("./src/utils/cea-608-parser.ts"),a=n("./src/utils/output-filter.ts"),s=n("./src/utils/webvtt-parser.ts"),u=n("./src/utils/texttrack-utils.ts"),l=n("./src/utils/imsc1-ttml-parser.ts"),c=n("./src/types/loader.ts"),f=n("./src/utils/logger.ts"),h=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new a.default(this,"textTrack1"),n=new a.default(this,"textTrack2"),r=new a.default(this,"textTrack3"),s=new a.default(this,"textTrack4");this.cea608Parser1=new o.default(1,t,n),this.cea608Parser2=new o.default(3,r,s)}e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(i.Events.FRAG_LOADING,this.onFragLoading,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(i.Events.FRAG_LOADING,this.onFragLoading,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,n,r,o){for(var a,s,u,l,c=!1,f=o.length;f--;){var h=o[f],d=(a=h[0],s=h[1],u=t,l=n,Math.min(s,l)-Math.max(a,u));if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],n),c=!0,d/(n-t)>.5))return}if(c||o.push([t,n]),this.config.renderTextTracksNatively){var p=this.captionsTracks[e];this.Cues.newCue(p,t,n,r)}else{var v=this.Cues.newCue(null,t,n,r);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:v,track:e})}},t.onInitPtsFound=function(e,t){var n=this,r=t.frag,o=t.id,a=t.initPTS,s=t.timescale,u=this.unparsedVttFrags;"main"===o&&(this.initPTS[r.cc]=a,this.timescale[r.cc]=s),u.length&&(this.unparsedVttFrags=[],u.forEach(function(e){n.onFragLoaded(i.Events.FRAG_LOADED,e)}))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],o=i.label,a=i.languageCode,s=this.getExistingTrack(e);if(s)n[e]=s,Object(u.clearCurrentCues)(n[e]),Object(u.sendAddTrackEvent)(n[e],r);else{var l=this.createTextTrack("captions",o,a);l&&(l[e]=!0,n[e]=l)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},t.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Object(u.clearCurrentCues)(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Object(u.clearCurrentCues)(t[n])}},t.onSubtitleTracksUpdated=function(e,t){var n=this;this.textTracks=[];var r=t.subtitleTracks||[],o=r.some(function(e){return e.textCodec===l.IMSC1_CODEC});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var a=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var r;if(t<s.length){for(var i=null,o=0;o<s.length;o++)if(d(s[o],e)){i=s[o];break}i&&(r=i)}r?Object(u.clearCurrentCues)(r):(r=n.createTextTrack("subtitles",e.name,e.lang))&&(r.mode="disabled"),r&&(r.groupId=e.groupId,n.textTracks.push(r))})}else if(!a&&this.tracks&&this.tracks.length){var c=this.tracks.map(function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},t.onManifestLoaded=function(e,t){var n=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var r="textTrack"+t[1],i=n.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}})},t.onFragLoading=function(e,t){var n=this.cea608Parser1,r=this.cea608Parser2,i=this.lastSn,o=this.lastPartIndex;if(this.enabled&&n&&r&&t.frag.type===c.PlaylistLevelType.MAIN){var a,s,u=t.frag.sn,l=null!=(a=null==t?void 0:null===(s=t.part)||void 0===s?void 0:s.index)?a:-1;u===i+1||u===i&&l===o+1||(n.reset(),r.reset()),this.lastSn=u,this.lastPartIndex=l}},t.onFragLoaded=function(e,t){var n=t.frag,o=t.payload,a=this.initPTS,s=this.unparsedVttFrags;if(n.type===c.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!Object(r.isFiniteNumber)(a[n.cc]))return s.push(t),void(a.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var u=n.decryptdata,f="stats"in t;if(null==u||null==u.key||"AES-128"!==u.method||f){var h=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),h&&h.textCodec===l.IMSC1_CODEC?this._parseIMSC1(n,o):this._parseVTTs(n,o,d)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var n=this,r=this.hls;Object(l.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],function(t){n._appendCues(t,e.level),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){f.logger.log("Failed to parse IMSC1: "+t),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})},t._parseVTTs=function(e,t,n){var r=this,o=this.hls;Object(s.parseWebVTT)(t,this.initPTS[e.cc],this.timescale[e.cc],n,e.cc,e.start,function(t){r._appendCues(t,e.level),o.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(n){r._fallbackToIMSC1(e,t),f.logger.log("Failed to parse VTT cue: "+n),o.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})},t._fallbackToIMSC1=function(e,t){var n=this,r=this.tracks[e.level];r.textCodec||Object(l.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],function(){r.textCodec=l.IMSC1_CODEC,n._parseIMSC1(e,t)},function(){r.textCodec="wvtt"})},t._appendCues=function(e,t){var n=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[t];if("disabled"===r.mode)return;e.forEach(function(e){return Object(u.addCueToTrack)(r,e)})}else{var o=this.tracks[t].default?"default":"subtitles"+t;n.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:e,track:o})}},t.onFragDecrypted=function(e,t){var n=t.frag;if(n.type===c.PlaylistLevelType.SUBTITLE){if(!Object(r.isFiniteNumber)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(i.Events.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var n=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&n&&r)for(var i=0;i<t.samples.length;i++){var o=t.samples[i].bytes;if(o){var a=this.extractCea608Data(o);n.addData(t.samples[i].pts,a[0]),r.addData(t.samples[i].pts,a[1])}}},t.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset,i=t.endOffsetSubtitles,o=t.type,a=this.media;if(a&&!(a.currentTime<r)){if(!o||"video"===o){var s=this.captionsTracks;Object.keys(s).forEach(function(e){return Object(u.removeCuesInRange)(s[e],n,r)})}if(this.config.renderTextTracksNatively&&0===n&&void 0!==i){var l=this.textTracks;Object.keys(l).forEach(function(e){return Object(u.removeCuesInRange)(l[e],n,i)})}}},t.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var o=e[n++],a=127&e[n++],s=127&e[n++],u=3&o;0===a&&0===s||0!=(4&o)&&(0!==u&&1!==u||(r[u].push(a),r[u].push(s)))}return r},e}();function d(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}},"./src/crypt/aes-crypto.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var r=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"removePadding",function(){return i}),n.d(t,"default",function(){return o});var r=n("./src/utils/typed-array.ts");function i(e){var t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?Object(r.sliceUint8)(e,0,t-n):e}var o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],f=s[3],h=new Uint32Array(256),d=0,p=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[d]=g,t[g]=d;var y=h[d],m=h[y],b=h[m],E=257*h[g]^16843008*g;r[d]=E<<24|E>>>8,i[d]=E<<16|E>>>16,o[d]=E<<8|E>>>24,a[d]=E,E=16843009*b^65537*m^257*y^16843008*d,u[g]=E<<24|E>>>8,l[g]=E<<16|E>>>16,c[g]=E<<8|E>>>24,f[g]=E,d?(d=y^h[h[h[b^y]]],p^=h[h[p]]):d=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,a,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),h=this.sBox,d=this.rcon,p=this.invSubMix,v=p[0],g=p[1],y=p[2],m=p[3];for(o=0;o<l;o++)o<i?s=c[o]=t[o]:(u=s,o%i==0?(u=h[(u=u<<8|u>>>24)>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=d[o/i|0]<<24):i>6&&o%i==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),c[o]=s=(c[o-i]^u)>>>0);for(a=0;a<l;a++)o=l-a,u=3&a?c[o]:c[o-4],f[a]=a<4||o<=4?u:v[h[u>>>24]]^g[h[u>>>16&255]]^y[h[u>>>8&255]]^m[h[255&u]],f[a]=f[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n){for(var r,i,o,a,s,u,l,c,f,h,d,p,v,g,y=this.keySize+6,m=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,_=E[0],T=E[1],k=E[2],A=E[3],S=this.uint8ArrayToUint32Array_(n),w=S[0],L=S[1],P=S[2],O=S[3],C=new Int32Array(e),R=new Int32Array(C.length),D=this.networkToHostOrderSwap;t<C.length;){for(f=D(C[t]),h=D(C[t+1]),d=D(C[t+2]),p=D(C[t+3]),s=f^m[0],u=p^m[1],l=d^m[2],c=h^m[3],v=4,g=1;g<y;g++)r=_[s>>>24]^T[u>>16&255]^k[l>>8&255]^A[255&c]^m[v],i=_[u>>>24]^T[l>>16&255]^k[c>>8&255]^A[255&s]^m[v+1],o=_[l>>>24]^T[c>>16&255]^k[s>>8&255]^A[255&u]^m[v+2],a=_[c>>>24]^T[s>>16&255]^k[u>>8&255]^A[255&l]^m[v+3],s=r,u=i,l=o,c=a,v+=4;r=b[s>>>24]<<24^b[u>>16&255]<<16^b[l>>8&255]<<8^b[255&c]^m[v],i=b[u>>>24]<<24^b[l>>16&255]<<16^b[c>>8&255]<<8^b[255&s]^m[v+1],o=b[l>>>24]<<24^b[c>>16&255]<<16^b[s>>8&255]<<8^b[255&u]^m[v+2],a=b[c>>>24]<<24^b[s>>16&255]<<16^b[u>>8&255]<<8^b[255&l]^m[v+3],R[t]=D(r^w),R[t+1]=D(a^L),R[t+2]=D(o^P),R[t+3]=D(i^O),w=f,L=h,P=d,O=p,t+=4}return R.buffer},e}()},"./src/crypt/decrypter.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return l});var r=n("./src/crypt/aes-crypto.ts"),i=n("./src/crypt/fast-aes-key.ts"),o=n("./src/crypt/aes-decryptor.ts"),a=n("./src/utils/logger.ts"),s=n("./src/utils/mp4-tools.ts"),u=n("./src/utils/typed-array.ts"),l=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var t=e.prototype;return t.destroy=function(){this.observer=null},t.isSync=function(){return this.config.enableSoftwareAES},t.flush=function(){var e=this.currentResult;if(e){var t=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Object(o.removePadding)(t):t}this.reset()},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,n,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,n);var i=this.flush();i&&r(i.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,n).then(r)},t.softwareDecrypt=function(e,t,n){var r=this.currentIV,i=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=Object(s.appendUint8Array)(a,e),this.remainderData=null);var l=this.getValidChunk(e);if(!l.length)return null;r&&(n=r);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new o.default),c.expandKey(t);var f=i;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=Object(u.sliceUint8)(l,-16).buffer,f||null},t.webCryptoDecrypt=function(e,t,n){var o=this,a=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new i.default(a,t)),this.fastAesKey.expandKey().then(function(t){return a?new r.default(a,n).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))}).catch(function(r){return o.onWebCryptoError(r,e,t,n)})},t.onWebCryptoError=function(e,t,n,r){return a.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(t,n,r)},t.getValidChunk=function(e){var t=e,n=e.length-e.length%16;return n!==e.length&&(t=Object(u.sliceUint8)(e,0,n),this.remainderData=Object(u.sliceUint8)(e,n)),t},t.logOnce=function(e){this.logEnabled&&(a.logger.log("[decrypter.ts]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var r=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/adts.ts"),o=n("./src/utils/logger.ts"),a=n("./src/demux/id3.ts");function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){var t,n;function r(t,n){var r;return(r=e.call(this)||this).observer=void 0,r.config=void 0,r.observer=t,r.config=n,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n);var u=r.prototype;return u.resetInitSegment=function(t,n,r){e.prototype.resetInitSegment.call(this,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(e){if(!e)return!1;for(var t=(a.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(i.probe(e,t))return o.logger.log("ADTS sync word found !"),!0;return!1},u.canParse=function(e,t){return i.canParse(e,t)},u.appendFrame=function(e,t,n){i.initTrackConfig(e,this.observer,t,n,e.manifestCodec);var r=i.appendFrame(e,t,n,this.initPTS,this.frameIndex);if(r&&0===r.missing)return r},r}(r.default);u.minProbeByteLength=9,t.default=u},"./src/demux/adts.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"getAudioConfig",function(){return a}),n.d(t,"isHeaderPattern",function(){return s}),n.d(t,"getHeaderLength",function(){return u}),n.d(t,"getFullFrameLength",function(){return l}),n.d(t,"canGetFrameLength",function(){return c}),n.d(t,"isHeader",function(){return f}),n.d(t,"canParse",function(){return h}),n.d(t,"probe",function(){return d}),n.d(t,"initTrackConfig",function(){return p}),n.d(t,"getFrameDuration",function(){return v}),n.d(t,"parseFrameHeader",function(){return g}),n.d(t,"appendFrame",function(){return y});var r=n("./src/utils/logger.ts"),i=n("./src/errors.ts"),o=n("./src/events.ts");function a(e,t,n,a){var s,u,l,c,f=navigator.userAgent.toLowerCase(),h=a,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=1+((192&t[n+2])>>>6);var p=(60&t[n+2])>>>2;if(!(p>d.length-1))return l=(1&t[n+2])<<2,l|=(192&t[n+3])>>>6,r.logger.log("manifest codec:"+a+", ADTS type:"+s+", samplingIndex:"+p),/firefox/i.test(f)?p>=6?(s=5,c=new Array(4),u=p-3):(s=2,c=new Array(2),u=p):-1!==f.indexOf("android")?(s=2,c=new Array(2),u=p):(s=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&p>=6?u=p-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(p>=6&&1===l||/vivaldi/i.test(f))||!a&&1===l)&&(s=2,c=new Array(2)),u=p)),c[0]=s<<3,c[0]|=(14&p)>>1,c[1]|=(1&p)<<7,c[1]|=l<<3,5===s&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[p],channelCount:l,codec:"mp4a.40."+s,manifestCodec:h};e.trigger(o.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function s(e,t){return 255===e[t]&&240==(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function l(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function c(e,t){return t+5<e.length}function f(e,t){return t+1<e.length&&s(e,t)}function h(e,t){return c(e,t)&&s(e,t)&&l(e,t)<=e.length-t}function d(e,t){if(f(e,t)){var n=u(e,t);if(t+n>=e.length)return!1;var r=l(e,t);if(r<=n)return!1;var i=t+r;return i===e.length||f(e,i)}return!1}function p(e,t,n,i,o){if(!e.samplerate){var s=a(t,n,i,o);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,r.logger.log("parsed codec:"+e.codec+", rate:"+s.samplerate+", channels:"+s.channelCount)}}function v(e){return 9216e4/e}function g(e,t,n,r,i){var o=u(e,t),a=l(e,t);if((a-=o)>0)return{headerLength:o,frameLength:a,stamp:n+r*i}}function y(e,t,n,r,i){var o=g(t,n,r,i,v(e.samplerate));if(o){var a,s=o.frameLength,u=o.headerLength,l=o.stamp,c=u+s,f=Math.max(0,n+c-t.length);f?(a=new Uint8Array(c-u)).set(t.subarray(n+u,t.length),0):a=t.subarray(n+u,n+c);var h={unit:a,pts:l};return f||e.samples.push(h),{sample:h,length:c,missing:f}}}},"./src/demux/base-audio-demuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"initPTSFn",function(){return l});var r=n("./src/polyfills/number.ts"),i=n("./src/demux/id3.ts"),o=n("./src/demux/dummy-demuxed-track.ts"),a=n("./src/utils/mp4-tools.ts"),s=n("./src/utils/typed-array.ts"),u=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(){},t.resetContiguity=function(){},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,n){},t.demux=function(e,t){this.cachedData&&(e=Object(a.appendUint8Array)(this.cachedData,e),this.cachedData=null);var n,r,u=i.getID3Data(e,0),c=u?u.length:0,f=this._audioTrack,h=this._id3Track,d=u?i.getTimeStamp(u):void 0,p=e.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=l(d,t)),u&&u.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:u}),r=this.initPTS;c<p;){if(this.canParse(e,c)){var v=this.appendFrame(f,e,c);v?(this.frameIndex++,r=v.sample.pts,n=c+=v.length):c=p}else i.canParse(e,c)?(u=i.getID3Data(e,c),h.samples.push({pts:r,dts:r,data:u}),n=c+=u.length):c++;if(c===p&&n!==p){var g=Object(s.sliceUint8)(e,n);this.cachedData?this.cachedData=Object(a.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:f,avcTrack:Object(o.dummyTrack)(),id3Track:h,textTrack:Object(o.dummyTrack)()}},t.demuxSampleAes=function(e,t,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(o.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(o.dummyTrack)()}},t.destroy=function(){},e}(),l=function(e,t){return Object(r.isFiniteNumber)(e)?90*e:9e4*t};t.default=u},"./src/demux/chunk-cache.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var r=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,n=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var n=new Uint8Array(t),r=0,i=0;i<e.length;i++){var o=e[i];n.set(o,r),r+=o.length}return n}(t,n),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":function(e,t,n){"use strict";function r(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}n.r(t),n.d(t,"dummyTrack",function(){return r})},"./src/demux/exp-golomb.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.ts"),i=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&r.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,n=8,r=0;r<e;r++)0!==n&&(n=(t+this.readEG()+256)%256),t=0===n?t:n},t.readSPS=function(){var e,t,n,r=0,i=0,o=0,a=0,s=this.readUByte.bind(this),u=this.readBits.bind(this),l=this.readUEG.bind(this),c=this.readBoolean.bind(this),f=this.skipBits.bind(this),h=this.skipEG.bind(this),d=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);s();var v=s();if(u(5),f(3),s(),d(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var g=l();if(3===g&&f(1),d(),d(),f(1),c())for(t=3!==g?8:12,n=0;n<t;n++)c()&&p(n<6?16:64)}d();var y=l();if(0===y)l();else if(1===y)for(f(1),h(),h(),e=l(),n=0;n<e;n++)h();d(),f(1);var m=l(),b=l(),E=u(1);0===E&&f(1),f(1),c()&&(r=l(),i=l(),o=l(),a=l());var _=[1,1];if(c()&&c())switch(s()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[s()<<8|s(),s()<<8|s()]}return{width:Math.ceil(16*(m+1)-2*r-2*i),height:(2-E)*(b+1)*16-(E?2:4)*(o+a),pixelRatio:_}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=i},"./src/demux/id3.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"isHeader",function(){return i}),n.d(t,"isFooter",function(){return o}),n.d(t,"getID3Data",function(){return a}),n.d(t,"canParse",function(){return u}),n.d(t,"getTimeStamp",function(){return l}),n.d(t,"isTimeStampFrame",function(){return c}),n.d(t,"getID3Frames",function(){return h}),n.d(t,"decodeFrame",function(){return d}),n.d(t,"utf8ArrayToStr",function(){return m}),n.d(t,"testables",function(){return b});var r,i=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},a=function(e,t){for(var n=t,r=0;i(e,t);){r+=10,r+=s(e,t+6),o(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(n,n+r)},s=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},u=function(e,t){return i(e,t)&&s(e,t+6)+10<=e.length-t},l=function(e){for(var t=h(e),n=0;n<t.length;n++){var r=t[n];if(c(r))return y(r)}},c=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},f=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=s(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}},h=function(e){for(var t=0,n=[];i(e,t);){for(var r=s(e,t+6),a=(t+=10)+r;t+8<a;){var u=f(e.subarray(t)),l=d(u);l&&n.push(l),t+=u.size+10}o(e,t)&&(t+=10)}return n},d=function(e){return"PRIV"===e.type?p(e):"W"===e.type[0]?g(e):v(e)},p=function(e){if(!(e.size<2)){var t=m(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}},v=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,n=m(e.data.subarray(t),!0);t+=n.length+1;var r=m(e.data.subarray(t));return{key:e.type,info:n,data:r}}var i=m(e.data.subarray(1));return{key:e.type,data:i}}},g=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,n=m(e.data.subarray(t),!0);t+=n.length+1;var r=m(e.data.subarray(t));return{key:e.type,info:n,data:r}}var i=m(e.data);return{key:e.type,data:i}},y=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},m=function(e,t){void 0===t&&(t=!1);var n=E();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var o,a,s,u=e.length,l="",c=0;c<u;){if(0===(o=e[c++])&&t)return l;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(o);break;case 12:case 13:a=e[c++],l+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=e[c++],s=e[c++],l+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&s)<<0)}}return l},b={decodeTextFrame:v};function E(){return r||void 0===self.TextDecoder||(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/id3.ts"),o=n("./src/utils/logger.ts"),a=n("./src/demux/mpegaudio.ts");function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n);var u=r.prototype;return u.resetInitSegment=function(t,n,r){e.prototype.resetInitSegment.call(this,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(e){if(!e)return!1;for(var t=(i.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(a.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},u.canParse=function(e,t){return a.canParse(e,t)},u.appendFrame=function(e,t,n){if(null!==this.initPTS)return a.appendFrame(e,t,n,this.initPTS,this.frameIndex)},r}(r.default);u.minProbeByteLength=4,t.default=u},"./src/demux/mp4demuxer.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/mp4-tools.ts"),i=n("./src/demux/dummy-demuxed-track.ts"),o=function(){function e(e,t){this.remainderData=null,this.config=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.resetContiguity=function(){},e.probe=function(e){return Object(r.findBox)({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.demux=function(e){var t=e,n=Object(i.dummyTrack)();if(this.config.progressive){this.remainderData&&(t=Object(r.appendUint8Array)(this.remainderData,e));var o=Object(r.segmentValidRange)(t);this.remainderData=o.remainder,n.samples=o.valid||new Uint8Array}else n.samples=t;return{audioTrack:Object(i.dummyTrack)(),avcTrack:n,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.flush=function(){var e=Object(i.dummyTrack)();return e.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:e,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.demuxSampleAes=function(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}();o.minProbeByteLength=1024,t.default=o},"./src/demux/mpegaudio.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"appendFrame",function(){return u}),n.d(t,"parseHeader",function(){return l}),n.d(t,"isHeaderPattern",function(){return c}),n.d(t,"isHeader",function(){return f}),n.d(t,"canParse",function(){return h}),n.d(t,"probe",function(){return d});var r=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],a=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],s=[0,1,1,4];function u(e,t,n,r,i){if(!(n+24>t.length)){var o=l(t,n);if(o&&n+o.frameLength<=t.length){var a=r+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(n,n+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),{sample:s,length:o.frameLength,missing:0}}}}function l(e,t){var n=e[t+1]>>3&3,u=e[t+1]>>1&3,l=e[t+2]>>4&15,c=e[t+2]>>2&3;if(1!==n&&0!==l&&15!==l&&3!==c){var f=e[t+2]>>1&1,h=e[t+3]>>6,d=1e3*i[14*(3===n?3-u:3===u?3:4)+l-1],p=o[3*(3===n?0:2===n?1:2)+c],v=3===h?1:2,g=a[n][u],y=s[u],m=8*g*y,b=Math.floor(g*d/p+f)*y;if(null===r){var E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);r=E?parseInt(E[1]):0}return!!r&&r<=87&&2===u&&d>=224e3&&0===h&&(e[t+3]=128|e[t+3]),{sampleRate:p,channelCount:v,frameLength:b,samplesPerFrame:m}}}function c(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function f(e,t){return t+1<e.length&&c(e,t)}function h(e,t){return c(e,t)&&4<=e.length-t}function d(e,t){if(t+1<e.length&&c(e,t)){var n=l(e,t),r=4;null!=n&&n.frameLength&&(r=n.frameLength);var i=t+r;return i===e.length||f(e,i)}return!1}},"./src/demux/sample-aes.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/crypt/decrypter.ts"),i=n("./src/demux/tsdemuxer.ts"),o=function(){function e(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new r.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,function(o){var a=new Uint8Array(o);i.set(a,16),r||s.decryptAacSamples(e,t+1,n)})},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){for(var n=new Uint8Array(t),r=0,i=32;i<e.length-16;i+=160,r+=16)e.set(n.subarray(r,r+16),i);return e},t.decryptAvcSample=function(e,t,n,r,o,a){var s=Object(i.discardEPB)(o.data),u=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(u.buffer,function(i){o.data=l.getAvcDecryptedUnit(s,i),a||l.decryptAvcSamples(e,t,n+1,r)})},t.decryptAvcSamples=function(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var o=i[n];if(!(o.data.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,o,a),!a)return}}}},e}();t.default=o},"./src/demux/transmuxer-interface.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return f});var r=n("./node_modules/webworkify-webpack/index.js"),i=n("./src/events.ts"),o=n("./src/demux/transmuxer.ts"),a=n("./src/utils/logger.ts"),s=n("./src/errors.ts"),u=n("./src/utils/mediasource-helper.ts"),l=n("./node_modules/eventemitter3/index.js"),c=Object(u.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function e(e,t,n,u){var f=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=e,this.id=t,this.onTransmuxComplete=n,this.onFlush=u;var h=e.config,d=function(t,n){(n=n||{}).frag=f.frag,n.id=f.id,e.trigger(t,n)};this.observer=new l.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,d),this.observer.on(i.Events.ERROR,d);var p={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(h.enableWorker&&"undefined"!=typeof Worker){var g;a.logger.log("demuxing in webworker");try{g=this.worker=r("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(t){e.trigger(i.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:v,id:t,config:JSON.stringify(h)})}catch(e){a.logger.warn("Error in worker:",e),a.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new o.default(this.observer,p,h,v,t),this.worker=null}}else this.transmuxer=new o.default(this.observer,p,h,v,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.observer=null},t.push=function(e,t,n,r,i,s,u,l,c,f){var h,d,p=this;c.transmuxing.start=self.performance.now();var v=this.transmuxer,g=this.worker,y=s?s.start:i.start,m=i.decryptdata,b=this.frag,E=!(b&&i.cc===b.cc),_=!(b&&c.level===b.level),T=b?c.sn-b.sn:-1,k=this.part?c.part-this.part.index:1,A=!_&&(1===T||0===T&&1===k),S=self.performance.now();(_||T||0===i.stats.parsing.start)&&(i.stats.parsing.start=S),!s||!k&&A||(s.stats.parsing.start=S);var w=!(b&&(null===(h=i.initSegment)||void 0===h?void 0:h.url)===(null===(d=b.initSegment)||void 0===d?void 0:d.url)),L=new o.TransmuxState(E,A,l,_,y,w);if(!A||E||w){a.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+"\n        discontinuity: "+E+"\n        trackSwitch: "+_+"\n        contiguous: "+A+"\n        accurateTimeOffset: "+l+"\n        timeOffset: "+y+"\n        initSegmentChange: "+w);var P=new o.TransmuxConfig(n,r,t,u,f);this.configureTransmuxer(P)}if(this.frag=i,this.part=s,g)g.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:L},e instanceof ArrayBuffer?[e]:[]);else if(v){var O=v.push(e,m,c,L);Object(o.isPromise)(O)?O.then(function(e){p.handleTransmuxComplete(e)}):this.handleTransmuxComplete(O)}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:e});else if(n){var i=n.flush(e);Object(o.isPromise)(i)?i.then(function(n){t.handleFlushResult(n,e)}):this.handleFlushResult(i,e)}},t.handleFlushResult=function(e,t){var n=this;e.forEach(function(e){n.handleTransmuxComplete(e)}),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,n=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):n&&n.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return s});var r=n("./src/demux/transmuxer.ts"),i=n("./src/events.ts"),o=n("./src/utils/logger.ts"),a=n("./node_modules/eventemitter3/index.js");function s(e){var t=new a.EventEmitter,n=function(t,n){e.postMessage({event:t,data:n})};t.on(i.Events.FRAG_DECRYPTED,n),t.on(i.Events.ERROR,n),e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.transmuxer=new r.default(t,a.typeSupported,s,a.vendor,a.id),Object(o.enableLogs)(s.debug),n("init",null);break;case"configure":e.transmuxer.configure(a.config);break;case"demux":var l=e.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(r.isPromise)(l)?l.then(function(t){u(e,t)}):u(e,l);break;case"flush":var f=a.chunkMeta,h=e.transmuxer.flush(f);Object(r.isPromise)(h)?h.then(function(t){c(e,t,f)}):c(e,h,f)}})}function u(e,t){if((n=t.remuxResult).audio||n.video||n.text||n.id3||n.initSegment){var n,r=[],i=t.remuxResult,o=i.audio,a=i.video;o&&l(r,o),a&&l(r,a),e.postMessage({event:"transmuxComplete",data:t},r)}}function l(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function c(e,t,n){t.forEach(function(t){u(e,t)}),e.postMessage({event:"flush",data:n})}},"./src/demux/transmuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return m}),n.d(t,"isPromise",function(){return E}),n.d(t,"TransmuxConfig",function(){return _}),n.d(t,"TransmuxState",function(){return T});var r,i=n("./src/events.ts"),o=n("./src/errors.ts"),a=n("./src/crypt/decrypter.ts"),s=n("./src/demux/aacdemuxer.ts"),u=n("./src/demux/mp4demuxer.ts"),l=n("./src/demux/tsdemuxer.ts"),c=n("./src/demux/mp3demuxer.ts"),f=n("./src/remux/mp4-remuxer.ts"),h=n("./src/remux/passthrough-remuxer.ts"),d=n("./src/demux/chunk-cache.ts"),p=n("./src/utils/mp4-tools.ts"),v=n("./src/utils/logger.ts");try{r=self.performance.now.bind(self.performance)}catch(e){v.logger.debug("Unable to use Performance API on this environment"),r=self.Date.now}var g=[{demux:l.default,remux:f.default},{demux:u.default,remux:h.default},{demux:s.default,remux:f.default},{demux:c.default,remux:f.default}],y=1024;g.forEach(function(e){var t=e.demux;y=Math.max(y,t.minProbeByteLength)});var m=function(){function e(e,t,n,r,i){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new d.default,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r,this.id=i}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,n,i){var o=this,a=n.transmuxing;a.executeStart=r();var s=new Uint8Array(e),u=this.cache,l=this.config,c=this.currentTransmuxState,f=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=function(e,t){var n=null;e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(n=t);return n}(s,t);if(h&&"AES-128"===h.method){var d=this.getDecrypter();if(!l.enableSoftwareAES)return this.decryptionPromise=d.webCryptoDecrypt(s,h.key.buffer,h.iv.buffer).then(function(e){var t=o.push(e,null,n);return o.decryptionPromise=null,t}),this.decryptionPromise;var v=d.softwareDecrypt(s,h.key.buffer,h.iv.buffer);if(!v)return a.executeEnd=r(),b(n);s=new Uint8Array(v)}var g=i||c,y=g.contiguous,m=g.discontinuity,E=g.trackSwitch,_=g.accurateTimeOffset,T=g.timeOffset,k=g.initSegmentChange,A=f.audioCodec,S=f.videoCodec,w=f.defaultInitPts,L=f.duration,P=f.initSegmentData;if((m||E||k)&&this.resetInitSegment(P,A,S,L),(m||k)&&this.resetInitialTimestamp(w),y||this.resetContiguity(),this.needsProbing(s,m,E)){if(u.dataLength){var O=u.flush();s=Object(p.appendUint8Array)(O,s)}this.configureTransmuxer(s,f)}var C=this.transmux(s,h,T,_,n),R=this.currentTransmuxState;return R.contiguous=!0,R.discontinuity=!1,R.trackSwitch=!1,a.executeEnd=r(),C},t.flush=function(e){var t=this,n=e.transmuxing;n.executeStart=r();var a=this.decrypter,s=this.cache,u=this.currentTransmuxState,l=this.decryptionPromise;if(l)return l.then(function(){return t.flush(e)});var c=[],f=u.timeOffset;if(a){var h=a.flush();h&&c.push(this.push(h,null,e))}var d=s.dataLength;s.reset();var p=this.demuxer,v=this.remuxer;if(!p||!v)return d>=y&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=r(),[b(e)];var g=p.flush(f);return E(g)?g.then(function(n){return t.flushRemux(c,n,e),c}):(this.flushRemux(c,g,e),c)},t.flushRemux=function(e,t,n){var i=t.audioTrack,o=t.avcTrack,a=t.id3Track,s=t.textTrack,u=this.currentTransmuxState,l=u.accurateTimeOffset,c=u.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var f=this.remuxer.remux(i,o,a,s,c,l,!0,this.id);e.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=r()},t.resetInitialTimestamp=function(e){var t=this.demuxer,n=this.remuxer;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,n,r){var i=this.demuxer,o=this.remuxer;i&&o&&(i.resetInitSegment(t,n,r),o.resetInitSegment(e,t,n))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,n,r,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,i):this.transmuxUnencrypted(e,n,r,i)},t.transmuxUnencrypted=function(e,t,n,r){var i=this.demuxer.demux(e,t,!1,!this.config.progressive),o=i.audioTrack,a=i.avcTrack,s=i.id3Track,u=i.textTrack;return{remuxResult:this.remuxer.remux(o,a,s,u,t,n,!1,this.id),chunkMeta:r}},t.transmuxSampleAes=function(e,t,n,r,i){var o=this;return this.demuxer.demuxSampleAes(e,t,n).then(function(e){return{remuxResult:o.remuxer.remux(e.audioTrack,e.avcTrack,e.id3Track,e.textTrack,n,r,!1,o.id),chunkMeta:i}})},t.configureTransmuxer=function(e,t){for(var n,r=this.config,i=this.observer,o=this.typeSupported,a=this.vendor,s=t.audioCodec,l=t.defaultInitPts,c=t.duration,f=t.initSegmentData,d=t.videoCodec,p=0,y=g.length;p<y;p++)if(g[p].demux.probe(e)){n=g[p];break}n||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:u.default,remux:h.default});var m=this.demuxer,b=this.remuxer,E=n.remux,_=n.demux;b&&b instanceof E||(this.remuxer=new E(i,r,o,a)),m&&m instanceof _||(this.demuxer=new _(i,r,o),this.probe=_.probe),this.resetInitSegment(f,s,d,c),this.resetInitialTimestamp(l)},t.needsProbing=function(e,t,n){return!this.demuxer||!this.remuxer||t||n},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new a.default(this.observer,this.config)),e},e}();var b=function(e){return{remuxResult:{},chunkMeta:e}};function E(e){return"then"in e&&e.then instanceof Function}var _=function(e,t,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i},T=function(e,t,n,r,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=o}},"./src/demux/tsdemuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"discardEPB",function(){return E});var r=n("./src/demux/adts.ts"),i=n("./src/demux/mpegaudio.ts"),o=n("./src/demux/exp-golomb.ts"),a=n("./src/demux/id3.ts"),s=n("./src/demux/sample-aes.ts"),u=n("./src/events.ts"),l=n("./src/utils/mp4-tools.ts"),c=n("./src/utils/logger.ts"),f=n("./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},d=function(){function e(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=n}e.probe=function(t){var n=e.syncOffset(t);return!(n<0)&&(n&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:h[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",r),this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3",r),this._txtTrack=e.createTrack("text",r),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=n,this._duration=r},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,n=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},t.demux=function(t,n,r,i){var o;void 0===r&&(r=!1),void 0===i&&(i=!1),r||(this.sampleAes=null);var a=this._avcTrack,s=this._audioTrack,h=this._id3Track,d=a.pid,p=a.pesData,m=s.pid,b=h.pid,E=s.pesData,_=h.pesData,T=!1,k=this.pmtParsed,A=this._pmtId,S=t.length;if(this.remainderData&&(S=(t=Object(l.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),S<188&&!i)return this.remainderData=t,{audioTrack:s,avcTrack:a,id3Track:h,textTrack:this._txtTrack};var w=Math.max(0,e.syncOffset(t));(S-=(S+w)%188)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,S,t.buffer.byteLength-S));for(var L=0,P=w;P<S;P+=188)if(71===t[P]){var O=!!(64&t[P+1]),C=((31&t[P+1])<<8)+t[P+2],R=void 0;if((48&t[P+3])>>4>1){if((R=P+5+t[P+4])===P+188)continue}else R=P+4;switch(C){case d:O&&(p&&(o=y(p))&&this.parseAVCPES(o,!1),p={data:[],size:0}),p&&(p.data.push(t.subarray(R,P+188)),p.size+=P+188-R);break;case m:O&&(E&&(o=y(E))&&(s.isAAC?this.parseAACPES(o):this.parseMPEGPES(o)),E={data:[],size:0}),E&&(E.data.push(t.subarray(R,P+188)),E.size+=P+188-R);break;case b:O&&(_&&(o=y(_))&&this.parseID3PES(o),_={data:[],size:0}),_&&(_.data.push(t.subarray(R,P+188)),_.size+=P+188-R);break;case 0:O&&(R+=t[R]+1),A=this._pmtId=v(t,R);break;case A:O&&(R+=t[R]+1);var D=g(t,R,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,r);(d=D.avc)>0&&(a.pid=d),(m=D.audio)>0&&(s.pid=m,s.isAAC=D.isAAC),(b=D.id3)>0&&(h.pid=b),T&&!k&&(c.logger.log("reparse from beginning"),T=!1,P=w-188),k=this.pmtParsed=!0;break;case 17:case 8191:break;default:T=!0}}else L++;L>0&&this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+L+" TS packet/s that do not start with 0x47"}),a.pesData=p,s.pesData=E,h.pesData=_;var I={audioTrack:s,avcTrack:a,id3Track:h,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(I),I},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,n=e.audioTrack,r=e.avcTrack,i=e.id3Track,o=r.pesData,a=n.pesData,s=i.pesData;o&&(t=y(o))?(this.parseAVCPES(t,!0),r.pesData=null):r.pesData=o,a&&(t=y(a))?(n.isAAC?this.parseAACPES(t):this.parseMPEGPES(t),n.pesData=null):(null!=a&&a.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=a),s&&(t=y(s))?(this.parseID3PES(t),i.pesData=null):i.pesData=s},t.demuxSampleAes=function(e,t,n){var r=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new s.default(this.observer,this.config,t);return this.decrypt(r,i)},t.decrypt=function(e,t){return new Promise(function(n){var r=e.audioTrack,i=e.avcTrack;r.samples&&r.isAAC?t.decryptAacSamples(r.samples,0,function(){i.samples?t.decryptAvcSamples(i.samples,0,0,function(){n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,function(){n(e)})})},t.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},t.parseAVCPES=function(e,t){var n,r=this,i=this._avcTrack,s=this.parseAVCNALu(e.data),u=this.avcSample,l=!1;e.data=null,u&&s.length&&!i.audFound&&(m(u,i),u=this.avcSample=p(!1,e.pts,e.dts,"")),s.forEach(function(t){switch(t.type){case 1:n=!0,u||(u=r.avcSample=p(!0,e.pts,e.dts,"")),u.frame=!0;var s=t.data;if(l&&s.length>4){var c=new o.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(u.key=!0)}break;case 5:n=!0,u||(u=r.avcSample=p(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:n=!0;var f=new o.default(E(t.data));f.readUByte();for(var h=0,d=0,v=!1,g=0;!v&&f.bytesAvailable>1;){h=0;do{h+=g=f.readUByte()}while(255===g);d=0;do{d+=g=f.readUByte()}while(255===g);if(4===h&&0!==f.bytesAvailable){if(v=!0,181===f.readUByte())if(49===f.readUShort())if(1195456820===f.readUInt())if(3===f.readUByte()){for(var y=f.readUByte(),_=31&y,T=[y,f.readUByte()],k=0;k<_;k++)T.push(f.readUByte()),T.push(f.readUByte()),T.push(f.readUByte());b(r._txtTrack.samples,{type:3,pts:e.pts,bytes:T})}}else if(5===h&&0!==f.bytesAvailable){if(v=!0,d>16){for(var A=[],S=0;S<16;S++)A.push(f.readUByte().toString(16)),3!==S&&5!==S&&7!==S&&9!==S||A.push("-");for(var w=d-16,L=new Uint8Array(w),P=0;P<w;P++)L[P]=f.readUByte();b(r._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:A.join(""),userData:Object(a.utf8ArrayToStr)(L),userDataBytes:L})}}else if(d<f.bytesAvailable)for(var O=0;O<d;O++)f.readUByte()}break;case 7:if(n=!0,l=!0,!i.sps){var C=new o.default(t.data).readSPS();i.width=C.width,i.height=C.height,i.pixelRatio=C.pixelRatio,i.sps=[t.data],i.duration=r._duration;for(var R=t.data.subarray(1,4),D="avc1.",I=0;I<3;I++){var x=R[I].toString(16);x.length<2&&(x="0"+x),D+=x}i.codec=D}break;case 8:n=!0,i.pps||(i.pps=[t.data]);break;case 9:n=!1,i.audFound=!0,u&&m(u,i),u=r.avcSample=p(!1,e.pts,e.dts,"");break;case 12:n=!1;break;default:n=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&n&&u.units.push(t)}),t&&u&&(m(u,i),this.avcSample=null)},t.getLastNalUnit=function(){var e,t,n=this.avcSample;if(!n||0===n.units.length){var r=this._avcTrack.samples;n=r[r.length-1]}if(null!==(e=n)&&void 0!==e&&e.units){var i=n.units;t=i[i.length-1]}return t},t.parseAVCNALu=function(e){var t,n,r=e.byteLength,i=this._avcTrack,o=i.naluState||0,a=o,s=[],u=0,l=-1,c=0;for(-1===o&&(l=0,c=31&e[0],o=0,u=1);u<r;)if(t=e[u++],o)if(1!==o)if(t)if(1===t){if(l>=0){var f={data:e.subarray(l,u-o-1),type:c};s.push(f)}else{var h=this.getLastNalUnit();if(h&&(a&&u<=4-a&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-a)),(n=u-o-1)>0)){var d=new Uint8Array(h.data.byteLength+n);d.set(h.data,0),d.set(e.subarray(0,n),h.data.byteLength),h.data=d,h.state=0}}u<r?(l=u,c=31&e[u],o=0):o=-1}else o=0;else o=3;else o=t?0:2;else o=t?0:1;if(l>=0&&o>=0){var p={data:e.subarray(l,r),type:c,state:o};s.push(p)}if(0===s.length){var v=this.getLastNalUnit();if(v){var g=new Uint8Array(v.data.byteLength+e.byteLength);g.set(v.data,0),g.set(e,v.data.byteLength),v.data=g}}return i.naluState=o,s},t.parseAACPES=function(e){var t,n,i,o,a,s=0,l=this._audioTrack,h=this.aacOverFlow,d=e.data;if(h){this.aacOverFlow=null;var p=h.sample.unit.byteLength,v=Math.min(h.missing,p),g=p-v;h.sample.unit.set(d.subarray(0,v),g),l.samples.push(h.sample),s=h.missing}for(t=s,n=d.length;t<n-1&&!r.isHeader(d,t);t++);if(t!==s&&(t<n-1?(i="AAC PES did not start with ADTS header,offset:"+t,o=!1):(i="no ADTS header found in AAC PES",o=!0),c.logger.warn("parsing error:"+i),this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:o,reason:i}),o))return;if(r.initTrackConfig(l,this.observer,d,t,this.audioCodec),void 0!==e.pts)a=e.pts;else{if(!h)return void c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var y=r.getFrameDuration(l.samplerate);a=h.sample.pts+y}for(var m=0;t<n;){if(r.isHeader(d,t)){if(t+5<n){var b=r.appendFrame(l,d,t,a,m);if(b){if(!b.missing){t+=b.length,m++;continue}this.aacOverFlow=b}}break}t++}},t.parseMPEGPES=function(e){var t=e.data,n=t.length,r=0,o=0,a=e.pts;if(void 0!==a)for(;o<n;)if(i.isHeader(t,o)){var s=i.appendFrame(this._audioTrack,t,o,a,r);if(!s)break;o+=s.length,r++}else o++;else c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e){void 0!==e.pts?this._id3Track.samples.push(e):c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function p(e,t,n,r){return{key:e,frame:!1,pts:t,dts:n,units:[],debug:r,length:0}}function v(e,t){return(31&e[t+10])<<8|e[t+11]}function g(e,t,n,r){var i={audio:-1,avc:-1,id3:-1,isAAC:!0},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){var a=(31&e[t+1])<<8|e[t+2];switch(e[t]){case 207:if(!r){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=a);break;case 21:-1===i.id3&&(i.id3=a);break;case 219:if(!r){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=a);break;case 3:case 4:n?-1===i.audio&&(i.audio=a,i.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}function y(e){var t,n,r,i,o,a=0,s=e.data;if(!e||0===e.size)return null;for(;s[0].length<19&&s.length>1;){var u=new Uint8Array(s[0].length+s[1].length);u.set(s[0]),u.set(s[1],s[0].length),s[0]=u,s.splice(1,1)}if(1===((t=s[0])[0]<<16)+(t[1]<<8)+t[2]){if((n=(t[4]<<8)+t[5])&&n>e.size-6)return null;var l=t[7];192&l&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?i-(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(c.logger.warn(Math.round((i-o)/9e4)+"s delta between PTS and DTS, align them"),i=o):o=i);var f=(r=t[8])+9;if(e.size<=f)return null;e.size-=f;for(var h=new Uint8Array(e.size),d=0,p=s.length;d<p;d++){var v=(t=s[d]).byteLength;if(f){if(f>v){f-=v;continue}t=t.subarray(f),v-=f,f=0}h.set(t,a),a+=v}return n&&(n-=r+3),{data:h,pts:i,dts:o,len:n}}return null}function m(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var n=t.samples,r=n.length;if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}t.samples.push(e)}e.debug.length&&c.logger.log(e.pts+"/"+e.dts+":"+e.debug)}function b(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}function E(e){for(var t=e.byteLength,n=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;var i=t-n.length,o=new Uint8Array(i),a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),o[r]=e[a];return o}d.minProbeByteLength=188,t.default=d},"./src/errors.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",function(){return r}),n.d(t,"ErrorDetails",function(){return i}),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"}(i||(i={}))},"./src/events.ts":function(e,t,n){"use strict";var r;n.r(t),n.d(t,"Events",function(){return r}),function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"}(r||(r={}))},"./src/hls.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return m});var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),i=n("./src/loader/playlist-loader.ts"),o=n("./src/loader/key-loader.ts"),a=n("./src/controller/id3-track-controller.ts"),s=n("./src/controller/latency-controller.ts"),u=n("./src/controller/level-controller.ts"),l=n("./src/controller/fragment-tracker.ts"),c=n("./src/controller/stream-controller.ts"),f=n("./src/is-supported.ts"),h=n("./src/utils/logger.ts"),d=n("./src/config.ts"),p=n("./node_modules/eventemitter3/index.js"),v=n("./src/events.ts"),g=n("./src/errors.ts");function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=Object(d.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,Object(h.enableLogs)(n.debug),this._autoLevelCapping=-1,n.progressive&&Object(d.enableStreamingMode)(n);var r=n.abrController,f=n.bufferController,v=n.capLevelController,g=n.fpsController,y=this.abrController=new r(this),m=this.bufferController=new f(this),b=this.capLevelController=new v(this),E=new g(this),_=new i.default(this),T=new o.default(this),k=new a.default(this),A=this.levelController=new u.default(this),S=new l.FragmentTracker(this),w=this.streamController=new c.default(this,S);b.setStreamController(w),E.setStreamController(w);var L=[A,w];this.networkControllers=L;var P=[_,T,y,m,b,E,k,S];this.audioTrackController=this.createController(n.audioTrackController,null,L),this.createController(n.audioStreamController,S,L),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,L),this.createController(n.subtitleStreamController,S,L),this.createController(n.timelineController,null,P),this.emeController=this.createController(n.emeController,null,P),this.cmcdController=this.createController(n.cmcdController,null,P),this.latencyController=this.createController(s.default,null,P),this.coreComponents=P}e.isSupported=function(){return Object(f.isSupported)()};var t,n,m,b=e.prototype;return b.createController=function(e,t,n){if(e){var r=t?new e(this,t):new e(this);return n&&n.push(r),r}return null},b.on=function(e,t,n){void 0===n&&(n=this),this._emitter.on(e,t,n)},b.once=function(e,t,n){void 0===n&&(n=this),this._emitter.once(e,t,n)},b.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},b.off=function(e,t,n,r){void 0===n&&(n=this),this._emitter.off(e,t,n,r)},b.listeners=function(e){return this._emitter.listeners(e)},b.emit=function(e,t,n){return this._emitter.emit(e,t,n)},b.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){h.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(v.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1},b.listenerCount=function(e){return this._emitter.listenerCount(e)},b.destroy=function(){h.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0},b.attachMedia=function(e){h.logger.log("attachMedia"),this._media=e,this.trigger(v.Events.MEDIA_ATTACHING,{media:e})},b.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},b.loadSource=function(e){this.stopLoad();var t=this.media,n=this.url,i=this.url=r.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});h.logger.log("loadSource:"+i),t&&n&&n!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.Events.MANIFEST_LOADING,{url:e})},b.startLoad=function(e){void 0===e&&(e=-1),h.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},b.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},b.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.recoverMediaError=function(){h.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},b.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},t=e,m=[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:d.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}],(n=[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var n=e.length,r=0;r<n;r++)if(e[r].maxBitrate>t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&y(t.prototype,n),m&&y(t,m),e}();m.defaultConfig=void 0},"./src/is-supported.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"isSupported",function(){return o}),n.d(t,"changeTypeSupported",function(){return a});var r=n("./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function o(){var e=Object(r.getMediaSource)();if(!e)return!1;var t=i(),n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),o=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!o}function a(){var e,t=i();return"function"==typeof(null==t?void 0:null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./src/loader/fragment-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return c}),n.d(t,"LoadError",function(){return h});var r=n("./src/polyfills/number.ts"),i=n("./src/errors.ts");function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return a(e,arguments,u(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function a(e,t,n){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=Math.pow(2,17),c=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var n=this,r=e.url;if(!r)return Promise.reject(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var o=this.config,a=o.fLoader,s=o.loader;return new Promise(function(r,u){n.loader&&n.loader.destroy();var c=n.loader=e.loader=a?new a(o):new s(o),d=f(e),p={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:l};e.stats=c.stats,c.load(d,p,{onSuccess:function(t,i,o,a){n.resetLoader(e,c),r({frag:e,part:null,payload:t.data,networkDetails:a})},onError:function(t,r,o){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:o}))},onAbort:function(t,r,o){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:o}))},onTimeout:function(t,r,o){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:o}))},onProgress:function(n,r,i,o){t&&t({frag:e,part:null,payload:i,networkDetails:o})}})})},t.loadPart=function(e,t,n){var r=this;this.abort();var o=this.config,a=o.fLoader,s=o.loader;return new Promise(function(u,c){r.loader&&r.loader.destroy();var d=r.loader=e.loader=a?new a(o):new s(o),p=f(e,t),v={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:l};t.stats=d.stats,d.load(p,v,{onSuccess:function(i,o,a,s){r.resetLoader(e,d),r.updateStatsFromPart(e,t);var l={frag:e,part:t,payload:i.data,networkDetails:s};n(l),u(l)},onError:function(n,o,a){r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:n,networkDetails:a}))},onAbort:function(n,o,a){e.stats.aborted=t.stats.aborted,r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:a}))},onTimeout:function(n,o,a){r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:a}))}})})},t.updateStatsFromPart=function(e,t){var n=e.stats,r=t.stats,i=r.total;if(n.loaded+=r.loaded,i){var o=Math.round(e.duration/t.duration),a=Math.min(Math.round(n.loaded/i),o),s=(o-a)*Math.round(n.loaded/a);n.total=n.loaded+s}else n.total=Math.max(n.loaded,n.total);var u=n.loading,l=r.loading;u.start?u.first+=l.first-l.start:(u.start=l.start,u.first=l.first),u.end=l.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function f(e,t){void 0===t&&(t=null);var n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},o=n.byteRangeStartOffset,a=n.byteRangeEndOffset;return Object(r.isFiniteNumber)(o)&&Object(r.isFiniteNumber)(a)&&(i.rangeStart=o,i.rangeEnd=a),i}var h=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(n=e.call.apply(e,[this].concat(i))||this).data=void 0,n.data=t,n}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n),r}(o(Error))},"./src/loader/fragment.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"ElementaryStreamTypes",function(){return r}),n.d(t,"BaseSegment",function(){return d}),n.d(t,"Fragment",function(){return p}),n.d(t,"Part",function(){return v});var r,i=n("./src/polyfills/number.ts"),o=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/utils/logger.ts"),s=n("./src/loader/level-key.ts"),u=n("./src/loader/load-stats.ts");function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}!function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"}(r||(r={}));var d=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},h(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),p=function(e){function t(t,n){var r;return(r=e.call(this,n)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new u.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=t,r}l(t,e);var n=t.prototype;return n.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},n.setDecryptDataFromLevelKey=function(e,t){var n=e;return"AES-128"===(null==e?void 0:e.method)&&e.uri&&!e.iv&&((n=s.LevelKey.fromURI(e.uri)).method=e.method,n.iv=this.createInitializationVector(t),n.keyFormat="identity"),n},n.setElementaryStreamInfo=function(e,t,n,r,i,o){void 0===o&&(o=!1);var a=this.elementaryStreams,s=a[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,n),s.startDTS=Math.min(s.startDTS,r),s.endDTS=Math.max(s.endDTS,i)):a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:i,partial:o}},n.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[r.AUDIO]=null,e[r.VIDEO]=null,e[r.AUDIOVIDEO]=null},h(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(i.isFiniteNumber)(this.programDateTime))return null;var e=Object(i.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;return!(null===(e=this.decryptdata)||void 0===e||!e.keyFormat||!this.decryptdata.uri)}}]),t}(d),v=function(e){function t(t,n,r,i,o){var a;(a=e.call(this,r)||this).fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new u.LoadStats,a.duration=t.decimalFloatingPoint("DURATION"),a.gap=t.bool("GAP"),a.independent=t.bool("INDEPENDENT"),a.relurl=t.enumeratedString("URI"),a.fragment=n,a.index=i;var s=t.enumeratedString("BYTERANGE");return s&&a.setByteRange(s,o),o&&(a.fragOffset=o.fragOffset+o.duration),a}return l(t,e),h(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(d)},"./src/loader/key-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return a});var r=n("./src/events.ts"),i=n("./src/errors.ts"),o=n("./src/utils/logger.ts"),a=function(){function e(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){this.hls.on(r.Events.KEY_LOADING,this.onKeyLoading,this)},t._unregisterListeners=function(){this.hls.off(r.Events.KEY_LOADING,this.onKeyLoading)},t.destroy=function(){for(var e in this._unregisterListeners(),this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},t.onKeyLoading=function(e,t){var n=t.frag,i=n.type,a=this.loaders[i];if(n.decryptdata){var s=n.decryptdata.uri;if(s!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;if(a&&(o.logger.warn("abort previous key loader for type:"+i),a.abort()),!s)return void o.logger.warn("key uri is falsy");var l=u.loader,c=n.loader=this.loaders[i]=new l(u);this.decrypturl=s,this.decryptkey=null;var f={url:s,frag:n,responseType:"arraybuffer"},h={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(f,h,d)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(r.Events.KEY_LOADED,{frag:n}))}else o.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(e,t,n){var i=n.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=null,delete this.loaders[i.type],this.hls.trigger(r.Events.KEY_LOADED,{frag:i})):o.logger.error("after key load, decryptdata unset")},t.loaderror=function(e,t){var n=t.frag,o=n.loader;o&&o.abort(),delete this.loaders[n.type],this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},t.loadtimeout=function(e,t){var n=t.frag,o=n.loader;o&&o.abort(),delete this.loaders[n.type],this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},e}()},"./src/loader/level-details.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"LevelDetails",function(){return o});var r=n("./src/polyfills/number.ts");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=e}var t,n,o;return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},t=e,(n=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(r.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&i(t.prototype,n),o&&i(t,o),e}()},"./src/loader/level-key.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"LevelKey",function(){return o});var r=n("./node_modules/url-toolkit/src/url-toolkit.js");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(e,t){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=t?Object(r.buildAbsoluteURL)(e,t,{alwaysNormalize:!0}):e}var t,n,o;return e.fromURL=function(t,n){return new e(t,n)},e.fromURI=function(t){return new e(t)},t=e,(n=[{key:"uri",get:function(){return this._uri}}])&&i(t.prototype,n),o&&i(t,o),e}()},"./src/loader/load-stats.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"LoadStats",function(){return r});var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return g});var r=n("./src/polyfills/number.ts"),i=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/loader/fragment.ts"),a=n("./src/loader/level-details.ts"),s=n("./src/loader/level-key.ts"),u=n("./src/utils/attr-list.ts"),l=n("./src/utils/logger.ts"),c=n("./src/utils/codecs.ts"),f=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,d=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;var g=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var n=t.shift()+".";return n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).substr(-4)}return e},e.resolve=function(e,t){return i.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],o={},a=!1;for(f.lastIndex=0;null!=(r=f.exec(t));)if(r[1]){var s=new u.AttrList(r[1]),l={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:e.resolve(r[2],n)},c=s.decimalResolution("RESOLUTION");c&&(l.width=c.width,l.height=c.height),y((s.CODECS||"").split(/[ ,]+/).filter(function(e){return e}),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=e.convertAVC1ToAVCOTI(l.videoCodec)),i.push(l)}else if(r[3]){var h=new u.AttrList(r[3]);h["DATA-ID"]&&(a=!0,o[h["DATA-ID"]]=h)}return{levels:i,sessionData:a?o:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var o;void 0===i&&(i=[]);var a=[],s=0;for(h.lastIndex=0;null!==(o=h.exec(t));){var l=new u.AttrList(o[1]);if(l.TYPE===r){var c={attrs:l,bitrate:0,id:s++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:r,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?e.resolve(l.URI,n):""};if(i.length){var f=e.findGroup(i,c.groupId)||i[0];m(c,f,"audioCodec"),m(c,f,"textCodec")}a.push(c)}}return a},e.parseLevelPlaylist=function(e,t,n,c,f){var h,g,y,m=new a.LevelDetails(t),E=m.fragments,_=null,T=0,k=0,A=0,S=0,w=null,L=new o.Fragment(c,t),P=-1,O=!1;for(d.lastIndex=0,m.m3u8=e;null!==(h=d.exec(e));){O&&(O=!1,(L=new o.Fragment(c,t)).start=A,L.sn=T,L.cc=S,L.level=n,_&&(L.initSegment=_,L.rawProgramDateTime=_.rawProgramDateTime));var C=h[1];if(C){L.duration=parseFloat(C);var R=(" "+h[2]).slice(1);L.title=R||null,L.tagList.push(R?["INF",C,R]:["INF",C])}else if(h[3])Object(r.isFiniteNumber)(L.duration)&&(L.start=A,y&&(L.levelkey=y),L.sn=T,L.level=n,L.cc=S,L.urlId=f,E.push(L),L.relurl=(" "+h[3]).slice(1),b(L,w),w=L,A+=L.duration,T++,k=0,O=!0);else if(h[4]){var D=(" "+h[4]).slice(1);w?L.setByteRange(D,w):L.setByteRange(D)}else if(h[5])L.rawProgramDateTime=(" "+h[5]).slice(1),L.tagList.push(["PROGRAM-DATE-TIME",L.rawProgramDateTime]),-1===P&&(P=E.length);else{if(!(h=h[0].match(p))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(g=1;g<h.length&&void 0===h[g];g++);var I=(" "+h[g]).slice(1),x=(" "+h[g+1]).slice(1),M=h[g+2]?(" "+h[g+2]).slice(1):"";switch(I){case"PLAYLIST-TYPE":m.type=x.toUpperCase();break;case"MEDIA-SEQUENCE":T=m.startSN=parseInt(x);break;case"SKIP":var F=new u.AttrList(x),N=F.decimalInteger("SKIPPED-SEGMENTS");if(Object(r.isFiniteNumber)(N)){m.skippedSegments=N;for(var U=N;U--;)E.unshift(null);T+=N}var B=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");B&&(m.recentlyRemovedDateranges=B.split("\t"));break;case"TARGETDURATION":m.targetduration=parseFloat(x);break;case"VERSION":m.version=parseInt(x);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(x||M)&&L.tagList.push(M?[x,M]:[x]);break;case"DIS":S++;case"GAP":L.tagList.push([I]);break;case"BITRATE":L.tagList.push([I,x]);break;case"DISCONTINUITY-SEQ":S=parseInt(x);break;case"KEY":var j,H=new u.AttrList(x),G=H.enumeratedString("METHOD"),V=H.URI,Y=H.hexadecimalInteger("IV"),K=H.enumeratedString("KEYFORMATVERSIONS"),z=H.enumeratedString("KEYID"),W=null!=(j=H.enumeratedString("KEYFORMAT"))?j:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(W)>-1){l.logger.warn("Keyformat "+W+" is not supported from the manifest");continue}if("identity"!==W)continue;G&&(y=s.LevelKey.fromURL(t,V),V&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(G)>=0&&(y.method=G,y.keyFormat=W,z&&(y.keyID=z),K&&(y.keyFormatVersions=K),y.iv=Y));break;case"START":var q=new u.AttrList(x).decimalFloatingPoint("TIME-OFFSET");Object(r.isFiniteNumber)(q)&&(m.startTimeOffset=q);break;case"MAP":var X=new u.AttrList(x);L.relurl=X.URI,X.BYTERANGE&&L.setByteRange(X.BYTERANGE),L.level=n,L.sn="initSegment",y&&(L.levelkey=y),L.initSegment=null,_=L,O=!0;break;case"SERVER-CONTROL":var $=new u.AttrList(x);m.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),m.holdBack=$.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Q=new u.AttrList(x);m.partTarget=Q.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=m.partList;J||(J=m.partList=[]);var Z=k>0?J[J.length-1]:void 0,ee=k++,te=new o.Part(new u.AttrList(x),L,t,ee,Z);J.push(te),L.duration+=te.duration;break;case"PRELOAD-HINT":var ne=new u.AttrList(x);m.preloadHint=ne;break;case"RENDITION-REPORT":var re=new u.AttrList(x);m.renditionReports=m.renditionReports||[],m.renditionReports.push(re);break;default:l.logger.warn("line parsed but not handled: "+h)}}}w&&!w.relurl?(E.pop(),A-=w.duration,m.partList&&(m.fragmentHint=w)):m.partList&&(b(L,w),L.cc=S,m.fragmentHint=L);var ie=E.length,oe=E[0],ae=E[ie-1];if((A+=m.skippedSegments*m.targetduration)>0&&ie&&ae){m.averagetargetduration=A/ie;var se=ae.sn;m.endSN="initSegment"!==se?se:0,oe&&(m.startCC=oe.cc,oe.initSegment||m.fragments.every(function(e){return e.relurl&&(t=e.relurl,v.test(null!=(n=null===(r=i.parseURL(t))||void 0===r?void 0:r.path)?n:""));var t,n,r})&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(L=new o.Fragment(c,t)).relurl=ae.relurl,L.level=n,L.sn="initSegment",oe.initSegment=L,m.needSidxRanges=!0))}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(A+=m.fragmentHint.duration),m.totalduration=A,m.endCC=S,P>0&&function(e,t){for(var n=e[t],r=t;r--;){var i=e[r];if(!i)return;i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(E,P),m},e}();function y(e,t){["video","audio","text"].forEach(function(n){var r=e.filter(function(e){return Object(c.isCodecType)(e,n)});if(r.length){var i=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}function m(e,t,n){var r=t[n];r&&(e[n]=r)}function b(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(r.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),o=n("./src/errors.ts"),a=n("./src/utils/logger.ts"),s=n("./src/utils/mp4-tools.ts"),u=n("./src/loader/m3u8-parser.ts"),l=n("./src/types/loader.ts"),c=n("./src/utils/attr-list.ts");function f(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}var h=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var n=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:l.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var n=t.id,r=t.level,i=t.url,o=t.deliveryDirectives;this.load({id:n,groupId:null,level:r,responseType:"text",type:l.PlaylistContextType.LEVEL,url:i,deliveryDirectives:o})},t.onAudioTrackLoading=function(e,t){var n=t.id,r=t.groupId,i=t.url,o=t.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:l.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:o})},t.onSubtitleTrackLoading=function(e,t){var n=t.id,r=t.groupId,i=t.url,o=t.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:l.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:o})},t.load=function(e){var t,n,r,i,o,s,u=this.hls.config,c=this.getInternalLoader(e);if(c){var f=c.context;if(f&&f.url===e.url)return void a.logger.trace("[playlist-loader]: playlist request ongoing");a.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),c.abort()}switch(e.type){case l.PlaylistContextType.MANIFEST:n=u.manifestLoadingMaxRetry,r=u.manifestLoadingTimeOut,i=u.manifestLoadingRetryDelay,o=u.manifestLoadingMaxRetryTimeout;break;case l.PlaylistContextType.LEVEL:case l.PlaylistContextType.AUDIO_TRACK:case l.PlaylistContextType.SUBTITLE_TRACK:n=0,r=u.levelLoadingTimeOut;break;default:n=u.levelLoadingMaxRetry,r=u.levelLoadingTimeOut,i=u.levelLoadingRetryDelay,o=u.levelLoadingMaxRetryTimeout}if((c=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part)&&(e.type===l.PlaylistContextType.LEVEL&&null!==e.level?s=this.hls.levels[e.level].details:e.type===l.PlaylistContextType.AUDIO_TRACK&&null!==e.id?s=this.hls.audioTracks[e.id].details:e.type===l.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(s=this.hls.subtitleTracks[e.id].details),s)){var h=s.partTarget,d=s.targetduration;h&&d&&(r=Math.min(1e3*Math.max(3*h,.8*d),r))}var p={timeout:r,maxRetry:n,retryDelay:i,maxRetryDelay:o,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(e,p,v)},t.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this.handleSidxRequest(e,n),void this.handlePlaylistLoaded(e,t,n,r);this.resetInternalLoader(n.type);var i=e.data;0===i.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,n,r):this.handleMasterPlaylist(e,t,n,r)):this.handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},t.loaderror=function(e,t,n){void 0===n&&(n=null),this.handleNetworkError(t,n,!1,e)},t.loadtimeout=function(e,t,n){void 0===n&&(n=null),this.handleNetworkError(t,n,!0)},t.handleMasterPlaylist=function(e,t,n,r){var o=this.hls,s=e.data,l=f(e,n),h=u.default.parseMasterPlaylist(s,l),d=h.levels,p=h.sessionData;if(d.length){var v=d.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}}),g=d.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}}),y=u.default.parseMasterPlaylistMedia(s,l,"AUDIO",v),m=u.default.parseMasterPlaylistMedia(s,l,"SUBTITLES",g),b=u.default.parseMasterPlaylistMedia(s,l,"CLOSED-CAPTIONS");if(y.length)y.some(function(e){return!e.url})||!d[0].audioCodec||d[0].attrs.AUDIO||(a.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}));o.trigger(i.Events.MANIFEST_LOADED,{levels:d,audioTracks:y,subtitles:m,captions:b,url:l,stats:t,networkDetails:r,sessionData:p})}else this.handleManifestParsingError(e,n,"no level found in manifest",r)},t.handleTrackOrLevelPlaylist=function(e,t,n,a){var s=this.hls,h=n.id,d=n.level,p=n.type,v=f(e,n),g=Object(r.isFiniteNumber)(h)?h:0,y=Object(r.isFiniteNumber)(d)?d:g,m=function(e){switch(e.type){case l.PlaylistContextType.AUDIO_TRACK:return l.PlaylistLevelType.AUDIO;case l.PlaylistContextType.SUBTITLE_TRACK:return l.PlaylistLevelType.SUBTITLE;default:return l.PlaylistLevelType.MAIN}}(n),b=u.default.parseLevelPlaylist(e.data,v,y,m,g);if(b.fragments.length){if(p===l.PlaylistContextType.MANIFEST){var E={attrs:new c.AttrList({}),bitrate:0,details:b,name:"",url:v};s.trigger(i.Events.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:v,stats:t,networkDetails:a,sessionData:null})}if(t.parsing.end=performance.now(),b.needSidxRanges){var _,T=null===(_=b.fragments[0].initSegment)||void 0===_?void 0:_.url;this.load({url:T,isSidxRequest:!0,type:p,level:d,levelDetails:b,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=b,this.handlePlaylistLoaded(e,t,n,a)}else s.trigger(i.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},t.handleSidxRequest=function(e,t){var n=Object(s.parseSegmentIndex)(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach(function(e,t){var r=e.info,o=i.fragments[t];0===o.byteRange.length&&o.setByteRange(String(1+r.end-r.start)+"@"+String(r.start)),o.initSegment&&o.initSegment.setByteRange(String(n.moovEndOffset)+"@0")})}},t.handleManifestParsingError=function(e,t,n,r){this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===l.PlaylistContextType.MANIFEST,url:e.url,reason:n,response:e,context:t,networkDetails:r})},t.handleNetworkError=function(e,t,n,r){void 0===n&&(n=!1),a.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=o.ErrorDetails.UNKNOWN,u=!1,c=this.getInternalLoader(e);switch(e.type){case l.PlaylistContextType.MANIFEST:s=n?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case l.PlaylistContextType.LEVEL:s=n?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case l.PlaylistContextType.AUDIO_TRACK:s=n?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case l.PlaylistContextType.SUBTITLE_TRACK:s=n?o.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:o.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}c&&this.resetInternalLoader(e.type);var f={type:o.ErrorTypes.NETWORK_ERROR,details:s,fatal:u,url:e.url,loader:c,context:e,networkDetails:t};r&&(f.response=r),this.hls.trigger(i.Events.ERROR,f)},t.handlePlaylistLoaded=function(e,t,n,r){var o=n.type,a=n.level,s=n.id,u=n.groupId,c=n.loader,f=n.levelDetails,h=n.deliveryDirectives;if(null!=f&&f.targetduration){if(c)switch(f.live&&(c.getCacheAge&&(f.ageHeader=c.getCacheAge()||0),c.getCacheAge&&!isNaN(f.ageHeader)||(f.ageHeader=0)),o){case l.PlaylistContextType.MANIFEST:case l.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:f,level:a||0,id:s||0,stats:t,networkDetails:r,deliveryDirectives:h});break;case l.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:f,id:s||0,groupId:u||"",stats:t,networkDetails:r,deliveryDirectives:h});break;case l.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:f,id:s||0,groupId:u||"",stats:t,networkDetails:r,deliveryDirectives:h})}}else this.handleManifestParsingError(e,n,"invalid target duration",r)},e}();t.default=h},"./src/polyfills/number.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",function(){return r}),n.d(t,"MAX_SAFE_INTEGER",function(){return i});var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(e,t,n){"use strict";n.r(t);var r=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();t.default=r},"./src/remux/mp4-generator.ts":function(e,t,n){"use strict";n.r(t);var r=Math.pow(2,32)-1,i=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t=8,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=r.length,a=o;o--;)t+=r[o].byteLength;var s=new Uint8Array(t);for(s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=255&t,s.set(e,4),o=0,t=8;o<a;o++)s.set(r[o],t),t+=r[o].byteLength;return s},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var i=Math.floor(n/(r+1)),o=Math.floor(n%(r+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var i=Math.floor(n/(r+1)),o=Math.floor(n%(r+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var n,r,i=t.samples||[],o=new Uint8Array(4+i.length);for(n=0;n<i.length;n++)r=i[n].flags,o[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,o)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,o=[],a=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(a))),u=t.width,l=t.height,c=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,f>>24,f>>16&255,f>>8&255,255&f])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,i=t.duration*t.timescale,o=t.width,a=t.height,s=Math.floor(i/(r+1)),u=Math.floor(i%(r+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,n){var i=e.sdtp(t),o=t.id,a=Math.floor(n/(r+1)),s=Math.floor(n%(r+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,i.length+16+20+8+16+8+8),i)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,o,a,s,u,l=t.samples||[],c=l.length,f=12+16*c,h=new Uint8Array(f);for(n+=8+f,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)o=(i=l[r]).duration,a=i.size,s=i.flags,u=i.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var n=e.moov(t),r=new Uint8Array(e.FTYP.byteLength+n.byteLength);return r.set(e.FTYP),r.set(n,e.FTYP.byteLength),r},e}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,t.default=i},"./src/remux/mp4-remuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return v}),n.d(t,"normalizePts",function(){return g});var r=n("./src/polyfills/number.ts"),i=n("./src/remux/aac-helper.ts"),o=n("./src/remux/mp4-generator.ts"),a=n("./src/events.ts"),s=n("./src/errors.ts"),u=n("./src/utils/logger.ts"),l=n("./src/types/loader.ts"),c=n("./src/utils/timescale-conversion.ts");function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var h=null,d=null,p=!1,v=function(){function e(e,t,n,r){if(void 0===r&&(r=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===h){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=i?parseInt(i[1]):0}if(null===d){var o=navigator.userAgent.match(/Safari\/(\d+)/i);d=o?parseInt(o[1]):0}p=!!h&&h<75||!!d&&d<600}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){u.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){u.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){u.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce(function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,g(e,n.pts)):r>0?e:n.pts},e[0].pts);return t&&u.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,r,i,o,a,s){var c,f,h,d,p,v,y=i,m=i,b=e.pid>-1,E=t.pid>-1,_=t.samples.length,T=e.samples.length>0,k=_>1;if((!b||T)&&(!E||k)||this.ISGenerated||a){this.ISGenerated||(h=this.generateIS(e,t,i));var A=this.isVideoContiguous,S=-1;if(k&&(S=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!A&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,S>0){u.logger.warn("[mp4-remuxer]: Dropped "+S+" out of "+_+" video samples due to a missing keyframe");var w=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(S),t.dropped+=S,m+=(t.samples[0].pts-w)/(t.timescale||9e4)}else-1===S&&(u.logger.warn("[mp4-remuxer]: No keyframe found out of "+_+" video samples"),v=!1);if(this.ISGenerated){if(T&&k){var L=this.getVideoStartPts(t.samples),P=(g(e.samples[0].pts,L)-L)/t.inputTimeScale;y+=Math.max(0,P),m+=Math.max(0,-P)}if(T){if(e.samplerate||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i)),f=this.remuxAudio(e,y,this.isAudioContiguous,o,E||k||s===l.PlaylistLevelType.AUDIO?m:void 0),k){var O=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,i)),c=this.remuxVideo(t,m,A,O)}}else k&&(c=this.remuxVideo(t,m,A,0));c&&(c.firstKeyFrame=S,c.independent=-1!==S)}}return this.ISGenerated&&(n.samples.length&&(p=this.remuxID3(n,i)),r.samples.length&&(d=this.remuxText(r,i))),{audio:f,video:c,initSegment:h,independent:v,text:d,id3:p}},t.generateIS=function(e,t,n){var i,a,s,u=e.samples,l=t.samples,c=this.typeSupported,f={},h=!Object(r.isFiniteNumber)(this._initPTS),d="audio/mp4";if(h&&(i=a=1/0),e.config&&u.length&&(e.timescale=e.samplerate,e.isAAC||(c.mpeg?(d="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),f.audio={id:"audio",container:d,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array(0):o.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(s=e.inputTimeScale,i=a=u[0].pts-Math.round(s*n))),t.sps&&t.pps&&l.length&&(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:o.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h)){s=t.inputTimeScale;var p=this.getVideoStartPts(l),v=Math.round(s*n);a=Math.min(a,g(l[0].dts,p)-v),i=Math.min(i,p-v)}if(Object.keys(f).length)return this.ISGenerated=!0,h&&(this._initPTS=i,this._initDTS=a),{tracks:f,initPTS:i,timescale:s}},t.remuxVideo=function(e,t,n,r){var i,l,d,v=e.inputTimeScale,m=e.samples,b=[],E=m.length,_=this._initPTS,T=this.nextAvcDts,k=8,A=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,w=0,L=!1;n&&null!==T||(T=t*v-(m[0].pts-g(m[0].dts,m[0].pts)));for(var P=0;P<E;P++){var O=m[P];if(O.pts=g(O.pts-_,T),O.dts=g(O.dts-_,T),O.dts>O.pts){w=Math.max(Math.min(w,O.pts-O.dts),-18e3)}O.dts<m[P>0?P-1:P].dts&&(L=!0)}L&&m.sort(function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r}),l=m[0].dts,d=m[m.length-1].dts;var C=Math.round((d-l)/(E-1));if(w<0){if(w<-2*C){u.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-C,!0)+" ms");for(var R=w,D=0;D<E;D++)m[D].dts=R=Math.max(R,m[D].pts-C),m[D].pts=Math.max(R,m[D].pts)}else{u.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(w,!0)+" ms to overcome this issue");for(var I=0;I<E;I++)m[I].dts=m[I].dts+w}l=m[0].dts}if(n){var x=l-T,M=x>C;if(M||x<-1){M?u.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(x,!0)+" ms ("+x+"dts) hole between fragments detected, filling it"):u.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(-x,!0)+" ms ("+x+"dts) overlapping between fragments detected"),l=T;var F=m[0].pts-x;m[0].dts=l,m[0].pts=F,u.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(F,!0)+"/"+Object(c.toMsFromMpegTsClock)(l,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(x,!0)+" ms")}}p&&(l=Math.max(0,l));for(var N=0,U=0,B=0;B<E;B++){for(var j=m[B],H=j.units,G=H.length,V=0,Y=0;Y<G;Y++)V+=H[Y].data.length;U+=V,N+=G,j.length=V,j.dts=Math.max(j.dts,l),j.pts=Math.max(j.pts,j.dts,0),A=Math.min(j.pts,A),S=Math.max(j.pts,S)}d=m[E-1].dts;var K,z=U+4*N+8;try{K=new Uint8Array(z)}catch(e){return void this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:z,reason:"fail allocating video mdat "+z})}var W=new DataView(K.buffer);W.setUint32(0,z),K.set(o.default.types.mdat,4);for(var q=0;q<E;q++){for(var X=m[q],$=X.units,Q=0,J=0,Z=$.length;J<Z;J++){var ee=$[J],te=ee.data,ne=ee.data.byteLength;W.setUint32(k,ne),k+=4,K.set(te,k),k+=ne,Q+=4+ne}if(q<E-1)i=m[q+1].dts-X.dts;else{var re=this.config,ie=X.dts-m[q>0?q-1:q].dts;if(re.stretchShortVideoTrack&&null!==this.nextAudioPts){var oe=Math.floor(re.maxBufferHole*v),ae=(r?A+r*v:this.nextAudioPts)-X.pts;ae>oe?((i=ae-ie)<0&&(i=ie),u.logger.log("[mp4-remuxer]: It is approximately "+ae/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=ie}else i=ie}var se=Math.round(X.pts-X.dts);b.push(new y(X.key,i,Q,se))}if(b.length&&h&&h<70){var ue=b[0].flags;ue.dependsOn=2,ue.isNonSync=0}console.assert(void 0!==i,"mp4SampleDuration must be computed"),this.nextAvcDts=T=d+i,this.isVideoContiguous=!0;var le={data1:o.default.moof(e.sequenceNumber++,l,f({},e,{samples:b})),data2:K,startPTS:A/v,endPTS:(S+i)/v,startDTS:l/v,endDTS:T/v,type:"video",hasAudio:!1,hasVideo:!0,nb:b.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(K.length,"MDAT length must not be zero"),le},t.remuxAudio=function(e,t,n,r,l){var c=e.inputTimeScale,h=c/(e.samplerate?e.samplerate:c),d=e.isAAC?1024:1152,p=d*h,v=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,b=[],E=e.samples,_=m?0:8,T=this.nextAudioPts||-1,k=t*c;if(this.isAudioContiguous=n=n||E.length&&T>0&&(r&&Math.abs(k-T)<9e3||Math.abs(g(E[0].pts-v,k)-T)<20*p),E.forEach(function(e){e.pts=g(e.pts-v,k)}),!n||T<0){if(!(E=E.filter(function(e){return e.pts>=0})).length)return;T=0===l?0:r?Math.max(0,k):E[0].pts}if(e.isAAC)for(var A=void 0!==l,S=this.config.maxAudioFramesDrift,w=0,L=T;w<E.length;w++){var P=E[w],O=P.pts,C=O-L,R=Math.abs(1e3*C/c);if(C<=-S*p&&A)0===w&&(u.logger.warn("Audio frame @ "+(O/c).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*C/c)+" ms."),this.nextAudioPts=T=L=O);else if(C>=S*p&&R<1e4&&A){var D=Math.round(C/p);(L=O-D*p)<0&&(D--,L+=p),0===w&&(this.nextAudioPts=T=L),u.logger.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(L/c).toFixed(3)+"s due to "+Math.round(1e3*C/c)+" ms gap.");for(var I=0;I<D;I++){var x=Math.max(L,0),M=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);M||(u.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),M=P.unit.subarray()),E.splice(w,0,{unit:M,pts:x}),L+=p,w++}}P.pts=L,L+=p}for(var F,N=null,U=null,B=0,j=E.length;j--;)B+=E[j].unit.byteLength;for(var H=0,G=E.length;H<G;H++){var V=E[H],Y=V.unit,K=V.pts;if(null!==U){b[H-1].duration=Math.round((K-U)/h)}else{if(n&&e.isAAC&&(K=T),N=K,!(B>0))return;B+=_;try{F=new Uint8Array(B)}catch(e){return void this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating audio mdat "+B})}m||(new DataView(F.buffer).setUint32(0,B),F.set(o.default.types.mdat,4))}F.set(Y,_);var z=Y.byteLength;_+=z,b.push(new y(!0,d,z,0)),U=K}var W=b.length;if(W){var q=b[b.length-1];this.nextAudioPts=T=U+h*q.duration;var X=m?new Uint8Array(0):o.default.moof(e.sequenceNumber++,N/h,f({},e,{samples:b}));e.samples=[];var $=N/c,Q=T/c,J={data1:X,data2:F,startPTS:$,endPTS:Q,startDTS:$,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.isAudioContiguous=!0,console.assert(F.length,"MDAT length must not be zero"),J}},t.remuxEmptyAudio=function(e,t,n,r){var o=e.inputTimeScale,a=o/(e.samplerate?e.samplerate:o),s=this.nextAudioPts,l=(null!==s?s:r.startDTS*o)+this._initDTS,c=r.endDTS*o+this._initDTS,f=1024*a,h=Math.ceil((c-l)/f),d=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(u.logger.warn("[mp4-remuxer]: remux empty Audio"),d){for(var p=[],v=0;v<h;v++){var g=l+v*f;p.push({unit:d,pts:g,dts:g})}return e.samples=p,this.remuxAudio(e,t,n,!1)}u.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var r=e.inputTimeScale,i=this._initPTS,o=this._initDTS,a=0;a<n;a++){var s=e.samples[a];s.pts=g(s.pts-i,t*r)/r,s.dts=g(s.dts-o,t*r)/r}var u=e.samples;return e.samples=[],{samples:u}}},t.remuxText=function(e,t){var n=e.samples.length;if(n){for(var r=e.inputTimeScale,i=this._initPTS,o=0;o<n;o++){var a=e.samples[o];a.pts=g(a.pts-i,t*r)/r}e.samples.sort(function(e,t){return e.pts-t.pts});var s=e.samples;return e.samples=[],{samples:s}}},e}();function g(e,t){var n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}var y=function(e,t,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=r,this.flags=new m(e)},m=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/polyfills/number.ts"),i=n("./src/utils/mp4-tools.ts"),o=n("./src/loader/fragment.ts"),a=n("./src/utils/logger.ts"),s=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndDTS=null},t.resetNextTimestamp=function(){this.lastEndDTS=null},t.resetInitSegment=function(e,t,n){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,n=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var r=this.initData=Object(i.parseInitSegment)(e);t||(t=l(r.audio,o.ElementaryStreamTypes.AUDIO)),n||(n=l(r.video,o.ElementaryStreamTypes.VIDEO));var s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:a.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},t.remux=function(e,t,n,o,s){var l=this.initPTS,c=this.lastEndDTS,f={audio:void 0,video:void 0,text:o,id3:n,initSegment:void 0};Object(r.isFiniteNumber)(c)||(c=this.lastEndDTS=s||0);var h=t.samples;if(!h||!h.length)return f;var d={initPTS:void 0,timescale:1},p=this.initData;if(p&&p.length||(this.generateInitSegment(h),p=this.initData),!p||!p.length)return a.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1),Object(r.isFiniteNumber)(l)||(this.initPTS=d.initPTS=l=u(p,h,c));var v=Object(i.getDuration)(h,p),g=c,y=v+g;Object(i.offsetStartDTS)(p,h,l),v>0?this.lastEndDTS=y:(a.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var m=!!p.audio,b=!!p.video,E="";m&&(E+="audio"),b&&(E+="video");var _={data1:h,startPTS:g,startDTS:g,endPTS:y,endDTS:y,type:E,hasAudio:m,hasVideo:b,nb:1,dropped:0};return f.audio="audio"===_.type?_:void 0,f.video="audio"!==_.type?_:void 0,f.text=o,f.id3=n,f.initSegment=d,f},e}(),u=function(e,t,n){return Object(i.getStartDTS)(e,t)-n};function l(e,t){var n=null==e?void 0:e.codec;return n&&n.length>4?n:"hvc1"===n?"hvc1.1.c.L120.90":"av01"===n?"av01.0.04M.08":"avc1"===n||t===o.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=s},"./src/task-loop.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var r=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./src/types/cmcd.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"CMCDVersion",function(){return a}),n.d(t,"CMCDObjectType",function(){return r}),n.d(t,"CMCDStreamingFormat",function(){return i}),n.d(t,"CMCDStreamType",function(){return o});var r,i,o,a=1;!function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"}(r||(r={})),function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(i||(i={})),function(e){e.VOD="v",e.LIVE="l"}(o||(o={}))},"./src/types/level.ts":function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i;function o(e,t){var n=e.canSkipUntil,r=e.canSkipDateRanges,o=e.endSN;return n&&(void 0!==t?t-o:0)<n?r?i.v2:i.Yes:i.No}n.r(t),n.d(t,"HlsSkip",function(){return i}),n.d(t,"getSkipValue",function(){return o}),n.d(t,"HlsUrlParameters",function(){return a}),n.d(t,"Level",function(){return s}),function(e){e.No="",e.Yes="YES",e.v2="v2"}(i||(i={}));var a=function(){function e(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},e}(),s=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}var t,n,i;return t=e,(n=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}])&&r(t.prototype,n),i&&r(t,i),e}()},"./src/types/loader.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"PlaylistContextType",function(){return r}),n.d(t,"PlaylistLevelType",function(){return i}),function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(r||(r={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(i||(i={}))},"./src/types/transmuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"ChunkMetadata",function(){return r});var r=function(e,t,n,r,i,o){void 0===r&&(r=0),void 0===i&&(i=-1),void 0===o&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=i,this.partial=o}},"./src/utils/attr-list.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"AttrList",function(){return o});var r=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var n=this[e];return n?parseFloat(n):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=r.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(i.lastIndex=0;null!==(t=i.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}()},"./src/utils/binary-search.ts":function(e,t,n){"use strict";n.r(t);t.default={search:function(e,t){for(var n=0,r=e.length-1,i=null,o=null;n<=r;){var a=t(o=e[i=(n+r)/2|0]);if(a>0)n=i+1;else{if(!(a<0))return o;r=i-1}}return null}}},"./src/utils/buffer-helper.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"BufferHelper",function(){return o});var r=n("./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},o=function(){function e(){}return e.isBuffered=function(t,n){try{if(t)for(var r=e.getBuffered(t),i=0;i<r.length;i++)if(n>=r.start(i)&&n<=r.end(i))return!0}catch(e){}return!1},e.bufferInfo=function(t,n,r){try{if(t){var i,o=e.getBuffered(t),a=[];for(i=0;i<o.length;i++)a.push({start:o.start(i),end:o.end(i)});return this.bufferedInfo(a,n,r)}}catch(e){}return{len:0,start:n,end:n,nextStart:void 0}},e.bufferedInfo=function(e,t,n){t=Math.max(0,t),e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end});var r=[];if(n)for(var i=0;i<e.length;i++){var o=r.length;if(o){var a=r[o-1].end;e[i].start-a<n?e[i].end>a&&(r[o-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var s,u=0,l=t,c=t,f=0;f<r.length;f++){var h=r[f].start,d=r[f].end;if(t+n>=h&&t<d)l=h,u=(c=d)-t;else if(t+n<h){s=h;break}}return{len:u,start:l||0,end:c||0,nextStart:s}},e.getBuffered=function(e){try{return e.buffered}catch(e){return r.logger.log("failed to get media.buffered",e),i}},e}()},"./src/utils/cea-608-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"Row",function(){return m}),n.d(t,"CaptionScreen",function(){return b});var r,i=n("./src/utils/logger.ts"),o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a=function(e){var t=e;return o.hasOwnProperty(e)&&(t=o[e]),String.fromCharCode(t)},s=15,u=100,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(r||(r={}));var p=function(){function e(){this.time=null,this.verboseLevel=r.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&i.logger.log(this.time+" ["+e+"] "+t)},e}(),v=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},g=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),y=function(){function e(e,t,n,r,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new g(t,n,r,i,o)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),m=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<u;t++)this.chars.push(new y);this.logger=e,this.pos=0,this.currPenState=new g}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<u;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(r.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(this.logger.log(r.DEBUG,"Too large cursor position "+this.pos),this.pos=u)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=a(e);this.pos>=u?this.logger.log(r.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<u;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<u;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),b=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<s;t++)this.rows.push(new m(e));this.logger=e,this.currRow=s-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1},t.equals=function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(r.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(r.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<s;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){var a=o.rows[i].cueStartTime,u=this.logger.time;if(a&&null!==u&&a<u)for(var l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(o.rows[i+l])}}this.currRow=t;var c=this.rows[this.currRow];if(null!==e.indent){var f=e.indent,h=Math.max(f-1,0);c.setCursor(e.indent),e.color=c.chars[h].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)},t.setBkgData=function(e){this.logger.log(r.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(r.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(r.INFO,"Rolling up")}else this.logger.log(r.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),E=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new b(n),this.nonDisplayedMemory=new b(n),this.lastOutputScreen=new b(n),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(r.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(r.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(r.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(r.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(r.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(r.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(r.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(r.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(r.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(r.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(r.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(r.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(r.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(r.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(r.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(r.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(r.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(r.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),_=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new p;this.channels=[null,new E(e,t,r),new E(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,i,o,a=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(i=127&t[s],o=127&t[s+1],0!==i||0!==o){if(this.logger.log(r.DATA,"["+v([t[s],t[s+1]])+"] -> ("+v([i,o])+")"),(n=this.parseCmd(i,o))||(n=this.parseMidrow(i,o)),n||(n=this.parsePAC(i,o)),n||(n=this.parseBackgroundAttributes(i,o)),!n&&(a=this.parseChars(i,o))){var u=this.currentChannel;if(u&&u>0)this.channels[u].insertChars(a);else this.logger.log(r.WARNING,"No channel found yet. TEXT-MODE?")}n||a||this.logger.log(r.WARNING,"Couldn't parse cleaned data "+v([i,o])+" orig: "+v([t[s],t[s+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(k(e,t,n))return T(null,null,n),this.logger.log(r.DEBUG,"Repeated command ("+v([e,t])+") is dropped"),!0;var i=20===e||21===e||23===e?1:2,o=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?o.ccRCL():33===t?o.ccBS():34===t?o.ccAOF():35===t?o.ccAON():36===t?o.ccDER():37===t?o.ccRU(2):38===t?o.ccRU(3):39===t?o.ccRU(4):40===t?o.ccFON():41===t?o.ccRDC():42===t?o.ccTR():43===t?o.ccRTD():44===t?o.ccEDM():45===t?o.ccCR():46===t?o.ccENM():47===t&&o.ccEOC():o.ccTO(t-32),T(e,t,n),this.currentChannel=i,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(r.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(r.DEBUG,"MIDROW ("+v([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(k(e,t,r))return T(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?l[e]:f[e]:1===i?c[e]:h[e];var o=this.channels[i];return!!o&&(o.setPAC(this.interpretPAC(n,t)),T(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,i,o=null,s=null;(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19)?(i=17===s?t+80:18===s?t+112:t+144,this.logger.log(r.INFO,"Special char '"+a(i)+"' in channel "+n),o=[i]):e>=32&&e<=127&&(o=0===t?[e]:[e,t]);if(o){var u=v(o);this.logger.log(r.DEBUG,"Char codes =  "+u.join(",")),T(e,t,this.cmdHistory)}return o},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=d[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),T(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}();function T(e,t,n){n.a=e,n.b=t}function k(e,t,n){return n.a===e&&n.b===t}t.default=_},"./src/utils/codecs.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"isCodecType",function(){return i}),n.d(t,"isCodecSupportedInMp4",function(){return o});var r={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(e,t){var n=r[t];return!!n&&!0===n[e.slice(0,4)]}function o(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/vttparser.ts"),i=n("./src/utils/webvtt-parser.ts"),o=n("./src/utils/texttrack-utils.ts"),a=/\s/,s={newCue:function(e,t,n,s){for(var u,l,c,f,h,d=[],p=self.VTTCue||self.TextTrackCue,v=0;v<s.rows.length;v++)if(c=!0,f=0,h="",!(u=s.rows[v]).isEmpty()){for(var g=0;g<u.chars.length;g++)a.test(u.chars[g].uchar)&&c?f++:(h+=u.chars[g].uchar,c=!1);u.cueStartTime=t,t===n&&(n+=1e-4),f>=16?f--:f++;var y=Object(r.fixLineBreaks)(h.trim()),m=Object(i.generateCueId)(t,n,y);e&&e.cues&&e.cues.getCueById(m)||((l=new p(t,n,y)).id=m,l.line=v+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*f/32)),d.push(l))}return e&&d.length&&(d.sort(function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line}),d.forEach(function(t){return Object(o.addCueToTrack)(e,t)})),d}};t.default=s},"./src/utils/discontinuities.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"findFirstFragWithCC",function(){return a}),n.d(t,"shouldAlignOnDiscontinuities",function(){return s}),n.d(t,"findDiscontinuousReferenceFrag",function(){return u}),n.d(t,"adjustSlidingStart",function(){return c}),n.d(t,"alignStream",function(){return f}),n.d(t,"alignPDT",function(){return h}),n.d(t,"alignFragmentByPDTDelta",function(){return d}),n.d(t,"alignMediaPlaylistByPDT",function(){return p});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts"),o=n("./src/controller/level-helper.ts");function a(e,t){for(var n=null,r=0,i=e.length;r<i;r++){var o=e[r];if(o&&o.cc===t){n=o;break}}return n}function s(e,t,n){return!(!t.details||!(n.endCC>n.startCC||e&&e.cc<n.startCC))}function u(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var o=a(n,r[0].cc);if(o&&(!o||o.startPTS))return o;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function l(e,t){if(e){var n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}}function c(e,t){for(var n=t.fragments,r=0,i=n.length;r<i;r++)l(n[r],e);t.fragmentHint&&l(t.fragmentHint,e),t.alignedSliding=!0}function f(e,t,n){t&&(!function(e,t,n){if(s(e,n,t)){var o=u(n.details,t);o&&Object(r.isFiniteNumber)(o.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),c(o.start,t))}}(e,n,t),!n.alignedSliding&&t.details&&h(n,t.details),n.alignedSliding||!t.details||n.skippedSegments||Object(o.adjustSliding)(t.details,n))}function h(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var n=t.fragments[0].programDateTime,o=e.fragments[0].programDateTime,a=(o-n)/1e3+t.fragments[0].start;a&&Object(r.isFiniteNumber)(a)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(o-n)+"ms, sliding:"+a.toFixed(3)+" "+e.url+" "),c(a,e))}}function d(e,t){var n=e.programDateTime;if(n){var r=(n-t)/1e3;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function p(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var n=t.fragments[0].programDateTime-1e3*t.fragments[0].start;e.fragments.forEach(function(e){d(e,n)}),e.fragmentHint&&d(e.fragmentHint,n),e.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/ewma.ts"),i=function(){function e(e,t,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new r.default(e),this.fast_=new r.default(t)}var t=e.prototype;return t.update=function(e,t){var n=this.slow_,i=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new r.default(e,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new r.default(t,i.getEstimate(),i.getTotalWeight()))},t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();t.default=i},"./src/utils/ewma.ts":function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}();t.default=r},"./src/utils/fetch-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"fetchSupported",function(){return f});var r=n("./src/polyfills/number.ts"),i=n("./src/loader/load-stats.ts"),o=n("./src/demux/chunk-cache.ts");function a(e){var t="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)})(e)}function s(e,t,n){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&u(i,n.prototype),i}).apply(null,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var h=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||d,this.controller=new self.AbortController,this.stats=new i.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,n){var i=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var a=function(e,t){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(c({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),s=n.onProgress,u="arraybuffer"===e.responseType,l=u?"byteLength":"length";this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){i.abortInternal(),n.onTimeout(o,e,i.response)},t.timeout),self.fetch(this.request).then(function(n){if(i.response=i.loader=n,!n.ok){var a=n.status,l=n.statusText;throw new p(l||"fetch, bad network response",a,n)}return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(n.headers.get("Content-Length")||"0"),s&&Object(r.isFiniteNumber)(t.highWaterMark)?i.loadProgressively(n,o,e,t.highWaterMark,s):u?n.arrayBuffer():n.text()}).then(function(a){var u=i.response;self.clearTimeout(i.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=a[l];var c={url:u.url,data:a};s&&!Object(r.isFiniteNumber)(t.highWaterMark)&&s(o,e,a,u),n.onSuccess(c,o,e,u)}).catch(function(t){if(self.clearTimeout(i.requestTimeout),!o.aborted){var r=t.code||0;n.onError({code:r,text:t.message},e,t.details)}})},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,n,r,i){void 0===r&&(r=0);var a=new o.default,s=e.body.getReader();return function o(){return s.read().then(function(s){if(s.done)return a.dataLength&&i(t,n,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var u=s.value,l=u.length;return t.loaded+=l,l<r||a.dataLength?(a.push(u),a.dataLength>=r&&i(t,n,a.flush(),e)):i(t,n,u,e),o()}).catch(function(){return Promise.reject()})}()},e}();function d(e,t){return new self.Request(e.url,t)}var p=function(e){var t,n;function r(t,n,r){var i;return(i=e.call(this,t)||this).code=void 0,i.details=void 0,i.code=n,i.details=r,i}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n),r}(a(Error));t.default=h},"./src/utils/imsc1-ttml-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"IMSC1_CODEC",function(){return c}),n.d(t,"parseIMSC1",function(){return p});var r=n("./src/utils/mp4-tools.ts"),i=n("./src/utils/vttparser.ts"),o=n("./src/utils/vttcue.ts"),a=n("./src/demux/id3.ts"),s=n("./src/utils/timescale-conversion.ts"),u=n("./src/utils/webvtt-parser.ts");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var c="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,d={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(e,t,n,i,c){var f=Object(r.findBox)(new Uint8Array(e),["mdat"]);if(0!==f.length){var h=f[0],p=Object(a.utf8ArrayToStr)(new Uint8Array(e,h.start,h.end-h.start)),E=Object(s.toTimescaleFromScale)(t,1,n);try{i(function(e,t){var n=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(r).reduce(function(e,t){return e[t]=n.getAttribute("ttp:"+t)||r[t],e},{}),a="preserve"!==n.getAttribute("xml:space"),s=g(v(n,"styling","style")),c=g(v(n,"layout","region")),f=v(n,"body","[begin]");return[].map.call(f,function(e){var n=function e(t,n){return[].slice.call(t.childNodes).reduce(function(t,r,i){var o;return"br"===r.nodeName&&i?t+"\n":null!==(o=r.childNodes)&&void 0!==o&&o.length?e(r,n):n?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}(e,a);if(!n||!e.hasAttribute("begin"))return null;var r=b(e.getAttribute("begin"),i),f=b(e.getAttribute("dur"),i),h=b(e.getAttribute("end"),i);if(null===r)throw m(e);if(null===h){if(null===f)throw m(e);h=r+f}var p=new o.default(r-t,h-t,n);p.id=Object(u.generateCueId)(p.startTime,p.endTime,p.text);var v=c[e.getAttribute("region")],g=s[e.getAttribute("style")];p.position=10,p.size=80;var E=function(e,t){var n="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(r,i){var o=y(t,n,i)||y(e,n,i);return o&&(r[i]=o),r},{})}(v,g),_=E.textAlign;if(_){var T=d[_];T&&(p.lineAlign=T),p.align=_}return l(p,E),p}).filter(function(e){return null!==e})}(p,E))}catch(e){c(e)}}else c(new Error("Could not parse IMSC1 mdat"))}function v(e,t,n){var r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function g(e){return e.reduce(function(e,t){var n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function y(e,t,n){return e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function m(e){return new Error("Could not parse ttml timestamp "+e)}function b(e,t){if(!e)return null;var n=Object(i.parseTimeStamp)(e);return null===n&&(f.test(e)?n=function(e,t){var n=f.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):h.test(e)&&(n=function(e,t){var n=h.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}},"./src/utils/logger.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"enableLogs",function(){return s}),n.d(t,"logger",function(){return u});var r=function(){},i={trace:r,debug:r,log:r,warn:r,info:r,error:r},o=i;function a(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.forEach(function(t){o[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):r}(t)})}function s(e){if(self.console&&!0===e||"object"==typeof e){a(e,"debug","log","info","warn","error");try{o.log()}catch(e){o=i}}else o=i}var u=i},"./src/utils/mediakeys-helper.ts":function(e,t,n){"use strict";var r;n.r(t),n.d(t,"KeySystems",function(){return r}),n.d(t,"requestMediaKeySystemAccess",function(){return i}),function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(r||(r={}));var i="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(e,t,n){"use strict";function r(){return self.MediaSource||self.WebKitMediaSource}n.r(t),n.d(t,"getMediaSource",function(){return r})},"./src/utils/mp4-tools.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"bin2str",function(){return s}),n.d(t,"readUint16",function(){return u}),n.d(t,"readUint32",function(){return l}),n.d(t,"writeUint32",function(){return c}),n.d(t,"findBox",function(){return f}),n.d(t,"parseSegmentIndex",function(){return h}),n.d(t,"parseInitSegment",function(){return d}),n.d(t,"getStartDTS",function(){return p}),n.d(t,"getDuration",function(){return v}),n.d(t,"computeRawDurationFromSamples",function(){return g}),n.d(t,"offsetStartDTS",function(){return y}),n.d(t,"segmentValidRange",function(){return m}),n.d(t,"appendUint8Array",function(){return b});var r=n("./src/utils/typed-array.ts"),i=n("./src/loader/fragment.ts"),o=Math.pow(2,32)-1,a=[].push;function s(e){return String.fromCharCode.apply(null,e)}function u(e,t){"data"in e&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n}function l(e,t){"data"in e&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n}function c(e,t,n){"data"in e&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function f(e,t){var n,r,i,o=[];if(!t.length)return o;"data"in e?(n=e.data,r=e.start,i=e.end):(r=0,i=(n=e).byteLength);for(var u=r;u<i;){var c=l(n,u),h=c>1?u+c:i;if(s(n.subarray(u+4,u+8))===t[0])if(1===t.length)o.push({data:n,start:u+8,end:h});else{var d=f({data:n,start:u+8,end:h},t.slice(1));d.length&&a.apply(o,d)}u=h}return o}function h(e){var t=f(e,["moov"])[0],n=t?t.end:null,r=f(e,["sidx"]);if(!r||!r[0])return null;var i=[],o=r[0],a=o.data[0],s=0===a?8:16,c=l(o,s);s+=4;s+=0===a?8:16,s+=2;var h=o.end+0,d=u(o,s);s+=2;for(var p=0;p<d;p++){var v=s,g=l(o,v);v+=4;var y=2147483647&g;if(1===(2147483648&g)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var m=l(o,v);v+=4,i.push({referenceSize:y,subsegmentDuration:m,info:{duration:m/c,start:h,end:h+y-1}}),h+=y,s=v+=4}return{earliestPresentationTime:0,timescale:c,version:a,referencesCount:d,references:i,moovEndOffset:n}}function d(e){for(var t=[],n=f(e,["moov","trak"]),r=0;r<n.length;r++){var o=n[r],a=f(o,["tkhd"])[0];if(a){var u=a.data[a.start],c=0===u?12:20,h=l(a,c),d=f(o,["mdia","mdhd"])[0];if(d){var p=l(d,c=0===(u=d.data[d.start])?12:20),v=f(o,["mdia","hdlr"])[0];if(v){var g=s(v.data.subarray(v.start+8,v.start+12)),y={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[g];if(y){var m=f(o,["mdia","minf","stbl","stsd"])[0],b=void 0;m&&(b=s(m.data.subarray(m.start+12,m.start+16))),t[h]={timescale:p,type:y},t[y]={timescale:p,id:h,codec:b}}}}}}return f(e,["moov","mvex","trex"]).forEach(function(e){var n=l(e,4),r=t[n];r&&(r.default={duration:l(e,12),flags:l(e,20)})}),t}function p(e,t){return f(t,["moof","traf"]).reduce(function(t,n){var r=f(n,["tfdt"])[0],i=r.data[r.start],o=f(n,["tfhd"]).reduce(function(t,n){var o=l(n,4),a=e[o];if(a){var s=l(r,4);1===i&&(s*=Math.pow(2,32),s+=l(r,8));var u=s/(a.timescale||9e4);if(isFinite(u)&&(null===t||u<t))return u}return t},null);return null!==o&&isFinite(o)&&(null===t||o<t)?o:t},null)||0}function v(e,t){for(var n=0,r=0,o=0,a=f(e,["moof","traf"]),s=0;s<a.length;s++){var u=a[s],c=f(u,["tfhd"])[0],d=t[l(c,4)];if(d){var p=d.default,v=l(c,0)|(null==p?void 0:p.flags),y=null==p?void 0:p.duration;8&v&&(y=l(c,2&v?12:8));for(var m=d.timescale||9e4,b=f(u,["trun"]),E=0;E<b.length;E++){if(!(n=g(b[E]))&&y)n=y*l(b[E],4);d.type===i.ElementaryStreamTypes.VIDEO?r+=n/m:d.type===i.ElementaryStreamTypes.AUDIO&&(o+=n/m)}}}if(0===r&&0===o){var _=h(e);if(null!=_&&_.references)return _.references.reduce(function(e,t){return e+t.info.duration||0},0)}return r||o}function g(e){var t=l(e,0),n=8;1&t&&(n+=4),4&t&&(n+=4);for(var r=0,i=l(e,4),o=0;o<i;o++){if(256&t)r+=l(e,n),n+=4;512&t&&(n+=4),1024&t&&(n+=4),2048&t&&(n+=4)}return r}function y(e,t,n){f(t,["moof","traf"]).forEach(function(t){f(t,["tfhd"]).forEach(function(r){var i=l(r,4),a=e[i];if(a){var s=a.timescale||9e4;f(t,["tfdt"]).forEach(function(e){var t=e.data[e.start],r=l(e,4);if(0===t)c(e,4,r-n*s);else{r*=Math.pow(2,32),r+=l(e,8),r-=n*s,r=Math.max(r,0);var i=Math.floor(r/(o+1)),a=Math.floor(r%(o+1));c(e,4,i),c(e,8,a)}})}})})}function m(e){var t={valid:null,remainder:null},n=f(e,["moof"]);if(!n)return t;if(n.length<2)return t.remainder=e,t;var i=n[n.length-1];return t.valid=Object(r.sliceUint8)(e,0,i.start-8),t.remainder=Object(r.sliceUint8)(e,i.start-8),t}function b(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}},"./src/utils/output-filter.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var r=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"sendAddTrackEvent",function(){return i}),n.d(t,"addCueToTrack",function(){return o}),n.d(t,"clearCurrentCues",function(){return a}),n.d(t,"removeCuesInRange",function(){return s}),n.d(t,"getCuesInRange",function(){return u});var r=n("./src/utils/logger.ts");function i(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function o(e,t){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(n){r.logger.debug("[texttrack-utils]: "+n);var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===n&&(e.mode=n)}function a(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var n=e.cues.length;n--;)e.removeCue(e.cues[n]);"disabled"===t&&(e.mode=t)}function s(e,t,n){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var i=u(e.cues,t,n),o=0;o<i.length;o++)e.removeCue(i[o]);"disabled"===r&&(e.mode=r)}function u(e,t,n){var r=[],i=function(e,t){if(t<e[0].startTime)return 0;var n=e.length-1;if(t>e[n].endTime)return-1;for(var r=0,i=n;r<=i;){var o=Math.floor((i+r)/2);if(t<e[o].startTime)i=o-1;else{if(!(t>e[o].startTime&&r<n))return o;r=o+1}}return e[r].startTime-t<t-e[i].startTime?r:i}(e,t);if(i>-1)for(var o=i,a=e.length;o<a;o++){var s=e[o];if(s.startTime>=t&&s.endTime<=n)r.push(s);else if(s.startTime>n)return r}return r}},"./src/utils/time-ranges.ts":function(e,t,n){"use strict";n.r(t);t.default={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}}},"./src/utils/timescale-conversion.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"toTimescaleFromBase",function(){return i}),n.d(t,"toTimescaleFromScale",function(){return o}),n.d(t,"toMsFromMpegTsClock",function(){return a}),n.d(t,"toMpegTsClockFromTimescale",function(){return s});var r=9e4;function i(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function o(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=!1),i(e,t,1/n,r)}function a(e,t){return void 0===t&&(t=!1),i(e,1e3,1/r,t)}function s(e,t){return void 0===t&&(t=1),i(e,r,1/t)}},"./src/utils/typed-array.ts":function(e,t,n){"use strict";function r(e,t,n){return Uint8Array.prototype.slice?e.slice(t,n):new Uint8Array(Array.prototype.slice.call(e,t,n))}n.r(t),n.d(t,"sliceUint8",function(){return r})},"./src/utils/vttcue.ts":function(e,t,n){"use strict";n.r(t),t.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var a in o)e[a]=o[a]}return e}function o(t,o,a){var s=this,u={enumerable:!0};s.hasBeenReset=!1;var l="",c=!1,f=t,h=o,d=a,p=null,v="",g=!0,y="auto",m="start",b=50,E="middle",_=50,T="middle";Object.defineProperty(s,"id",i({},u,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},u,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(s,"startTime",i({},u,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},u,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},u,{get:function(){return d},set:function(e){d=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},u,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},u,{get:function(){return v},set:function(t){var r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");v=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},u,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},u,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},u,{get:function(){return m},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},u,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},u,{get:function(){return E},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},u,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},u,{get:function(){return T},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),s.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}()},"./src/utils/vttparser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"parseTimeStamp",function(){return o}),n.d(t,"fixLineBreaks",function(){return f}),n.d(t,"VTTParser",function(){return h});var r=n("./src/utils/vttcue.ts"),i=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function o(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}var n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}var a=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1},e}();function s(e,t,n,r){var i=r?e.split(r):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(n);if(2===a.length)t(a[0],a[1])}}var u=new r.default(0,0,""),l="middle"===u.align?"middle":"center";function c(e,t,n){var r=e;function i(){var t=o(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=i(),c(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),c(),t.endTime=i(),c(),function(e,t){var r=new a;s(e,function(e,t){var i;switch(e){case"region":for(var o=n.length-1;o>=0;o--)if(n[o].id===t){r.set(e,n[o].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),r.integer(e,i[0]),r.percent(e,i[0])&&r.set("snapToLines",!1),r.alt(e,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",l,"end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",l,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",l,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===u.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",l);var o=r.get("position","auto");"auto"===o&&50===u.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function f(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var h=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=f(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var o=(i=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=n(),t.state){case"HEADER":/:/.test(i)?s(i,function(e,t){},/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new r.default(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{c(i,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var u=-1!==i.indexOf("--\x3e");if(!i||u&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"generateCueId",function(){return h}),n.d(t,"parseWebVTT",function(){return p});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/vttparser.ts"),o=n("./src/demux/id3.ts"),a=n("./src/utils/timescale-conversion.ts"),s=n("./src/remux/mp4-remuxer.ts"),u=/\r\n|\n\r|\n|\r/g,l=function(e,t,n){return void 0===n&&(n=0),e.substr(n,t.length)===t},c=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),o=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(r.isFiniteNumber)(t)&&Object(r.isFiniteNumber)(n)&&Object(r.isFiniteNumber)(i)&&Object(r.isFiniteNumber)(o)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,t+=6e4*i,t+=36e5*o},f=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()};function h(e,t,n){return f(e.toString())+f(t.toString())+f(n)}var d=function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!==(o=i)&&void 0!==o&&o.new;){var o;e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC]}e.presentationOffset=n};function p(e,t,n,r,f,p,v,g){var y,m=new i.VTTParser,b=Object(o.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(u,"\n").split("\n"),E=[],_=Object(a.toMpegTsClockFromTimescale)(t,n),T="00:00.000",k=0,A=0,S=!0,w=!1;m.oncue=function(e){var t=r[f],n=r.ccOffset,i=(k-_)/9e4;if(null!=t&&t.new&&(void 0!==A?n=r.ccOffset=t.start:d(r,f,i)),i&&(n=i-r.presentationOffset),w){var o=e.endTime-e.startTime,a=Object(s.normalizePts)(9e4*(e.startTime+n-A),9e4*p)/9e4;e.startTime=a,e.endTime=a+o}var u=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(u)),e.id||(e.id=h(e.startTime,e.endTime,u)),e.endTime>0&&E.push(e)},m.onparsingerror=function(e){y=e},m.onflush=function(){y?g(y):v(E)},b.forEach(function(e){if(S){if(l(e,"X-TIMESTAMP-MAP=")){S=!1,w=!0,e.substr(16).split(",").forEach(function(e){l(e,"LOCAL:")?T=e.substr(6):l(e,"MPEGTS:")&&(k=parseInt(e.substr(7)))});try{A=c(T)/1e3}catch(e){w=!1,y=e}return}""===e&&(S=!1)}m.parse(e+"\n")}),m.flush()}},"./src/utils/xhr-loader.ts":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.ts"),i=n("./src/loader/load-stats.ts"),o=/^age:\s*[\d.]+\s*$/m,a=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(n,t.url)}catch(e){n.open("GET",t.url,!0),i(n,t.url)}n.readyState||n.open("GET",t.url,!0);var o=this.context.headers;if(o)for(var a in o)n.setRequestHeader(a,o[a])}catch(e){return void this.callbacks.onError({code:n.status,text:e.message},t,n)}t.rangeEnd&&n.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),n.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,n=this.stats;if(e&&t){var i=t.readyState,o=this.config;if(!n.aborted&&i>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===i){t.onreadystatechange=null,t.onprogress=null;var a=t.status;if(a>=200&&a<300){var s,u;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),u="arraybuffer"===e.responseType?(s=t.response).byteLength:(s=t.responseText).length,n.loaded=n.total=u,!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(n,e,s,t),!this.callbacks)return;var c={url:t.responseURL,data:s};this.callbacks.onSuccess(c,n,e,t)}else n.retry>=o.maxRetry||a>=400&&a<499?(r.logger.error(a+" while loading "+e.url),this.callbacks.onError({code:a,text:t.statusText},e,t)):(r.logger.warn(a+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout)}},t.loadtimeout=function(){r.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&o.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}();t.default=a}}).default},e.exports=r())},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,i=function(){function e(e){return null==e?String(e):K[z.call(e)]||"object"}function t(t){return"function"==e(t)}function r(e){return null!=e&&e==e.window}function i(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function o(t){return"object"==e(t)}function a(e){return o(e)&&!r(e)&&Object.getPrototypeOf(e)==Object.prototype}function s(e){return"number"==typeof e.length}function u(e){return e.length>0?T.fn.concat.apply([],e):e}function l(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function c(e){return e in D?D[e]:D[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||I[l(e)]?t:t+"px"}function h(e){return"children"in e?O.call(e.children):T.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function d(e,t){var n,r=e?e.length:0;for(n=0;r>n;n++)this[n]=e[n];this.length=r,this.selector=t||""}function p(e,t,n){for(_ in t)n&&(a(t[_])||$(t[_]))?(a(t[_])&&!a(e[_])&&(e[_]={}),$(t[_])&&!$(e[_])&&(e[_]=[]),p(e[_],t[_],n)):t[_]!==E&&(e[_]=t[_])}function v(e,t){return null==t?T(e):T(e).filter(t)}function g(e,n,r,i){return t(n)?n.call(e,r,i):n}function y(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function m(e,t){var n=e.className||"",r=n&&n.baseVal!==E;return t===E?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function b(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?T.parseJSON(e):e):e}catch(t){return e}}var E,_,T,k,A,S,w=[],L=w.concat,P=w.filter,O=w.slice,C=window.document,R={},D={},I={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},x=/^\s*<(\w+|!)[^>]*>/,M=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,F=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,N=/^(?:body|html)$/i,U=/([A-Z])/g,B=["val","css","html","text","data","width","height","offset"],j=C.createElement("table"),H=C.createElement("tr"),G={tr:C.createElement("tbody"),tbody:j,thead:j,tfoot:j,td:H,th:H,"*":C.createElement("div")},V=/complete|loaded|interactive/,Y=/^[\w-]*$/,K={},z=K.toString,W={},q=C.createElement("div"),X={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},$=Array.isArray||function(e){return e instanceof Array};return W.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,o=!i;return o&&(i=q).appendChild(e),r=~W.qsa(i,t).indexOf(e),o&&q.removeChild(e),r},A=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},S=function(e){return P.call(e,function(t,n){return e.indexOf(t)==n})},W.fragment=function(e,t,n){var r,i,o;return M.test(e)&&(r=T(C.createElement(RegExp.$1))),r||(e.replace&&(e=e.replace(F,"<$1></$2>")),t===E&&(t=x.test(e)&&RegExp.$1),t in G||(t="*"),(o=G[t]).innerHTML=""+e,r=T.each(O.call(o.childNodes),function(){o.removeChild(this)})),a(n)&&(i=T(r),T.each(n,function(e,t){B.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},W.Z=function(e,t){return new d(e,t)},W.isZ=function(e){return e instanceof W.Z},W.init=function(e,n){var r;if(!e)return W.Z();if("string"==typeof e)if("<"==(e=e.trim())[0]&&x.test(e))r=W.fragment(e,RegExp.$1,n),e=null;else{if(n!==E)return T(n).find(e);r=W.qsa(C,e)}else{if(t(e))return T(C).ready(e);if(W.isZ(e))return e;if($(e))r=function(e){return P.call(e,function(e){return null!=e})}(e);else if(o(e))r=[e],e=null;else if(x.test(e))r=W.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==E)return T(n).find(e);r=W.qsa(C,e)}}return W.Z(r,e)},(T=function(e,t){return W.init(e,t)}).extend=function(e){var t,n=O.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){p(e,n,t)}),e},W.qsa=function(e,t){var n,r="#"==t[0],i=!r&&"."==t[0],o=r||i?t.slice(1):t,a=Y.test(o);return e.getElementById&&a&&r?(n=e.getElementById(o))?[n]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:O.call(a&&!r&&e.getElementsByClassName?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},T.contains=C.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},T.type=e,T.isFunction=t,T.isWindow=r,T.isArray=$,T.isPlainObject=a,T.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},T.inArray=function(e,t,n){return w.indexOf.call(t,e,n)},T.camelCase=A,T.trim=function(e){return null==e?"":String.prototype.trim.call(e)},T.uuid=0,T.support={},T.expr={},T.noop=function(){},T.map=function(e,t){var n,r,i,o=[];if(s(e))for(r=0;r<e.length;r++)null!=(n=t(e[r],r))&&o.push(n);else for(i in e)null!=(n=t(e[i],i))&&o.push(n);return u(o)},T.each=function(e,t){var n,r;if(s(e)){for(n=0;n<e.length;n++)if(!1===t.call(e[n],n,e[n]))return e}else for(r in e)if(!1===t.call(e[r],r,e[r]))return e;return e},T.grep=function(e,t){return P.call(e,t)},window.JSON&&(T.parseJSON=JSON.parse),T.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),T.fn={constructor:W.Z,length:0,forEach:w.forEach,reduce:w.reduce,push:w.push,sort:w.sort,splice:w.splice,indexOf:w.indexOf,concat:function(){var e,t,n=[];for(e=0;e<arguments.length;e++)t=arguments[e],n[e]=W.isZ(t)?t.toArray():t;return L.apply(W.isZ(this)?this.toArray():this,n)},map:function(e){return T(T.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return T(O.apply(this,arguments))},ready:function(e){return V.test(C.readyState)&&C.body?e(T):C.addEventListener("DOMContentLoaded",function(){e(T)},!1),this},get:function(e){return e===E?O.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return w.every.call(this,function(t,n){return!1!==e.call(t,n,t)}),this},filter:function(e){return t(e)?this.not(this.not(e)):T(P.call(this,function(t){return W.matches(t,e)}))},add:function(e,t){return T(S(this.concat(T(e,t))))},is:function(e){return this.length>0&&W.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==E)this.each(function(t){e.call(this,t)||n.push(this)});else{var r="string"==typeof e?this.filter(e):s(e)&&t(e.item)?O.call(e):T(e);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return T(n)},has:function(e){return this.filter(function(){return o(e)?T.contains(this,e):T(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!o(e)?e:T(e)},last:function(){var e=this[this.length-1];return e&&!o(e)?e:T(e)},find:function(e){var t=this;return e?"object"==n(e)?T(e).filter(function(){var e=this;return w.some.call(t,function(t){return T.contains(t,e)})}):1==this.length?T(W.qsa(this[0],e)):this.map(function(){return W.qsa(this,e)}):T()},closest:function(e,t){var r=this[0],o=!1;for("object"==n(e)&&(o=T(e));r&&!(o?o.indexOf(r)>=0:W.matches(r,e));)r=r!==t&&!i(r)&&r.parentNode;return T(r)},parents:function(e){for(var t=[],n=this;n.length>0;)n=T.map(n,function(e){return(e=e.parentNode)&&!i(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return v(t,e)},parent:function(e){return v(S(this.pluck("parentNode")),e)},children:function(e){return v(this.map(function(){return h(this)}),e)},contents:function(){return this.map(function(){return this.contentDocument||O.call(this.childNodes)})},siblings:function(e){return v(this.map(function(e,t){return P.call(h(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return T.map(this,function(t){return t[e]})},show:function(){return this.each(function(){var e,t,n;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(e=this.nodeName,R[e]||(t=C.createElement(e),C.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),R[e]=n),R[e]))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var r=T(e).get(0),i=r.parentNode||this.length>1;return this.each(function(t){T(this).wrapAll(n?e.call(this,t):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){T(this[0]).before(e=T(e));for(var t;(t=e.children()).length;)e=t.first();T(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var r=T(this),i=r.contents(),o=n?e.call(this,t):e;i.length?i.wrapAll(o):r.append(o)})},unwrap:function(){return this.parent().each(function(){T(this).replaceWith(T(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=T(this);(e===E?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return T(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return T(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;T(this).empty().append(g(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=g(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(o(e))for(_ in e)y(this,_,e[_]);else y(this,e,g(this,t,n,this.getAttribute(e)))}):this.length&&1===this[0].nodeType?!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:E},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){y(this,e)},this)})},prop:function(e,t){return e=X[e]||e,1 in arguments?this.each(function(n){this[e]=g(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(e,t){var n="data-"+e.replace(U,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,t):this.attr(n);return null!==r?b(r):E},val:function(e){return 0 in arguments?this.each(function(t){this.value=g(this,e,t,this.value)}):this[0]&&(this[0].multiple?T(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=T(this),r=g(this,e,t,n.offset()),i=n.offsetParent().offset(),o={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;if(!T.contains(C.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var r,i=this[0];if(!i)return;if(r=getComputedStyle(i,""),"string"==typeof t)return i.style[A(t)]||r.getPropertyValue(t);if($(t)){var o={};return T.each(t,function(e,t){o[t]=i.style[A(t)]||r.getPropertyValue(t)}),o}}var a="";if("string"==e(t))n||0===n?a=l(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(l(t))});else for(_ in t)t[_]||0===t[_]?a+=l(_)+":"+f(_,t[_])+";":this.each(function(){this.style.removeProperty(l(_))});return this.each(function(){this.style.cssText+=";"+a})},index:function(e){return e?this.indexOf(T(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&w.some.call(this,function(e){return this.test(m(e))},c(e))},addClass:function(e){return e?this.each(function(t){if("className"in this){k=[];var n=m(this);g(this,e,t,n).split(/\s+/g).forEach(function(e){T(this).hasClass(e)||k.push(e)},this),k.length&&m(this,n+(n?" ":"")+k.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===E)return m(this,"");k=m(this),g(this,e,t,k).split(/\s+/g).forEach(function(e){k=k.replace(c(e)," ")}),m(this,k.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var r=T(this);g(this,e,n,m(this)).split(/\s+/g).forEach(function(e){(t===E?!r.hasClass(e):t)?r.addClass(e):r.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===E?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===E?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),r=N.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(T(e).css("margin-top"))||0,n.left-=parseFloat(T(e).css("margin-left"))||0,r.top+=parseFloat(T(t[0]).css("border-top-width"))||0,r.left+=parseFloat(T(t[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||C.body;e&&!N.test(e.nodeName)&&"static"==T(e).css("position");)e=e.offsetParent;return e})}},T.fn.detach=T.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});T.fn[e]=function(n){var o,a=this[0];return n===E?r(a)?a["inner"+t]:i(a)?a.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){(a=T(this)).css(e,g(this,n,t,a[e]()))})}}),["after","prepend","before","append"].forEach(function(t,n){var r=n%2;T.fn[t]=function(){var t,i,o=T.map(arguments,function(n){return"object"==(t=e(n))||"array"==t||null==n?n:W.fragment(n)}),a=this.length>1;return o.length<1?this:this.each(function(e,t){i=r?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var s=T.contains(C.documentElement,i);o.forEach(function(e){if(a)e=e.cloneNode(!0);else if(!i)return T(e).remove();i.insertBefore(e,t),s&&function e(t,n){n(t);for(var r=0,i=t.childNodes.length;i>r;r++)e(t.childNodes[r],n)}(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},T.fn[r?t+"To":"insert"+(n?"Before":"After")]=function(e){return T(e)[t](this),this}}),W.Z.prototype=d.prototype=T.fn,W.uniq=S,W.deserializeValue=b,T.zepto=W,T}();window.Zepto=i,void 0===window.$&&(window.$=i),function(e){function t(e){return e._zid||(e._zid=f++)}function n(e,n,i,o){if((n=r(n)).ns)var a=function(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}(n.ns);return(v[t(e)]||[]).filter(function(e){return!(!e||n.e&&e.e!=n.e||n.ns&&!a.test(e.ns)||i&&t(e.fn)!==t(i)||o&&e.sel!=o)})}function r(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e,t){return e.del&&!y&&e.e in m||!!t}function o(e){return b[e]||y&&m[e]||e}function a(n,a,s,l,f,h,d){var p=t(n),g=v[p]||(v[p]=[]);a.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(s);var a=r(t);a.fn=s,a.sel=f,a.e in b&&(s=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?a.fn.apply(this,arguments):void 0}),a.del=h;var p=h||s;a.proxy=function(e){if(!(e=u(e)).isImmediatePropagationStopped()){e.data=l;var t=p.apply(n,e._args==c?[e]:[e].concat(e._args));return!1===t&&(e.preventDefault(),e.stopPropagation()),t}},a.i=g.length,g.push(a),"addEventListener"in n&&n.addEventListener(o(a.e),a.proxy,i(a,d))})}function s(e,r,a,s,u){var l=t(e);(r||"").split(/\s/).forEach(function(t){n(e,t,a,s).forEach(function(t){delete v[l][t.i],"removeEventListener"in e&&e.removeEventListener(o(t.e),t.proxy,i(t,u))})})}function u(t,n){return(n||!t.isDefaultPrevented)&&(n||(n=t),e.each(k,function(e,r){var i=n[e];t[e]=function(){return this[r]=E,i&&i.apply(n,arguments)},t[r]=_}),(n.defaultPrevented!==c?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=E)),t}function l(e){var t,n={originalEvent:e};for(t in e)T.test(t)||e[t]===c||(n[t]=e[t]);return u(n,e)}var c,f=1,h=Array.prototype.slice,d=e.isFunction,p=function(e){return"string"==typeof e},v={},g={},y="onfocusin"in window,m={focus:"focusin",blur:"focusout"},b={mouseenter:"mouseover",mouseleave:"mouseout"};g.click=g.mousedown=g.mouseup=g.mousemove="MouseEvents",e.event={add:a,remove:s},e.proxy=function(n,r){var i=2 in arguments&&h.call(arguments,2);if(d(n)){var o=function(){return n.apply(r,i?i.concat(h.call(arguments)):arguments)};return o._zid=t(n),o}if(p(r))return i?(i.unshift(n[r],n),e.proxy.apply(null,i)):e.proxy(n[r],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var E=function(){return!0},_=function(){return!1},T=/^([A-Z]|returnValue$|layer[XY]$)/,k={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r,i,o){var u,f,v=this;return t&&!p(t)?(e.each(t,function(e,t){v.on(e,n,r,t,o)}),v):(p(n)||d(i)||!1===i||(i=r,r=n,n=c),(i===c||!1===r)&&(i=r,r=c),!1===i&&(i=_),v.each(function(c,d){o&&(u=function(e){return s(d,e.type,i),i.apply(this,arguments)}),n&&(f=function(t){var r,o=e(t.target).closest(n,d).get(0);return o&&o!==d?(r=e.extend(l(t),{currentTarget:o,liveFired:d}),(u||i).apply(o,[r].concat(h.call(arguments,1)))):void 0}),a(d,t,i,r,n,f||u)}))},e.fn.off=function(t,n,r){var i=this;return t&&!p(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(p(n)||d(r)||!1===r||(r=n,n=c),!1===r&&(r=_),i.each(function(){s(this,t,r,n)}))},e.fn.trigger=function(t,n){return(t=p(t)||e.isPlainObject(t)?e.Event(t):u(t))._args=n,this.each(function(){t.type in m&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,r){var i,o;return this.each(function(a,s){(i=l(p(t)?e.Event(t):t))._args=r,i.target=s,e.each(n(s,t.type||t),function(e,t){return o=t.proxy(i),!i.isImmediatePropagationStopped()&&void 0})}),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){p(e)||(e=(t=e).type);var n=document.createEvent(g[e]||"Events"),r=!0;if(t)for(var i in t)"bubbles"==i?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),u(n)}}(i),function(e){function t(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}function n(e,n,r,i){return e.global?t(n||g,r,i):void 0}function r(t){t.global&&0==e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var r=t.context;return!1!==t.beforeSend.call(r,e,t)&&!1!==n(t,r,"ajaxBeforeSend",[e,t])&&void n(t,r,"ajaxSend",[e,t])}function a(e,t,r,i){var o=r.context,a="success";r.success.call(o,e,a,t),i&&i.resolveWith(o,[e,a,t]),n(r,o,"ajaxSuccess",[t,r,e]),u(a,t,r)}function s(e,t,r,i,o){var a=i.context;i.error.call(a,r,t,e),o&&o.rejectWith(a,[r,t,e]),n(i,a,"ajaxError",[r,i,e||t]),u(t,r,i)}function u(e,t,r){var o=r.context;r.complete.call(o,t,e),n(r,o,"ajaxComplete",[t,r]),i(r)}function l(){}function c(e){return e&&(e=e.split(";",2)[0]),e&&(e==_?"html":e==E?"json":m.test(e)?"script":b.test(e)&&"xml")||"text"}function f(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function h(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}var d,p,v=0,g=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,m=/^(?:text|application)\/javascript/i,b=/^(?:text|application)\/xml/i,E="application/json",_="text/html",T=/^\s*$/,k=g.createElement("a");k.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var r,i,u=t.jsonpCallback,l=(e.isFunction(u)?u():u)||"jsonp"+ ++v,c=g.createElement("script"),f=window[l],h=function(t){e(c).triggerHandler("error",t||"abort")},d={abort:h};return n&&n.promise(d),e(c).on("load error",function(o,u){clearTimeout(i),e(c).off().remove(),"error"!=o.type&&r?a(r[0],d,t,n):s(null,u||"error",d,t,n),window[l]=f,r&&e.isFunction(f)&&f(r[0]),f=r=void 0}),!1===o(d,t)?(h("abort"),d):(window[l]=function(){r=arguments},c.src=t.url.replace(/\?(.+)=\?/,"?$1="+l),g.head.appendChild(c),t.timeout>0&&(i=setTimeout(function(){h("timeout")},t.timeout)),d)},e.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:E,xml:"application/xml, text/xml",html:_,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n,i,u=e.extend({},t||{}),h=e.Deferred&&e.Deferred();for(d in e.ajaxSettings)void 0===u[d]&&(u[d]=e.ajaxSettings[d]);r(u),u.crossDomain||((n=g.createElement("a")).href=u.url,n.href=n.href,u.crossDomain=k.protocol+"//"+k.host!=n.protocol+"//"+n.host),u.url||(u.url=window.location.toString()),(i=u.url.indexOf("#"))>-1&&(u.url=u.url.slice(0,i)),function(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=f(t.url,t.data),t.data=void 0)}(u);var v=u.dataType,y=/\?.+=\?/.test(u.url);if(y&&(v="jsonp"),!1!==u.cache&&(t&&!0===t.cache||"script"!=v&&"jsonp"!=v)||(u.url=f(u.url,"_="+Date.now())),"jsonp"==v)return y||(u.url=f(u.url,u.jsonp?u.jsonp+"=?":!1===u.jsonp?"":"callback=?")),e.ajaxJSONP(u,h);var m,b=u.accepts[v],E={},_=function(e,t){E[e.toLowerCase()]=[e,t]},A=/^([\w-]+:)\/\//.test(u.url)?RegExp.$1:window.location.protocol,S=u.xhr(),w=S.setRequestHeader;if(h&&h.promise(S),u.crossDomain||_("X-Requested-With","XMLHttpRequest"),_("Accept",b||"*/*"),(b=u.mimeType||b)&&(b.indexOf(",")>-1&&(b=b.split(",",2)[0]),S.overrideMimeType&&S.overrideMimeType(b)),(u.contentType||!1!==u.contentType&&u.data&&"GET"!=u.type.toUpperCase())&&_("Content-Type",u.contentType||"application/x-www-form-urlencoded"),u.headers)for(p in u.headers)_(p,u.headers[p]);if(S.setRequestHeader=_,S.onreadystatechange=function(){if(4==S.readyState){S.onreadystatechange=l,clearTimeout(m);var t,n=!1;if(S.status>=200&&S.status<300||304==S.status||0==S.status&&"file:"==A){v=v||c(u.mimeType||S.getResponseHeader("content-type")),t=S.responseText;try{"script"==v?(0,eval)(t):"xml"==v?t=S.responseXML:"json"==v&&(t=T.test(t)?null:e.parseJSON(t))}catch(e){n=e}n?s(n,"parsererror",S,u,h):a(t,S,u,h)}else s(S.statusText||null,S.status?"error":"abort",S,u,h)}},!1===o(S,u))return S.abort(),s(null,"abort",S,u,h),S;if(u.xhrFields)for(p in u.xhrFields)S[p]=u.xhrFields[p];var L=!("async"in u)||u.async;for(p in S.open(u.type,u.url,L,u.username,u.password),E)w.apply(S,E[p]);return u.timeout>0&&(m=setTimeout(function(){S.onreadystatechange=l,S.abort(),s(null,"timeout",S,u,h)},u.timeout)),S.send(u.data?u.data:null),S},e.get=function(){return e.ajax(h.apply(null,arguments))},e.post=function(){var t=h.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=h.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,o=this,a=t.split(/\s/),s=h(t,n,r),u=s.success;return a.length>1&&(s.url=a[0],i=a[1]),s.success=function(t){o.html(i?e("<div>").html(t.replace(y,"")).find(i):t),u&&u.apply(o,arguments)},e.ajax(s),this};var A=encodeURIComponent;e.param=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(A(t)+"="+A(n))},function t(n,r,i,o){var a,s=e.isArray(r),u=e.isPlainObject(r);e.each(r,function(r,l){a=e.type(l),o&&(r=i?o:o+"["+(u||"object"==a||"array"==a?r:"")+"]"),!o&&s?n.add(l.name,l.value):"array"==a||!i&&"object"==a?t(n,l,i,r):n.add(r,l)})}(r,t,n),r.join("&").replace(/%20/g,"+")}}(i),(r=i).Callbacks=function(e){e=r.extend({},e);var t,n,i,o,a,s,u=[],l=!e.once&&[],c=function r(c){for(t=e.memory&&c,n=!0,s=o||0,o=0,a=u.length,i=!0;u&&a>s;++s)if(!1===u[s].apply(c[0],c[1])&&e.stopOnFalse){t=!1;break}i=!1,u&&(l?l.length&&r(l.shift()):t?u.length=0:f.disable())},f={add:function(){if(u){var n=u.length;(function t(n){r.each(n,function(n,r){"function"==typeof r?e.unique&&f.has(r)||u.push(r):r&&r.length&&"string"!=typeof r&&t(r)})})(arguments),i?a=u.length:t&&(o=n,c(t))}return this},remove:function(){return u&&r.each(arguments,function(e,t){for(var n;(n=r.inArray(t,u,n))>-1;)u.splice(n,1),i&&(a>=n&&--a,s>=n&&--s)}),this},has:function(e){return!(!u||!(e?r.inArray(e,u)>-1:u.length))},empty:function(){return a=u.length=0,this},disable:function(){return u=l=t=void 0,this},disabled:function(){return!u},lock:function(){return l=void 0,t||f.disable(),this},locked:function(){return!l},fireWith:function(e,t){return!u||n&&!l||(t=[e,(t=t||[]).slice?t.slice():t],i?l.push(t):c(t)),this},fire:function(){return f.fireWith(this,arguments)},fired:function(){return!!n}};return f},function(e){function t(n){var r=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],i="pending",o={state:function(){return i},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var n=arguments;return t(function(t){e.each(r,function(r,i){var s=e.isFunction(n[r])&&n[r];a[i[1]](function(){var n=s&&s.apply(this,arguments);if(n&&e.isFunction(n.promise))n.promise().done(t.resolve).fail(t.reject).progress(t.notify);else{var r=this===o?t.promise():this,a=s?[n]:arguments;t[i[0]+"With"](r,a)}})}),n=null}).promise()},promise:function(t){return null!=t?e.extend(t,o):o}},a={};return e.each(r,function(e,t){var n=t[2],s=t[3];o[t[1]]=n.add,s&&n.add(function(){i=s},r[1^e][2].disable,r[2][2].lock),a[t[0]]=function(){return a[t[0]+"With"](this===a?o:this,arguments),this},a[t[0]+"With"]=n.fireWith}),o.promise(a),n&&n.call(a,a),a}var n=Array.prototype.slice;e.when=function(r){var i,o,a,s=n.call(arguments),u=s.length,l=0,c=1!==u||r&&e.isFunction(r.promise)?u:0,f=1===c?r:t(),h=function(e,t,r){return function(o){t[e]=this,r[e]=arguments.length>1?n.call(arguments):o,r===i?f.notifyWith(t,r):--c||f.resolveWith(t,r)}};if(u>1)for(i=new Array(u),o=new Array(u),a=new Array(u);u>l;++l)s[l]&&e.isFunction(s[l].promise)?s[l].promise().done(h(l,a,s)).fail(f.reject).progress(h(l,o,i)):--c;return c||f.resolveWith(a,s),f.promise()},e.Deferred=t}(i),function(e){function t(){l=null,f.last&&(f.el.trigger("longTap"),f={})}function n(){l&&clearTimeout(l),l=null}function r(){a&&clearTimeout(a),s&&clearTimeout(s),u&&clearTimeout(u),l&&clearTimeout(l),a=s=u=l=null,f={}}function i(e){return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function o(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}var a,s,u,l,c,f={};e(document).ready(function(){var h,d,p,v,g=0,y=0;"MSGesture"in window&&((c=new MSGesture).target=document.body),e(document).bind("MSGestureEnd",function(e){var t=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;t&&(f&&f.el&&f.el.trigger("swipe"),f&&f.el&&f.el.trigger("swipe"+t))}).on("touchstart MSPointerDown pointerdown",function(n){(!(v=o(n,"down"))||i(n))&&(p=v?n:n.touches[0],n.touches&&1===n.touches.length&&f.x2&&(f.x2=void 0,f.y2=void 0),h=Date.now(),d=h-(f.last||h),f.el=e("tagName"in p.target?p.target:p.target.parentNode),a&&clearTimeout(a),f.x1=p.pageX,f.y1=p.pageY,d>0&&250>=d&&(f.isDoubleTap=!0),f.last=h,l=setTimeout(t,750),c&&v&&c.addPointer(n.pointerId))}).on("touchmove MSPointerMove pointermove",function(e){(!(v=o(e,"move"))||i(e))&&(p=v?e:e.touches[0],n(),f.x2=p.pageX,f.y2=p.pageY,g+=Math.abs(f.x1-f.x2),y+=Math.abs(f.y1-f.y2))}).on("touchend MSPointerUp pointerup",function(t){(!(v=o(t,"up"))||i(t))&&(n(),f.x2&&Math.abs(f.x1-f.x2)>30||f.y2&&Math.abs(f.y1-f.y2)>30?u=setTimeout(function(){f&&f.el&&f.el.trigger("swipe"),f&&f.el&&f.el.trigger("swipe"+function(e,t,n,r){return Math.abs(e-t)>=Math.abs(n-r)?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}(f.x1,f.x2,f.y1,f.y2)),f={}},0):"last"in f&&(30>g&&30>y?s=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=r,f.el&&f.el.trigger(t),f.isDoubleTap?(f.el&&f.el.trigger("doubleTap"),f={}):a=setTimeout(function(){a=null,f.el&&f.el.trigger("singleTap"),f={}},250)},0):f={}),g=y=0)}).on("touchcancel MSPointerCancel pointercancel",r),e(window).on("scroll",r)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}})}(i),function(e){function t(t){return!(!(t=e(t)).width()&&!t.height())&&"none"!==t.css("display")}function n(e,t){e=e.replace(/=#\]/g,'="#"]');var n,r,i=s.exec(e);if(i&&i[2]in a&&(n=a[i[2]],r=i[3],e=i[1],r)){var o=Number(r);r=isNaN(o)?r.replace(/^["']|["']$/g,""):o}return t(e,n,r)}var r=e.zepto,i=r.qsa,o=r.matches,a=e.expr[":"]={visible:function(){return t(this)?this:void 0},hidden:function(){return t(this)?void 0:this},selected:function(){return this.selected?this:void 0},checked:function(){return this.checked?this:void 0},parent:function(){return this.parentNode},first:function(e){return 0===e?this:void 0},last:function(e,t){return e===t.length-1?this:void 0},eq:function(e,t,n){return e===n?this:void 0},contains:function(t,n,r){return e(this).text().indexOf(r)>-1?this:void 0},has:function(e,t,n){return r.qsa(this,n).length?this:void 0}},s=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),u=/^\s*>/,l="Zepto"+ +new Date;r.qsa=function(t,o){return n(o,function(n,a,s){try{var c;!n&&a?n="*":u.test(n)&&(c=e(t).addClass(l),n="."+l+" "+n);var f=i(t,n)}catch(e){throw console.error("error performing selector: %o",o),e}finally{c&&c.removeClass(l)}return a?r.uniq(e.map(f,function(e,t){return a.call(e,t,f,s)})):f})},r.matches=function(e,t){return n(t,function(t,n,r){return!(t&&!o(e,t)||n&&n.call(e,null,r)!==e)})}}(i),function(){try{getComputedStyle(void 0)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t){try{return e(t)}catch(e){return null}}}}(),e.exports=i},function(e,t,n){"use strict";var r=n(6);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var a=p(function(){t(i,r)});"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=l,l.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);this.state!==u?f(n,this.state===s?e:t,this.outcome):this.queue.push(new c(n,e,t));return n},c.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){o.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){if(e instanceof this)return e;return o.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=new Array(n),s=0,u=-1,l=new this(i);for(;++u<n;)c(e[u],u);return l;function c(e,i){t.resolve(e).then(function(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(l,a))},function(e){r||(r=!0,o.reject(l,e))})}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=-1,s=new this(i);for(;++a<n;)u=e[a],t.resolve(u).then(function(e){r||(r=!0,o.resolve(s,e))},function(e){r||(r=!0,o.reject(s,e))});var u;return s}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),o=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(o).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r={},i=function(e){var t;return function(){return void 0===t&&(t=function(){return window&&document&&document.all&&!window.atob}.apply(this,arguments)),t}}(),o=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),a=null,s=0,u=[],l=n(58);function c(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(g(i.parts[a],t))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(g(i.parts[a],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function h(e,t){var n=o(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=o(e.insertAt.before,n);n.insertBefore(t,i)}}function d(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function p(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=n.nc;r&&(e.attrs.nonce=r)}return v(t,e.attrs),h(e,t),t}function v(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function g(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var u=s++;n=a||(a=p(t)),r=m.bind(null,n,u,!1),i=m.bind(null,n,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),h(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=l(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){d(n),n.href&&URL.revokeObjectURL(n.href)}):(n=p(t),r=function(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){d(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=i()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return c(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var a=n[o];(s=r[a.id]).refs--,i.push(s)}for(e&&c(f(e,t),t),o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete r[s.id]}}}};var y=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function m(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=y(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{}}return r(e,[{key:"name",get:function(){return this.constructor.name}},{key:"tagName",get:function(){return this.options.tagName||"div"}},{key:"attributes",get:function(){return{class:this.options.className}}}]),r(e,[{key:"attr",value:function(e,t){if(void 0===t)return this.element.getAttribute(e);this.element.setAttribute(e,t)}},{key:"show",value:function(){this.removeClass("ad_runner_ui_hide")}},{key:"hide",value:function(){this.addClass("ad_runner_ui_hide")}},{key:"on",value:function(e,t){this.element.addEventListener(e,t)}},{key:"off",value:function(e,t){this.element.removeEventListener(e,t)}},{key:"html",value:function(e){this.element.innerHTML=e}},{key:"style",value:function(e,t){this.element.style[e]=t}},{key:"appendChild",value:function(e){this.element.appendChild(e.element||e)}},{key:"hasClass",value:function(e){return this.element.classList?this.element.classList.contains(e):new RegExp("(^|\\s)"+e+"($|\\s)").test(this.element.className)}},{key:"addClass",value:function(e){this.element.classList?this.element.classList.add(e):this.hasClass(this.element,e)||(this.element.className=(this.element.className+" "+e).trim())}},{key:"removeClass",value:function(e){this.element.classList?this.element.classList.remove(e):this.element.className=this.element.className.split(/\s+/).filter(function(t){return t!==e}).join(" ")}},{key:"render",value:function(){var e=this;this.element=this.options.element||document.createElement(this.tagName),Object.keys(this.attributes).forEach(function(t){var n=e.attributes[t];void 0!==n&&e.element.setAttribute(t,n)})}},{key:"remove",value:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}]),e}()},function(e,t,n){var r=n(5).DEFAULT_MAX_VOLUME;function i(e,t){return String(e).toUpperCase().indexOf(String(t).toUpperCase())>-1}function o(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}e.exports={contentVolumeToAdVolume:function(e){return e?e/100*r:0},convertToSecond:function(e){var t=isNaN(e)?e.split(":"):e;return 60*+t[0]*60+60*+t[1]+ +t[2]},isImaAd:function(e){return!i(e.system.name,"celtra")&&(i(e.system.name,"google")||i(e.system.version,"google")||i(e.system.name,"gamma"))},isFacebookAd:function(e){return i(e.system.name,"facebook")||i(e.system.version,"facebook")},isAsiaSmartAd:function(e){return e.vastAdTagURI&&i(e.vastAdTagURI,"adnetwork.adasiaholdings.com")||i(e.system.name,"smart")||i(e.system.name,"wootag")},formatTime:function(e,t){if(!isFinite(e))return"--:--";e*=1e3;var n=(e=parseInt(e/1e3))%60,r=(e=parseInt(e/60))%60,i=(e=parseInt(e/60))%24,o=parseInt(e/24),a="";return o&&o>0&&(a+=o+":",i<1&&(a+="00:")),(i&&i>0||t)&&(a+=("0"+i).slice(-2)+":"),a+=("0"+r).slice(-2)+":",(a+=("0"+n).slice(-2)).trim()},createPromiseDefer:o,createTimeoutPromise:function(e){var t=o(),n=setTimeout(t.resolve,e);return t.promise.cancel=function(){return clearTimeout(n)},t.promise},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Opera Mini/i.test(navigator.userAgent)}}},function(e,t,n){"use strict";var r=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdViewableImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoProgress","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError","AdClickBackground","AdClickThruVpaid"];r.forEach(function(e){r[e]=e}),Object.freeze(r),e.exports=r},function(e,t){e.exports={AD_POSITION:{preroll:"pre-roll",midroll:"mid-roll",postroll:"post-roll"},AD_DONE_REASON:{timeout:"timeout",error:"error",ended:"ended",skipped:"skipped"},COUNT_DOWN_DURATION:5,PRELOAD_DURATION:7,DEFAULT_MIDROLL_START_TIME:10,DEFAULT_SKIP_TIMEOUT:3,DEFAULT_AD_START_TIMEOUT:10,DEFAULT_NON_LINEAR_DURATION:15,DEFAULT_MAX_VOLUME:.75}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"===n(e)&&null!==e}function a(e){return void 0===e}r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),r=(l=n.slice()).length,u=0;u<r;u++)l[u].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.exports=r},function(e,t,n){e.exports={VastPlayer:n(21),VAST:n(12),EventEmitter:n(6)}},function(e,t,n){"use strict";var r=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];r.forEach(function(e){this[e.toUpperCase()]=e},r),Object.freeze(r),e.exports=r},function(e,t,n){"use strict";var r=n(15),i=document.createElement("video");n(14),t.isDesktop=!/Android|Silk|Mobile|PlayBook/.test(r.navigator.userAgent),t.canPlay=function(e){switch(i.canPlayType(e)){case"probably":return 2;case"maybe":return 1;default:return 0}},Object.freeze(t)},function(e,t,n){"use strict";function r(e,t,n){t.on(e,function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];n.emit.apply(n,[e].concat(t))})}function i(e,t,n){n.forEach(function(n){t.listeners(n).length>0&&r(n,e,t)}),t.on("newListener",function(i){n.indexOf(i)>-1&&t.listeners(i).length<1&&r(i,e,t)})}function o(e){this.events=e.slice(),this.__private__={target:null,source:null}}o.prototype.from=function(e){return this.__private__.source=e,this.__private__.target&&i(e,this.__private__.target,this.events),this},o.prototype.to=function(e){return this.__private__.target=e,this.__private__.source&&i(this.__private__.source,e,this.events),this},e.exports=o},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}e.exports=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adContainerElement=t,this.videoContent=n,this.logger=r.logger,this.onAdStarted=r.onAdStarted,this.onAdStopped=r.onAdStopped,this.onAdLoaded=r.onAdLoaded,this.options=i,this.logger.debug(this.name,"initializing")}return r(e,[{key:"selfControl",get:function(){return!1}},{key:"canClickThrough",get:function(){return!1}},{key:"viewDetailLink",get:function(){return""}}]),r(e,[{key:"loadAd",value:function(e){throw new Error("this must be overridden")}},{key:"initUserAction",value:function(){throw new Error("this must be overridden")}},{key:"canRun",value:function(e){throw new Error("this must be overridden")}},{key:"start",value:function(){throw new Error("this must be overridden")}},{key:"stop",value:function(){throw new Error("this must be overridden")}},{key:"pause",value:function(){throw new Error("this must be overridden")}},{key:"resume",value:function(){throw new Error("this must be overridden")}},{key:"cancel",value:function(){throw new Error("this must be overridden")}},{key:"viewDetail",value:function(){throw new Error("this must be overridden")}},{key:"setVolume",value:function(e){throw new Error("this must be overridden")}},{key:"setAdData",value:function(e){this.adData=e}},{key:"getVolume",value:function(){throw new Error("this must be overridden")}},{key:"isPaused",value:function(){throw new Error("this must be overridden")}},{key:"getRemainingTime",value:function(){throw new Error("this must be overridden")}},{key:"getDuration",value:function(){throw new Error("this must be overridden")}},{key:"getSkipOffset",value:function(){throw new Error("this must be overridden")}},{key:"resize",value:function(e,t,n){}},{key:"destroy",value:function(){throw new Error("this must be overridden")}}]),e}()},function(e,t,n){e.exports=n(22)},function(e,t,n){"use strict";e.exports=function(){return Array.prototype.slice.call(arguments).reduce(function(e,t){return Object.keys(t||{}).reduce(function(e,n){return e[n]=t[n],e},e)},{})}},function(e,t){var n={JAVASCRIPT:"application/javascript",FLASH:"application/x-shockwave-flash"};Object.freeze(n),e.exports=n},function(e,t){e.exports=window},function(e,t,n){"use strict";var r=n(39),i=n(8);function o(e,t){var n=this;r.call(this,Math.floor(e.duration||0),t),this.video=e,[i.PLAYING,i.PAUSE,i.TIMEUPDATE].forEach(function(t){return e.addEventListener(t,function(){return n.tick()},!1)})}o.prototype=Object.create(r.prototype),o.prototype._getState=function(){return{playing:!this.video.paused,currentTime:this.video.currentTime}},e.exports=o},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(46),a=n(52),s=n(53),u=(n(3).createPromiseDefer,[o,a,s]),l=function(){},c=function(){function e(t){var n=this,r=t.linearAdContainer,i=t.nonLinearAdContainer,o=t.contentPlayer,a=t.logger,c=t.onAdStarted,f=t.onAdStopped,h=t.onAdSkipped,d=t.onAdLoaded,p=t.onResetState,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=a,this.props={onAdStarted:c,onAdStopped:f,onAdSkipped:h,onAdLoaded:d||l,onResetState:p||l},this.loadPromise=null,this.currentPlayer=null,this.adData=null,this.adStarted=!1,this.adCancelled=!1,this.adVolume=1,this.lastError=null,this.players=u.map(function(e){return new e(e===s?i:r,o,{logger:a,onAdStarted:n._onAdStarted.bind(n),onAdStopped:n._onAdStopped.bind(n),onAdSkipped:n._onAdSkipped.bind(n),onAdLoaded:n._onAdLoaded.bind(n)},v)})}return i(e,[{key:"name",get:function(){return"Player"}}]),i(e,[{key:"initUserAction",value:function(){this.players.forEach(function(e){return e.initUserAction()})}},{key:"load",value:function(e){return this.adData=e,this.adCancelled=!1,this.adStarted=!1,this.lastError=null,this.loadPromise=this._loadAd(),this.loadPromise}},{key:"start",value:function(){this._playAd()}},{key:"stop",value:function(){this.currentPlayer.stop()}},{key:"skip",value:function(){this.currentPlayer.skip()}},{key:"cancel",value:function(){this.adCancelled=!0,this.currentPlayer&&this.currentPlayer.cancel()}},{key:"pause",value:function(){this.currentPlayer.pause()}},{key:"resume",value:function(){this.currentPlayer.resume()}},{key:"destroy",value:function(){this.players.forEach(function(e){return e.destroy()})}},{key:"resize",value:function(e,t,n){this.players.forEach(function(r){return r.resize(e,t,n)})}},{key:"setVolume",value:function(e){this.adVolume=e,this.currentPlayer&&this.currentPlayer.setVolume(e)}},{key:"getCurrentPlayer",value:function(){return this.currentPlayer}},{key:"isPlayingLinearAd",value:function(){return this.currentPlayer instanceof o?this.currentPlayer.currentAd&&this.currentPlayer.currentAd.isLinear():!(this.currentPlayer instanceof s)}},{key:"isGoogleNonLinearAd",value:function(){return this.currentPlayer instanceof o&&this.currentPlayer.currentAd&&!this.currentPlayer.currentAd.isLinear()}},{key:"_onAdStarted",value:function(){this.adStarted=!0,this.props.onAdStarted()}},{key:"_onAdStopped",value:function(e,t,n,r){var i=r||this.adData;this.adStarted||n?this.props.onAdStopped(e,t,i):(this.lastError=e,this._playAd(this.adIndex+1))}},{key:"_onAdSkipped",value:function(){this.props.onAdSkipped()}},{key:"_onAdLoaded",value:function(){this.props.onAdLoaded()}},{key:"_loadAd",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.logger.debug(this.name,"_loadAd | adIndex",t," | adData",this.adData.ads),this.adCancelled)return Promise.resolve();var n=this.adData.ads[t];if(this.currentPlayer=null,!n)return t>0&&this.logger.debug(this.name,"no ad left to load"),Promise.resolve();this.logger.debug(this.name,"loading ad item ".concat(t+1,"/").concat(this.adData.ads.length),n);var r=this._getPlayerForAd(n);return r?r.loadAd(n,this.adData).then(function(){return e.logger.debug(e.name,"ad loaded"),{player:r,adIndex:t}}).catch(function(n){return e.logger.error(e.name,"error while loading ad, falling back to next item:",n),e._loadAd(t+1)}):(this.logger.debug(this.name,"no player to play this ad, trying next item",n),this._loadAd(t+1))}},{key:"_playAd",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.adCancelled||(this.loadPromise?(e=this.loadPromise,delete this.loadPromise):e=this._loadAd(n),e.then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.player,r=e.adIndex;t.adCancelled||(n?(t.adIndex=r,t.currentPlayer=n,n.setAdData(t.adData),n.setVolume(t.adVolume),n.start()):t._onAdStopped(t.lastError||new Error("Cannot run ad"),null,!0))}))}},{key:"_getPlayerForAd",value:function(e){return this.players.filter(function(t){return t.canRun(e)})[0]}}]),e}();e.exports=c},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=n(2),l=n(3).formatTime;n(62),e.exports=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,i(t).call(this,e))).render(),"string"!=typeof n.options.template)throw new Error("options.template is required");return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,u),a(t,[{key:"attributes",get:function(){return{class:this.options.className||"ad_runner_ui_countdown"}}}]),a(t,[{key:"update",value:function(e){this._setRemainingTime(e)}},{key:"_setRemainingTime",value:function(e){var t;t=this.options.formatTime?l(e):Math.round(e),this.element.textContent=this.options.template.replace("%s",t)}}]),t}()},function(e,t,n){e.exports={Runner:n(20),Player:n(17),VAST:n(7).VAST}},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(7).VAST,a=n(17),s=n(60),u=n(61),l=n(87),c=n(3),f=c.contentVolumeToAdVolume,h=c.convertToSecond,d=c.createPromiseDefer,p=c.createTimeoutPromise,v=n(5),g=v.AD_POSITION,y=v.AD_DONE_REASON,m=v.DEFAULT_AD_START_TIMEOUT,b=v.DEFAULT_MIDROLL_START_TIME,E={free:1,loading:2,starting:3,playing:4},_={startTimeout:m,skipTimeout:v.DEFAULT_SKIP_TIMEOUT,countdownPlay:!0,defaultMidrollStartTime:b,getPoster:function(){},showSlideBlack:!1,removeAdmarkOnError:!0,autoPlayAdBreaks:!0,autoPlay:!1,mute:!1},T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.plugin=t,this.options=this._normalizeOption(n);var r=t.getAdContainers(),i=t.getContentPlayer();this.player=new a({linearAdContainer:r.linear,nonLinearAdContainer:r.nonLinear,contentPlayer:i,logger:this.logger,onAdStarted:this._onAdStarted.bind(this),onAdStopped:this._onAdStopped.bind(this),onAdSkipped:this._onAdSkipped.bind(this),onAdLoaded:this._onAdLoaded.bind(this),onResetState:this._onResetState.bind(this)},this.options),this.scheduler=new s({logger:this.logger,prepareAd:this._prepareAd.bind(this),beforePlayAd:this._beforePlayAd.bind(this),preloadAd:this._preloadAd.bind(this),loadAd:this._loadAd.bind(this),playAd:this._playAd.bind(this)}),this.adUi=new u(this.options,r),this.adMark=new l(r.adMark),this.state=E.free,this.adsLoaded=!1,this.adDeferred=null}return i(e,[{key:"name",get:function(){return"Runner"}},{key:"logger",get:function(){return this.plugin.getLogger()}},{key:"viewDetailLink",get:function(){var e=this.player.getCurrentPlayer();return e&&e.viewDetailLink}}]),i(e,[{key:"onContentProgress",value:function(e){this.scheduler.onContentProgress(e)}},{key:"onContentEnded",value:function(){this.scheduler.onContentEnded(),this.adMark.removeMarkItems()}},{key:"onUserAction",value:function(){this.player.initUserAction()}},{key:"onAdsDataLoaded",value:function(e){var t=this;this.logger.debug(this.name,"onAdsDataLoaded",e),this._normalizeAdsData(e),this.scheduler.populateAdsData(e),this.plugin.getContentMetadata().then(function(e){t.scheduler&&t.scheduler.dataLoadingDeferred.promise.then(function(){t.adMark.render(e.duration,t.scheduler.midrollAds)})})}},{key:"destroy",value:function(){this.player.destroy(),this.player=null,this.scheduler=null,this.adUi.remove(),this.adMark.remove()}},{key:"resize",value:function(e,t,n){this.player.resize(e,t,n)}},{key:"pauseAd",value:function(){this.player.pause()}},{key:"resumeAd",value:function(){this.player.resume()}},{key:"stopAd",value:function(){this.player.stop()}},{key:"showPosterAndPlayIcon",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.adUi.skipButton,n=t.poster,r=t.playIcon;e?(t.loadPoster(),n.show(),r.show()):(n.hide(),r.hide())}},{key:"_onResetState",value:function(){this.state=E.free,this.adsLoaded=!1}},{key:"_preloadAd",value:function(e){this.adsLoaded||this._loadAd(e)}},{key:"_prepareAd",value:function(e,t){this.options.countdownPlay&&this.adsLoaded&&(this.adUi.countdownToPlay.show(),this.adUi.countdownToPlay.update(t))}},{key:"_beforePlayAd",value:function(e,t){var n=this;this.adUi.countdownToPlay.hide(),e||!this.adsLoaded?setTimeout(function(){n.adsLoaded&&(n.options.showSlideBlack?(n.plugin.pauseForAd(),n.logger.debug(n.name,"Showing black screen"),n.adUi.slideBlack.show(),n.adUi.slideBlack.fadeIn(),setTimeout(function(){t()},2e3)):t())},1e3):t()}},{key:"_loadAd",value:function(e){this.state===E.free&&(this.adsLoaded=!1,this.state=E.loading,this.adDeferred=d(),this.logger.debug(this.name,"loading ad",e),this.player.load(e))}},{key:"_playAd",value:function(e,t){var n=this;return this._loadAd(e),this.logger.debug(this.name,"play ad",e),this.state=E.starting,this.adMetadata=t,this.adUi.onAdWillStart(),this.plugin.onAdWillStart&&this.plugin.onAdWillStart(),this.adTimeoutPromise=p(1e3*this.options.startTimeout),this.adTimeoutPromise.then(function(){n.logger.debug(n.name,"cannot start ad within ".concat(n.options.startTimeout,"s, cancelling...")),n.player&&n.player.cancel(),n._onAdStopped(null,y.timeout,e)}),this.player.setVolume(f(this.plugin.getContentVolume())),this.player.start(),this.adDeferred.promise}},{key:"_onAdStarted",value:function(){var e=this;this._mayPauseContent();var t=this.player.getCurrentPlayer();this.state=E.playing,this.adTimeoutPromise.cancel(),this.adUi.slideBlack.fadeOut(),setTimeout(function(){e.adUi.slideBlack.hide()},400),this.adUi.setPlayer(t),this.adUi.onAdStarted(this.adMetadata),this.plugin.onAdStarted&&this.plugin.onAdStarted(),this.logger.debug(this.name,"ad started by player:",t.name),this.player.isPlayingLinearAd()||(this.state=E.free,this.adDeferred.resolve(),this._mayResumeContent())}},{key:"_onAdStopped",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.ended,r=arguments.length>2?arguments[2]:void 0;switch(e&&(n=y.error),this.player.isGoogleNonLinearAd()&&this.plugin.hideLinearAdContainer&&this.plugin.hideLinearAdContainer(),(!e||e&&this.options.removeAdmarkOnError)&&r._completeAd&&r._completeAd(),this.state){case E.loading:break;case E.starting:case E.playing:}t.adTimeoutPromise.cancel(),t.adUi.onAdStopped(),t.plugin.onAdStopped&&t.plugin.onAdStopped(n),t._mayResumeContent(),t.logger.debug(t.name,"ad stopped:",n,e||""),t.adUi.slideBlack.hide(),this.state=E.free,this.adsLoaded=!1,this.adDeferred.resolve()}},{key:"_onAdSkipped",value:function(){this.plugin.onAdSkipped&&this.plugin.onAdSkipped()}},{key:"_onAdLoaded",value:function(){this.adsLoaded=!0}},{key:"_mayPauseContent",value:function(){this.player.isPlayingLinearAd()?this.plugin.pauseForAd():this.player.isGoogleNonLinearAd()&&(this.plugin.showLinearAdContainer&&this.plugin.showLinearAdContainer(),this.adUi.onAdStopped())}},{key:"_mayResumeContent",value:function(){this.adMetadata.order===this.adMetadata.total&&this.plugin.resumeAfterAd()}},{key:"_normalizeAdsData",value:function(e){var t=this;e.forEach(function(e){e.ads=o.pojoFromXML(e.server.tag).ads,delete e.server,Object.assign(e,t._buildAdOption(e))})}},{key:"_buildAdOption",value:function(e){var t={position:e.position,skipoffset:e.skipoffset?h(e.skipoffset):-1,startTime:e.startTime?h(e.startTime):0};return t.position!==g.midroll||t.startTime||(this.logger.warn(this.name,"no startTime specified on mid-roll ad, will use default startTime:",this.options.defaultMidrollStartTime),t.startTime=this.options.defaultMidrollStartTime),t}},{key:"_normalizeOption",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},_,e,{getPoster:this.plugin.getPoster&&this.plugin.getPoster.bind(this.plugin)})}}]),e}();e.exports=T},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(6),o=n(12),a=n(36),s=n(40),u=n(4),l=n(10),c=n(43),f=n(44),h=n(9),d=n(45);function p(e){return e}function v(){return new Error("VASTPlayer not ready.")}function g(e){return function(){var t=this,n=this.__private__.player;return this.ready?n[e]?n[e].apply(n,arguments).then(function(){return t}):Promise.resolve().then(function(){return t}):Promise.reject(v())}}function y(e){return{get:function(){if(!this.ready)throw v();return this.__private__.player[e]},set:function(t){if(!this.ready)throw v();return this.__private__.player[e]=t}}}function m(e,t){return String(e).toUpperCase().indexOf(String(t).toUpperCase())>-1}function b(e,t){var n=this;i.call(this),this.__private__={container:e,config:function e(){var t,n,i,o,a={},s=arguments.length;for(t=0;t<s;t++)for(i in n=arguments[t]||{})o=n[i],void 0===a[i]&&(a[i]=o),"object"===r(o)&&(a[i]=e(a[i],o));return a}(t,{vast:{resolveWrappers:!0,maxRedirects:5},tracking:{mapper:p},width:480,height:270}),vast:null,ready:!1,player:null,isVPAID:!1,vpaidVendor:null,video:f()};var o=this;this.on(u.AdClickThru,function(e,t,n){var r=e||o.viewDetailLink;n&&r&&(this.__private__.player.alreadyEmitViewable||(this.__private__.player.alreadyEmitViewable=!0,this.__private__.player.emit(u.AdViewableImpression)),window.open(r));var i=o.vast.get("ads[0].creatives[0].videoClicks.clickTrackings");i&&i.length>0&&i.map(function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.send(null)})}),this.on(u.AdClickBackground,function(){var e=o.__private__.player;e.video&&h.isDesktop&&(e.video.paused?n.resumeAd():n.pauseAd())})}n(15).console,b.prototype=Object.create(i.prototype),Object.defineProperties(b.prototype,{container:{get:function(){return this.__private__.container}},config:{get:function(){return this.__private__.config}},vast:{get:function(){return this.__private__.vast}},ready:{get:function(){return this.__private__.ready}},paused:{get:function(){return this.__private__.video.paused}},video:{set:function(e){return this.__private__.video=e}},isVPAID:{get:function(){return this.__private__.isVPAID}},isAsiaSmartAd:{get:function(){return(e=this.vast.ads[0]).vastAdTagURI&&m(e.vastAdTagURI,"adnetwork.adasiaholdings.com")||m(e.system.name,"smart")||m(e.system.name,"wootag");var e}},vpaidVendor:{get:function(){return this.__private__.vpaidVendor}},viewDetailLink:{get:function(){return this.vast&&this.vast.get("ads[0].creatives[0].videoClicks.clickThrough")}},adRemainingTime:y("adRemainingTime"),adDuration:y("adDuration"),adVolume:y("adVolume")}),b.prototype.load=function(e){var t=this,n=this.config.vast;return("string"==typeof e?o.fetch(e,n):new o(e).resolveWrappers()).then(function(e){var n=function(){var n=e.filter("ads[0].creatives[0].mediaFiles",a.canPlayMediaFile),r=e.filter("ads[0].creatives[0].mediaFiles",s.canPlayMediaFile);if(r.length>0)return t.__private__.isVPAID=!1,t.__private__.vpaidVendor=null,{player:new s(t.container,t.__private__.video,t.config),mediaFiles:r};if(n.length>0)return t.__private__.isVPAID=!0,t.__private__.vpaidVendor=d.getVpaidVendor(n),{player:new a(t.container,t.__private__.video,t.config,t),mediaFiles:n};throw new Error("There are no playable <MediaFile>s.")}(),r=n.player,i=n.mediaFiles,o={adParameters:e.get("ads[0].creatives[0].parameters"),progressEvents:e.get("ads[0].creatives[0].trackingEvents").filter(function(e){return"progress"==e.event})},f=[].concat(e.map("ads[0].impressions",function(e){return{event:"impression",uri:e.uri}}),e.map("ads[0].viewableImpressions",function(e){return{event:"viewableImpression",uri:e.uri}}),e.map("ads[0].errors",function(e){return{event:"error",uri:e}}),e.get("ads[0].creatives[0].trackingEvents"),e.map("ads[0].creatives[0].videoClicks.clickTrackings",function(e){return{event:"clickThrough",uri:e}})),h=new l(u),p=new c(f,t.config.tracking.mapper);if(h.from(r).to(t),t.__private__.vast=e,t.__private__.player=r,t.isAsiaSmartAd){var v=e.get("ads[0].creatives[0].duration");v&&(r.adDuration=v)}return r.load(i,o).then(function(){p.track(r)})}).then(function(){return t.__private__.ready=!0,t.emit("ready"),t}).catch(function(e){throw t.emit("error",e),e})},b.prototype.startAd=g("startAd"),b.prototype.stopAd=g("stopAd"),b.prototype.skipAd=g("skipAd"),b.prototype.pauseAd=g("pauseAd"),b.prototype.resumeAd=g("resumeAd"),b.prototype.init=function(){var e=this.__private__.video,t=this.__private__.container;return e.init(t)},b.vpaidSWFLocation="https://ajax.cdnjs.com/ajax/libs/videojs-vast-vpaid/2.0.2/VPAIDFlash.swf",e.exports=b},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(23),o=n(24),a=n(25),s=n(13),u=n(26),l=Array.prototype.push,c=n(27),f={inline:function(e){a({description:null,survey:null},e)},wrapper:function(){}},h={linear:function(e){a({trackingEvents:[],parameters:null,videoClicks:null},e),(e.mediaFiles||[]).forEach(function(e){a({id:null,bitrate:null,scalable:null,maintainAspectRatio:null,apiFramework:null},e)})},companions:function(e){e.companions.forEach(function(e){a({expandedWidth:null,expandedHeight:null,apiFramework:null,trackingEvents:[],clickThrough:null,altText:null,parameters:null},e)})},nonLinear:function(e){a({trackingEvents:[]},e),e.ads.forEach(function(e){a({id:null,expandedWidth:null,expandedHeight:null,scalable:null,maintainAspectRatio:null,minSuggestedDuration:null,apiFramework:null,clickThrough:null,parameters:null},e)})}},d=["ads.celtra.com"];function p(){}function v(e,t){var n=e.indexOf("redirectUrl=");if(n>-1&&d.some(function(t){return e.indexOf(t)>-1})){var r=e.slice(n+"redirectUrl=".length);return e=e.slice(0,n),i.get(e,t).catch(p).then(function(){return i.get(r,t)})}return i.get(e,t)}function g(e){o(e,this,!0),this.ads.forEach(function(e){a({system:{version:null},errors:[]},e),e.creatives.forEach(function(e){a({id:null,sequence:null,adID:null},e),h[e.type](e)}),f[e.type](e)}),this.__private__={wrappers:[],inlines:[]}}Object.defineProperties(g.prototype,{wrappers:{get:function(){var e=this.__private__.wrappers;return e.length=0,l.apply(e,this.filter("ads",function(e){return"wrapper"===e.type})),e}},inlines:{get:function(){var e=this.__private__.inlines;return e.length=0,l.apply(e,this.filter("ads",function(e){return"inline"===e.type})),e}}}),g.prototype.get=function(e){return((e||"").match(/[^\[\]\.]+/g)||[]).reduce(function(e,t){return e?e[t]:void 0},this)},g.prototype.set=function(e,t){var n=function(){for(var t,n=/[^\[\]\.]+/g,r=[];t=n.exec(e);)r.push({token:t[0],type:o(t,t.index+t[0].length)});return r}(),r=n.pop(),i=n.reduce(function(e,t){return e[t.token]||(e[t.token]=new t.type)},this);function o(e,t){switch(e.input.charAt(t)){case".":return Object;case"[":return Array;case"]":return o(e,t+1);default:return null}}if(!e)throw new Error("prop must be specified.");return i[r.token]=t},g.prototype.map=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)i.push(t.call(this,n[o],o,n));return i},g.prototype.filter=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)t.call(this,n[o],o,n)&&i.push(n[o]);return i},g.prototype.find=function(e,t){var n=this.get(e)||[],r=n.length;if(n instanceof Array)for(var i=0;i<r;i++)if(t.call(this,n[i],i,n))return n[i]},g.prototype.toPOJO=function(){var e=JSON.parse(JSON.stringify(this));return delete e.__private__,e},g.prototype.copy=function(){return new this.constructor(this.toPOJO())},g.prototype.resolveWrappers=function(){var e=isNaN(arguments[0])?1/0:arguments[0],t="function"==typeof arguments[0]?arguments[0]:arguments[1],n=this.constructor,r=this;return 0===e?Promise.reject(new Error("Too many redirects were made.")):u(Promise.all(this.map("wrappers",function(e){return Promise.resolve(v(e.vastAdTagURI,{withCredentials:!0})).then(function(t){return{wrapper:e,response:n.pojoFromXML(t.data).ads}})})).then(function(e){var t=e.map(function(e){return e.wrapper}),i=e.map(function(e){return e.response});return new n(s(r.toPOJO(),{ads:r.map("ads",function(e){var n=t.indexOf(e),r=t[n],o=i[n];return o?o.map(function(e,t){var n=function(e){return{linear:e.filter(r("linear")),companions:e.filter(r("companions")),nonLinear:e.filter(r("nonLinear"))}}(e.creatives);function r(e){return function(t){return t.type===e}}return a(e.impressions,t.impressions),a(e.viewableImpressions,t.viewableImpressions),a(e.errors,t.errors),t.creatives.forEach(function(e){a(n[e.type].shift()||{},e)}),l.apply(t.creatives,"wrapper"!==t.type?[]:["linear","companions","nonLinear"].reduce(function(e,t){return e.concat(n[t])},[])),t}.bind(null,r)):[e]}).reduce(function(e,t){return e.concat(t)})}))}).then(function(t){return t.get("wrappers.length")>0?t.resolveWrappers(e-1):t}),t)},g.prototype.toXML=function(){var e=this.validate();if(!e.valid)throw new Error("VAST is invalid: "+e.reasons.join(", "));return c(this)},g.prototype.validate=function(){var e=this,t=[],n={inline:function(t){var n={linear:function(e){a(e,{exists:["duration"],atLeastOne:["mediaFiles"]})},companions:function(t){e.get(t("companions")).forEach(function(e,n){a(function(e){return t("companions["+n+"]."+e)},{exists:[],atLeastOne:["resources"]})})},nonLinear:function(t){e.get(t("ads")).forEach(function(e,n){a(function(e){return t("ads["+n+"]."+e)},{exists:[],atLeastOne:["resources"]})})}};a(t,{exists:["title"],atLeastOne:["creatives"]}),e.get(t("creatives")).forEach(function(e,r){function i(e){return t("creatives["+r+"]."+e)}a(i,{exists:["type"],atLeastOne:[]}),(n[e.type]||p)(i)})},wrapper:function(e){a(e,{exists:["vastAdTagURI"],atLeastOne:[]})}};function r(e,n){e||t.push(n)}function i(t){r(e.get(t),t+" is required")}function o(t){r(e.get(t+".length")>0,t+" must contain at least one value")}function a(e,t){t.exists.map(e).forEach(i),t.atLeastOne.map(e).forEach(o)}return a(function(e){return e},{exists:[],atLeastOne:["ads"]}),this.get("ads").forEach(function(e,t){function r(e){return"ads["+t+"]."+e}a(r,{exists:["type","system.name"],atLeastOne:["impressions"]}),(n[e.type]||p)(r)}),{valid:0===t.length,reasons:0===t.length?null:t}},g.pojoFromXML=n(30),g.fetch=function(e){var t="object"===r(arguments[1])&&arguments[1]||{},n="function"==typeof arguments[2]?arguments[2]:arguments[1],i=this;return u(Promise.resolve(v(e,{headers:t.headers||{}})).then(function(e){var n=new i(i.pojoFromXML(e.data));return t.resolveWrappers?n.resolveWrappers(t.maxRedirects):n}),n)},e.exports=g},function(e,t){e.exports={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.withCredentials,r=t.headers;return new Promise(function(t,i){var o=new XMLHttpRequest;o.open("GET",e),o.withCredentials=Boolean(n),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status?t({data:o.responseText}):i(new Error("Unexpected status code:",o.status)))},r&&Object.keys(r).forEach(function(e){o.setRequestHeader(e,r[e])}),o.send()})}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=Array.prototype.push;e.exports=function e(t){var n="object"===r(arguments[1])?arguments[1]:null,o="boolean"==typeof arguments[1]?arguments[1]:arguments[2];return Object(t)!==t?t:t instanceof Array?function(t,n,r){var o=n||[];return i.apply(o,r?t.map(function(t){return e(t,null,!0)}):t),o}(t,n,o):function(t,n,r){return Object.keys(t).reduce(function(n,i){return n[i]=r?e(t[i],null,!0):t[i],n},n||{})}(t,n,o)}},function(e,t,n){"use strict";var r=Array.prototype.push;function i(e){return Object(e)===e}function o(e){return e instanceof Array}e.exports=function e(t,n){return[t,n].every(o)?(r.apply(n,t.filter(function(e){return n.indexOf(e)<0})),n):Object.keys(t).reduce(function(n,r){return[t[r],n[r]].every(i)&&e(t[r],n[r]),r in n||(n[r]=t[r]),n},n)}},function(e,t,n){"use strict";e.exports=function(e,t){return"function"!=typeof t?e:(e.then(function(e){t(null,e)},function(e){t(e)}),e)}},function(e,t,n){"use strict";var r=n(28),i=n(29),o={linear:function(e){return{tag:"Linear",children:[{tag:"Duration",value:r(e.duration)},a(e.trackingEvents),u(e)].concat(e.videoClicks?[{tag:"VideoClicks",children:[{tag:"ClickThrough",value:e.videoClicks.clickThrough,cdata:!0}].concat(e.videoClicks.clickTrackings.map(function(e){return{tag:"ClickTracking",value:e,cdata:!0}}),e.videoClicks.customClicks.map(function(e){return{tag:"CustomClick",attributes:{id:e.id},value:e.uri,cdata:!0}}))}]:[],[{tag:"MediaFiles",children:e.mediaFiles.map(function(e){return{tag:"MediaFile",attributes:{id:e.id,width:e.width,height:e.height,bitrate:e.bitrate,type:e.type,delivery:e.delivery,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,apiFramework:e.apiFramework},value:e.uri,cdata:!0}})}])}},companions:function(e){return{tag:"CompanionAds",children:e.companions.map(function(e){return{tag:"Companion",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,apiFramework:e.apiFramework},children:s(e.resources).concat([a(e.trackingEvents),{tag:"CompanionClickThrough",value:e.clickThrough,cdata:!0},{tag:"AltText",value:e.altText},u(e)])}})}},nonLinear:function(e){return{tag:"NonLinearAds",children:e.ads.map(function(e){return{tag:"NonLinear",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,minSuggestedDuration:r(e.minSuggestedDuration),apiFramework:e.apiFramework},children:s(e.resources).concat([{tag:"NonLinearClickThrough",value:e.clickThrough,cdata:!0},u(e)])}}).concat([a(e.trackingEvents)])}}};function a(e){return{tag:"TrackingEvents",children:e.map(function(e){return{tag:"Tracking",attributes:{event:e.event},value:e.uri,cdata:!0}})}}function s(e){return e.map(function(e){return{tag:function(t){switch(e.type){case"static":return"StaticResource";case"iframe":return"IFrameResource";case"html":return"HTMLResource"}}(),attributes:{creativeType:e.creativeType},value:e.data,cdata:!0}})}function u(e){return{tag:"AdParameters",value:e.parameters}}e.exports=function(e){return i({tag:"VAST",attributes:{version:e.get("version")},children:e.map("ads",function(e){return{tag:"Ad",attributes:{id:e.id},children:[{tag:function(){switch(e.type){case"inline":return"InLine";case"wrapper":return"Wrapper"}}(),children:[{tag:"AdSystem",attributes:{version:e.system.version},value:e.system.name},{tag:"AdTitle",value:e.title},{tag:"Description",value:e.description},{tag:"Survey",value:e.survey,cdata:!0},{tag:"VASTAdTagURI",value:e.vastAdTagURI,cdata:!0}].concat(e.errors.map(function(e){return{tag:"Error",value:e,cdata:!0}}),e.impressions.map(function(e){return{tag:"Impression",value:e.uri,cdata:!0,attributes:{id:e.id}}}),[{tag:"ViewableImpression",children:e.viewableImpressions.map(function(e){return{tag:"Viewable",value:e.uri,cdata:!0,attributes:{id:e.id}}})}],[{tag:"Creatives",children:e.creatives.map(function(e){return{tag:"Creative",attributes:{id:e.id,sequence:e.sequence,AdID:e.adID},children:[(t=e.type,o[t](e))]};var t}),required:!0}])}]}})},!0)}},function(e,t,n){"use strict";function r(e){return(e>9?"":"0")+e.toString()}e.exports=function(e){return Number(e)!==e?null:[Math.floor(e/60/60),Math.floor(e/60%60),Math.floor(e%60%60)].map(r).join(":")}},function(e,t,n){"use strict";function r(e){return null!=e}function i(e){return void 0!==e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function o(e){return e.cdata?function(e){return(void 0!==e?function(e){for(var t,n,r=[],i=/]]>/g,o=0;t=i.exec(e);)n=t.index+2,r.push(t.input.substring(o,n)),o=n;return r.push(e.substring(o,e.length)),r}(String(e)):[""]).reduce(function(e,t){return e+"<![CDATA["+t+"]]>"},"")}(e.value):i(e.value)}e.exports=function(e,t){return['<?xml version="1.0" encoding="UTF-8"?>'].concat(function e(t,n,a){var s=t.tag,u=t.attributes||{},l=Object.keys(u),c=t.children||[],f=t.value,h=c.length>0,d=l.every(function(e){return r(u[e])})&&l.length>0,p=r(f)||h||d,v=function(e){for(var t="";e--;)t+=" ";return t}(n),g="<"+s+Object.keys(u).reduce(function(e,t){return a&&!r(u[t])?e:e+" "+t+'="'+i(u[t])+'"'},"")+">",y="</"+s+">";return!a||p||t.required?h?[v+g].concat(t.children.reduce(function(t,r){return t.concat(e(r,n+4,a))},[]),[v+y]):[v+g+o(t)+y]:[]}(e,0,t)).join("\n")}},function(e,t,n){"use strict";var r=n(31),i=n(32),o=n(33),a=n(13),s=n(34),u=n(35),l={linear:function(e){var t=f(e.find("Duration")),n=f(e.find("Linear")),r=e.find("Tracking"),a=f(e.find("AdParameters")),s=e.find("VideoClicks")[0],l=e.find("MediaFile");return{type:"linear",skipOffset:n.attributes.skipoffset,duration:i(t.value)||void 0,trackingEvents:r.map(function(e){var t={event:e.attributes.event,uri:e.value};return"progress"===e.attributes.event&&(t.offset=i(e.attributes.offset)),t}),parameters:a.value,videoClicks:s&&function(){var e=f(s.find("ClickThrough")),t=s.find("ClickTracking"),n=s.find("CustomClick");return{clickThrough:e.value,clickTrackings:t.map(function(e){return e.value}),customClicks:n.map(function(e){return{id:e.attributes.id,uri:e.value}})}}(),mediaFiles:l.map(function(e){var t=e.attributes;return{id:t.id,delivery:t.delivery,type:t.type,uri:e.value,bitrate:u(t.bitrate),width:u(t.width),height:u(t.height),scalable:o(t.scalable),maintainAspectRatio:o(t.maintainAspectRatio),apiFramework:t.apiFramework}})}},companions:function(e){return{type:"companions",companions:e.find("Companion").map(function(e){var t=e.find("Tracking"),n=f(e.find("CompanionClickThrough")),r=f(e.find("StaticResource")),i=f(e.find("AltText")),o=f(e.find("AdParameters"));return{id:e.attributes.id,width:u(e.attributes.width),height:u(e.attributes.height),expandedWidth:u(e.attributes.expandedWidth),expandedHeight:u(e.attributes.expandedHeight),apiFramework:e.attributes.apiFramework,resources:function(e){return e.find("URL").map(function(e){return{data:e.value}})}(e),staticResource:r.value,trackingEvents:t.map(function(e){return{event:e.attributes.event,uri:e.value}}),clickThrough:n.value,altText:i.value,parameters:o.value}})}},nonLinear:function(e){var t=e.find("NonLinear"),n=e.find("Tracking");return{type:"nonLinear",ads:t.map(function(e){var t=f(e.find("NonLinearClickThrough")),n=f(e.find("StaticResource")),r=f(e.find("AdParameters"));return{id:e.attributes.id,width:e.attributes.width,height:e.attributes.height,expandedWidth:u(e.attributes.expandedWidth),expandedHeight:u(e.attributes.expandedHeight),scalable:o(e.attributes.scalable),maintainAspectRatio:o(e.attributes.maintainAspectRatio),minSuggestedDuration:i(e.attributes.minSuggestedDuration)||void 0,apiFramework:e.attributes.apiFramework,resources:n.value,clickThrough:t.value,parameters:r.value}}),trackingEvents:n.map(function(e){return{event:e.attributes.event,uri:e.value}})}}},c={inline:function(e){var t=f(e.find("AdTitle")),n=f(e.find("Description")),r=f(e.find("Survey"));return{type:"inline",title:t.value,description:n.value,survey:r.value}},wrapper:function(e){return{type:"wrapper",vastAdTagURI:f(e.find("VASTAdTagURI")).value}}};function f(e){return e[0]||{attributes:{}}}e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"VAST",n=r(e);if(!n(t)[0])throw new Error("["+e+"] is not a valid VAST document.");return s({version:f(n(t)).attributes.version,ads:n("Ad").map(function(e){var t=f(e.find("Wrapper,InLine")).tag.toLowerCase(),n=f(e.find("AdSystem")),r=f(e.find("AdTitle")),i=f(e.find("Description")),o=e.find("Error"),s=e.find("Impression"),h=e.find("ViewableImpression Viewable"),d=e.find("Creative").filter(function(e){return e.children().length});return a({id:e.attributes.id,system:{name:n.value,version:n.attributes.version},advertiser:{title:r.value,description:i.value},errors:o.map(function(e){return e.value}),impressions:s.map(function(e){return{uri:e.value,id:e.attributes.id}}),viewableImpressions:h.map(function(e){return{uri:e.value,id:e.attributes.id}}),creatives:d.map(function(e){var t=function(){switch(f(e.find("Linear,CompanionAds,NonLinearAds")).tag){case"Linear":return"linear";case"CompanionAds":return"companions";case"NonLinearAds":return"nonLinear"}}();return a({id:e.attributes.id,sequence:u(e.attributes.sequence),adID:e.attributes.AdID},l[t](e))})},c[t](e))})},!0)}},function(e,t,n){"use strict";var r=Array.prototype.map,i=Array.prototype.filter,o=Array.prototype.reduce,a=new DOMParser;function s(e){var t=e.childElementCount>0;return{tag:e.tagName,value:t?null:e.textContent,attributes:o.call(e.attributes,function(e,t){return e[t.name]=t.value,e},{}),find:function(t){return u(e.querySelectorAll(t))},children:function(){return i.call(e.childNodes,function(e){return e instanceof Element}).map(s)}}}function u(e){return r.call(e,s)}e.exports=function(e){var t=a.parseFromString(e,"application/xml");return function(e){return u(t.querySelectorAll(e))}}},function(e,t,n){"use strict";e.exports=function(e){var t=(e||"").match(/^(\d\d):(\d\d):(\d\d)$/);return t&&t.slice(1,4).map(parseFloat).reduce(function(e,t,n){return e+t*Math.pow(60,Math.abs(n-2))},0)}},function(e,t,n){"use strict";e.exports=function(e){switch((e||"").toLowerCase()){case"true":return!0;case"false":return!1}}},function(e,t,n){"use strict";e.exports=function e(t,n){return Object(t)!==t?t:Object.keys(t).reduce(function(r,i){return n&&t[i]instanceof Array?r[i]=t[i].filter(function(e){return void 0!==e}).map(function(t){return e(t,!0)}):n&&t[i]instanceof Object?r[i]=e(t[i],!0):void 0!==t[i]&&(r[i]=t[i]),r},{})}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){if(/string|number|boolean/.test(r(e)))return isNaN(e)?void 0:Number(e)}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t,n,r){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,r){var i,o=c(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(r,n),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(r,t)){if(!i.writable)return!1;i.value=n,Object.defineProperty(r,t,i)}else!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(r,t,n);return!0})(e,t,n,r)}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=c(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=n(37),d=n(4),p=n(14),v=n(8),g=n(9).isDesktop,y=n(38),m=n(16),b=n(10);function E(e,t,n){return e.addEventListener(t,n,!1)}var _=function(e){function t(e,n,r,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=i(this,f(t).call(this,e))).frame=null,a.video=n,a.config=r,a.parent=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,h),a(t,[{key:"adVolume",get:function(){return l(f(t.prototype),"adVolume",this)},set:function(e){(function(e,t,n,r,i){if(!u(e,t,n,r||e)&&i)throw new Error("failed to set property")})(f(t.prototype),"adVolume",e,this,!0),this.video.muted=0===e}}],[{key:"canPlayMediaFile",value:function(e){return(e.type===p.JAVASCRIPT||"application/x-javascript"===e.type)&&"VPAID"===e.apiFramework}}]),a(t,[{key:"load",value:function(e,t){var n=this,r=e[0].uri,i=e[0].bitrate;return new Promise(function(e,o){var a=document.createElement("iframe"),s=document.createElement("script"),u=n.video,l=null;function c(e){n.container.removeChild(a),n.adVolume=0,n.video.clean&&n.video.clean(),n.video=null,n.frame=null,n.api=null,e&&o(e)}a.src="about:blank",a.setAttribute("scrolling","no"),a.style.width="100%",a.style.height="100%",a.style.display="block",a.style.opacity="0",a.style.border="none",n.container.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.close(),a.contentWindow.document.body.style.margin="0",n.frame=a,s.src=r,s.onload=function(){var r=a.contentWindow.getVPAIDAd(),s=a.contentWindow.document.body,l=n.vpaidVersion=new y(r.handshakeVersion("2.0"));if(l.major>2)return o(new Error("VPAID version "+l+" is not supported."));a.contentWindow.addEventListener("resize",function(){var e=a.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")},!1),d.forEach(function(e){if(n.parent.isAsiaSmartAd||e!==d.AdStarted)return r.subscribe(function(){for(var t=new Array(arguments.length),r=arguments.length;r--;)t[r]=arguments[r];return n.emit.apply(n,[e].concat(t))},e)}),n.once(d.AdLoaded,function(){a.style.opacity="1",n.api=r,e(n)}),n.once(d.AdError,function(e){c(new Error(e))}),n.once(d.AdStopped,c),n.parent.isAsiaSmartAd&&(n.once(d.AdStopped,function(e){n.emit(d.AdSkipped)}),n.once(d.AdVideoStart,function(e){var t=a.contentWindow.document.querySelector(".sas-container").querySelector("iframe").contentWindow.document.querySelector("video");n.video=t,n.parent.video=t})),r.initAd(n.config.width,n.config.height,"normal",i,{AdParameters:t.adParameters},{slot:s,videoSlot:u,videoSlotCanAutoPlay:g})},s.onerror=function(){c(new Error("Failed to load MediaFile ["+r+"]."))},function(e,t,n){E(e,t,function r(){return function(e,t,n){e.removeEventListener(t,n,!1)}(e,t,r),n.apply(this,arguments)})}(u,v.PLAYING,function(){n.emit(d.AdStarted)}),E(u,v.TIMEUPDATE,function(){var e,t;e=n.container,!((t=e.getBoundingClientRect()).top||t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2)||n.alreadyEmitViewable?l=null:(l||(l=u.currentTime),u.currentTime-l>=2&&(n.alreadyEmitViewable=!0,n.emit(d.AdViewableImpression)))}),E(u,v.LOADEDMETADATA,function(){var e=new m(u,t.progressEvents);new b([d.AdVideoProgress]).from(e).to(n)}),a.contentWindow.document.body.appendChild(u),a.contentWindow.document.body.appendChild(s)})}}]),t}();e.exports=_},function(e,t,n){"use strict";var r=n(6),i=n(4);function o(e,t){return function(){var n=arguments,r=this.api,i=this;function o(){return new Error("Ad has not been loaded.")}function a(){return r[e].apply(r,n)}if(!t){if(!r)throw o();return a()}return new Promise(function(e,n){return r?(i.once(t,function(){e(i)}),a()):n(o())})}}function a(e){r.call(this),this.container=e,this.api=null,this.vpaidVersion=null}a.prototype=Object.create(r.prototype),Object.defineProperties(a.prototype,{adLinear:{get:o("getAdLinear")},adWidth:{get:o("getAdWidth")},adHeight:{get:o("getAdHeight")},adExpanded:{get:o("getAdExpanded")},adSkippableState:{get:o("getAdSkippableState")},adRemainingTime:{get:o("getAdRemainingTime")},adDuration:{get:o("getAdDuration"),set:function(e){}},adVolume:{get:o("getAdVolume"),set:o("setAdVolume")},adCompanions:{get:o("getAdCompanions")},adIcons:{get:o("getAdIcons")}}),a.prototype.load=function(){throw new Error("VPAID subclass must implement load() method.")},a.prototype.resizeAd=o("resizeAd",i.AdSizeChange),a.prototype.startAd=o("startAd",i.AdStarted),a.prototype.stopAd=o("stopAd",i.AdStopped),a.prototype.pauseAd=o("pauseAd",i.AdPaused),a.prototype.resumeAd=o("resumeAd",i.AdPlaying),a.prototype.expandAd=o("expandAd",i.AdExpandedChange),a.prototype.collapseAd=o("collapseAd",i.AdExpandedChange),a.prototype.skipAd=function(){o("skipAd",i.AdSkipped).call(this),this.stopAd()},e.exports=a},function(e,t,n){"use strict";function r(e){var t=e.split(".").map(parseFloat);this.string=e,this.major=t[0],this.minor=t[1],this.patch=t[2],Object.freeze(this)}r.prototype.toString=function(){return this.string},e.exports=r},function(e,t,n){"use strict";var r=n(6),i=n(4);function o(e,t,n){e!==i.AdVideoProgress?t.fired[e]||(t.emit(e),t.fired[e]=!0):t.emit(e,n)}function a(e,t){r.apply(this,arguments),this.duration=e,this.progressEvents=t.sort(function(e,t){return e.offset<t.offset}),this.seconds=Array.apply([],new Array(e)).map(function(){return!1}),this.fired=[i.AdVideoStart,i.AdVideoFirstQuartile,i.AdVideoMidpoint,i.AdVideoThirdQuartile,i.AdVideoComplete].reduce(function(e,t){return e[t]=!1,e},{})}a.prototype=Object.create(r.prototype),a.prototype.tick=function(){var e=this,t=this.seconds,n=this._getState(),r=Math.round(n.currentTime)-1,a=[1,2,3,4].map(function(e){return Math.floor(this.duration/4*e)},this);function s(e){var n=a[e-1];return!(!n||0==n)&&t.slice(0,n).every(function(e){return!0===e})}n.playing&&(o(i.AdVideoStart,this),r>-1&&(this.seconds[r]=!0)),s(1)&&o(i.AdVideoFirstQuartile,this),s(2)&&o(i.AdVideoMidpoint,this),s(3)&&o(i.AdVideoThirdQuartile,this),s(4)&&o(i.AdVideoComplete,this),this.progressEvents.length&&this._popMatchProgressEvents(n.currentTime).forEach(function(t){return o(i.AdVideoProgress,e,t)})},a.prototype._popMatchProgressEvents=function(e){for(var t=this.progressEvents,n=t.length-1;n>-1&&e>t[n].offset;)n-=1;return t.splice(n+1)},a.prototype._getState=function(){throw Error("this method must be overridden")},e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(9).canPlay,o=n(41),a=n(4),s=n(8),u=n(16),l=n(10);function c(e,t,n){return e.addEventListener(t,n,!1)}function f(e,t,n){return c(e,t,function r(){return function(e,t,n){e.removeEventListener(t,n,!1)}(e,t,r),n.apply(this,arguments)})}function h(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return Promise.reject(n());throw n()}return e.apply(this,arguments)}}function d(){return this.container.removeChild(this.video),this.video.clean(),this.video=null,this.alreadyEmitViewable=!1,Promise.resolve(this)}function p(e,t,n){r.call(this),this.container=e,this.video=t,this.config=n,this.__private__={hasPlayed:!1}}p.prototype=Object.create(r.prototype),Object.defineProperties(p.prototype,{adRemainingTime:{get:h(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:h(function(){return this.video.duration})},adVolume:{get:h(function(){return this.video.volume}),set:h(function(e){this.video.muted=0===e,this.video.volume=e})}}),p.prototype.load=function(e,t){var n=this;return new Promise(function(r,h){var d=n.video,p=function(e,t){var n=t.width,r=e.map(function(e){return{mediaFile:e,playability:"video/3gpp"!==e.type&&i(e.type)}}).filter(function(e){return e.playability>0}).sort(o("-playability","-mediaFile.bitrate")),a=r.map(function(e){return Math.abs(n-e.mediaFile.width)}),s=r[a.indexOf(Math.min.apply(Math,a))];return!s||s.playability<1?null:s.mediaFile}(e,{width:n.config.width,height:n.config.height}),v=null;if(!p)return h(new Error("There are no playable <MediaFile>s."));d.src=p.uri,f(d,s.LOADEDMETADATA,function(){var e=new u(d,t.progressEvents);new l(a).from(e).to(n),r(n),n.emit(a.AdLoaded),c(d,s.DURATIONCHANGE,function(){n.emit(a.AdDurationChange)}),c(d,s.VOLUMECHANGE,function(){n.emit(a.AdVolumeChange)})}),f(d,s.ERROR,function(){var e=d.error;n.emit(a.AdError,e.message),h(e)}),f(d,s.PLAYING,function(){n.__private__.hasPlayed=!0,n.emit(a.AdImpression)}),f(d,s.ENDED,function(){n.stopAd()}),c(d,s.TIMEUPDATE,function(){var e,t;e=n.container,!((t=e.getBoundingClientRect()).top||t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2)||n.alreadyEmitViewable?v=null:(v||(v=d.currentTime),d.currentTime-v>=2&&(n.alreadyEmitViewable=!0,n.emit(a.AdViewableImpression)))}),c(d,"click",function(){n.emit(a.AdClickBackground,null,null,!0)}),n.container.appendChild(d)})},p.prototype.startAd=h(function(){var e=this,t=this.video;return this.__private__.hasPlayed?Promise.reject(new Error("The advertisement has already been started.")):new Promise(function(n,r){return f(t,s.PLAYING,function(){n(e),e.alreadyPlayAd=!0,e.emit(a.AdStarted)}),t.play().catch(r)})},!0),p.prototype.stopAd=h(function(){return this.emit(a.AdStopped),d.call(this)},!0),p.prototype.skipAd=h(function(){return this.emit(a.AdSkipped),d.call(this)},!0),p.prototype.pauseAd=h(function(){var e=this,t=this.video;return this.video.paused?Promise.resolve(this):new Promise(function(n){return f(t,s.PAUSE,function(){n(e),e.emit(a.AdPaused)}),t.pause()})},!0),p.prototype.resumeAd=h(function(){var e=this,t=this.video;return this.__private__.hasPlayed?this.video.paused?new Promise(function(n){return f(t,s.PLAY,function(){n(e),e.emit(a.AdPlaying)}),t.play()}):Promise.resolve(this):Promise.reject(new Error("The ad has not been started yet."))},!0),p.canPlayMediaFile=function(e){return Boolean(document.createElement("video").canPlayType(e.type))},e.exports=p},function(e,t,n){var r,i,o,a=n(42);o=function(e){return function(t){return typeof t===e}},i=function(e,t){var n=1,r=t||function(e,t){return t};return"-"===e[0]&&(n=-1,e=e.substr(1)),function(t,i){var o,s=r(e,a.get(t,e)),u=r(e,a.get(i,e));return s<u&&(o=-1),s>u&&(o=1),s===u&&(o=0),o*n}},r=function(){var e=Array.prototype.slice.call(arguments),t=e.filter(o("string")),n=e.filter(o("function"))[0];return function(e,r){for(var o=t.length,a=0,s=0;0===a&&s<o;)a=i(t[s],n)(e,r),s++;return a}},e.exports=r},function(e,t,n){var r,i,o;!function(n,a){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=a():(i=[],void 0===(o="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=o))}(0,function(){"use strict";var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty;function n(e){if(!e)return!0;if(a(e)&&0===e.length)return!0;for(var n in e)if(t.call(e,n))return!1;return!0}function r(t){return e.call(t)}function i(e){return"number"==typeof e||"[object Number]"===r(e)}function o(e){return"string"==typeof e||"[object String]"===r(e)}function a(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===r(e)}function s(e){var t=parseInt(e);return t.toString()===e?t:e}function u(e,t,r,a){if(i(t)&&(t=[t]),n(t))return e;if(o(t))return u(e,t.split("."),r,a);var l=s(t[0]);if(1===t.length){var c=e[l];return void 0!==c&&a||(e[l]=r),c}return void 0===e[l]&&(i(l)?e[l]=[]:e[l]={}),u(e[l],t.slice(1),r,a)}var l={ensureExists:function(e,t,n){return u(e,t,n,!0)},set:function(e,t,n,r){return u(e,t,n,r)},insert:function(e,t,n,r){var i=l.get(e,t);r=~~r,a(i)||(i=[],l.set(e,t,i)),i.splice(r,0,n)},empty:function(e,t){if(n(t))return e;if(!n(e)){var s;if(!(s=l.get(e,t)))return e;if(o(s))return l.set(e,t,"");if(function(e){return"[object Boolean]"===r(e)}(s))return l.set(e,t,!1);if(i(s))return l.set(e,t,0);if(!a(s))return l.set(e,t,null);s.length=0}},push:function(e,t){var n=l.get(e,t);a(n)||(n=[],l.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},coalesce:function(e,t,n){for(var r,i=0,o=t.length;i<o;i++)if(void 0!==(r=l.get(e,t[i])))return r;return n},get:function(e,t,r){if(i(t)&&(t=[t]),n(t))return e;if(n(e))return r;if(o(t))return l.get(e,t.split("."),r);var a=s(t[0]);return 1===t.length?void 0===e[a]?r:e[a]:l.get(e[a],t.slice(1),r)},del:function(e,t){return function e(t,r){if(i(r)&&(r=[r]),!n(t)){if(n(r))return t;if(o(r))return e(t,r.split("."));var u=s(r[0]),l=t[u];if(1===r.length)void 0!==l&&(a(t)?t.splice(u,1):delete t[u]);else if(void 0!==t[u])return e(t[u],r.slice(1));return t}}(e,t)}};return l})},function(e,t,n){"use strict";var r=n(4);function i(e){return e}function o(e,t){(e||[]).forEach(function(e){(new Image).src=t(e)})}function a(e,t){this.pixels=e.reduce(function(e,t){return t&&(e[t.event]||(e[t.event]=[])).push(t.uri),e},{}),this.__private__={mapper:t||i}}a.prototype.track=function(e){var t=this.pixels,n=this.__private__.mapper,a=e.adVolume;function s(e,r,a){function s(e){return n((r||i)(e))}return function(){a&&!a()||o(t[e],s)}}e.on(r.AdSkipped,s("skip")),e.on(r.AdStarted,s("creativeView")),e.on(r.AdVolumeChange,s("unmute",null,function(){return 0===a&&e.adVolume>0})),e.on(r.AdVolumeChange,s("mute",null,function(){return a>0&&0===e.adVolume})),e.on(r.AdImpression,s("impression")),e.on(r.AdViewableImpression,function(){s("viewableImpression"),s("impression")}),e.on(r.AdVideoStart,s("start")),e.on(r.AdVideoFirstQuartile,s("firstQuartile")),e.on(r.AdVideoMidpoint,s("midpoint")),e.on(r.AdVideoThirdQuartile,s("thirdQuartile")),e.on(r.AdVideoProgress,function(e){o([e.uri],n||i)}),e.on(r.AdVideoComplete,s("complete")),e.on(r.AdUserAcceptInvitation,s("acceptInvitationLinear")),e.on(r.AdUserMinimize,s("collapse")),e.on(r.AdUserClose,s("closeLinear")),e.on(r.AdPaused,s("pause")),e.on(r.AdResumed,s("resume")),e.on(r.AdPlaying,s("resume")),e.on(r.AdError,s("error",function(e){return e.replace(/\[ERRORCODE\]/g,901)})),e.on(r.AdVolumeChange,function(){a=e.adVolume})},e.exports=a},function(e,t){e.exports=function(){var e=document.createElement("video"),t=[],n=!1,r=e.addEventListener,i=e.removeEventListener,o=e.play,a=Array.prototype.map.call(e.attributes,function(e){return e.name});return e.init=function(t){return n?Promise.resolve():(n=!0,e.parentNode||t.appendChild(e),Promise.resolve().then(function(){return e.load()}).catch(function(e){return console.log("Error while initializing video",e)}))},e.clean=function(){t.forEach(function(t){i.call(e,t.type,t.listener,t.options)}),t=[],e.load(),s()},e.addEventListener=function(n,i,o){return t.push({type:n,listener:i,options:o}),r.call(e,n,i,o)},e.removeEventListener=function(t,n,r){return i.call(e,t,n,r)},e.play=function(){return n=!0,o.call(e)},s(),e;function s(){Array.prototype.forEach.call(e.attributes,function(t){-1===a.indexOf(t.name)&&e.removeAttribute(t.name)}),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),e.setAttribute("preload","auto"),e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.backgroundColor="#000",e.style.objectFit="contain"}}},function(e,t){e.exports={getVpaidVendor:function(e){return/moatads\.com/.test(e[0].uri)?"MOAT":null}}},function(e,t,n){e.exports=n(47)},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=n(48),c=n(50),f=n(11),h=n(3),d=h.isImaAd,p=h.createPromiseDefer,v=n(51),g=n(5).DEFAULT_MAX_VOLUME;e.exports=function(e){function t(e,n,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,i(t).call(this,e,n,o,a)))._onAdsManagerLoaded=s._onAdsManagerLoaded.bind(u(u(s))),s._onAdEvent=s._onAdEvent.bind(u(u(s))),s._onAdErrorEvent=s._onAdErrorEvent.bind(u(u(s))),s.adDisplayContainer=null,s.adsLoader=null,s.adsManager=null,s.adOption=null,s.currentAd=null,s.volume=s.videoContent.muted?0:s.videoContent.volume*g,s.paused=!1,s.destroyed=!1,s.loadDeferred=null,s.startAdRequested=!1,s.cancelledAdRequested=!1,s.initUserActionHappened=!1,l.load().then(function(){return s._init()}).catch(function(e){s.destroyed||s.logger.error(s.name,"cannot load SDK",e)}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,f),a(t,[{key:"name",get:function(){return"GoogleImaPlayer"}},{key:"videoContentWidth",get:function(){return this.videoContent.offsetWidth}},{key:"videoContentHeight",get:function(){return this.videoContent.offsetHeight}},{key:"videoContentVolume",get:function(){return this.videoContent.muted?0:this.videoContent.volume}},{key:"selfControl",get:function(){return!1}},{key:"canClickThrough",get:function(){return!0}},{key:"isGoogleImaAd",get:function(){return!0}}]),a(t,[{key:"initUserAction",value:function(){!this.initUserActionHappened&&this.adDisplayContainer&&(this.initUserActionHappened=!0,this.adDisplayContainer.initialize(),this.adDisplayContainer.initialized=!0,this.logger.debug(this.name,"init user action done"))}},{key:"loadAd",value:function(e,t){var n=this;this.logger.debug(this.name,"loadAd ad ",e),this.adOption=t,this.tracker=new c(e),this.tracker._trackEvent("requestVast"),this.loadDeferred=p();var r=e.vastAdTagURI;return l.isReady().then(function(){return n._requestAds(r)}).then(function(){return n.loadDeferred.promise})}},{key:"canRun",value:function(e){return d(e)}},{key:"start",value:function(){return this.startAdRequested=!1,this.cancelledAdRequested=!1,this.paused=!1,this.destroyed?this._onAdStopped(new Error("cannot play ad since adsManager was destroyed")):this.adsManager?(this.initUserAction(),void this.adsManager.start()):(this.startAdRequested=!0,void this.logger.debug(this.name,"cannot play ad since adsManager is not loaded yet, try to play on load event"))}},{key:"stop",value:function(){this.adsManager&&this.adsManager.stop()}},{key:"skip",value:function(){this.stop()}},{key:"pause",value:function(){this.adsManager&&this.adsManager.pause()}},{key:"resume",value:function(){this.adsManager&&this.adsManager.resume()}},{key:"cancel",value:function(){this.adsManager?this.adsManager.stop():this.cancelledAdRequested=!0}},{key:"setVolume",value:function(e){this.logger.debug(this.name,"setVolume | volume ",e),this.volume=e,this.adsManager&&this.adsManager.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"isPaused",value:function(){return this.paused}},{key:"getRemainingTime",value:function(){return this.adsManager.getRemainingTime()}},{key:"getDuration",value:function(){return this.currentAd?this.currentAd.getDuration():0}},{key:"getSkipOffset",value:function(){return this.logger.debug(this.name,"skipTimeOffset",this.currentAd&&this.currentAd.getSkipTimeOffset()),this.adOption?this.adOption.skipoffset:-1}},{key:"resize",value:function(){this.adsManager&&this.adsManager.resize(this.videoContentWidth,this.videoContentHeight,google.ima.ViewMode.NORMAL)}},{key:"destroy",value:function(){this.destroyed=!0,this._destroyAdsManager(),this._destroyAdDisplayContainer(),this.element&&(this.adContainerElement.removeChild(this.element),this.element=null),this.logger.debug(this.name,"destroyed")}},{key:"_init",value:function(){this.destroyed||(this.element=document.createElement("div"),this.element.style.width="100%",this.element.style.height="100%",this.element.style.position="absolute",this.element.style.zIndex=1,this.element.style.backgroundColor="rgba(0, 0, 0, 0.8)",this.element.setAttribute("data-player",this.name),this.adContainerElement.appendChild(this.element),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),google.ima.settings.setDisableFlashAds(!0),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.element,this.videoContent),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setPlayerType("zplayer-ima"),this.adsLoader.getSettings().setPlayerVersion(v.version),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.options.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded,!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdErrorEvent,!1),this._hide())}},{key:"_show",value:function(){this.element.style.display="block"}},{key:"_hide",value:function(){this.element.style.display="none"}},{key:"_requestAds",value:function(e){this.logger.debug(this.name,"_requestAds | adTagUrl",e);var t=new google.ima.AdsRequest;t.adTagUrl=e,t.linearAdSlotWidth=this.videoContentWidth,t.linearAdSlotHeight=this.videoContentHeight,t.nonLinearAdSlotWidth=this.videoContentWidth,t.nonLinearAdSlotHeight=this.videoContentHeight,t.forceNonLinearFullSlot=!0,t.setAdWillAutoPlay(this.options.autoPlay),t.setAdWillPlayMuted(this.options.mute),this.adsLoader.requestAds(t)}},{key:"_onAdsManagerLoaded",value:function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.adsManager=e.getAdsManager(this.videoContent,t),this.setVolume(this.volume),this.adsManager.init(this.videoContentWidth,this.videoContentHeight,google.ima.ViewMode.NORMAL),this._startAdsManager(this.adsManager)}},{key:"_startAdsManager",value:function(e){e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdErrorEvent,!1,this);var t=[google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,google.ima.AdEvent.Type.ALL_ADS_COMPLETED];for(var n in t)e.addEventListener(t[n],this._onAdEvent,!1,this);this.cancelledAdRequested?this.cancel():this.startAdRequested&&this.start()}},{key:"_onAdEvent",value:function(e){var t=this;this.logger.debug(this.name,"Ad event:",e.type),this.tracker.onAdEvent(e);var n=e.getAd();switch(e.type){case google.ima.AdEvent.Type.LOADED:this.onAdLoaded(),this.loadDeferred.resolve(),this.loadDeferred=null,n.isLinear()||(this.element.style.backgroundColor="transparent");break;case google.ima.AdEvent.Type.STARTED:if(this.currentAd=n,this._onAdStarted(),!n.isLinear()){var r=-1===n.g.duration?15:n.g.duration;setTimeout(function(){t.adsManager&&t.adsManager.stop(),t._onAdStopped()},1e3*r)}break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this._onAdStopped();break;case google.ima.AdEvent.Type.PAUSED:this._onAdPausedEvent();break;case google.ima.AdEvent.Type.RESUMED:this._onAdResumedEvent()}}},{key:"_onAdErrorEvent",value:function(e){var t=e.getError();this.loadDeferred?this.loadDeferred.reject(t):(this.logger.error(this.name,"Ad error:",t.toString()),this._onAdStopped(t))}},{key:"_onAdPausedEvent",value:function(){this.paused=!0}},{key:"_onAdResumedEvent",value:function(){this.paused=!1}},{key:"_onAdStarted",value:function(){this._show(),this.onAdStarted()}},{key:"_onAdStopped",value:function(e){this._hide(),this._destroyAdsManager(),this.onAdStopped(e)}},{key:"_destroyAdsManager",value:function(){this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}},{key:"_destroyAdDisplayContainer",value:function(){this.adDisplayContainer&&(this.adDisplayContainer.destroy(),this.adDisplayContainer=null)}}]),t}()},function(e,t,n){var r,i=n(49);e.exports={load:function(){return r||(r=new Promise(function(e,t){i(function(n){n?e():t(new Error("failed to load IMA SDK"))},!0,6e3)})),r},isReady:function(){return r}}},function(e,t){e.exports=function(e,t,n){var r=window,i=document,o=null,a=function(t){r.clearTimeout(o),"function"==typeof e&&e(t)};if(r.google&&r.google.ima)a(!0);else{var s=!0===t?"https:":"",u=i.getElementsByTagName("script")[0],l=i.createElement("script");l.src=s+"//imasdk.googleapis.com/js/sdkloader/ima3.js",l.async=!0,"function"==typeof e&&(l.onload=function(){a(!0)}),u.parentNode.insertBefore(l,u),n&&(o=r.setTimeout(function(){a(!1)},n))}}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.impressionEvents=[].concat(t.impressions||[],t.viewableImpressions||[]),this.trackingEvents=t.creatives.lenght&&t.creatives[0].trackingEvents||[],t.creatives.lenght&&t.creatives[0].videoClicks&&(this.clickTrackingUri=t.creatives[0].videoClicks.clickTrackings[0])}return function(e,t,r){t&&n(e.prototype,t)}(e,[{key:"onAdEvent",value:function(e){var t=this;switch(e.type){case google.ima.AdEvent.Type.IMPRESSION:this.impressionEvents.forEach(function(e){return t._fireEvent(e.uri)});break;case google.ima.AdEvent.Type.STARTED:this._trackEvent("start"),this._trackEvent("creativeView");break;case google.ima.AdEvent.Type.FIRST_QUARTILE:this._trackEvent("firstQuartile");break;case google.ima.AdEvent.Type.MIDPOINT:this._trackEvent("midpoint");break;case google.ima.AdEvent.Type.THIRD_QUARTILE:this._trackEvent("thirdQuartile");break;case google.ima.AdEvent.Type.COMPLETE:this._trackEvent("complete");break;case google.ima.AdEvent.Type.PAUSED:this._trackEvent("pause");break;case google.ima.AdEvent.Type.RESUMED:this._trackEvent("resume");break;case google.ima.AdEvent.Type.SKIPPED:this._trackEvent("skip");break;case google.ima.AdEvent.Type.USER_CLOSE:this._trackEvent("close");break;case google.ima.AdEvent.Type.CLICK:this.clickTrackingUri&&this._fireEvent(this.clickTrackingUri)}}},{key:"_trackEvent",value:function(e){var t=this;this.trackingEvents.filter(function(t){return t.event===e}).forEach(function(e){return t._fireEvent(e.uri)})}},{key:"_fireEvent",value:function(e){e&&((new Image).src=e)}}]),e}()},function(e){e.exports={name:"@zplayer/ad-runner",version:"1.0.31",description:"Generic ad runner library for media player",main:"dist/ad-runner.min.js",author:"ZTE folks",publishConfig:{registry:"https://nexus-repo.zapps.vn/repository/zjs-repo/"},scripts:{dev:"webpack-dev-server --progress --mode development --config webpack.config.js",watch:"webpack --progress --watch --mode development --output-filename=[name].min.js --config webpack.config.js",build:"webpack -p --progress --mode production --config webpack.config.js","build-demo":"webpack --progress --mode development --config webpack.config.js",lint:"eslint *.js src/"},devDependencies:{"@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","@zjs/vast-player":"1.3.65","babel-loader":"^8.0.4","clean-webpack-plugin":"0.1.19","css-loader":"1.0.0",eslint:"^5.4.0","eslint-plugin-import":"^2.15.0","generate-changelog":"^1.7.1","html-webpack-plugin":"3.2.0","node-sass":"4.13.0","sass-loader":"7.1.0","style-loader":"0.23.0",webpack:"4.17.2","webpack-cli":"3.1.0","webpack-dev-server":"3.1.8","webpack-merge":"4.1.4"}}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=n(7).VastPlayer,c=n(11),f=n(3),h=f.isImaAd,d=f.isFacebookAd,p=f.isAsiaSmartAd,v=n(5).AD_DONE_REASON;e.exports=function(e){function t(e,n,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,i(t).call(this,e,n,o,a))).adOption=null,s.loadPromise=null,s.initUserActionHappened=!1,s.onAdSkipped=o.onAdSkipped,s._onAdError=s._onAdError.bind(u(u(s))),s._init(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,c),a(t,[{key:"name",get:function(){return"VastLinearPlayer"}},{key:"canClickThrough",get:function(){return this.player.isVPAID&&"MOAT"!==this.player.vpaidVendor}},{key:"isFacebookAd",get:function(){return d(this.ad)}},{key:"isAsiaSmartAd",get:function(){return p(this.ad)}},{key:"viewDetailLink",get:function(){return this.player&&this.player.viewDetailLink}}]),a(t,[{key:"canRun",value:function(e){return!h(e)&&"linear"===e.creatives[0].type}},{key:"initUserAction",value:function(){this.initUserActionHappened||(this.initUserActionHappened=!0,this.player.init(),this.logger.debug(this.name,"init user action done"))}},{key:"loadAd",value:function(e,t){return this.ad=e,this.adOption=t,this.loadPromise=this.player.load({ads:[e]}),this.loadPromise}},{key:"start",value:function(){var e=this;this.loadPromise.then(function(){return e.player.startAd()}).catch(this._onAdError)}},{key:"stop",value:function(){var e=this;this.loadPromise.then(function(){return e.player.stopAd()}).catch(this._onAdError)}},{key:"skip",value:function(){var e=this;this.loadPromise.then(function(){return e.player.skipAd()}).catch(this._onAdError)}},{key:"pause",value:function(){var e=this;return this.loadPromise.then(function(){return e.player.pauseAd()}).catch(this._onAdError)}},{key:"resume",value:function(){var e=this;return this.loadPromise.then(function(){return e.player.resumeAd()}).catch(this._onAdError)}},{key:"cancel",value:function(){this.stop()}},{key:"viewDetail",value:function(){var e=this;this.loadPromise.then(function(){if(e.player.isVPAID)try{e.player.__private__.video.click(),e.resume()}catch(t){e.logger.error(e.name,"error while simulate click on VPAID ad",t)}else e.player.emit("AdClickThru",null,null,!0)}).catch(this._onAdError)}},{key:"setVolume",value:function(e){var t=this;this.loadPromise.then(function(){t.player.adVolume=e})}},{key:"getVolume",value:function(){return this.loadPromise?this.player.adVolume:0}},{key:"isPaused",value:function(){return this.player.paused}},{key:"getRemainingTime",value:function(){if(this.isAsiaSmartAd){var e=this.getDuration();return e>0?e-this.getAdCurrentTime():e}return this.player&&this.player.adRemainingTime}},{key:"getDuration",value:function(){return this.player&&this.player.adDuration}},{key:"getAdCurrentTime",value:function(){return Math.floor(this.player.__private__.video.currentTime)}},{key:"getSkipOffset",value:function(){return this.logger.debug(this.name,"skipTimeOffset",this.adOption.skipoffset),this.adOption?this.adOption.skipoffset:-1}},{key:"destroy",value:function(){this.loadPromise&&this.ad&&this.stop(),this.player=null,this.element&&(this.adContainerElement.removeChild(this.element),this.element=null),this.logger.debug(this.name,"destroyed")}},{key:"_init",value:function(){var e=this,t=document.createElement("div"),n=new l(t,{width:e.videoContent.offsetWidth,height:e.videoContent.offsetHeight});t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.zIndex=1,t.setAttribute("data-player",this.name),n.on("AdStarted",function(){return e._onAdStartedEvent()}),n.on("AdStopped",function(){return e._onAdStoppedEvent()}),n.on("AdSkipped",function(){return e._onAdSkippedEvent()}),n.on("AdLoaded",function(){return e._onAdLoadedEvent()}),e.adContainerElement.appendChild(t),e.element=t,e.player=n,e._hide()}},{key:"_show",value:function(){this.element.style.display="block"}},{key:"_hide",value:function(){this.element.style.display="none"}},{key:"_onAdLoadedEvent",value:function(){this.onAdLoaded()}},{key:"_onAdStartedEvent",value:function(){if(this._show(),this.onAdStarted(),this.isFacebookAd)try{this.player.__private__.player.frame.contentDocument.querySelector("#an_skip_button").style.display="none"}catch(e){this.logger.warn(this.name,"failed to remove FB skip button",e)}}},{key:"_onAdStoppedEvent",value:function(e,t){this.loadPromise=null,this._hide(),this.onAdStopped(e,t)}},{key:"_onAdSkippedEvent",value:function(){this.onAdSkipped(),this._onAdStoppedEvent(null,v.skipped)}},{key:"_onAdError",value:function(e){this._onAdStoppedEvent(e)}}]),t}()},function(e,t,n){e.exports=n(54)},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(11),c=n(3).isImaAd,f=n(55),h=n(59),d=n(5).DEFAULT_NON_LINEAR_DURATION;e.exports=function(e){function t(e,n,r,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=i(this,o(t).call(this,e,n,r,a))).ad=null,s.adOption=null,s.imgUrl=null,s.adTimer=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"VastNonLinearPlayer"}},{key:"selfControl",get:function(){return!0}},{key:"viewDetailLink",get:function(){return this.ad.creatives[0].ads[0].clickThrough}}]),s(t,[{key:"canRun",value:function(e){return!c(e)&&e.creatives.length&&"nonLinear"===e.creatives[0].type}},{key:"initUserAction",value:function(){}},{key:"loadAd",value:function(e,t){this.ad=e,this.adOption=t,this.imgUrl=null;var n=e.creatives[0].ads[0].resources;return n&&this._isValidImageAd(n)?(this.imgUrl=n,this.onAdLoaded(),Promise.resolve()):Promise.reject(new Error("no playable non-linear file"))}},{key:"start",value:function(){this.adTimer&&this.stop();var e=this.ad.creatives[0],t=parseInt(e.ads[0].width),n=parseInt(e.ads[0].height);return this.tracker=new h(this.ad),this.adUi=new f(this,this.videoContent.offsetWidth,this.videoContent.offsetHeight),this.adUi.setImage(this.imgUrl,t,n),this.adContainerElement.appendChild(this.adUi.element),this._onAdStartedEvent(),Promise.resolve()}},{key:"stop",value:function(){this._onAdStoppedEvent()}},{key:"cancel",value:function(){this.stop()}},{key:"viewDetail",value:function(){try{var e=this.viewDetailLink;e&&window.open(e,"_blank")}catch(e){this.logger.error(this.name,"error while showing detail of ad",e)}}},{key:"setVolume",value:function(){}},{key:"getRemainingTime",value:function(){}},{key:"getDuration",value:function(){}},{key:"destroy",value:function(){this._stopAdTimer(),this.adUi&&this.adUi.remove(),this.logger.debug(this.name,"destroyed")}},{key:"_isValidImageAd",value:function(e){return!/\.swf/.test(e)}},{key:"_startAdTimer",value:function(){var e=this;this.adTimer=setTimeout(function(){return e.stop()},1e3*(this.adOption.duration||d))}},{key:"_stopAdTimer",value:function(){clearTimeout(this.adTimer),delete this.adTimer}},{key:"_onAdStartedEvent",value:function(){this._startAdTimer(),this.adUi.show(),this.tracker.onAdStarted(),this.onAdStarted()}},{key:"_onAdStoppedEvent",value:function(){this._stopAdTimer(),this.adUi.remove(),this.tracker.onAdStopped(),this.onAdStopped(null,null,!0,this.adData)}}]),t}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n(56);var l=n(2);e.exports=function(e){function t(e,n,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,a(t).call(this,{className:"ad_runner_non_linear_ad_ui"}))).player=e,o.maxWidth=n,o.maxHeight=i,o._onCloseButtonClickEvent=o._onCloseButtonClickEvent.bind(u(u(o))),o._onImageClickEvent=o._onImageClickEvent.bind(u(u(o))),o.render(),o._registerEvents(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"render",value:function(){o(a(t.prototype),"render",this).call(this),this.closeButton=new l({tagName:"span"}),this.closeButton.render(),this.closeButton.html("[x]"),this.closeButton.attr("title","Đóng quảng cáo"),this.appendChild(this.closeButton),this.image=new l({tagName:"img"}),this.image.render(),this.appendChild(this.image)}},{key:"remove",value:function(){this._unregisterEvents(),o(a(t.prototype),"remove",this).call(this)}},{key:"setImage",value:function(e,t,n){(t>this.maxWidth||n>this.maxHeight)&&(this.image.attr("width","auto"),this.image.attr("height","auto"),t>n?this.image.style("max-width","".concat(this.maxWidth-40,"px")):this.image.style("max-height","".concat(this.maxHeight-40,"px"))),this.image.attr("src",e)}},{key:"_registerEvents",value:function(){this.closeButton.on("click",this._onCloseButtonClickEvent),this.image.on("click",this._onImageClickEvent)}},{key:"_unregisterEvents",value:function(){this.closeButton.off("click",this._onCloseButtonClickEvent),this.image.off("click",this._onImageClickEvent)}},{key:"_onCloseButtonClickEvent",value:function(e){e.stopPropagation(),this.player.stop()}},{key:"_onImageClickEvent",value:function(e){e.stopPropagation(),this.player.viewDetail()}}]),t}()},function(e,t,n){var r=n(57);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_non_linear_ad_ui span{position:absolute;top:0;right:0;color:#f9754d;cursor:pointer;padding:2px;font-weight:bold;background-color:white}.ad_runner_non_linear_ad_ui img{cursor:pointer}\n",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=["start","creativeView"],i=["close"];e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.impressionEvents=[].concat(t.impressions||[],t.viewableImpressions||[]),this.trackingEvents=t.creatives[0].trackingEvents}return function(e,t,r){t&&n(e.prototype,t)}(e,[{key:"onAdStarted",value:function(){var e=this;this.impressionEvents.forEach(function(t){return e._fireEvent(t.uri)}),this._trackEvents(r)}},{key:"onAdStopped",value:function(){this._trackEvents(i)}},{key:"_trackEvents",value:function(e){var t=this;this.trackingEvents.filter(function(t){return e.indexOf(t.event)>-1}).forEach(function(e){return t._fireEvent(e.uri)})}},{key:"_fireEvent",value:function(e){e&&((new Image).src=e)}}]),e}()},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(5),a=o.AD_POSITION,s=o.PRELOAD_DURATION,u=o.COUNT_DOWN_DURATION,l=n(3).createPromiseDefer,c="midroll";function f(e){return e.ads[0]&&e.ads[0].creatives.length&&"nonLinear"!==e.ads[0].creatives[0].type}e.exports=function(){function e(t){var n=t.prepareAd,r=t.beforePlayAd,i=t.preloadAd,o=t.loadAd,a=t.playAd,s=t.logger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props={prepareAd:n,beforePlayAd:r,preloadAd:i,loadAd:o,playAd:a,logger:s},this._reset(),this.dataLoadingDeferred=l()}return i(e,[{key:"name",get:function(){return"Scheduler"}},{key:"logger",get:function(){return this.props.logger}}]),i(e,[{key:"populateAdsData",value:function(e){var t=this;e.forEach(function(e){return e.position===a.preroll?t.prerollAds.push(e):e.position===a.postroll?t.postrollAds.push(e):void t.midrollAds.push(e)}),this.midrollAds.sort(function(e,t){return t.startTime>e.startTime?1:-1}),this.prerollAds.length&&this.props.loadAd(this.prerollAds[0]),this.dataLoadingDeferred.resolve()}},{key:"onContentProgress",value:function(e){var t=this;if(this.ignoredFirstFrame){if(!this.state)return this._setState("preroll"),void this.dataLoadingDeferred.promise.then(function(){t._playAds(t.prerollAds).then(function(){t._setState(c)})});if(this.state===c){if(!this.midrollAds.length)return this._setState("postroll");var n=e.current<0?e.total:e.current,r=this._getAdsPriorTime(this.midrollAds,n),i=this._getAdsPriorTime(this.midrollAds,n+s);if(i.length&&this.props.preloadAd(i[0]),r.length)this.midrollAds.splice(this.midrollAds.length-r.length,r.length),this.props.beforePlayAd(f(r[0]),function(){t._playAds(r)});else{var o=this._getAdsPriorTime(this.midrollAds,n+u);if(o.length){var a=o[0].startTime-n;this.props.prepareAd(o[0],a)}}}}else this.ignoredFirstFrame=!0}},{key:"onContentEnded",value:function(){this.midrollAds.length&&this.logger.warn(this.name,"cannot play these mid-roll ads because start time is too late",this.midrollAds),this._playAds(this.postrollAds),this._reset()}},{key:"_reset",value:function(){this.ignoredFirstFrame=!1,this._setState(null),this.prerollAds=[],this.midrollAds=[],this.postrollAds=[]}},{key:"_setState",value:function(e){this.logger.info(this.name,"state changed from ".concat(this.state," to ").concat(e)),this.state=e}},{key:"_playAds",value:function(e){var t=this,n=[],r=[];return e.forEach(function(e){f(e)?n.push(e):r.push(e)}),this._playAd(n).then(function(){return t._playAd(r)})}},{key:"_playAd",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e[n];if(r){var i={order:n+1,total:e.length};return this.props.playAd(r,i).catch(function(e){t.logger.error(t.name,"error while playing ad",e)}).then(function(){return t._playAd(e,n+1)})}return Promise.resolve()}},{key:"_getAdsPriorTime",value:function(e,t){for(var n=e.length-1;n>-1&&t>e[n].startTime;)--n;return e.slice(n+1).reverse()}}]),e}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2),f=n(18),h=n(64),d=n(3),p=n(79),v=n(82);n(85);var g="is_mobile";e.exports=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this))).options=e,i.adContainers=n,i.$adContainer=new c({element:n.linear}),i.$adContainer.render(),i.adPlayer=null,i.adPaused=!1,i.adVolume=0,i.adVolumeCached=1,i.mouseEntered=!1,i._onClick=i._onClick.bind(l(l(i))),i._onMouseEnter=i._onMouseEnter.bind(l(l(i))),i._onMouseLeave=i._onMouseLeave.bind(l(l(i))),i._onSkipBtnClick=i._onSkipBtnClick.bind(l(l(i))),i._onViewDetailBtnClick=i._onViewDetailBtnClick.bind(l(l(i))),i.render(),i._registerEvents(),i.control.hide(),d.isMobile()&&(i.addClass(g),i.$adContainer.off("mouseenter",i._onMouseEnter),i.$adContainer.off("mouseleave",i._onMouseLeave)),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){return i(o(t.prototype),"render",this).call(this),this.hide(),this.$uiLoading=new c({className:"ad_runner_ui_loading"}),this.$uiLoading.render(),this.$uiLoading.element.textContent="Đang tải quảng cáo...",this.$uiLoading.hide(),this.$uiViewDetail=new c({className:"ad_runner_ui_viewdetail"}),this.$uiViewDetail.render(),this.$uiViewDetail.element.textContent="Xem chi tiết quảng cáo",this.$uiAdIndex=new c({className:"ad_runner_ui_adindex"}),this.$uiAdIndex.render(),this.$uiAdIndex.hide(),this.countdownToPlay=new f({template:"Quảng cáo hiển thị sau %ss",className:"ad_runner_ui_countdown_to_play"}),this.countdownToPlay.hide(),this.skipButton=new p({getPoster:this.options.getPoster}),this.control=new h(this),this.slideBlack=new v(this),this.appendChild(this.$uiViewDetail),this.appendChild(this.$uiAdIndex),this.appendChild(this.skipButton),this.appendChild(this.control),this.$adContainer.appendChild(this),this.adContainers.notification.appendChild(this.countdownToPlay.element),this.adContainers.notification.appendChild(this.$uiLoading.element),this.adContainers.notification.appendChild(this.slideBlack.element),this}},{key:"remove",value:function(){this._unregisterEvents(),this._stopSkipTimer(),this._stopProgressTimer(),this.skipButton.remove(),this.countdownToPlay.remove(),this.control.remove(),this.$uiLoading.remove(),this.slideBlack.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"setPlayer",value:function(e){this.adPlayer=e}},{key:"togglePlayPause",value:function(){this.adPlayer.isPaused()?(this.adPlayer.resume(),this._onPauseStateChanged(!1)):(this.adPlayer.pause(),this._onPauseStateChanged(!0))}},{key:"toggleMute",value:function(){var e=this.adPlayer.getVolume(),t=e?0:this.adVolumeCached;this.adPlayer.setVolume(t),this._onVolumeChanged(t),this.adVolumeCached=e}},{key:"onAdWillStart",value:function(){this.show(),this.$uiLoading.show(),this.$uiViewDetail.hide(),this.$uiAdIndex.hide(),this.skipButton.hide(),this.skipButton.loadPoster(),this.countdownToPlay.hide()}},{key:"onAdStarted",value:function(e){if(this.adPlayer.selfControl)return this.$uiLoading.hide(),void this.hide();this.adPlayer.canClickThrough?this.addClass("click-through"):this.removeClass("click-through"),this.adPlayer.isFacebookAd?this.addClass("facebook-ad"):this.removeClass("facebook-ad"),this.adPlayer.isGoogleImaAd?this.addClass("google-ima-ad"):this.removeClass("google-ima-ad"),this.$uiLoading.hide(),this.$uiViewDetail.show(),e&&e.total>1&&(this.$uiAdIndex.show(),this.$uiAdIndex.html("Quảng cáo ".concat(e.order," / ").concat(e.total))),this._startProgressTimer(),this.adPlayer.getSkipOffset()>-1&&(this.skipButton.show(),this.skipButton.update(this._getTimeToSkip()||5),this._startSkipTimer()),this._onVolumeChanged(this.adPlayer.getVolume())}},{key:"onAdStopped",value:function(){this._stopSkipTimer(),this._stopProgressTimer(),this.$uiLoading.hide(),this.hide()}},{key:"_registerEvents",value:function(){this.on("click",this._onClick),this.$adContainer.on("mouseenter",this._onMouseEnter),this.$adContainer.on("mouseleave",this._onMouseLeave),this.skipButton.on("click",this._onSkipBtnClick),this.$uiViewDetail.on("click",this._onViewDetailBtnClick)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClick),this.$adContainer.off("mouseenter",this._onMouseEnter),this.$adContainer.off("mouseleave",this._onMouseLeave),this.skipButton.off("click",this._onSkipBtnClick),this.$uiViewDetail.off("click",this._onViewDetailBtnClick)}},{key:"_startProgressTimer",value:function(){var e=this;this.progressTimer=setInterval(function(){var t={duration:e.adPlayer.getDuration(),remaining:e.adPlayer.getRemainingTime(),paused:e.adPlayer.isPaused()};e.control.onProgress(t);var n=e.adPlayer.getVolume();t.paused!==e.adPaused&&e._onPauseStateChanged(t.paused),n!==e.adVolume&&e._onVolumeChanged(n)},1e3)}},{key:"_stopProgressTimer",value:function(){clearInterval(this.progressTimer),this.progressTimer=null}},{key:"_startSkipTimer",value:function(){var e=this;this._stopSkipTimer();var t=this._getTimeToSkip();this.skipTimer=setInterval(function(){var n=e._getTimeToSkip();e.adPlayer.isPaused()||(t-=1),n<=0||n-t>e.options.skipTimeout?(e.skipButton.skipOn(),e._stopSkipTimer()):e.skipButton.update(n)},1e3)}},{key:"_stopSkipTimer",value:function(){this.skipTimer&&(clearInterval(this.skipTimer),this.skipTimer=null)}},{key:"_getTimeToSkip",value:function(){var e=this.adPlayer.getSkipOffset()+this.adPlayer.getRemainingTime()-this.adPlayer.getDuration();return e<0?5:e}},{key:"_onSkipBtnClick",value:function(e){var t=this;e.stopPropagation(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=arguments.length>2?arguments[2]:void 0;e.style.opacity||(e.style.opacity=1);var r=null;window.requestAnimationFrame(function i(o){var a=o-(r=r||o),s=parseFloat(1-a/t,2);e.style.opacity=s<0?0:s,a>t?"function"==typeof n&&n():window.requestAnimationFrame(i)})}(this.adPlayer.element,300,function(){t.adPlayer.skip(),t.adPlayer.element.style.opacity=null})}},{key:"_onViewDetailBtnClick",value:function(e){e.stopPropagation(),this.adPlayer.viewDetail()}},{key:"_onClick",value:function(){this.togglePlayPause()}},{key:"_onMouseEnter",value:function(){this.mouseEntered=!0,!this.adPaused&&this.control.show()}},{key:"_onMouseLeave",value:function(){this.mouseEntered=!1,!this.adPaused&&this.control.hide()}},{key:"_onPauseStateChanged",value:function(e){this.adPaused=e,this.control.onPauseStateChanged(e,this.mouseEntered)}},{key:"_onVolumeChanged",value:function(e){this.adVolume=e,this.control.onMuteStateChanged(0===e)}}]),t}()},function(e,t,n){var r=n(63);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_countdown{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2),c=n(65),f=n(68),h=n(71),d=n(74);n(77),e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).adUi=e,n.render(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_control"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"show",value:function(){this.playpause.show(),this.volume.show(),this.timer.show(),this.removeClass("minimized"),this.adUi.addClass("has_control")}},{key:"hide",value:function(){this.playpause.hide(),this.volume.hide(),this.timer.hide(),this.addClass("minimized"),this.adUi.removeClass("has_control")}},{key:"remove",value:function(){this.timeline.remove(),this.playpause.remove(),this.volume.remove(),this.timer.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.timeline=new c,this.playpause=new f(this.adUi),this.timer=new d,this.volume=new h(this.adUi),this.appendChild(this.timeline),this.appendChild(this.playpause),this.appendChild(this.timer),this.appendChild(this.volume)}},{key:"onProgress",value:function(e){e.paused||(this.timeline.setPosition((e.duration-e.remaining)/e.duration*100),this.timer.update(e))}},{key:"onPauseStateChanged",value:function(e,t){e?this.show():t||this.hide(),this.playpause.onPauseStateChanged(e)}},{key:"onMuteStateChanged",value:function(e){this.volume.onMuteStateChanged(e)}}]),t}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2);n(66),e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_timeline"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.$uiProgress=new l,this.$uiProgress.render(),this.appendChild(this.$uiProgress)}},{key:"setPosition",value:function(e){e<=100&&this.$uiProgress.style("width","".concat(e,"%"))}}]),t}()},function(e,t,n){var r=n(67);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_timeline{bottom:0;height:4px;left:0;position:absolute;width:100%}.ad_runner_ui_timeline>div{-webkit-transition:width 1s linear;-moz-transition:width 1s linear;-o-transition:width 1s linear;transition:width 1s linear;background-color:#ffff00;height:100%;width:0%}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2);n(69);var f='<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><path d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z"></path></svg>';e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this))).adUi=e,n._onClickEvent=n._onClickEvent.bind(l(l(n))),n.render(),n._registerEvents(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui_playpause"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html(f)}},{key:"remove",value:function(){this._unregisterEvents(),i(o(t.prototype),"remove",this).call(this)}},{key:"onPauseStateChanged",value:function(e){e?this.html('<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><path d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z"></path></svg>'):this.html(f)}},{key:"_registerEvents",value:function(){this.on("click",this._onClickEvent)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClickEvent)}},{key:"_onClickEvent",value:function(e){e.stopPropagation(),this.adUi.togglePlayPause()}}]),t}()},function(e,t,n){var r=n(70);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_playpause{width:35px;height:35px;float:left;margin-left:5px}.ad_runner_ui_playpause:hover{cursor:pointer}.ad_runner_ui_playpause>svg{fill:#f5f5f5}.ad_runner_ui_playpause:hover>svg,.ad_runner_ui_playpause:active>svg{fill:#ffffff}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2);n(72);var f='<svg height="100%" viewBox="0 0 36 36" width="100%"><path d="M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 Z M19,11.29 C21.89,12.15 24,14.83 24,18 C24,21.17 21.89,23.85 19,24.71 L19,26.77 C23.01,25.86 26,22.28 26,18 C26,13.72 23.01,10.14 19,9.23 L19,11.29 Z"></path></svg>';e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this)))._onClickEvent=n._onClickEvent.bind(l(l(n))),n.adUi=e,n.render(),n._registerEvents(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui_volume"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html(f)}},{key:"remove",value:function(){this._unregisterEvents(),i(o(t.prototype),"remove",this).call(this)}},{key:"onMuteStateChanged",value:function(e){e?this.html('<svg height="100%" viewBox="0 0 36 36" width="100%"><path d="m16.98686,9.984l0,4.219l-2.109,-2.109l2.109,-2.11zm-7.734,-0.984l16.734,16.734l-1.266,1.266l-2.063,-2.063c-1.078,0.844 -2.297,1.5 -3.656,1.828l0,-2.063c0.844,-0.234 1.594,-0.656 2.25,-1.172l-4.266,-4.266l0,6.75l-5.016,-5.016l-3.984,0l0,-6l4.734,0l-4.734,-4.734l1.267,-1.264zm14.718,9c0,-3.188 -2.063,-5.859 -4.969,-6.703l0,-2.063c4.031,0.891 6.984,4.5 6.984,8.766c0,1.5 -0.375,2.953 -1.031,4.172l-1.5,-1.547c0.328,-0.797 0.516,-1.688 0.516,-2.625zm-2.484,0c0,0.234 0,0.422 -0.047,0.609l-2.438,-2.438l0,-2.203c1.5,0.75 2.484,2.25 2.484,4.031l0.001,0.001z"></path></svg>'):this.html(f)}},{key:"_registerEvents",value:function(){this.on("click",this._onClickEvent)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClickEvent)}},{key:"_onClickEvent",value:function(e){e.stopPropagation(),this.adUi.toggleMute()}}]),t}()},function(e,t,n){var r=n(73);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_volume{width:35px;height:35px;float:right;margin-right:5px}.ad_runner_ui_volume:hover{cursor:pointer}.ad_runner_ui_volume>svg{fill:#f5f5f5}.ad_runner_ui_volume:hover>svg,.ad_runner_ui_volume:active>svg{fill:#ffffff}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2),c=n(3).formatTime;n(75),e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_timer"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html("00:00 / 00:00")}},{key:"update",value:function(e){var t=c(e.duration-e.remaining),n=c(e.duration);this.html("".concat(t," / ").concat(n))}}]),t}()},function(e,t,n){var r=n(76);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_timer{color:#f5f5f5;float:left;margin-left:5px;height:35px;line-height:35px;font-size:12px}\n",""])},function(e,t,n){var r=n(78);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_control{-webkit-transition:height 100ms ease;-moz-transition:height 100ms ease;-o-transition:height 100ms ease;transition:height 100ms ease;background:linear-gradient(transparent, #000);bottom:0;height:40px;left:0;position:absolute;width:100%;pointer-events:none}.ad_runner_ui_control.minimized{background:none;height:5px}.ad_runner_ui_control>*{pointer-events:auto}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2),f=n(18);n(80),e.exports=function(e){function t(e){var n,i=e.getPoster;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this)))._onPosterLoad=n._onPosterLoad.bind(l(l(n))),n.render(),n._registerEvents(),n.getPoster=i,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"attributes",get:function(){return{class:"ad_runner_ui_skip_button"}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.countdown=new f({template:"Bỏ qua quảng cáo sau %ss",className:"countdown"}),this.countdown.render(),this.update=this.countdown.update.bind(this.countdown),this.skipText=new c({className:"skip_text"}),this.skipText.render(),this.skipText.element.textContent="Bỏ qua",this.poster=new c({tagName:"img"}),this.poster.render(),this.poster.hide(),this.playIcon=new c({className:"play_icon"}),this.playIcon.render(),this.playIcon.html('<svg viewBox="12 12 24 24"><style type="text/css"> .st1{fill:none;stroke:#f1f1f1;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;} </style><g><g><path class="st1" d="M21.88173,28.00095l6.30217-3.67922c0.24333-0.14206,0.24348-0.49362,0.00028-0.63589l-6.30217-3.68663 c-0.2455-0.14361-0.5542,0.03345-0.5542,0.31786v7.36585C21.32781,27.9672,21.63623,28.14428,21.88173,28.00095z"/><circle class="st1" cx="24" cy="24" r="11.1667"/></g></g></svg>'),this.appendChild(this.skipText),this.appendChild(this.countdown),this.appendChild(this.poster),this.appendChild(this.playIcon)}},{key:"show",value:function(){i(o(t.prototype),"show",this).call(this),this.skipText.hide(),this.countdown.show(),this.removeClass("skippable")}},{key:"hide",value:function(){i(o(t.prototype),"hide",this).call(this),this.poster.hide(),this.removeClass("has_poster")}},{key:"remove",value:function(){this._unregisterEvents(),this.countdown.remove(),this.poster.remove(),this.skipText.remove(),this.playIcon.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"loadPoster",value:function(){var e=this;this.getPoster&&this.getPoster().then(function(t){e.poster.attr("src",t)})}},{key:"skipOn",value:function(){this.skipText.show(),this.countdown.hide(),this.addClass("skippable")}},{key:"_onPosterLoad",value:function(){this.poster.show(),this.addClass("has_poster")}},{key:"_registerEvents",value:function(){this.poster.on("load",this._onPosterLoad)}},{key:"_unregisterEvents",value:function(){this.poster.off("load",this._onPosterLoad)}}]),t}()},function(e,t,n){var r=n(81);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_skip_button{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;-webkit-transition:bottom 100ms ease;-moz-transition:bottom 100ms ease;-o-transition:bottom 100ms ease;transition:bottom 100ms ease;background-color:#2b2a2a;align-items:center;border:1px solid rgba(72,72,72,0.4);bottom:35px;display:flex;height:42px;padding:0;pointer-events:none !important;right:0px;text-align:center}.ad_runner_ui_skip_button.skippable{pointer-events:auto !important;cursor:pointer}.ad_runner_ui_skip_button .countdown{padding:5px;max-width:100px}.ad_runner_ui_skip_button .skip_text{font-size:13px;width:100px}.ad_runner_ui_skip_button .play_icon{position:absolute;width:65px;height:30px;right:0;display:none}.ad_runner_ui_skip_button .play_icon svg{width:30px;height:30px}.ad_runner_ui_skip_button.skippable.has_poster .play_icon{display:block}.ad_runner_ui_skip_button img{height:38px;object-fit:cover;width:65px}.is_mobile .ad_runner_ui_skip_button{width:170px;justify-content:center}.is_mobile .ad_runner_ui_skip_button .countdown{max-width:120px}.ad_runner_ui.facebook-ad .ad_runner_ui_skip_button{background-color:#000}.ad_runner_ui.has_control .ad_runner_ui_skip_button{bottom:35px}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n(83);var u=n(2);e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a(t).call(this,{className:"ad_runners_ui_slide_black"}))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,u),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"fadeIn",value:function(){this.addClass("ad_ui_slide_black_fade_in")}},{key:"fadeOut",value:function(){this.removeClass("ad_ui_slide_black_fade_in")}},{key:"render",value:function(){o(a(t.prototype),"render",this).call(this),this.html('<span class="ad_message_text">Video nội dung sẽ tiếp tục sau đoạn quảng cáo</span>'),this.hide()}}]),t}()},function(e,t,n){var r=n(84);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runners_ui_slide_black{position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;background-color:#000;opacity:0;-webkit-transition:opacity .3s linear;-moz-transition:opacity .3s linear;-o-transition:opacity .3s linear;transition:opacity .3s linear}.ad_runners_ui_slide_black.ad_ui_slide_black_fade_in{opacity:1}.ad_runners_ui_slide_black .ad_message_text{color:#eee;font-size:13px;position:absolute;left:10px;bottom:10px}\n",""])},function(e,t,n){var r=n(86);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,'.ad_runner_ui{left:0px;position:absolute;top:0px;width:100%;height:100%;z-index:2}.ad_runner_ui.click-through{pointer-events:none}.ad_runner_ui.click-through>*{pointer-events:auto}.ad_runner_ui.click-through .ad_runner_ui_viewdetail{display:none}.ad_runner_ui .ad_runner_ui_viewdetail{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAA2ElEQVQ4ja2U0U3DMBRFz0MM0BkyQleo2CAVm7ACYoaOUDagjJBs0G6A6AaHjzhSVcXGDtw/289H9z1fGbVXv83rCKBuCzWqwwPwBmz4D92Qt433+iVnawz0wDEtr/N+Myx1cEjLE/C6CpZAn0wzPkXE0+15New3UDXsDjQC+1xh8TVTvuYcDmo+RiVYEwh4bGhtFxHXTN0z8LXoTO3Uc40j9SUb2gT9ALqSo6o2I2JUR6ZkV4MWYQm4V7sWEBRyFhGXFlARtkahnpmG/Ve9z/9S6aet0aB2P+baSzgLyi9XAAAAAElFTkSuQmCC");background-position-x:calc(100% - 5px);background-position-y:center;background-repeat:no-repeat;background-size:12px;cursor:pointer;padding-right:20px;right:10px;top:10px}.ad_runner_ui .ad_runner_ui_adindex{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;background-color:transparent;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAjVJREFUOBHlVEFrU0EQ/mb35TVtqqRKq0LaXhRbxbMggh5UKioePQserEcP4smjoHjoTUERvAi9eCmC9A+UCqJQJIJ6KAhNqlBLNE3y8nb89iV5SbB66bEDYb/9ZufLzOy8BXadia84Wi/MOCezgE6rYoTkEEQy3Bu6hZxfScFxUSIH1YigSm6D+6Ix+jgz9u2NROWJ87Fziz5gp2aNuWCcczd3KtSJ91oGghMdorPa4bsIR5eQ2b8IM3itQ8OEZ8ktIBwrIsg/B8xo6ksAtdgb6WNt7hZsbhZxdR4arSDY+xASngbsOEWesIMNxL/mKH6Svvv9gtQKyOR6WZO9TKFlxL/nSFuE2Yuw2Stw0QeIySHavAONv/JOfkLsZG+oxzkKqhdNTYKjcLWF9j6GuhI8J1pJOHXfk9VtzacxXaCBHwc/Cl2Ly+zCnnQvxOrWeWqzxclga7UF/tF0eq4NnOFU1XtZx3JNeIqHp2AGZljWQbZtmSW/S47Z7FV2YgLhyEv28EFvqJ/QutRK4yU25EDqkTxv8hVMcCShtLmKxo8zxDEFHsEOtW5dXQXRxvWk391YKUt9rVDkxE+lZBtIcJwZnoMdvo1m5R5c9UXiEXuY47IP2lxhRlt9YfzCPgX8nj4zw78EtfkRMX8uesuS36eBGn/xyW5v1DIKebq9t8VqY4mg9r8jqc9rJY9DbW3ykoi7wUyPqSCfPA6QAdb078cBWk8eB+XjIFJUNc+yh1Zfp+q7B/wBa0XJ8tc9BKoAAAAASUVORK5CYII=");background-position-y:center;background-repeat:no-repeat;bottom:50px;left:15px;padding-left:25px;text-shadow:0 0 4px #000}.ad_runner_ui_countdown_to_play{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px;z-index:1}.ad_runner_ui_loading{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px}.ad_runner_ui_hide{display:none !important}\n',""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n(88);var l=n(2);e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}(this,u(t).call(this,{className:"ad_runners_ui_ad_mark_container"})),s(u(t.prototype),"render",o(n)).call(o(n)),n.containerElement=e,e&&e.appendChild(n.element),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,l),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"render",value:function(e,t){var n=this;this.containerElement&&t.forEach(function(t){var r=100*t.startTime/e;if(0<=r&&r<=100){var i=n._createAdMarkItem(r);n.appendChild(i),t.adMarkItem=i,t._completeAd=function(){i.remove()}}})}},{key:"removeMarkItems",value:function(){this.html("")}},{key:"setContainer",value:function(e){e.appendChild(this.element)}},{key:"_createAdMarkItem",value:function(e){var t=document.createElement("span");return t.setAttribute("class","ad_runners_ui_ad_mark_container_item"),t.style.left="".concat(e,"%"),t}}]),t}()},function(e,t,n){var r=n(89);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runners_ui_ad_mark_container{display:flex !important;width:100%;height:100%}.ad_runners_ui_ad_mark_container .ad_runners_ui_ad_mark_container_item{height:100%;width:5px;background-color:yellow;display:block;position:relative}\n",""])}])},function(e,t,n){"use strict";(function(e){"function"!=typeof e.Promise&&(e.Promise=n(2))}).call(this,n(3))},function(e,t,n){"use strict";(function(t){var n,r,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(c),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var u=new t.MessageChannel;u.port1.onmessage=c,n=function(){u.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}e.exports=function(e){1!==l.push(e)||r||n()}}).call(this,n(3))},function(e,t,n){var r=n(8);Object.getOwnPropertySymbols||(Object.getOwnPropertySymbols=r)},function(e,t,n){(function(t){!function(e,n){"use strict";if(!(n in e)){var r,i=typeof t==typeof i?window:t,o=0,a=""+Math.random(),s="__symbol:",u=s.length,l="__symbol@@"+a,c="defineProperty",f="defineProperties",h="getOwnPropertyNames",d="getOwnPropertyDescriptor",p="propertyIsEnumerable",v=e[h],g=e[d],y=e.create,m=e.keys,b=e.freeze||e,E=e[c],_=e[f],T=g(e,h),k=e.prototype,A=k.hasOwnProperty,S=k[p],w=k.toString,L=function(e,t,n){A.call(e,l)||E(e,l,{enumerable:!1,configurable:!1,writable:!1,value:{}}),e[l]["@@"+t]=n},P=function(){},O=function(e){return e!=l&&!A.call(x,e)},C=function(e){return e!=l&&A.call(x,e)},R=function(e){var t=""+e;return C(t)?A.call(this,t)&&this[l]["@@"+t]:S.call(this,e)},D=function(t){return E(k,t,{enumerable:!1,configurable:!0,get:P,set:function(e){r(this,t,{enumerable:!1,configurable:!0,writable:!0,value:e}),L(this,t,!0)}}),b(x[t]=E(e(t),"constructor",M))},I=function e(t){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return D(s.concat(t||"",a,++o))},x=y(null),M={value:I},F=function(e){return x[e]},N=function(e,t,n){var i=""+t;return C(i)?(r(e,i,n.enumerable?function(e){var t=y(e);return t.enumerable=!1,t}(n):n),L(e,i,!!n.enumerable)):E(e,t,n),e},U=function(e){return v(e).filter(C).map(F)};T.value=N,E(e,c,T),T.value=U,E(e,n,T),T.value=function(e){return v(e).filter(O)},E(e,h,T),T.value=function(e,t){var n=U(t);return n.length?m(t).concat(n).forEach(function(n){R.call(t,n)&&N(e,n,t[n])}):_(e,t),e},E(e,f,T),T.value=R,E(k,p,T),T.value=I,E(i,"Symbol",T),T.value=function(e){var t=s.concat(s,e,a);return t in k?x[t]:D(t)},E(I,"for",T),T.value=function(e){if(O(e))throw new TypeError(e+" is not a symbol");if(A.call(x,e)){var t=e.slice(u);if(t.slice(0,u)===s&&(t=t.slice(u))!==a)return(t=t.slice(0,t.length-a.length)).length>0?t:void 0}},E(I,"keyFor",T),T.value=function(e,t){var n=g(e,t);return n&&C(t)&&(n.enumerable=R.call(e,t)),n},E(e,d,T),T.value=function(e,t){return 1===arguments.length||void 0===t?y(e):function(e,t){var n=y(e);return v(t).forEach(function(e){R.call(t,e)&&N(n,e,t[e])}),n}(e,t)},E(e,"create",T),T.value=function(){var e=w.call(this);return"[object String]"===e&&C(this)?"[object Symbol]":e},E(k,"toString",T);try{if(!0!==y(E({},s,{get:function(){return E(this,s,{value:!0})[s]}}))[s])throw"IE11";r=E}catch(e){r=function(e,t,n){var r=g(k,t);delete k[t],E(e,t,n),E(k,t,r)}}}}(Object,"getOwnPropertySymbols"),function(e,t){"use strict";var n,r=e.defineProperty,i=e.prototype,o=i.toString,a="toStringTag";["iterator","match","replace","search","split","hasInstance","isConcatSpreadable","unscopables","species","toPrimitive",a].forEach(function(s){if(!(s in t))switch(r(t,s,{value:t(s)}),s){case a:(n=e.getOwnPropertyDescriptor(i,"toString")).value=function(){var e=o.call(this),n=null!=this?this[t.toStringTag]:this;return null==n?e:"[object "+n+"]"},r(i,"toString",n)}})}(Object,Symbol),function(e,t,n){function r(){return this}t[e]||(t[e]=function(){var t=0,n=this,i={next:function(){var e=n.length<=t;return e?{done:e}:{done:e,value:n[t++]}}};return i[e]=r,i}),n[e]||(n[e]=function(){var t=String.fromCodePoint,n=this,i=0,o=n.length,a={next:function(){var e=o<=i,r=e?"":t(n.codePointAt(i));return i+=r.length,e?{done:e}:{done:e,value:r}}};return a[e]=r,a})}(Symbol.iterator,Array.prototype,String.prototype),e.exports=Object.getOwnPropertySymbols}).call(this,n(3))},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){var r={"./blue.scss":[33,1],"./green.scss":[34,2],"./light_blue.scss":[35,3],"./purple.scss":[36,4],"./red.scss":[37,5]};function i(e){var t=r[e];return t?n.e(t[1]).then(function(){var e=t[0];return n.t(e,7)}):Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}i.keys=function(){return Object.keys(r)},i.id=23,e.exports=i},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"cloneDeep",function(){return W}),n.d(r,"getDeep",function(){return q}),n.d(r,"each",function(){return $}),n.d(r,"extend",function(){return Q}),n.d(r,"objValuesToArray",function(){return J});var i={};n.r(i),n.d(i,"hasClass",function(){return le}),n.d(i,"addClass",function(){return ce}),n.d(i,"removeClass",function(){return fe}),n.d(i,"toggleClass",function(){return he}),n.d(i,"setClass",function(){return de}),n.d(i,"setStyles",function(){return pe}),n.d(i,"isEl",function(){return ve}),n.d(i,"isTextNode",function(){return ge}),n.d(i,"emptyEl",function(){return ye}),n.d(i,"normalizeContent",function(){return me}),n.d(i,"appendContent",function(){return be}),n.d(i,"insertContent",function(){return Ee}),n.d(i,"textContent",function(){return _e}),n.d(i,"createEl",function(){return Te}),n.d(i,"createElFromHTML",function(){return ke}),n.d(i,"getAttribute",function(){return Ae}),n.d(i,"setAttribute",function(){return Se}),n.d(i,"removeAttribute",function(){return we}),n.d(i,"findPosition",function(){return Le}),n.d(i,"isOnViewport",function(){return Pe}),n.d(i,"getPointerPosition",function(){return Oe}),n.d(i,"isSingleLeftClick",function(){return Ce}),n.d(i,"removeFromDom",function(){return Re});var o={};n.r(o),n.d(o,"IS_IPAD",function(){return at}),n.d(o,"IS_IPHONE",function(){return st}),n.d(o,"IS_IPOD",function(){return ut}),n.d(o,"IS_IOS",function(){return lt}),n.d(o,"IOS_VERSION",function(){return ct}),n.d(o,"IS_ANDROID",function(){return ft}),n.d(o,"ANDROID_VERSION",function(){return ht}),n.d(o,"IS_NATIVE_ANDROID",function(){return dt}),n.d(o,"IS_FIREFOX",function(){return pt}),n.d(o,"IS_EDGE",function(){return vt}),n.d(o,"IS_CHROME",function(){return gt}),n.d(o,"CHROME_VERSION",function(){return yt}),n.d(o,"IE_VERSION",function(){return mt}),n.d(o,"IS_SAFARI",function(){return bt}),n.d(o,"IS_ANY_SAFARI",function(){return Et}),n.d(o,"IS_MOBILE",function(){return _t});var a={};n.r(a),n.d(a,"createPromiseDefer",function(){return Tt});var s={};n.r(s),n.d(s,"orderBy",function(){return jt}),n.d(s,"whereBy",function(){return Ht}),n.d(s,"average",function(){return Gt}),n.d(s,"findWithAttr",function(){return Vt});var u={};n.r(u),n.d(u,"getHours",function(){return jr}),n.d(u,"getMinutes",function(){return Hr}),n.d(u,"getSeconds",function(){return Gr}),n.d(u,"getCurrentTimeSeconds",function(){return Vr}),n.d(u,"formatTime",function(){return Yr});var l={};n.r(l),n.d(l,"format",function(){return Jo}),n.d(l,"escapeHtml",function(){return Zo}),n.d(l,"trimHtml",function(){return ea}),n.d(l,"trimAccents",function(){return ta}),n.d(l,"startsWith",function(){return na}),n.d(l,"endsWith",function(){return ra}),n.d(l,"generateId",function(){return ia}),n.d(l,"getPercentage",function(){return oa}),n.d(l,"replaceAll",function(){return aa}),n.d(l,"toTitleCase",function(){return sa}),n.d(l,"toPascalCase",function(){return ua}),n.d(l,"toCamelCase",function(){return la}),n.d(l,"stripHTML",function(){return ca}),n.d(l,"getHTML",function(){return fa});var c={};n.r(c),n.d(c,"checkAdBlocker",function(){return rs});var f={};n.r(f),n.d(f,"fetchUrl",function(){return is});var h={};n.r(h),n.d(h,"fadeOut",function(){return Iu}),n.d(h,"fadeIn",function(){return xu});n(5),n(7);var d={};function p(e){return d[e]||(d[e]=0),e+ ++d[e]}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g="font-weight: bold; font-size: 13px;",y="color: #ff8000;"+g,m="color: #ff0000;"+g,b=1,E=4,_=["color: #0000ff;font-weight: bold; font-size: 13px;","color: #006600;font-weight: bold; font-size: 13px;",y,m,m],T=["debug","info","warn","error","disabled"],k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.offLevel=n}var t,n;return t=e,(n=[{key:"debug",value:function(e){this.log(e,0,Array.prototype.slice.call(arguments,1))}},{key:"info",value:function(e){this.log(e,b,Array.prototype.slice.call(arguments,1))}},{key:"warn",value:function(e){this.log(e,2,Array.prototype.slice.call(arguments,1))}},{key:"error",value:function(e){this.log(e,3,Array.prototype.slice.call(arguments,1))}},{key:"onOff",value:function(){this.level===this.offLevel?this.level=this.previousLevel:(this.previousLevel=this.level,this.level=this.offLevel),window.console&&window.console.log&&window.console.log("%c[Zplayer.Log] set log level to "+T[this.level],y)}},{key:"level",value:function(e){this.level=e}},{key:"log",value:function(e,t,n){if(!(t<this.level)){n||(n=e,e=null);var r=_[t],i="";e&&(i="["+e+"]"),window.console&&window.console.log&&window.console.log.apply(console,["%c["+T[t]+"]"+i,r].concat(n))}}}])&&v(t.prototype,n),e}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}k.LEVEL_DEBUG=0,k.LEVEL_INFO=b,k.LEVEL_WARN=2,k.LEVEL_ERROR=3,k.LEVEL_DISABLED=E,k.getInstance=function(){return void 0===this._instance&&(this._instance=new this,this._instance.previousLevel=this._instance.level,this._instance.level=this._instance.offLevel),this._instance},k.setLevel=function(e){this.getInstance().level=e},k.debug=function(){this.getInstance().debug.apply(this.getInstance(),arguments)},k.info=function(){this.getInstance().info.apply(this.getInstance(),arguments)},k.warn=function(){this.getInstance().warn.apply(this.getInstance(),arguments)},k.error=function(){this.getInstance().error.apply(this.getInstance(),arguments)};var w=Array.prototype.slice,L=/\s+/,P=function(e,t,n,r){if(!n)return!0;if("object"===S(n)){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(L.test(n)){for(var o=n.split(L),a=0,s=o.length;a<s;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},O=function(e,t,n,r){var i,o=-1,a=e.length,s=t[0],u=t[1],l=t[2];!function c(){try{switch(t.length){case 0:for(;++o<a;)(i=e[o]).callback.call(i.ctx);return;case 1:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s);return;case 2:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s,u);return;case 3:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s,u,l);return;default:for(;++o<a;)(i=e[o]).callback.apply(i.ctx,t);return}}catch(e){k.error.apply(k,[n,"error on event",r,"trigger","-",e]),c()}}()},C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"register",value:function(t){e.Custom||(e.Custom={});var n="string"==typeof t&&t.toUpperCase().trim();n&&!e.Custom[n]?e.Custom[n]=n.toLowerCase().split("_").map(function(e,t){return 0===t?e:e=e[0].toUpperCase()+e.slice(1)}).join(""):k.error("Events","Error when register event: "+t)}}],(n=[{key:"on",value:function(e,t,n){if(!P(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r?(r.push({callback:t,context:n,ctx:n||this}),this):this}},{key:"once",value:function(e,t,n){var r,i=this;if(!P(this,"once",e,[t,n])||!t)return this;return r=function(){i.off(e,r),t.apply(this,arguments)},this.on(e,r,n)}},{key:"off",value:function(e,t,n){var r,i,o,a,s,u,l,c;if(!this._events||!P(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(s=0,u=(a=e?[e]:Object.keys(this._events)).length;s<u&&(e=a[s],o=this._events[e])&&(this._events[e]=r=[],t||n);s++){for(l=0,c=o.length;l<c;l++)i=o[l],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this}},{key:"trigger",value:function(e){var t=this.name||this.constructor.name;if(!e)return k.warn.apply(k,[t,"trying to trigger undefined event, ignored"]),this;if(!this._events)return this;var n=w.call(arguments,1);if(!P(this,"trigger",e,n))return this;var r=this._events[e],i=this._events.all;return r&&O(r,n,t,e),i&&O(i,arguments,t,e),this}},{key:"stopListening",value:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;for(var o in n||"object"!==S(t)||(n=this),e&&((r={})[e._listenId]=e),r)(e=r[o]).off(t,n,this),(i||0===Object.keys(e._events).length)&&delete this._listeningTo[o];return this}}])&&A(t.prototype,n),r&&A(t,r),e}(),R={listenTo:"on",listenToOnce:"once"};Object.keys(R).forEach(function(e){C.prototype[e]=function(t,n,r){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=p("l"))]=t,r||"object"!==S(n)||(r=this),t[R[e]](n,r,this),this}});function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}["PLAYER_PLAY","PLAYER_PLAY_INTENT","PLAYER_PAUSE","PLAYER_STOP","PLAYER_ENDED","PLAYER_SEEK","PLAYER_SEEKED","PLAYER_SEEKING","PLAYER_ERROR","PLAYER_TIMEUPDATE","PLAYER_PROGRESS","PLAYER_FULLSCREEN","PLAYER_READY","PLAYER_BUFFERING","PLAYER_BUFFERING_CHANGE","PLAYER_BUFFERFULL","PLAYER_PRESS_PLAY","PLAYER_VOLUMEUPDATE","PLAYER_LOADEDMETADATA","PLAYER_CLICK","PLAYER_DBLCLICK","PLAYER_KEYDOWN","PLAYER_MOUSE_ENTER","PLAYER_MOUSE_LEAVE","PLAYER_MOUSE_MOVE","PLAYER_CONTEXTMENU","PLAYER_LEVELS_AVAILABEL","PLAYER_LEVEL_SWITCHED","PLAYER_SETTINGS_MENU_HIDE","PLAYER_QUALITY_LEVELS_SELECTED","PLAYER_UPDATE_SIZE","PLAYER_CANPLAYTHROUGH","PLAYER_WAITING","PLAYER_ORIENTATION_CHANGE","PLAYER_AD_PAUSE_REQUEST","PLAYER_AD_RESUME_REQUEST","PLAYER_AD_WILL_START","PLAYER_AD_STARTED","PLAYER_AD_STOPPED","PLAYER_AD_SKIPPED","PLAYER_AD_LOAD_TIMEOUT","PLAYER_MEDIACONTROL_DISABLE","PLAYER_MEDIACONTROL_ENABLE","PLAYER_MEDIACONTROL_SHOW","PLAYER_MEDIACONTROL_HIDE","PLAYER_MEDIACONTROL_READY","PLAYER_MEDIACONTROL_CLICK","PLAYER_MEDIACONTROL_DBLCLICK","PLAYER_DVRSTATECHANGED","PLAYER_THEATER_MODE_CHANGE","PLAYBACK_PROGRESS","PLAYBACK_TIMEUPDATE","PLAYBACK_BUFFERING","PLAYBACK_BUFFERING_CHANGE","PLAYBACK_BUFFERFULL","PLAYBACK_SETTINGSUPDATE","PLAYBACK_LOADEDMETADATA","PLAYBACK_VOLUMEUPDATE","PLAYBACK_HIGHDEFINITIONUPDATE","PLAYBACK_BITRATE","PLAYBACK_LEVELS_AVAILABLE","PLAYBACK_LEVEL_SWITCH_START","PLAYBACK_LEVEL_SWITCH_END","PLAYBACK_PLAYBACKSTATE","PLAYBACK_DVR","PLAYBACK_DVRSTATECHANGED","PLAYBACK_MEDIACONTROL_DISABLE","PLAYBACK_MEDIACONTROL_ENABLE","PLAYBACK_ENDED","PLAYBACK_PLAY_INTENT","PLAYBACK_PLAY","PLAYBACK_PAUSE","PLAYBACK_SEEKING","PLAYBACK_WAITING","PLAYBACK_SEEKED","PLAYBACK_STOP","PLAYBACK_ERROR","PLAYBACK_STATS_ADD","PLAYBACK_FRAGMENT_LOADED","PLAYBACK_LEVEL_SWITCHED","PLAYBACK_SUBTITLE_AVAILABLE","PLAYBACK_SUBTITLE_CHANGED","PLAYBACK_FULLSCREEN_IOS","PLAYBACK_CANPLAYTHROUGH","MEDIACONTROL_HIDE","MEDIACONTROL_SHOW","LOADING_SPINNER_HIDE","LOADING_SPINNER_SHOW","MEDIACONTROL_MOUSEMOVE_SEEKBAR","MEDIACONTROL_MOUSELEAVE_SEEKBAR"].forEach(function(e){C[e]=e});var N=function(e){var t,n,r;function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),e&&(t=e.options),(n=I(this,x(i).call(this))).player=e,n._options=t,n.uniqueId=p("o"),n._nameEvents={},n.constructor.NAME_EVENTS.forEach(function(e){C[e]=e,n._nameEvents[e]=e}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(i,C),t=i,r=[{key:"NAME_EVENTS",get:function(){return[]}}],(n=[{key:"bindEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;this.listenEvents.forEach(function(n){n.once?e.listenToOnce(n.target||t||e,n.name,n.handler):e.listenTo(n.target||t||e,n.name,n.handler)})}},{key:"unbindEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;this.listenEvents.forEach(function(n){n.once?e.stopListening(n.target||t||e,n.name):e.stopListening(n.target||t||e,n.name,n.handler)})}},{key:"options",get:function(){return this._options}},{key:"listenEvents",get:function(){return[]}}])&&M(t.prototype,n),r&&M(t,r),i}(),U=function(e){return null!=e?e.constructor:null},B=function(e,t){return Boolean(e&&t&&e instanceof t)},j=function(e){return null==e},H=function(e){return U(e)===Object},G=function(e){return U(e)===String},V=function(e){return Array.isArray(e)},Y=function(e){return B(e,NodeList)},K=function(e){return j(e)||(G(e)||V(e)||Y(e))&&!e.length||H(e)&&!Object.keys(e).length},z={nullOrUndefined:j,object:H,number:function(e){return U(e)===Number&&!Number.isNaN(e)},string:G,boolean:function(e){return U(e)===Boolean},function:function(e){return U(e)===Function},array:V,weakMap:function(e){return B(e,WeakMap)},nodeList:Y,element:function(e){return B(e,Element)},textNode:function(e){return U(e)===Text},event:function(e){return B(e,Event)},cue:function(e){return B(e,window.TextTrackCue)||B(e,window.VTTCue)},track:function(e){return B(e,TextTrack)||!j(e)&&G(e.kind)},url:function(e){if(B(e,window.URL))return!0;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!K(new URL(t).hostname)}catch(e){return!1}},empty:K};function W(e){return JSON.parse(JSON.stringify(e))}function q(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}var X=function(e){return z.object(e)?Object.keys(e):[]};function $(e,t){X(e).forEach(function(n){return t(e[n],n)})}function Q(e){e=e||{};for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r)for(var i in r)r.hasOwnProperty(i)&&("[object Object]"!==Object.prototype.toString.call(r[i])?e[i]=r[i]:e[i]=Q(e[i],r[i]))}return e}function J(e){return Object.values&&Object.values(e)||Object.keys(e).map(function(t){return e[t]})}function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return t&&ne(e.prototype,t),n&&ne(e,n),e}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oe=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ee(this,te(t).call(this,e))).pluginOptions=n.getPluginOptions(),n.enabled=!0,n.pluginOptions.disabled&&n.disable(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,N),re(t,[{key:"defaultOptions",get:function(){return{}}}]),re(t,[{key:"initialize",value:function(){var e=this;return Promise.resolve().then(function(){return e.setUp()}).then(function(){return e.enabled&&e.bindEvents()})}},{key:"getPluginOptions",value:function(){return Q(this.defaultOptions,q(this._options,"pluginsOptions.".concat(this.name))||this.defaultOptions)}},{key:"setUp",value:function(){}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.enabled=!0,k.debug(this.name,"enabled"))}},{key:"disable",value:function(){this.enabled&&(this.unbindEvents(),this.enabled=!1,k.debug(this.name,"disabled"))}},{key:"destroy",value:function(){this.disable(),this.player.removePlugin(this.name)}}]),t}(),ae=n(1),se=n.n(ae);function ue(e){if(/\s/.test(e))throw new Error("class has illegal whitespace characters")}function le(e,t){return ue(t),e.classList?e.classList.contains(t):(n=t,new RegExp("(^|\\s)"+n+"($|\\s)")).test(e.className);var n}function ce(e,t){return e.classList?e.classList.add(t):le(e,t)||(e.className=(e.className+" "+t).trim()),e}function fe(e,t){return e.classList?e.classList.remove(t):(ue(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e}function he(e,t,n){if(e.classList)return void 0===n?e.classList.toggle(t):e.classList.toggle(t,n);var r=le(e,t);return"function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=!r),n!==r?(n?ce(e,t):fe(e,t),e):void 0}function de(e,t){return e.className=t,e}function pe(e,t){for(var n in t)if(null===t[n]){var r=n.split(/(?=[A-Z])/).map(function(e){return e.toLowerCase()}).join("-");e.style.removeProperty(r)}else e.style[n]=t[n];return e}function ve(e){return z.object(e)&&1===e.nodeType}function ge(e){return z.object(e)&&3===e.nodeType}function ye(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function me(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),ve(e)||ge(e)?e:"string"==typeof e&&/\S/.test(e)?document.createTextNode(e):void 0}).filter(function(e){return e})}function be(e,t){return me(t).forEach(function(t){return e.appendChild(t)}),e}function Ee(e,t){return be(ye(e),t)}function _e(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=document.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?i.setAttribute(e,n):i[e]=n}),Object.getOwnPropertyNames(n).forEach(function(e){i.setAttribute(e,n[e])}),r&&be(i,r),i}function ke(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}function Ae(e,t){return e.getAttribute(t)}function Se(e,t,n){e.setAttribute(t,n)}function we(e,t){e.removeAttribute(t)}function Le(e){var t;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var n=document.documentElement,r=document.body,i=n.clientLeft||r.clientLeft||0,o=window.pageXOffset||r.scrollLeft,a=t.left+o-i,s=n.clientTop||r.clientTop||0,u=window.pageYOffset||r.scrollTop,l=t.top+u-s;return{left:Math.round(a),top:Math.round(l)}}function Pe(e){if(e){var t=e.getBoundingClientRect();return t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2}}function Oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={},i=Le(e),o=n?e.offsetHeight:e.offsetWidth,a=n?e.offsetWidth:e.offsetHeight,s=i.top,u=i.left,l=t.pageY,c=t.pageX;return t.changedTouches&&(c=t.changedTouches[0].pageX,l=t.changedTouches[0].pageY),r.y=Math.max(0,Math.min(1,(s-l+a)/a)),r.x=Math.max(0,Math.min(1,(c-u)/o)),r}function Ce(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||0===e.button&&1===e.buttons}function Re(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=/^(\S+)\s*(.*)$/,Ue=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=xe(this,Me(t).call(this,e,n))).cid=p("c"),r.buildElement(),r.delegateEvents(),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,N),n=t,i=[{key:"tagName",get:function(){return"div"}},{key:"events",get:function(){return{}}},{key:"attributes",get:function(){return{}}}],(r=[{key:"$",value:function(e){return this.$el.find(e)}},{key:"setElement",value:function(e){return this.$el=se.a.zepto.isZ(e)?e:se()(e),this.el=this.$el[0],this}},{key:"buildElement",value:function(){if(this.el)this.setElement(this.el,!1);else{var e=Q({},this.attributes);this.id&&(e.id=this.id);var t=Q({},this.properties),n=Te(this.tagName,t,e);this.setElement(n,!1)}}},{key:"delegateEvents",value:function(e){if(!e&&!(e=this.events))return this;for(var t in e){var n=e[t];if(n&&n.constructor!==Function&&(n=this[e[t]]),n){var r=t.match(Ne),i=r[1],o=r[2];i+=".delegateEvents"+this.cid,""===o?this.$el.on(i,n.bind(this)):this.$el.on(i,o,n.bind(this))}}}},{key:"undelegateEvents",value:function(){return this.$el.off(".delegateEvents"+this.cid),this}},{key:"render",value:function(){return this}},{key:"remove",value:function(){return this.$el.remove(),this.unbindEvents(),this.undelegateEvents(),this}},{key:"getAttribute",value:function(e){return Ae(this.el,e)}},{key:"setAttribute",value:function(e,t){Se(this.el,e,t)}},{key:"removeAttribute",value:function(e){we(this.el,e)}},{key:"setStyles",value:function(e){pe(this.el,e)}},{key:"hasClass",value:function(e){return le(this.el,e)}},{key:"addClass",value:function(e){ce(this.el,e)}},{key:"removeClass",value:function(e){fe(this.el,e)}},{key:"toggleClass",value:function(e,t){he(this.el,e,t)}},{key:"show",value:function(){this.removeClass("--z--hide")}},{key:"hide",value:function(){this.addClass("--z--hide")}},{key:"properties",get:function(){return{}}}])&&Ie(n.prototype,r),i&&Ie(n,i),t}();function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t,n){return t&&Ge(e.prototype,t),n&&Ge(e,n),e}function Ye(e,t){return(Ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ke=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=je(this,He(t).call(this,e))).pluginOptions=n.getPluginOptions(),n.enabled=!0,n.pluginOptions.disabled&&n.disable(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ye(e,t)}(t,Ue),Ve(t,[{key:"defaultOptions",get:function(){return{}}}]),Ve(t,[{key:"initialize",value:function(){var e=this;return Promise.resolve().then(function(){return e.setUp()}).then(function(){return e.render()}).then(function(){return e.enabled&&e.bindEvents()})}},{key:"getPluginOptions",value:function(){return Q(this.defaultOptions,q(this._options,"pluginsOptions.".concat(this.name))||this.defaultOptions)}},{key:"setUp",value:function(){}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.show(),this.enabled=!0,k.debug(this.name,"enabled"))}},{key:"disable",value:function(){this.enabled&&(this.unbindEvents(),this.hide(),this.enabled=!1,k.debug(this.name,"disabled"))}},{key:"destroy",value:function(){this.disable(),this.remove(),this.player.removePlugin(this.name)}}]),t}();n(9);function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qe(this,Xe(t).call(this,null,e))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(t,Ue),n=t,(r=[{key:"play",value:function(){throw new Error("this must be implemented")}},{key:"pause",value:function(){throw new Error("this must be implemented")}},{key:"stop",value:function(){}},{key:"seek",value:function(){}},{key:"seekPercentage",value:function(){}},{key:"getDuration",value:function(){return 0}},{key:"isPlaying",value:function(){return!1}},{key:"isReady",value:function(){throw new Error("this must be implemented")}},{key:"getPlaybackType",value:function(){return t.NO_OP}},{key:"isHighDefinitionInUse",value:function(){return!1}},{key:"volume",value:function(){}},{key:"getVolume",value:function(){return 0}},{key:"isHlsPlayback",value:function(){return!1}},{key:"isMp4Playback",value:function(){return!1}},{key:"destroy",value:function(){this.remove()}}])&&We(n.prototype,r),i&&We(n,i),t}();Qe.canPlay=function(){return!1},Qe.VOD="vod",Qe.AOD="aod",Qe.LIVE="live",Qe.LIVE_END="live_end",Qe.NO_OP="no_op",Qe.type="playback";var Je,Ze,et,tt,nt=Qe,rt=window.navigator&&window.navigator.userAgent||"",it=/AppleWebKit\/([\d.]+)/i.exec(rt),ot=it?parseFloat(it.pop()):null,at=/iPad/i.test(rt),st=/iPhone/i.test(rt)&&!at,ut=/iPod/i.test(rt),lt=st||at||ut,ct=(Je=rt.match(/OS (\d+)_/i))&&Je[1]?Je[1]:null,ft=/Android/i.test(rt),ht=function(){var e=rt.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),dt=ft&&ht<5&&ot<537,pt=/Firefox/i.test(rt),vt=/Edge/i.test(rt),gt=!vt&&(/Chrome/i.test(rt)||/CriOS/i.test(rt)),yt=(tt=rt.match(/(Chrome|CriOS)\/(\d+)/))&&tt[2]?parseFloat(tt[2]):null,mt=(!(et=(Ze=/MSIE\s(\d+)\.\d/.exec(rt))&&parseFloat(Ze[1]))&&/Trident\/7.0/i.test(rt)&&/rv:11.0/.test(rt)&&(et=11),et),bt=/Safari/i.test(rt)&&!gt&&!ft&&!vt,Et=(bt||lt)&&!gt,_t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Mobile Safari|Opera Mini/i.test(rt);function Tt(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(e,t){return!t||"object"!==kt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e,t,n){return(St="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function wt(e){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t,n){return t&&Lt(e.prototype,t),n&&Lt(e,n),e}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Rt={wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]},Dt=Object.keys(Rt).reduce(function(e,t){return[].concat(Ct(e),Ct(Rt[t]))},[]),It=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];(n=At(this,(e=wt(t)).call.apply(e,[this].concat(i))))._readyDeferred=Tt(),n._destroyed=!1,n._loadStarted=!1,n._playheadMoving=!1,n._playheadMovingTimer=null,n._stopped=!1,n.isHlsPlayback()||n.setupSource(n.options.src),n.options.playback||(n.options.playback=n.options||{});var a=n.options.playback.preload||(bt?"auto":n.options.preload);return Q(n.el,{muted:n.options.mute,loop:n.options.loop,preload:a,autoPlay:n.options.autoPlay||!1}),n.options.playInline&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,nt),Pt(t,[{key:"isAudioOnly",get:function(){var e=this.options.src,n=t._mimeTypesForUrl(e,Rt,this.options.mimeType);return this.options.playback&&this.options.playback.audioOnly||this.options.audioOnly||Dt.indexOf(n[0])>=0}},{key:"events",get:function(){return{canplay:"_onCanPlay",canplaythrough:"_onCanplaythrough",error:"_onError",loadeddata:"_onLoadedData",loadedmetadata:"_onLoadedMetadata",stalled:"_onStalled",timeupdate:"_onTimeUpdate",waiting:"_onWaiting",pause:"_onPause",playing:"_onPlaying",progress:"_onProgress",seeking:"_onSeeking",seeked:"_onSeeked",ended:"_onEnded",webkitbeginfullscreen:"_onBeginFullScreen",webkitendfullscreen:"_onEndFullScreen"}}},{key:"ended",get:function(){return this.el.ended}},{key:"buffering",get:function(){return this._isBuffering}}]),Pt(t,[{key:"setupSource",value:function(e){z.empty(e)||(this._src=e,this.el.src=e)}},{key:"getSource",value:function(){return this._src}},{key:"render",value:function(){return this._readyDeferred.resolve(),this}},{key:"isPlaying",value:function(){return!this.el.paused&&!this.el.ended}},{key:"isReady",value:function(){return this._readyDeferred.promise}},{key:"play",value:function(){return this._stopped=!1,this._handleBufferingEvents(),this.playPromise=this.el.play(),k.debug(this.name,"PLAY_PROMISE",this.playPromise),this.playPromise}},{key:"pause",value:function(){var e=this;this.playPromise?this.playPromise.then(function(){return e.el.pause()}):this.el.pause()}},{key:"stop",value:function(){this.pause(),this._stopped=!0,this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(C.PLAYBACK_STOP)}},{key:"volume",value:function(e){e<0||e>100||(0===e?this.mute():this.unmute(),this.el.volume=e/100,this.trigger(C.PLAYBACK_VOLUMEUPDATE,e))}},{key:"getVolume",value:function(){return this.el.volume}},{key:"mute",value:function(){this.$el.attr({muted:"true"}),this.el.muted=!0}},{key:"unmute",value:function(){this.$el.attr({muted:null}),this.el.muted=!1}},{key:"isMuted",value:function(){return this.el.muted}},{key:"seek",value:function(e){z.number(e)&&(this.el.currentTime=e)}},{key:"seekPercentage",value:function(e){var t=this.el.duration*(e/100);this.seek(t)}},{key:"getCurrentTime",value:function(){this.el.currentTime}},{key:"getDuration",value:function(){return this.el.duration}},{key:"setPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.el.playbackRate=e}},{key:"setPreload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"metadata";return this.el.preload=e,this}},{key:"destroy",value:function(){this._destroyed=!0,St(wt(t.prototype),"destroy",this).call(this),this.el.removeAttribute("src"),this._src=null}},{key:"_now",value:function(){return Date.now()}},{key:"_onCanPlay",value:function(){this._handleBufferingEvents()}},{key:"_onCanplaythrough",value:function(e){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_CANPLAYTHROUGH,{time:this._now(),data:e})}},{key:"_onError",value:function(){var e=this.el.error;if(e){var t={code:e.code,description:e.message,raw:e};this.trigger(C.PLAYBACK_ERROR,t)}else k.warn(this.name,"HTML5 media unknown error")}},{key:"_onWaiting",value:function(e){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_WAITING,{time:this._now(),data:e}),this._loadStarted=!0}},{key:"_onLoadedData",value:function(){this._loadStarted=!0,this._handleBufferingEvents()}},{key:"_onLoadedMetadata",value:function(e){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_LOADEDMETADATA,{duration:e.target.duration,data:e})}},{key:"_onStalled",value:function(){this._handleBufferingEvents()}},{key:"_onTimeUpdate",value:function(){this.trigger(C.PLAYBACK_TIMEUPDATE,{current:this.el.currentTime,total:this.el.duration})}},{key:"_onProgress",value:function(){if(this.el.buffered.length){for(var e=this.el.buffered.length,t=[],n=0,r=0;r<e;r++)t=[].concat(Ct(t),[{start:this.el.buffered.start(r),end:this.el.buffered.end(r)}]),this.el.currentTime>=t[r].start&&this.el.currentTime<=t[r].end&&(n=r);var i={start:t[n].start,current:t[n].end,total:this.el.duration};this.trigger(C.PLAYBACK_PROGRESS,i,t)}}},{key:"_onPause",value:function(){this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(C.PLAYBACK_PAUSE)}},{key:"_onPlaying",value:function(){this._startPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(C.PLAYBACK_PLAY)}},{key:"_onSeeking",value:function(e){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_SEEKING,{time:this._now(),data:e})}},{key:"_onSeeked",value:function(){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_SEEKED)}},{key:"_onEnded",value:function(){this._handleBufferingEvents(),this.trigger(C.PLAYBACK_ENDED,this.name)}},{key:"_handleBufferingPercent",value:function(){if("html5_video"===this.name&&(1===this.el.networkState||2===this.el.networkState)){for(var e,t=this.el.buffered.length,n=this.el.currentTime,r=0,i=0;i<t;i++){var o=this.el.buffered.end(i);(o<=n&&o>r||this.el.buffered.start(i)<=n&&o>=n)&&(r=o)}e=100/6*(6-(n+3-r)),this.trigger(C.PLAYBACK_BUFFERING_CHANGE,e)}}},{key:"_handleBufferingEvents",value:function(){this._handleBufferingPercent();var e=!this.el.ended&&!this.el.paused,t=this._loadStarted&&!this.el.ended&&!this._stopped&&(e&&!this._playheadMoving||this.el.readyState<this.el.HAVE_FUTURE_DATA);this._isBuffering!=t&&(this._isBuffering=t,t?this.trigger(C.PLAYBACK_BUFFERING,this.name):this.trigger(C.PLAYBACK_BUFFERFULL,this.name))}},{key:"_startPlayheadMovingChecks",value:function(){null===this._playheadMovingTimer&&(this._playheadMovingTimeOnCheck=null,this._determineIfPlayheadMoving(),this._playheadMovingTimer=setInterval(this._determineIfPlayheadMoving.bind(this),500))}},{key:"_stopPlayheadMovingChecks",value:function(){null!==this._playheadMovingTimer&&(clearInterval(this._playheadMovingTimer),this._playheadMovingTimer=null,this._playheadMoving=!1)}},{key:"_determineIfPlayheadMoving",value:function(){var e=this._playheadMovingTimeOnCheck,t=this.el.currentTime;this._playheadMoving=e!==t,this._playheadMovingTimeOnCheck=t,this._handleBufferingEvents()}},{key:"_onBeginFullScreen",value:function(){this.trigger(C.PLAYBACK_FULLSCREEN_IOS,!0)}},{key:"_onEndFullScreen",value:function(){this.trigger(C.PLAYBACK_FULLSCREEN_IOS,!1)}},{key:"getPlaybackType",value:function(){throw new Error("this must be implemented")}}]),t}();function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e,t){return!t||"object"!==xt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ut(e,t){return(Ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}It._mimeTypesForUrl=function(e,t,n){var r=(e.split("?")[0].match(/.*\.(.*)$/)||[])[1],i=n||r&&t[r.toLowerCase()]||[];return i.constructor===Array?i:[i]},It._canPlay=function(e,t,n,r){var i=It._mimeTypesForUrl(n,t,r),o=document.createElement(e);return!!i.filter(function(e){return!!o.canPlayType(e).replace(/no/,"")})[0]};var Bt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ft(this,Nt(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}(t,It),n=t,(r=[{key:"getPlaybackType",value:function(){var e=nt.VOD;return[0,void 0,1/0].indexOf(this.el.duration)>=0?nt.LIVE:e}},{key:"isMp4Playback",value:function(){return!0}},{key:"name",get:function(){return"html5_video"}},{key:"tagName",get:function(){return this.isAudioOnly?"audio":"video"}},{key:"attributes",get:function(){return{"data-html5-video":""}}}])&&Mt(n.prototype,r),i&&Mt(n,i),t}();function jt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(z.array(e)&&t)return e.sort(function(e,r){return n?e[t]-r[t]:r[t]-e[t]})}function Ht(e,t,n){if(z.array(e))return e.filter(function(e){return e[t]===n}).shift()}function Gt(e){return e.length?e.reduce(function(e,t){return e+t},0)/e.length:0}function Vt(e,t,n){for(var r=e.length,i=0;i<r;i++)if(e[i][t]===n)return i;return-1}Bt.canPlay=function(e,t){var n={mp4:["avc1.42E01E","avc1.58A01E","avc1.4D401E","avc1.64001E","mp4v.20.8","mp4v.20.240","mp4a.40.2"].map(function(e){return'video/mp4; codecs="'+e+', mp4a.40.2"'}),ogg:['video/ogg; codecs="theora, vorbis"','video/ogg; codecs="dirac"','video/ogg; codecs="theora, speex"'],"3gpp":['video/3gpp; codecs="mp4v.20.8, samr"'],webm:['video/webm; codecs="vp8, vorbis"'],mkv:['video/x-matroska; codecs="theora, vorbis"'],m3u8:["application/x-mpegurl"]};return n.ogv=n.ogg,n["3gp"]=n["3gpp"],It._canPlay("video",n,e,t)};var Yt=n(0),Kt=n.n(Yt);function zt(e){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t,n){return(Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $t(e,t,n){return t&&Xt(e.prototype,t),n&&Xt(e,n),e}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Zt={startLevel:-1},en=16,tn=function(e){function t(){var e,n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return r=this,(n=!(i=(e=qt(t)).call.apply(e,[this].concat(a)))||"object"!==zt(i)&&"function"!=typeof i?Jt(r):i)._config={hls:q(n.options,"playback.hls")||Zt,recoverMaxRetry:q(n.options,"playback.hls.recoverMaxRetry")||en},n._recoverRetry=0,n._recoveredMediaError=!1,n._playbackType=nt.VOD,n._onHLSJSError=n._onHLSJSError.bind(Jt(Jt(n))),n._initHls(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(t,It),$t(t,[{key:"name",get:function(){return"hls"}},{key:"tagName",get:function(){return this.isAudioOnly?"audio":"video"}},{key:"levels",get:function(){return this._levels||[]}},{key:"currentLevel",get:function(){return null===this._currentLevel||void 0===this._currentLevel?-1:this._currentLevel},set:function(e){var t=this;this.playPromise&&this.playPromise.then(function(){t._currentLevel=e,t._hls&&(t._hls.currentLevel=t._currentLevel)})}},{key:"startLevel",set:function(e){var t=this;this.playPromise&&this.playPromise.then(function(){t._startLevel=e,t._hls&&(t._hls.startLevel=t._startLevel)})},get:function(){return this._startLevel}}],[{key:"canPlay",value:function(e,t){var n=e.split("?")[0].match(/.*\.(.*)$/)||[];return(n.length>1&&"m3u8"===n[1].toLowerCase()||"application/x-mpegURL"===t||"application/vnd.apple.mpegurl"===t)&&Kt.a.isSupported()}}]),$t(t,[{key:"stop",value:function(){Wt(qt(t.prototype),"stop",this).call(this),this._hls.destroy(),delete this._hls}},{key:"isHlsPlayback",value:function(){return!0}},{key:"_initHls",value:function(){var e=this,t=new Kt.a(this._config.hls);t.on(Kt.a.Events.MEDIA_ATTACHED,function(){return t.loadSource(e.options.src)}),t.on(Kt.a.Events.ERROR,this._onHLSJSError),t.once(Kt.a.Events.LEVEL_LOADED,this._updatePlaybackType.bind(this)),t.on(Kt.a.Events.LEVEL_SWITCH,this._onLevelSwitch.bind(this)),t.on(Kt.a.Events.LEVEL_SWITCHED,this._onLevelSwitched.bind(this)),t.on(Kt.a.Events.FRAG_LOAD_PROGRESS,this._onFragLoadingProgress.bind(this)),t.on(Kt.a.Events.FRAG_LOADED,this._onFragLoadedProgress.bind(this)),t.attachMedia(this.el),this._hls=t}},{key:"_updatePlaybackType",value:function(e,t){k.debug(this.name,"_updatePlaybackType",t),this._playbackType=t.details.live?nt.LIVE:t.details.startSN>0?nt.LIVE_END:nt.VOD,this.trigger(C.PLAYBACK_DVRSTATECHANGED),this._fillLevels(),k.debug(this.name,"LEVELS",this._levels),this.initLevelFromLocalStorage()}},{key:"_onLevelSwitch",value:function(e,t){k.debug(this.name,"_onLevelSwitch",t)}},{key:"_onLevelSwitched",value:function(e,t){k.debug(this.name,"_onLevelSwitched",t);var n=Ht(this.levels,"index",t.level);this.trigger(C.PLAYBACK_LEVEL_SWITCHED,n)}},{key:"_addingSuffixCharacter",value:function(e){var t=e.toString().toLowerCase();return t.indexOf("p")>-1?t:t+"p"}},{key:"_generateLabel",value:function(e){return e.name||Math.ceil(e.bitrate/1e3)}},{key:"_fillLevels",value:function(){var e=this;z.empty(this._levels)&&(this._levels=this._hls.levels.map(function(t,n){return{index:n,level:t,label:e._addingSuffixCharacter(e._generateLabel(t))}}),this._levels.unshift({index:-1,label:"Auto"}),this.trigger(C.PLAYBACK_LEVELS_AVAILABLE,this._levels))}},{key:"initLevelFromLocalStorage",value:function(){if(z.array(this._levels)&&this.options.quality){var e=Ht(this._levels,"label",this.options.quality);z.object(e)&&z.object(e.level)&&(this.currentLevel=e.index,this.startLevel=e.index)}}},{key:"_recoverMediaError",value:function(e){return this._recoverRetry+=1,this._recoverRetry>this._config.recoverMaxRetry?(k.error(this.name,"could not recover from error after maximum number of attempts",e),this.trigger(C.PLAYBACK_ERROR,e),void this.stop()):(k.warn(this.name,"recovering fatal error (".concat(this._recoverRetry,"/").concat(this._config.recoverMaxRetry,"):"),e),this._recoveredMediaError?(this._hls.swapAudioCodec(),void this._hls.recoverMediaError()):(this._recoveredMediaError=!0,void this._hls.recoverMediaError()))}},{key:"_onError",value:function(){var e=this.el.error;if(e){var t=e.code,n={code:t,description:e.message,raw:e};if(t===e.MEDIA_ERR_DECODE)return this._recoverMediaError(n);this.trigger(C.PLAYBACK_ERROR,n)}else k.warn(this.name,"HTML5 video unknown error")}},{key:"_onHLSJSError",value:function(e,t){if(t.fatal){var n={code:"".concat(t.type,"_").concat(t.details),description:t.reason||(t.response?"status: ".concat(t.response.code,", text: ").concat(t.response.text):"unknown"),raw:t};return t.type===Kt.a.ErrorTypes.NETWORK_ERROR&&t.response.code<400?(k.debug(this.name,"recovering network error, user may be offline:",n),void this._hls.startLoad()):t.type!==Kt.a.ErrorTypes.MEDIA_ERROR?(k.error(this.name,"unrecoverable fatal error: ".concat(t.type),n),this.trigger(C.PLAYBACK_ERROR,n),void this.stop()):void this._recoverMediaError(n)}}},{key:"_onTimeUpdate",value:function(){this.el.duration&&this.trigger(C.PLAYBACK_TIMEUPDATE,{current:this.el.currentTime,total:this.el.duration})}},{key:"_onFragLoadingProgress",value:function(e,t){var n=100/t.stats.total*t.stats.loaded;this.trigger(C.PLAYBACK_BUFFERING_CHANGE,n)}},{key:"_onFragLoadedProgress",value:function(){this.trigger(C.PLAYBACK_BUFFERFULL,this.name)}},{key:"getPlaybackType",value:function(){return this._playbackType}}]),t}();function nn(e){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e,t){return!t||"object"!==nn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function on(e,t,n){return(on="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=an(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function an(e){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function un(e,t,n){return t&&sn(e.prototype,t),n&&sn(e,n),e}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var cn=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=rn(this,(e=an(t)).call.apply(e,[this].concat(i))))._ready=!1,n._readyDeferred=Tt(),n._isSeeking=!1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,nt),un(t,[{key:"name",get:function(){return"youtube_playback"}},{key:"attributes",get:function(){return{"data-youtube-playback":"",class:"zplayer-youtube-playback",style:"height:100%",id:this.cid}}},{key:"buffering",get:function(){return!1}}],[{key:"canPlay",value:function(e){return this.isYTVideo(e)}},{key:"isYTVideo",value:function(e){return!!e.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/)&&RegExp.$1}}]),un(t,[{key:"ready",value:function(){this._ready=!0,this.$el.hide(),this._readyDeferred.resolve()}},{key:"qualityChange",value:function(){this.trigger(C.PLAYBACK_HIGHDEFINITIONUPDATE)}},{key:"stateChange",value:function(e){switch(e.data){case window.YT.PlayerState.PLAYING:this.$el.show(),this.trigger(C.PLAYBACK_PLAY),this._isSeeking&&(this._isSeeking=!1,this.trigger(C.PLAYBACK_SEEKED));break;case window.YT.PlayerState.PAUSE:this.$el.hide(),this.trigger(C.PLAYBACK_PAUSE);break;case window.YT.PlayerState.ENDED:this.ended(),this.seek(0),this.stop();break;default:this.$el.show()}}},{key:"play",value:function(){var e=this;this._progressTimer=this._progressTimer||setInterval(function(){return e.progress()},100),this._timeupdateTimer=setInterval(function(){return e.timeupdate()},100),this.player.playVideo(),this.trigger(C.PLAYBACK_PLAY),this.trigger(C.PLAYBACK_BUFFERFULL)}},{key:"pause",value:function(){this.clearTimer(),this.player&&this.player.pauseVideo(),this.trigger(C.PLAYBACK_PAUSE)}},{key:"seek",value:function(e){this.player&&(this.player.seekTo(e),this._isSeeking=!0,setTimeout(function(){},100))}},{key:"ended",value:function(){this.trigger(C.PLAYBACK_ENDED)}},{key:"stop",value:function(){this.player.stopVideo(),this.clearTimer()}},{key:"volume",value:function(e){this.player&&(this.player.setVolume(e),e<=0?this.player.mute():this.player.unMute(),this.trigger(C.PLAYBACK_VOLUMEUPDATE,e))}},{key:"isMuted",value:function(){return this.player&&this.player.isMuted()}},{key:"getVolume",value:function(){return this.player&&this.player.getVolume()}},{key:"progress",value:function(){var e=this.player.getDuration()*this.player.getVideoLoadedFraction();this.trigger(C.PLAYBACK_PROGRESS,0,e,this.player.getDuration())}},{key:"timeupdate",value:function(){this.trigger(C.PLAYBACK_TIMEUPDATE,{current:this.player.getCurrentTime(),total:this.player.getDuration()})}},{key:"isPlaying",value:function(){return this.player&&this._timeupdateTimer&&this.player.getPlayerState()==window.YT.PlayerState.PLAYING}},{key:"isReady",value:function(){return this._readyDeferred.promise}},{key:"getDuration",value:function(){var e=0;return this.player&&(e=this.player.getDuration()),parseFloat(e)}},{key:"render",value:function(){var e=this;return this.el.append(Te("div",{},{id:"yt".concat(this.cid)})),setTimeout(function(){e._setupYoutubePlayer()},1),this}},{key:"setPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.player.setPlaybackRate(e)}},{key:"_setupYoutubePlayer",value:function(){window.YT&&window.YT.Player?this._embedYoutubePlayer():this._embedYoutubeApiScript()}},{key:"_getVideoId",value:function(e){return void 0!==(e=e.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/))[2]?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]}},{key:"_embedYoutubeApiScript",value:function(){var e=this,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("async","async"),t.setAttribute("src","https://www.youtube.com/iframe_api"),document.body.appendChild(t),window.onYouTubeIframeAPIReady=function(){return e._embedYoutubePlayer()}}},{key:"_embedYoutubePlayer",value:function(){var e=this,t={controls:0,autoplay:this.options.autoPlay?1:0,disablekb:1,rel:0,enablejsapi:1,iv_load_policy:3,modestbranding:1,showinfo:0,html5:1,playsinline:this.options.playInline?1:0};this.player=new window.YT.Player("yt".concat(this.cid),{videoId:this._getVideoId(this.options.source),playerVars:t,width:"100%",height:"100%",events:{onReady:function(){return e.ready()},onStateChange:function(t){return e.stateChange(t)},onPlaybackQualityChange:function(t){return e.qualityChange(t)}}})}},{key:"getPlaybackType",value:function(){return nt.VOD}},{key:"clearTimer",value:function(){clearInterval(this._timeupdateTimer),clearInterval(this._progressTimer),this._timeupdateTimer=null,this._progressTimer=null}},{key:"destroy",value:function(){this.clearTimer(),on(an(t.prototype),"destroy",this).call(this),this.stop(),this.player.destroy(),this.player=null}}]),t}();n(10);function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dn(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vn(e,t){return(vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),dn(this,pn(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vn(e,t)}(t,nt),n=t,i=[{key:"canPlay",value:function(){return!0}}],(r=[{key:"render",value:function(){var e=Te("p",{innerHTML:"Your browser does not support the playback of this video. Please try using a different browser."},{"data-no-op-msg":""});return this.el.append(e),this}},{key:"isReady",value:function(){return Promise.resolve()}},{key:"name",get:function(){return"no_op"}},{key:"attributes",get:function(){return{"data-no-op":""}}}])&&hn(n.prototype,r),i&&hn(n,i),t}(),yn=(n(11),"--z--hide"),mn="--z--full-width",bn="--z--bg-transparent",En="--z--fadeout",_n={layout:{left:["playpause","volume","time"],right:["settings","fullscreen"],default:["seekbar"]},type:{fullWidth:!1},alwaysShowControl:!1,showOnPauseMobile:!1,disabledAutoHide:!1,hideAnimation:!1,theme:"",disabled:!1},Tn={BG_TYPE_TRANSPARENT:"transparent",BG_TYPE_GRADIENT:"gradient",THEME:{RED:"red",BLUE:"blue",PURPLE:"purple",GREEN:"green",LIGHT_BLUE:"light_blue"},MAP_THEME_COLOR:{RED:"#f00",BLUE:"#2FA1B3",PURPLE:"#721799",GREEN:"#6cd936",LIGHT_BLUE:"#2196F3"}};n(12);function kn(e){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sn(e,t){return!t||"object"!==kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wn(e){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ln(e,t){return(Ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pn=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Sn(this,wn(t).call(this,e))).plugin=n,r.bindEvents(),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ln(e,t)}(t,Ue),n=t,(r=[{key:"destroy",value:function(){this.remove()}},{key:"handleClick",value:function(){}},{key:"className",get:function(){return["",this.name].join(" ")}},{key:"attributes",get:function(){return{class:this.className}}},{key:"events",get:function(){return{click:"handleClick"}}}])&&An(n.prototype,r),i&&An(n,i),t}();function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rn(e,t){return!t||"object"!==On(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function In(e,t){return(In=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Rn(this,Dn(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&In(e,t)}(t,Pn),n=t,(r=[{key:"name",get:function(){return"ButtonControl"}},{key:"tagName",get:function(){return"button"}},{key:"className",get:function(){return["--z--control --z--btn",this.name].join(" ")}}])&&Cn(n.prototype,r),i&&Cn(n,i),t}();function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Fn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"initializer",value:function(e,t){this.controls=t}},{key:"onMouseOver",value:function(){_t||this.controls.disableAutoHide()}},{key:"onMouseOut",value:function(){this.controls.enableAutoHide()}},{key:"handleClick",value:function(){}},{key:"events",get:function(){return{click:"handleClick",mouseover:"onMouseOver",mouseout:"onMouseOut"}}}])&&Mn(t.prototype,n),r&&Mn(t,r),e}();function Nn(e){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Un(e){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jn(e,t){return(jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function(t){function r(){for(var e,t,i,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),this,i=(e=Un(r)).call.apply(e,[this].concat(a)),t=!i||"object"!==Nn(i)&&"function"!=typeof i?Bn(this):i,n.forEach(function(e){var n;(n=e.prototype.initializer).call.apply(n,[Bn(t)].concat(a))}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jn(e,t)}(r,e),r}(),o=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach(function(n){n.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})};return n.forEach(function(e){o(i.prototype,e.prototype),o(i,e)}),i}function Gn(e){return(Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vn(e,t){return!t||"object"!==Gn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yn(e){return(Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t,n){return t&&Kn(e.prototype,t),n&&Kn(e,n),e}function Wn(e,t){return(Wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qn=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n=Vn(this,(e=Yn(t)).call.apply(e,[this].concat(i)));var a=i[0];return n.config=Q({},_n,q(a.options,"controls.playPause")||{}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wn(e,t)}(t,Hn(xn,Fn)),zn(t,[{key:"name",get:function(){return"PlayPauseControl"}},{key:"className",get:function(){return"--z--control --z--btn --z--control-play"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_ENDED,handler:this.onEnded},{name:C.PLAYER_CLICK,handler:this.toogleIcon},{name:C.PLAYER_PLAY,handler:this.toogleIcon},{name:C.PLAYER_PAUSE,handler:this.toogleIcon}]}}]),zn(t,[{key:"toogleIcon",value:function(){fe(this.iconEl,"pl-ic-refresh");var e=this.player.isPlaying();he(this.iconEl,"pl-ic-play_arrow",!e),he(this.iconEl,"pl-ic-pause",e),this.setAttribute("title",e?"Dừng":"Phát")}},{key:"onEnded",value:function(){fe(this.iconEl,"pl-ic-play_arrow"),fe(this.iconEl,"pl-ic-pause"),ce(this.iconEl,"pl-ic-refresh"),this.setAttribute("title","Phát lại")}},{key:"handleClick",value:function(){this.player.togglePlay(),this.toogleIcon()}},{key:"render",value:function(){return this.iconEl=Te("span",{},{class:"--z--icon pl-ic-play_arrow"}),this.config.color&&pe(this.iconEl,{color:this.config.color}),this.el.append(this.iconEl),this}}]),t}();n(13);function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $n(e,t){return!t||"object"!==Xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qn(e){return(Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zn(e,t,n){return t&&Jn(e.prototype,t),n&&Jn(e,n),e}function er(e,t){return(er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tr=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=$n(this,Qn(t).call(this,e,n))).isDragging=!1,r.distance=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&er(e,t)}(t,Pn),Zn(t,[{key:"name",get:function(){return"SliderControl"}}]),Zn(t,[{key:"onMouseDown",value:function(e){(_t||Ce(e))&&(this.isDragging=!0,e&&e.preventDefault(),this.plugin.disableAutoHide(),window.on("mousemove",this.onMouseMove.bind(this)),window.on("mouseup",this.onBodyUnbindMouseMove.bind(this)))}},{key:"onMouseUp",value:function(e){this.isDragging=!1,this.distance=this.calculateDistance(e),this.handleMouseUp(),this.plugin.enableAutoHide()}},{key:"onMouseMove",value:function(e){_t&&!this.isDragging||(this.distance=this.calculateDistance(e),(_t||Ce(e))&&(this.isDragging&&this.handleMouseMove(),this.plugin.disableAutoHide()))}},{key:"onBodyUnbindMouseMove",value:function(e){_t&&!this.isDragging||(window.off("mousemove",this.onMouseMove.bind(this)),window.off("mouseup",this.onBodyUnbindMouseMove.bind(this)),this.onMouseUp(e))}},{key:"calculateDistance",value:function(e){var t=this.player.options,n=t.lockRotateFullscreen,r=t.customIosFullscreen,i=!this.player.isLandscapeScreen(),o=this.player.isFullscreen(),a=r&&n&&i&&o,s=Oe(this.el,e,a);return a?1-s.y:s.x}},{key:"handleClick",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"handleMouseMove",value:function(){throw new Error("this must be overridden")}},{key:"handleMouseUp",value:function(){throw new Error("this must be overridden")}},{key:"events",get:function(){return{click:"handleClick",touchmove:"onMouseMove",touchstart:"onMouseDown",mousedown:"onMouseDown",touchend:"onMouseUp"}}}]),t}();n(14);function nr(e){return(nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(e,t){return!t||"object"!==nr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ir(e){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ar(e,t,n){return t&&or(e.prototype,t),n&&or(e,n),e}function sr(e,t){return(sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ur={color:"",bulletColor:""},lr=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=rr(this,ir(t).call(this,e))).config=Q({},ur,r),n.render(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sr(e,t)}(t,Pn),ar(t,[{key:"name",get:function(){return"SliderFillRecentBar"}},{key:"className",get:function(){return"--z--bar --z--bar-fill-recent"}},{key:"tagName",get:function(){return"span"}}]),ar(t,[{key:"update",value:function(e){if(z.number(e)){var t={width:"".concat(e,"%")};pe(this.el,t)}}},{key:"render",value:function(){return this.config.color&&pe(this.el,{backgroundColor:this.config.color}),this.bulletEl=Te("span",{},{class:"--z--bullet"}),this.config.bulletColor&&pe(this.bulletEl,{backgroundColor:this.config.bulletColor}),this.el.append(this.bulletEl),this}}]),t}();function cr(e){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fr(e,t){return!t||"object"!==cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hr(e){return(hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pr(e,t,n){return t&&dr(e.prototype,t),n&&dr(e,n),e}function vr(e,t){return(vr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gr=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=q(e.options,"controls.seekBar.foregroundColor")||"",r=q(e.options,"controls.seekBar.playHeadColor")||"";return fr(this,hr(t).call(this,e,{color:n,bulletColor:r}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vr(e,t)}(t,lr),pr(t,[{key:"name",get:function(){return"ProgressControl"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_TIMEUPDATE,handler:this.onTimeUpdate}]}}]),pr(t,[{key:"onTimeUpdate",value:function(e){var t=e.current<0?e.total:e.current;this.currentPositionValue=t,this.currentDurationValue=e.total,this.currentSeekBarPercentage=this.currentPositionValue/this.currentDurationValue*100,this.update(this.currentSeekBarPercentage)}}]),t}();n(15);function yr(e){return(yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mr(e,t){return!t||"object"!==yr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function br(e){return(br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t,n){return t&&Er(e.prototype,t),n&&Er(e,n),e}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kr={color:""},Ar=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=mr(this,br(t).call(this,e))).config=Q({},kr,r),n.render(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(t,Pn),_r(t,[{key:"name",get:function(){return"SliderLoadedBar"}},{key:"className",get:function(){return"--z--bar --z--bar-fill-load"}},{key:"tagName",get:function(){return"span"}}]),_r(t,[{key:"update",value:function(e){if(z.number(e)){var t={width:"".concat(e,"%")};pe(this.el,t)}}},{key:"render",value:function(){return this.config.color&&pe(this.el,{backgroundColor:this.config.color}),this}}]),t}();function Sr(e){return(Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wr(e,t){return!t||"object"!==Sr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Lr(e){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Or(e,t,n){return t&&Pr(e.prototype,t),n&&Pr(e,n),e}function Cr(e,t){return(Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rr=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=q(e.options,"controls.seekBar.bufferedColor")||"";return wr(this,Lr(t).call(this,e,{color:n}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(t,Ar),Or(t,[{key:"name",get:function(){return"LoadProgressBar"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_PROGRESS,handler:this.onProgressUpdate}]}}]),Or(t,[{key:"onProgressUpdate",value:function(e){var t=e.start/e.total*100,n=e.current/e.total*100;this.processLoaded=n-t,this.update(this.processLoaded)}}]),t}();n(16);function Dr(e){return(Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ir(e,t){return!t||"object"!==Dr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fr(e,t,n){return t&&Mr(e.prototype,t),n&&Mr(e,n),e}function Nr(e,t){return(Nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ur={color:""},Br=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ir(this,xr(t).call(this,e))).config=Q({},Ur,r),n.render(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nr(e,t)}(t,Pn),Fr(t,[{key:"name",get:function(){return"SliderBackgroundBar"}},{key:"className",get:function(){return"--z--bar --z--bar-bg"}},{key:"tagName",get:function(){return"span"}}]),Fr(t,[{key:"render",value:function(){return this.config.color&&pe(this.el,{backgroundColor:this.config.color}),this}}]),t}(),jr=function(e){return parseInt(e/60/60%60,10)},Hr=function(e){return parseInt(e/60%60,10)},Gr=function(e){return parseInt(e%60,10)};function Vr(){return(new Date).getTime()/1e3}function Yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!z.number(e))return"";var r=function(e){return"0".concat(e).slice(-2)},i=jr(e),o=Hr(e),a=Gr(e);return i=t||i>0?"".concat(i,":"):"","".concat(n&&e>0?"-":"").concat(i).concat(r(o),":").concat(r(a))}function Kr(e){return(Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t){return!t||"object"!==Kr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wr(e){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xr(e,t,n){return t&&qr(e.prototype,t),n&&qr(e,n),e}function $r(e,t){return($r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qr=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=zr(this,Wr(t).call(this,e))).enabled=!0,n.render(),n.hide(),n.bindEvents(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$r(e,t)}(t,Ue),Xr(t,[{key:"name",get:function(){return"SeekTime"}},{key:"tagName",get:function(){return"span"}},{key:"attributes",get:function(){return{class:"--z--seek-time"}}},{key:"listenEvents",get:function(){return[{name:C.MEDIACONTROL_MOUSEMOVE_SEEKBAR,handler:this.onMouseMoveSeekbar},{name:C.MEDIACONTROL_MOUSELEAVE_SEEKBAR,handler:this.onMouseLeaveSeekbar}]}}]),Xr(t,[{key:"onMouseMoveSeekbar",value:function(e,t){var n=t*this.player.getDuration();pe(this.el,{left:100*t+"%",marginLeft:-this.el.offsetWidth/2+"px"}),this.el.textContent=Yr(n),this.show()}},{key:"onMouseLeaveSeekbar",value:function(){this.hide()}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.show(),this.enabled=!0)}},{key:"disable",value:function(){this.unbindEvents(),this.hide(),this.enabled=!1}},{key:"render",value:function(){return this.el.innerHTML="00:00",this}}]),t}();function Jr(e){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zr(e,t){return!t||"object"!==Jr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ei(e,t,n){return(ei="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ti(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ti(e){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ni(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ri(e,t,n){return t&&ni(e.prototype,t),n&&ni(e,n),e}function ii(e,t){return(ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oi=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n=Zr(this,(e=ti(t)).call.apply(e,[this].concat(i)));var a=i[0],s=q(a.options,"controls.seekBar.backgroundColor")||"";return n.loadProgressBar=new Rr(a),n.progressControl=new gr(a),n.barBackground=new Br(a,{color:s}),n.seekTime=new Qr(a),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ii(e,t)}(t,Hn(tr,Fn)),ri(t,[{key:"name",get:function(){return"SeekBarControl"}},{key:"className",get:function(){return"--z--progress-bar"}},{key:"events",get:function(){return{touchmove:"onMouseMove",mousedown:"onMouseDown",touchstart:"onMouseDown",touchend:"onMouseUp",mouseleave:"onMouseLeave",mouseover:"onMouseOver",mouseout:"onMouseOut",mousemove:"onMouseMove"}}},{key:"listenEvents",get:function(){return[{once:!0,name:C.PLAYER_DVRSTATECHANGED,handler:this.dvrChanged}]}}]),ri(t,[{key:"onMouseLeave",value:function(e){this.player.trigger(C.MEDIACONTROL_MOUSELEAVE_SEEKBAR,e)}},{key:"onMouseMove",value:function(e){k.debug(this.name,"onMouseMove"),ei(ti(t.prototype),"onMouseMove",this).call(this,e),this.player.trigger(C.MEDIACONTROL_MOUSEMOVE_SEEKBAR,e,this.distance)}},{key:"onMouseDown",value:function(e){k.debug(this.name,"onMouseDown"),ei(ti(t.prototype),"onMouseDown",this).call(this,e),this.addClass("active"),this.isPlayingBeforeSeek=this.player.isPlaying(),this.isPlayingBeforeSeek&&this.player.pause()}},{key:"update",value:function(){var e=100*this.distance;this.player.seekPercentage(e),this.currentSeekBarPercentage=e,this.progressControl.update(this.currentSeekBarPercentage)}},{key:"handleMouseMove",value:function(){this.player.mediaControl.draggingSeekBar=!0,this.update()}},{key:"handleMouseUp",value:function(){this.plugin.draggingSeekBar=!1,this.update(),this.removeClass("active"),this.seekTime.hide(),this.isPlayingBeforeSeek&&this.player.play()}},{key:"dvrChanged",value:function(){this.player.isLive()&&this.hide()}},{key:"render",value:function(){return this.el.append(this.barBackground.el),this.el.append(this.loadProgressBar.el),this.el.append(this.progressControl.el),this.el.append(this.seekTime.el),this}},{key:"remove",value:function(){[this.loadProgressBar,this.progressControl,this.barBackground,this.seekTime].forEach(function(e){e.remove()}),ei(ti(t.prototype),"remove",this).call(this)}}]),t}();n(17);function ai(e){return(ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function si(e,t){return!t||"object"!==ai(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function li(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ci(e,t,n){return t&&li(e.prototype,t),n&&li(e,n),e}function fi(e,t){return(fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hi={currentTimeColor:"",totalTimeColor:"",delimiterColor:"",delimiter:"/"},di=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=si(this,ui(t).call(this,e))).config=Q({},hi,q(e.options,"controls.time")||{}),n.currentTime=0,n.duration=n.player.getDuration(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fi(e,t)}(t,Pn),ci(t,[{key:"name",get:function(){return"TimeControl"}},{key:"className",get:function(){return"--z--control --z--control-time"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_TIMEUPDATE,handler:this.onTimeUpdate},{name:C.PLAYER_LOADEDMETADATA,handler:this.onLoadedMetaData},{once:!0,name:C.PLAYER_DVRSTATECHANGED,handler:this.dvrChanged}]}}]),ci(t,[{key:"onLoadedMetaData",value:function(){this.duration=this.player.getDuration(),this.update()}},{key:"update",value:function(){this.currentTimeEl&&(this.currentTimeEl.textContent=Yr(this.currentTime)),this.durationEl&&(this.durationEl.textContent=Yr(this.duration))}},{key:"onTimeUpdate",value:function(e){this.el&&(this.currentTime=e.current<0?e.total:e.current,this.duration||(this.duration=this.player.getDuration()),this.update())}},{key:"dvrChanged",value:function(){this.player.isLive()&&this.hide()}},{key:"render",value:function(){return this.currentTimeEl=Te("span"),this.spaceEl=Te("span",{innerHTML:this.config.delimiter}),this.durationEl=Te("span",{innerHTML:Yr(this.duration)}),pe(this.currentTimeEl,{color:this.config.currentTimeColor}),pe(this.spaceEl,{color:this.config.delimiterColor}),pe(this.durationEl,{color:this.config.totalTimeColor}),this.el.append(this.currentTimeEl),this.el.append(this.spaceEl),this.el.append(this.durationEl),this}}]),t}();n(18),n(19);function pi(e){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vi(e,t){return!t||"object"!==pi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gi(e){return(gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mi(e,t,n){return t&&yi(e.prototype,t),n&&yi(e,n),e}function bi(e,t){return(bi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ei={color:""},_i=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=vi(this,gi(t).call(this,e))).config=Q({},Ei,q(e.options,"controls.volumeButton")||{}),n.volume=e.options.mute?0:e.options.volume,n.cachedVolume=e.options.volume||100,n.volumeIconClass="",n._chooseVolumeIconInit(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bi(e,t)}(t,xn),mi(t,[{key:"name",get:function(){return"VolumeButton"}},{key:"className",get:function(){return"--z--control --z--btn --z--volume-icon"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_VOLUMEUPDATE,handler:this.onVolumeUpdated}]}}]),mi(t,[{key:"_chooseVolumeIconInit",value:function(){0===this.volume?this.volumeIconClass="pl-ic-volume_off":this.volume>=50?this.volumeIconClass="pl-ic-volume_up":this.volume<50&&(this.volumeIconClass="pl-ic-volume_down")}},{key:"handleClick",value:function(){this.player.isMuted()?this.player.setVolume(this.cachedVolume,!0):this.player.setVolume(0,!0)}},{key:"onVolumeUpdated",value:function(e){this.volume=e,e>0&&(this.cachedVolume=e),this.updateIcon(e),this.setAttribute("title",0===e?"Bật âm thanh":"Tắt tiếng")}},{key:"updateIcon",value:function(e){he(this.iconEl,"pl-ic-volume_down",e<50),he(this.iconEl,"pl-ic-volume_up",e>=50),he(this.iconEl,"pl-ic-volume_off",0===e)}},{key:"render",value:function(){return this.iconEl=Te("span",{},{class:"--z--icon ".concat(this.volumeIconClass)}),this.config.color&&pe(this.iconEl,{color:this.config.color}),this.el.append(this.iconEl),this}}]),t}();n(20);function Ti(e){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ki(e,t){return!t||"object"!==Ti(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ai(e,t,n){return(Ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Si(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Si(e){return(Si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Li(e,t,n){return t&&wi(e.prototype,t),n&&wi(e,n),e}function Pi(e,t){return(Pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oi=function(e){function t(e,n,r){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=ki(this,Si(t).call(this,e,r))).volume=e.options.mute?0:e.options.volume,i.parent=n;var o=q(e.options,"controls.volumeBar.foregroundColor")||"",a=q(e.options,"controls.volumeBar.backgroundColor")||"",s=q(e.options,"controls.volumeBar.volumeHeadColor")||"";return i.barFill=new lr(e,{color:o,bulletColor:s}),i.barBackground=new Br(e,{color:a}),i.update(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pi(e,t)}(t,tr),Li(t,[{key:"name",get:function(){return"VolumeBar"}},{key:"className",get:function(){return"--z--volume-bar"}},{key:"tagName",get:function(){return"span"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_VOLUMEUPDATE,handler:this.onVolumeUpdated},{name:C.PLAYER_READY,handler:this.onPlayerReady},{name:C.PLAYER_FULLSCREEN,handler:this.onPlayerReady}]}}]),Li(t,[{key:"onPlayerReady",value:function(){this.player.getPlayerSize().width<=400?this.hide():this.show()}},{key:"onVolumeUpdated",value:function(e){this.volume=e,this.update()}},{key:"setVolume",value:function(e){e=Math.min(100,Math.max(e,0)),this.volume=e,this.player.setVolume(e,!0),this.update()}},{key:"update",value:function(){this.barFill&&this.barFill.update(this.volume)}},{key:"onMouseDown",value:function(e){Ai(Si(t.prototype),"onMouseDown",this).call(this,e),this.parent.toggleHideAnimation(!1)}},{key:"handleMouseMove",value:function(){this.handleMouse()}},{key:"handleMouseUp",value:function(){this.handleMouse(),this.parent.toggleHideAnimation(!0)}},{key:"handleMouse",value:function(){this.player.mediaControl.draggingVolumeBar=!0,this.setVolume(100*this.distance)}},{key:"render",value:function(){return this.el.append(this.barBackground.el),this.el.append(this.barFill.el),this}}]),t}();function Ci(e){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ri(e,t,n){return(Ri="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Di(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Di(e){return(Di=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ii(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xi(e,t,n){return t&&Ii(e.prototype,t),n&&Ii(e,n),e}function Mi(e,t){return(Mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ni=!0,Ui=function(e){function t(){var e,n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];r=this,n=!(i=(e=Di(t)).call.apply(e,[this].concat(a)))||"object"!==Ci(i)&&"function"!=typeof i?Fi(r):i;var u=a[0],l=a[1];n.volumeButton=new _i(u),n.volumeBar=new Oi(u,Fi(Fi(n)),l);var c=q(u.options,"controls.volumeBarShowOnHover");return z.nullOrUndefined(c)&&(c=Ni),n.toggleHideAnimation(c),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mi(e,t)}(t,Hn(Pn,Fn)),xi(t,[{key:"name",get:function(){return"VolumeControl"}},{key:"className",get:function(){return"--z--control --z--control-volume"}}]),xi(t,[{key:"toggleHideAnimation",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.toggleClass("--z--hide-animation",e)}},{key:"render",value:function(){return this.el.append(this.volumeButton.render().el),this.el.append(this.volumeBar.render().el),this}},{key:"remove",value:function(){[this.volumeButton,this.volumeBar].forEach(function(e){e.remove()}),Ri(Di(t.prototype),"remove",this).call(this)}}]),t}(),Bi=(n(21),{isFullscreenIos:!1,isFullscreen:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||this.isFullscreenIos)},requestFullscreen:function(e){e.requestFullscreen?e.requestFullscreen().catch(function(e){k.error("requestFullscreen | ",e)}):e.webkitRequestFullscreen?e.webkitRequestFullscreen().catch(function(e){k.error("webkitRequestFullscreen | ",e)}):e.mozRequestFullScreen?e.mozRequestFullScreen().catch(function(e){k.error("mozRequestFullScreen | ",e)}):e.msRequestFullscreen?e.msRequestFullscreen().catch(function(e){k.error("msRequestFullscreen | ",e)}):e.querySelector&&e.querySelector("video")&&e.querySelector("video").webkitEnterFullScreen?e.querySelector("video").webkitEnterFullScreen().catch(function(e){k.error("webkitEnterFullScreen | ",e)}):e.webkitEnterFullScreen&&e.webkitEnterFullScreen().catch(function(e){k.error("webkitEnterFullScreen | ",e)})},cancelFullscreen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.exitFullscreen?e.exitFullscreen().catch(function(e){k.error("exitFullscreen | ",e)}):e.webkitCancelFullScreen?e.webkitCancelFullScreen().catch(function(e){k.error("webkitCancelFullScreen | ",e)}):e.webkitExitFullscreen?e.webkitExitFullscreen().catch(function(e){k.error("webkitExitFullscreen | ",e)}):e.mozCancelFullScreen?e.mozCancelFullScreen().catch(function(e){k.error("mozCancelFullScreen | ",e)}):e.msExitFullscreen?e.msExitFullscreen().catch(function(e){k.error("msExitFullscreen | ",e)}):void 0},fullscreenEnabled:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}});function ji(e){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hi(e,t){return!t||"object"!==ji(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gi(e){return(Gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yi(e,t,n){return t&&Vi(e.prototype,t),n&&Vi(e,n),e}function Ki(e,t){return(Ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zi={color:""},Wi=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n=Hi(this,(e=Gi(t)).call.apply(e,[this].concat(i)));var a=i[0];return n.config=Q({},zi,q(a.options,"controls.fullscreen")||{}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ki(e,t)}(t,Hn(xn,Fn)),Yi(t,[{key:"name",get:function(){return"FullScreenControl"}},{key:"className",get:function(){return"--z--control --z--btn --z--control-full-screen"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_FULLSCREEN,handler:this._onFullScreenChange},{name:C.PLAYER_DBLCLICK,handler:this._onDblClicked}]}}]),Yi(t,[{key:"handleClick",value:function(){this.config.functionFullscreen?this.config.functionFullscreen():this.player.toggleFullscreen()}},{key:"_onDblClicked",value:function(){this.config.dblClickToFullScreen&&this.handleClick()}},{key:"toogleIconFullScreen",value:function(e){he(this.iconEl,"pl-ic-fullscreen_exit",e),he(this.iconEl,"pl-ic-fullscreen",!e),this.setButtonTooltip(e)}},{key:"setButtonTooltip",value:function(e){var t=this.config.buttonTooltip,n=t?t.on:"Toàn màn hình",r=t?t.off:"Thoát chế độ toàn màn hình";this.setAttribute("title",e?r:n)}},{key:"render",value:function(){return this.iconEl=Te("span",{},{class:"--z--icon pl-ic-fullscreen"}),this.setButtonTooltip(this.player.isFullscreen()),this.config.color&&pe(this.iconEl,{color:this.config.color}),this.el.append(this.iconEl),this}},{key:"_onFullScreenChange",value:function(e){this.toogleIconFullScreen(e)}}]),t}();n(22);function qi(e){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xi(e,t,n){return(Xi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$i(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function $i(e){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ji(e,t,n){return t&&Qi(e.prototype,t),n&&Qi(e,n),e}function Zi(e,t){return(Zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var to={color:"",labelBgColor:"",labelTextColor:""},no=function(e){function t(e,n){var r,i,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(r=!(o=$i(t).call(this,e))||"object"!==qi(o)&&"function"!=typeof o?eo(i):o).config=Q({},to,q(e.options,"controls.SettingsButton")||{}),r.parent=n,r.label="",window.on("click.".concat(r.name),r.clickOutsideSettingsButton.bind(eo(eo(r)))),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zi(e,t)}(t,Pn),Ji(t,[{key:"name",get:function(){return"SettingsButton"}},{key:"className",get:function(){return"--z--btn --z--btn-settings"}},{key:"tagName",get:function(){return"button"}}]),Ji(t,[{key:"clickOutsideSettingsButton",value:function(e){le(e.target,"pl-ic-settings")||this.parent.hideSettingsMenu()}},{key:"remove",value:function(){window.off("click.".concat(this.name),this.clickOutsideSettingsButton.bind(this)),Xi($i(t.prototype),"remove",this).call(this)}},{key:"handleClick",value:function(e){e.stopPropagation(),this.parent.toggleVisibleSettingsMenu()}},{key:"updateBadgeLabel",value:function(e){this.label=e,this.iconLabelEl.textContent=e}},{key:"render",value:function(){return this.iconEl=Te("span",{},{class:"--z--icon pl-ic-settings"}),this.iconLabelEl=Te("span",{},{class:"--z--badge"}),this.iconLabelEl.textContent=this.label,this.setAttribute("title","Cài đặt"),pe(this.iconEl,{color:this.config.color}),pe(this.iconLabelEl,{backgroundColor:this.config.labelBgColor,color:this.config.labelTextColor}),this.el.append(this.iconEl),this.el.append(this.iconLabelEl),this}}]),t}(),ro={MENU_TYPE:{TOGGLE:"toggle",EXPAND:"expand"},LIST_MENU_TYPE:{CHECKLIST:"checklist",MIXIN:"mixin"}};function io(e){return(io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ao(e,t,n[t])})}return e}function ao(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function so(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function uo(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lo(e){return(lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function co(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fo(e,t,n){return t&&co(e.prototype,t),n&&co(e,n),e}function ho(e,t){return(ho=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var po=function(){},vo=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n=uo(this,(e=lo(t)).call.apply(e,[this].concat(i)));var a=i[2];return n.render(),n.parent=a,n.controls=n.parent.controls,n.settingsMenuItems={},n.routeHistory=[],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ho(e,t)}(t,Hn(Pn,Fn)),fo(t,[{key:"name",get:function(){return"SettingsMenu"}},{key:"className",get:function(){return"--z--zpl-settings-menu"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_READY,handler:this.onPlayerReady},{name:C.PLAYER_MEDIACONTROL_HIDE,handler:this.onHideMediaControl},{name:C.PLAYER_SETTINGS_MENU_HIDE,handler:this.hideMenu},{name:C.PLAYER_PLAY,handler:this.hideMenu},{name:C.PLAYER_PAUSE,handler:this.hideMenu},{name:C.PLAYER_FULLSCREEN,handler:this.hideMenu},{name:C.PLAYER_MEDIACONTROL_CLICK,handler:this.hideMenu},{name:C.PLAYER_VOLUMEUPDATE,handler:this.hideMenu}]}}]),fo(t,[{key:"handleClick",value:function(e){e.stopPropagation()}},{key:"onHideMediaControl",value:function(){this.hideMenu()}},{key:"onPlayerReady",value:function(){var e=J(this.settingsMenuItems);e.length&&(e=jt(e,"order")),e.length?(this.createMenu({type:ro.LIST_MENU_TYPE.MIXIN,config:{itemsList:e}}),this.parent.show(),this.parent.settingsButton.show()):this.parent.hide()}},{key:"registerMenuItem",value:function(e){var t=e.pluginKey,n=void 0===t?"":t,r=e.type,i=void 0===r?ro.MENU_TYPE.TOGGLE:r,o=e.config,a=void 0===o?{}:o,s=e.order,u=void 0===s?0:s,l=e.callback,c=void 0===l?po:l,f=e.optionsConfig;if(!n)throw new Error("pluginKey must be required");this.settingsMenuItems[n]={type:i,config:a,order:u,callback:c,optionsConfig:f}}},{key:"asyncRegisterMenuItem",value:function(){this.registerMenuItem.apply(this,arguments),this.onPlayerReady()}},{key:"createToggleItem",value:function(e){var t=this,n=e.title,r=void 0===n?"":n,i=e.checked,o=void 0!==i&&i,a=e.clickCallback,s=void 0===a?po:a,u=e.itemIndex,l=Te("div",{innerHTML:'\n            <div class="--z--zpl-item-label">\n                '.concat(r,'\n            </div>\n            <div class="--z--zpl-item-content">\n                <div class="--z--zpl-toggle-checkbox"></div>\n            </div>\n        ')},{class:"--z--zpl-menu-item","aria-checked":o});return l.on("click",function(e){z.function(s)&&s(e,l);var n="true"!==Ae(l,"aria-checked");Se(l,"aria-checked",n);var r=t.routeHistory.length;if(r){var i=t.routeHistory[r-1];if("mixin"===q(i,"config.headerConfig.optionsMenu.type")){var o=q(i,"config.headerConfig.optionsMenu.data");if(z.array(o)&&o.length){var a=o[u],c=q(a,"config.checked");a&&!z.nullOrUndefined(c)&&(a.config.checked=n)}}}}),l}},{key:"createExpandableItem",value:function(e){var t=this,n=e.title,r=void 0===n?"":n,i=e.activeItemIndex,o=void 0===i?0:i,a=e.clickCallback,s=void 0===a?po:a,u=e.subMenu,l=e.optionsConfig,c=e.historyData,f=e.itemIndex,h=u.type,d=u.data,p=u.clickCallback,v=u.titleClickCallback,g=d&&z.array(d)&&d[o],y=g&&g.displayName||g&&g.label||"",m=Te("div",{innerHTML:'\n            <div class="--z--zpl-item-label">\n                '.concat(r,'\n            </div>\n            <div class="--z--zpl-item-content">\n                <div class="--z--zpl-has-expand">\n                    <span> ').concat(y,' </span>\n                    <i class="pl-ic-keyboard_arrow_right"></i>\n                </div>\n            </div>\n        ')},{class:"--z--zpl-menu-item"});return d.map(function(e,t){return e.checked=o===t,e}),m.data={title:r,activeItemIndex:o,subMenu:u,optionsConfig:l,itemIndex:f},m.on("click",function(e){if(z.function(s)&&s(e,m),z.nullOrUndefined(c)||z.empty(c)||(t.routeHistory=[].concat(so(t.routeHistory),[c])),h===ro.LIST_MENU_TYPE.CHECKLIST){var n={headerConfig:{title:r,showOptions:!!l,optionText:l&&l.label,optionsClickCallback:l&&l.clickCallback,optionsMenu:l&&l.subMenu,titleClickCallback:v},itemsList:d,clickCallback:p,itemIndex:f};t.createCheckListMenu(n,{type:ro.LIST_MENU_TYPE.CHECKLIST,config:n})}}),m}},{key:"createCheckableItem",value:function(e){var t=this,n=e.label,r=void 0===n?"":n,i=e.disabled,o=void 0!==i&&i,a=e.checked,s=void 0!==a&&a,u=e.callback,l=void 0===u?po:u,c=e.itemIndex,f=Te("div",{innerHTML:'\n            <div class="--z--zpl-item-label">\n                <i class="pl-ic-done"></i>\n                <span class="txt">'.concat(r,"</span>\n            </div>\n        ")},{class:"--z--zpl-menu-item","aria-checked":s,"aria-disabled":o});return f.on("click",function(e){if(z.function(l)&&l(e,f),o)return!1;for(var n=(f.parentNode||f.parentElement).childNodes,r=n.length,i=0;i<r;i++){Se(n[i],"aria-checked",!1)}Se(f,"aria-checked",!0);var a=t.routeHistory.length,s=t.routeHistory[a-1],u=q(s,"config.itemsList"),h=u&&z.array(u)&&u[c],d=q(f.data,"index");if(z.nullOrUndefined(d))throw new Error("Element must be have index property in data",f);if(h&&!z.nullOrUndefined(h.type)){var p=q(h,"config.activeItemIndex");z.nullOrUndefined(p)||(h.config.activeItemIndex=d)}else{var v=q(s,"config.headerConfig.optionsMenu");v&&!z.nullOrUndefined(q(v,"activeItemIndex"))&&(v.activeItemIndex=d)}}),f}},{key:"goBack",value:function(){var e=this.routeHistory.length;if(e){var t=this.routeHistory[e-1];t&&(this.createMenu(t),this.routeHistory.pop())}}},{key:"createMenuHeader",value:function(e){var t=this,n=e.title,r=void 0===n?"":n,i=e.showOptions,o=void 0!==i&&i,a=e.optionText,s=void 0===a?"Options":a,u=e.titleClickCallback,l=void 0===u?po:u,c=e.optionsClickCallback,f=void 0===c?po:c,h=e.optionsMenu,d=e.historyData,p=e.itemIndex,v=Te("div",{},{class:"--z--zpl-panel-header --z--clearfix"}),g=Te("button",{innerHTML:'<i class="pl-ic-keyboard_arrow_left"></i> '.concat(r)},{class:"--z--panel-title"});if(g.on("click",function(e){e.stopPropagation(),t.goBack(),z.function(l)&&l(e)}),v.append(g),o){var y=Te("div",{innerText:s},{class:"--z--zpl-options"});y.on("click",function(e){e.stopPropagation();var n=t.routeHistory[t.routeHistory.length-1],r=n&&q(n,"config.itemsList"),i=r&&z.array(r)&&r[p];if(i){var o=q(i,"config.activeItemIndex");z.nullOrUndefined(o)||(d.config.activeItemIndex=o,q(d,"config.itemsList")&&d.config.itemsList.map(function(e,t){return e.checked=o===t,e}))}z.nullOrUndefined(d)||z.empty(d)||(t.routeHistory=[].concat(so(t.routeHistory),[d])),z.function(f)&&f(e);var a=h.type,u=h.data,l=h.activeItemIndex,c={headerConfig:{title:s},itemsList:u,itemIndex:p};a===ro.LIST_MENU_TYPE.CHECKLIST?(z.number(l)&&u.map(function(e,t){return e.checked=l===t,e}),t.createCheckListMenu(c,{type:ro.LIST_MENU_TYPE.CHECKLIST,config:c})):a===ro.LIST_MENU_TYPE.MIXIN&&t.createMixinMenu(c,{type:ro.LIST_MENU_TYPE.MIXIN,config:c})}),v.append(y)}return v}},{key:"createMenu",value:function(e){var t=e.type,n=e.config;"checklist"===t?this.createCheckListMenu(oo({},n),{type:t,config:n}):"mixin"===t&&this.createMixinMenu(oo({},n),{type:t,config:n})}},{key:"createCheckListMenu",value:function(e,t){var n=e.headerConfig,r=e.itemsList,i=void 0===r?[]:r,o=e.clickCallback,a=void 0===o?po:o,s=e.itemIndex;if(this.panelEl.innerHTML="",n){var u=this.createMenuHeader(oo({},n,{historyData:t,itemIndex:s}));this.panelEl.append(u)}for(var l=Te("div",{},{class:"--z--panel-scroll-wrapper"}),c=Te("div",{},{class:"--z--zpl-panel-menu"}),f=i.length,h=0;h<f;h++){var d=i[h];if(!z.object(d)||!d.label)return;var p=this.createCheckableItem({label:d.displayName||d.label,checked:!!d.checked,disabled:!!d.disabled,callback:a,itemIndex:s});p.data=d,c.append(p)}l.append(c),this.panelEl.append(l)}},{key:"createMixinMenu",value:function(e,t){var n=e.headerConfig,r=e.itemsList,i=void 0===r?[]:r;if(this.panelEl.innerHTML="",n){var o=this.createMenuHeader(n);this.panelEl.append(o)}for(var a=Te("div",{},{class:"--z--panel-scroll-wrapper"}),s=Te("div",{},{class:"--z--zpl-panel-inner"}),u=i.length,l=0;l<u;l++){var c=i[l],f=c.type,h=c.config,d=c.callback,p=c.optionsConfig,v=null;f===ro.MENU_TYPE.TOGGLE?v=this.createToggleItem(oo({},h,{itemIndex:l})):f===ro.MENU_TYPE.EXPAND&&(v=this.createExpandableItem(oo({},h,{optionsConfig:p,historyData:t,itemIndex:l}))),z.function(d)&&d(v),v&&s.append(v)}a.append(s),this.panelEl.append(a)}},{key:"toggleVisibleMenu",value:function(){he(this.el,"--z--show"),this.player.isMenuOpen=!this.player.isMenuOpen}},{key:"hideMenu",value:function(){fe(this.el,"--z--show"),this.player.isMenuOpen=!1}},{key:"render",value:function(){this.panelEl=Te("div",{},{class:"--z--zpl-panel"}),this.el.append(this.panelEl),this.player.el.append(this.el)}}]),t}();function go(e){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yo(e,t,n){return(yo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function mo(e){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Eo(e,t,n){return t&&bo(e.prototype,t),n&&bo(e,n),e}function _o(e,t){return(_o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function To(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ko(e){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ao(e,t){return!t||"object"!==ko(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function So(e){return(So=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lo(e,t,n){return t&&wo(e.prototype,t),n&&wo(e,n),e}function Po(e,t){return(Po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oo(e){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Co(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ro(e,t){return!t||"object"!==Oo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Do(e,t,n){return(Do="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Io(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Io(e){return(Io=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mo={playpause:qn,seekbar:oi,time:di,volume:Ui,fullscreen:Wi,settings:function(e){function t(){var e,n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];r=this,n=!(i=(e=mo(t)).call.apply(e,[this].concat(a)))||"object"!==go(i)&&"function"!=typeof i?To(r):i;var u=a[0],l=a[1];return n.settingsButton=new no(u,To(To(n))),n.settingsMenu=new vo(u,l,To(To(n))),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_o(e,t)}(t,Hn(Pn,Fn)),Eo(t,[{key:"name",get:function(){return"SettingsControl"}},{key:"className",get:function(){return"--z--control --z--control-settings"}}]),Eo(t,[{key:"toggleVisibleSettingsMenu",value:function(){this.settingsMenu.toggleVisibleMenu()}},{key:"hideSettingsMenu",value:function(){this.settingsMenu.hideMenu()}},{key:"render",value:function(){return this.el.append(this.settingsButton.render().el),this}},{key:"remove",value:function(){[this.settingsButton,this.settingsMenu].forEach(function(e){e.remove()}),yo(mo(t.prototype),"remove",this).call(this)}}]),t}(),theatermode:function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n=Ao(this,(e=So(t)).call.apply(e,[this].concat(i)));var a=i[0];return n.config=Q({},_n,q(a.options,"controls.theaterMode")||{}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Po(e,t)}(t,Hn(xn,Fn)),Lo(t,[{key:"name",get:function(){return"TheaterModeControl"}},{key:"className",get:function(){return"--z--control --z--btn --z--control-theater-mode"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_THEATER_MODE_CHANGE,handler:this._onTheaterModeChange}]}}]),Lo(t,[{key:"toggleIcon",value:function(e){he(this.iconEl,"pl-ic-theater",e),he(this.iconEl,"pl-ic-theater-mini",!e),this.setButtonTooltip(e)}},{key:"handleClick",value:function(){this.player.toggleTheaterMode()}},{key:"setButtonTooltip",value:function(e){var t=this.config.buttonTooltip,n=t?t.on:"Chế độ rạp chiếu",r=t?t.off:"Thoát chế độ rạp chiếu";this.setAttribute("title",e?r:n)}},{key:"render",value:function(){var e=this.options.theaterMode,t=e?"pl-ic-theater":"pl-ic-theater-mini";return this.iconEl=Te("span",{},{class:"--z--icon ".concat(t)}),this.setButtonTooltip(e),this.el.append(this.iconEl),this}},{key:"_onTheaterModeChange",value:function(e){this.toggleIcon(e)}}]),t}()},Fo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ro(this,Io(t).apply(this,arguments))}var r,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(t,Ke),r=t,o=[{key:"NAME_EVENTS",get:function(){return[{name:C.PLAYER_MOUSE_MOVE,handler:this.onMouseMove},{name:C.PLAYER_MOUSE_LEAVE,handler:this.onMouseLeave},{name:C.PLAYER_PLAY,handler:this.onPlay},{name:C.PLAYER_PAUSE,handler:this.onPause}]}}],(i=[{key:"setUp",value:function(){this.draggingVolumeBar=!1,this.draggingSeekBar=!1,this.autoHideDisabled=!1,this.setting=Q({},this.pluginOptions),this.setting.layout=q(this.pluginOptions,"layout"),this.controls=[],this.leftElement=null,this.rightElement=null,this.pluginOptions.disabled||this.onMouseMove()}},{key:"setupTheme",value:function(){var e=this,t=this.setting,r=t.type,i=t.theme;if(r.fullWidth){ce(this.innerEl,mn),ce(this.el,mn);var o=r.fullWidth;switch(o.backgoundType){case Tn.BG_TYPE_TRANSPARENT:ce(this.innerEl,bn);break;case Tn.BG_TYPE_GRADIENT:ce(this.innerEl,bn),ce(this.el,bn)}var a=o.paddingTop;z.number(a)&&a>=0&&pe(this.innerEl,{paddingTop:String(a).indexOf("px")>-1?a:"".concat(a,"px")}),pe(this.innerEl,{backgroundImage:o.backgroundImage,backgroundColor:o.backgroundColor}),this.setting.hideAnimation&&(this.hideClass=En)}i&&(J(Tn.THEME).indexOf(i)>-1&&n(23)("./".concat(i,".scss")).then(function(t){var n=Te("style",{innerHTML:t.default});e.innerEl.append(n)}))}},{key:"onClicked",value:function(e){e.stopPropagation(),this.player.trigger(C.PLAYER_MEDIACONTROL_CLICK)}},{key:"onDblClicked",value:function(e){e.stopPropagation(),this.player.trigger(C.PLAYER_MEDIACONTROL_DBLCLICK)}},{key:"onMouseLeave",value:function(){this.autoHideDisabled||this.setting.alwaysShowControl||(clearTimeout(this.hideTimeout),this.hide())}},{key:"onMouseMove",value:function(){var e=this;this.autoHideDisabled||this.setting.disabledAutoHide||(clearTimeout(this.hideTimeout),this.show(),this.setting.alwaysShowControl||(this.hideTimeout=setTimeout(function(){return e.onMouseLeave()},3e3)))}},{key:"onPlay",value:function(){this.enableAutoHide()}},{key:"onPause",value:function(){this.onMouseLeave(),_t?this.setting.showOnPauseMobile&&this.disableAutoHide():this.disableAutoHide()}},{key:"disableAutoHide",value:function(){this.autoHideDisabled=!0,clearTimeout(this.hideTimeout),this.show()}},{key:"enableAutoHide",value:function(){this.setting.disabledAutoHide||this.player.isPlaying()&&(this.autoHideDisabled=!1,this.onMouseMove())}},{key:"disable",value:function(){Do(Io(t.prototype),"disable",this).call(this),this.player.disableMediaControl()}},{key:"enable",value:function(){Do(Io(t.prototype),"enable",this).call(this),this.player.enableMediaControl()}},{key:"show",value:function(){k.debug(this.name,"show"),fe(this.el,this.hideClass),this.player.showMediaControl()}},{key:"hide",value:function(){this.hideClass||(this.hideClass=yn),k.debug(this.name,"hide",this.hideClass),ce(this.el,this.hideClass),this.player.hideMediaControl()}},{key:"destroy",value:function(){Do(Io(t.prototype),"destroy",this).call(this),this.controls.forEach(function(e){return e.remove()}),this.remove()}},{key:"getControl",value:function(e){return this.controls&&this.controls.filter(function(t){return t.name===e})[0]}},{key:"renderControl",value:function(e,t){if(t){var n=Mo[t];if(n){var r=new n(this.player,this);e.append(r.render().el),this.controls.push(r)}}}},{key:"render",value:function(){var e=this;if(!this.controls)return this;if(Do(Io(t.prototype),"render",this).call(this),this.leftElement=Te("div",{},{class:"--z--control-left"}),this.rightElement=Te("div",{},{class:"--z--control-right"}),this.innerEl=Te("div",{},{class:"--z--controls"}),(!this.setting.layout.left||!this.setting.layout.left.length)&&ce(this.rightElement,"--z--only-right-control"),this.setting.layout.default){var n=!0,r=!1,i=void 0;try{for(var o,a=this.setting.layout.default[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this.renderControl(this.innerEl,s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}if(this.setting.layout.left){var u=!0,l=!1,c=void 0;try{for(var f,h=this.setting.layout.left[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;this.renderControl(this.leftElement,d)}}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}}if(this.setting.layout.right){var p=!0,v=!1,g=void 0;try{for(var y,m=this.setting.layout.right[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){var b=y.value;this.renderControl(this.rightElement,b)}}catch(e){v=!0,g=e}finally{try{p||null==m.return||m.return()}finally{if(v)throw g}}}return this.setupTheme(),this.innerEl.append(this.leftElement),this.innerEl.append(this.rightElement),this.el.append(this.innerEl),this.player.$el.append(this.el),setTimeout(function(){e.player.mediaControlReady()},0),this}},{key:"name",get:function(){return"ControlsPlugin"}},{key:"attributes",get:function(){return{class:"--z--controls-wrapper"}}},{key:"events",get:function(){return{click:"onClicked",dblclick:"onDblClicked"}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_MOUSE_MOVE,handler:this.onMouseMove},{name:C.PLAYER_MOUSE_LEAVE,handler:this.onMouseLeave},{name:C.PLAYER_PLAY,handler:this.onPlay},{name:C.PLAYER_PAUSE,handler:this.onPause}]}},{key:"defaultOptions",get:function(){return _n}}])&&Co(r.prototype,i),o&&Co(r,o),t}();n(24);function No(e){return(No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bo(e,t){return!t||"object"!==No(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ho(e,t){return(Ho=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Go={poster:"//zjs-znews.zingcdn.me/zplayer/images/poster_default.jpg"},Vo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Bo(this,jo(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ho(e,t)}(t,Ke),n=t,(r=[{key:"_onPlayerPlayIntent",value:function(){this.hide()}},{key:"_onPlayerEnded",value:function(){this.player.options.customIosFullscreen||this.show()}},{key:"handleClick",value:function(){return this.player.play(),!1}},{key:"getPosterUrl",value:function(){return this.options.poster||this.pluginOptions.poster}},{key:"render",value:function(){var e=this.getPosterUrl(),t=Te("div",{},{class:"--z--poster-controls --z--play-wrapper --z--active"});return this.el.setAttribute("style","background-image : url(".concat(e,");")),z.empty(this.pluginOptions.styles)||pe(this.el,this.pluginOptions.styles),this.$el.append(t),this.player.$el.append(this.el),this}},{key:"name",get:function(){return"PosterPlugin"}},{key:"attributes",get:function(){return{class:"--z--player-poster"}}},{key:"events",get:function(){return{click:"handleClick",touch:"handleClick"}}},{key:"defaultOptions",get:function(){return Go}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_PLAY_INTENT,handler:this._onPlayerPlayIntent},{name:C.PLAYER_ENDED,handler:this._onPlayerEnded}]}}])&&Uo(n.prototype,r),i&&Uo(n,i),t}();n(25);function Yo(e){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ko(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zo(e,t){return!t||"object"!==Yo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wo(e,t,n){return(Wo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function qo(e){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xo(e,t){return(Xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $o={showLabel:!1},Qo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),zo(this,qo(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xo(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){Wo(qo(t.prototype),"setUp",this).call(this),this.bufferingPercent=1,this.shouldUpdate=!0}},{key:"onBuffering",value:function(){this.shouldUpdate=!0,this.show()}},{key:"onBufferingChange",value:function(e){z.number(e)&&((e=Math.floor(e))<1?e=1:e>99&&(e=99),this.bufferingPercent=e,this.update())}},{key:"onBufferFull",value:function(){k.debug(this.name,"onBufferFull"),this.bufferingPercent=1,this.update(),this.hide(),this.shouldUpdate=!1}},{key:"onStop",value:function(){k.debug(this.name,"onStop"),this.bufferingPercent=1,this.hide()}},{key:"show",value:function(){var e=this;null===this.showTimeout&&(this.showTimeout=setTimeout(function(){e.player.trigger(C.LOADING_SPINNER_SHOW),e.$el.show()},300))}},{key:"hide",value:function(){null!==this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.player.trigger(C.LOADING_SPINNER_HIDE),this.$el.hide()}},{key:"update",value:function(){this.shouldUpdate&&this.pieWrapperEl&&(de(this.pieWrapperEl,"--z--pie-wrapper --z--progress-".concat(this.bufferingPercent)),this.labelEl&&_e(this.labelEl,"".concat(this.bufferingPercent,"%")))}},{key:"render",value:function(){return this.pieEl=Te("div",{},{class:"--z--pie-progress-size"}),this.pieWrapperEl=Te("div",{innerHTML:'\n                <div class="--z--pie">\n                    <div class="--z--left-side --z--half-circle"></div>\n                    <div class="--z--right-side --z--half-circle"></div>\n                </div>\n                <div class="--z--shadow"></div>\n                '},{class:"--z--pie-wrapper"}),this.pluginOptions.showLabel&&(this.labelEl=Te("div",{innerHTML:"".concat(this.bufferingPercent,"%")},{class:"--z--label"}),this.pieWrapperEl.prepend(this.labelEl)),this.pieEl.append(this.pieWrapperEl),this.$el.append(this.pieEl),this.player.$el.append(this.$el),this.$el.hide(),this.player.buffering&&this.onBuffering(),this}},{key:"_onPlayerPlayIntent",value:function(){this.player.buffering&&this.show()}},{key:"name",get:function(){return"LoadingSpinnerPlugin"}},{key:"attributes",get:function(){return{class:"--z--loading-wrapper"}}},{key:"defaultOptions",get:function(){return $o}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_PLAY_INTENT,handler:this._onPlayerPlayIntent},{name:C.PLAYER_BUFFERING,handler:this.onBuffering},{name:C.PLAYER_BUFFERING_CHANGE,handler:this.onBufferingChange},{name:C.PLAYER_BUFFERFULL,handler:this.onBufferFull},{name:C.PLAYER_STOP,handler:this.onStop},{name:C.PLAYER_ENDED,handler:this.onStop},{name:C.PLAYER_ERROR,handler:this.onStop}]}}])&&Ko(n.prototype,r),i&&Ko(n,i),t}();function Jo(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?e.toString().replace(/{(\d+)}/g,function(e,t){return n[t].toString()}):e}function Zo(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function ea(e){var t=document.createDocumentFragment(),n=document.createElement("div");return t.appendChild(n),n.innerHTML=e,t.firstChild.innerText}function ta(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function na(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return String.prototype.startsWith?e.startsWith(t,n):(n=!n||n<0?0:+n,e.indexOf(t)===n)}function ra(e,t,n){return String.prototype.endsWith?e.endsWith(t,n):((void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t)}function ia(e){return"".concat(e,"-").concat(Math.floor(1e4*Math.random()))}function oa(e,t){return 0===e||0===t||Number.isNaN(e)||Number.isNaN(t)?0:(e/t*100).toFixed(2)}function aa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"),n.toString())}function sa(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function ua(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return e=aa(e,"-"," "),e=aa(e,"_"," "),aa(e=sa(e)," ","")}function la(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return(e=ua(e)).charAt(0).toLowerCase()+e.slice(1)}function ca(e){var t=document.createDocumentFragment(),n=document.createElement("div");return t.appendChild(n),n.innerHTML=e,t.firstChild.innerText}function fa(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML}function ha(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var da=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=[]}var t,n,r;return t=e,(n=[{key:"getItem",value:function(e){return this.data[e]}},{key:"setItem",value:function(e,t){this.data[e]=String(t)}},{key:"removeItem",value:function(e){delete this.data[e]}}])&&ha(t.prototype,n),r&&ha(t,r),e}();function pa(){try{return"localStorage"in window&&(window.localStorage.setItem("__test__","__test__"),window.localStorage.removeItem("__test__"),!0)}catch(e){return!1}}var va=pa()?window.localStorage:new da;function ga(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ya=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zplayer";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.key=t}var t,n,r;return t=e,r=[{key:"supported",value:function(){return pa()}}],(n=[{key:"get",value:function(e){var t=va.getItem(this.key);if(z.empty(t))return{};var n=function(e){try{return JSON.parse(e)}catch(e){return{}}}(t);return z.string(e)&&e.length?n[e]:n}},{key:"set",value:function(e){if(z.object(e)){var t=this.get();z.empty(t)&&(t={}),Q(t,e),va.setItem(this.key,JSON.stringify(t))}}},{key:"clean",value:function(){va.removeItem(this.key)}}])&&ga(t.prototype,n),r&&ga(t,r),e}();function ma(e){return(ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ba(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ea(e,t){return!t||"object"!==ma(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _a(e,t,n){return(_a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ta(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ta(e){return(Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ka(e,t){return(ka=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Aa="zplayer-trk",Sa=5e3,wa=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ea(this,Ta(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ka(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){this.options.sources!=[{source:"",mimeType:""}]&&(this._isFirstLoad=!0,this._isBuffering=!0,this._trackingApi=this.pluginOptions.trackingApi,this._storage=new ya(ia(Aa)),this._reset(),this._sendLastReports())}},{key:"destroy",value:function(){_a(Ta(t.prototype),"destroy",this).call(this),this._stopMonitoring()}},{key:"_now",value:function(){return Date.now()}},{key:"_onPlayIntent",value:function(){this._timeOnStartLoad=this._now(),this._start("startup"),this._startMonitoring()}},{key:"_onBitrate",value:function(e){var t=parseInt(e.label),n=this._now(),r=this._metrics.extra.bitratesHistory.length;if(r>0){var i=this._metrics.extra.bitratesHistory[r-1];i.end=n,i.time=n-i.start}this._metrics.extra.bitratesHistory.push({start:this._now(),bitrate:t}),this._inc("changeLevel")}},{key:"_onFirstPlaying",value:function(){this.listenTo(this.player,C.PLAYER_TIMEUPDATE,this._onContainerUpdateWhilePlaying),this.listenEvents.push({name:C.PLAYER_TIMEUPDATE,handler:this._onContainerUpdateWhilePlaying}),this._start("watch"),this._stop("startup")}},{key:"_onContainerUpdateWhilePlaying",value:function(){this.player.isPlaying()&&(this._stop("watch"),this._start("watch"))}},{key:"_onCanPlayThrough",value:function(e){if(this.player.isPlaying()){var t=e.time;this._isFirstLoad?(this._isFirstLoad=!1,this._timeOnCanPlayFirstLoad=t):(this._timeOnCanPlayThrough=t,this._trackLatencyHistory(this._isBuffering))}}},{key:"_trackLatencyHistory",value:function(e){if(e)if(this._isSeeking)this._seekLatencyHistory.push(this._timeOnCanPlayThrough-this._timeOnSeeking),this._isSeeking=!1;else if(this._isWaiting){var t=this._timeOnCanPlayThrough-this._timeOnWaiting;this._metrics.timers.playLatency+=t,this._isWaiting=!1}}},{key:"_onSeeking",value:function(e){this._isSeeking=!0,this._timeOnSeeking=e.time}},{key:"_onWaiting",value:function(e){this._isSeeking||(this._isWaiting=!0,this._timeOnWaiting=e.time)}},{key:"_onPlayerEnded",value:function(){this._sendReportThenReset(),this.stopListening(),this.bindEvents()}},{key:"_onPlayerError",value:function(e){this._metrics.extra.errorDetail.push("code: ".concat(e.code,", description: ").concat(e.description)),this._inc("error"),this._sendReportThenReset()}},{key:"_startMonitoring",value:function(){var e=this;this._intervalId=setInterval(function(){e._buildReport(),e._sendLastReports()},Sa),this._buildReport(),k.info(this.name,"started monitoring")}},{key:"_stopMonitoring",value:function(){clearInterval(this._intervalId),k.info(this.name,"stopped monitoring")}},{key:"_sendReportThenReset",value:function(){this._stopMonitoring(),this._buildReport(),this._sendReport(this._storage.get()),this._reset()}},{key:"_reset",value:function(){this._isFirstLoad=!0,this._seekLatencyHistory=[],this._newMetrics(),this._storage.clean()}},{key:"_sendLastReports",value:function(){var e=this;Object.keys(va).filter(La).forEach(function(t){var n,r=JSON.parse(va.getItem(t));e._storage.key===t||(n=r)&&Date.now()-n._updatedAt<Sa||(e._sendReport(r),va.removeItem(t),k.debug(e.name,"sent report:",t))})}},{key:"_saveMetrics",value:function(){var e={_updatedAt:this._now(),userAgent:navigator.userAgent,fromUrl:window.location.href,params:JSON.stringify(this._metrics)};this._storage.set(e)}},{key:"_sendReport",value:function(e){k.debug(this.name,"sending report:",e),this._trackingApi.forEach(function(t){(new Image).src=t+"?userAgent="+encodeURIComponent(e.userAgent)+"&fromUrl="+encodeURIComponent(e.fromUrl)+"&params="+encodeURIComponent(e.params)})}},{key:"onPlay",value:function(){this._inc("play")}},{key:"onPause",value:function(){this._stop("watch"),this._start("pause"),this._inc("pause"),this.listenToOnce(this.player,C.PLAYER_PLAY,this.playAfterPause)}},{key:"playAfterPause",value:function(){this._stop("pause"),this._start("watch")}},{key:"onSeek",value:function(e){this._inc("seek"),this._metrics.extra.watchHistory.push([1e3*e,1e3*e])}},{key:"onFullScreen",value:function(){this._inc("fullscreen")}},{key:"onProgress",value:function(e){this._metrics.extra.buffersize=1e3*e.current}},{key:"onTimeUpdate",value:function(e){var t=1e3*e.current,n=1e3*e.total,r=this._metrics.extra.watchHistory.length;this._metrics.extra.duration=n,this._metrics.extra.currentTime=t,0===r?this._metrics.extra.watchHistory.push([t,t]):this._metrics.extra.watchHistory[r-1][1]=t}},{key:"onBuffering",value:function(){this._isBuffering=!0,this._inc("buffering"),this._start("buffering"),this.listenToOnce(this.player,C.PLAYER_BUFFERFULL,this.onBufferfull)}},{key:"onBufferfull",value:function(){this._isBuffering=!1,this._stop("buffering"),this.listenToOnce(this.player,C.PLAYER_BUFFERING,this.onBuffering)}},{key:"_inc",value:function(e){this._metrics.counters[e]+=1}},{key:"_timerHasStarted",value:function(e){return void 0!==this["_start".concat(e)]}},{key:"_start",value:function(e){this["_start".concat(e)]=this._now()}},{key:"_stop",value:function(e){this._metrics.timers[e]+=this._now()-this["_start".concat(e)]}},{key:"_fetchFPS",value:function(){var e={html5_video:this._html5FetchFPS,hls:this._html5FetchFPS};e[this._playbackName]&&e[this._playbackName].call(this)}},{key:"_calculateBitrates",value:function(){var e=this,t=this._metrics.extra.bitratesHistory.map(function(e){return e.bitrate});this._metrics.extra.bitrateMean=t.reduce(function(e,t){return e+t},0)/t.length,this._metrics.extra.bitrateVariance=t.map(function(t){return Math.pow(t-e._metrics.extra.bitrateMean,2)}).reduce(function(e,t){return e+t},0)/t.length,this._metrics.extra.bitrateStandardDeviation=Math.sqrt(this._metrics.extra.bitrateVariance),this._metrics.extra.bitrateMostUsed=this._metrics.extra.bitratesHistory.sort(function(e,t){return e.time<t.time})[0]}},{key:"_calculatePercentages",value:function(){this._metrics.extra.duration>0&&(this._metrics.extra.watchedPercentage=this._metrics.timers.watch/this._metrics.extra.duration*100,this._metrics.extra.bufferingPercentage=this._metrics.timers.buffering/this._metrics.extra.duration*100)}},{key:"_calculateStartLatency",value:function(){!this._timeOnCanPlayFirstLoad||this._timeOnCanPlayFirstLoad<=0||(this._metrics.timers.startLatency=this._timeOnCanPlayFirstLoad-this._timeOnStartLoad)}},{key:"_calculateSeekLatency",value:function(){this._metrics.timers.seekLatency=Gt(this._seekLatencyHistory)}},{key:"_newMetrics",value:function(){var e=this;this._metrics={counters:{play:0,pause:0,error:0,buffering:0,decodedFrames:0,droppedFrames:0,fps:0,changeLevel:0,seek:0,fullscreen:0,dvrUsage:0},timers:{startup:0,watch:0,pause:0,buffering:0,session:0,startLatency:0,seekLatency:0,playLatency:0,getSourceLatency:0},extra:{product:"",level:"",playbackName:"",playbackType:"",playbackRedirector:"",playbackSrc:"",mimeType:"",platform:_t?"webm":"webd",zdnServer:"",bitratesHistory:[],bitrateMean:0,bitrateVariance:0,bitrateStandardDeviation:0,bitrateMostUsed:0,buffersize:0,errorDetail:[],watchHistory:[],watchedPercentage:0,bufferingPercentage:0,isOnline:!0}},window.ZA&&z.function(window.ZA.getVisitorID)&&window.ZA.getVisitorID(function(t){k.debug(e.name,"ZA visitor ID:",t),e._metrics.extra.visitorId=t})}},{key:"_buildReport",value:function(){this._stop("session"),this._start("session"),this._metrics.extra.playbackName=this._playbackName,this._metrics.extra.playbackType=this._playbackType,this._metrics.extra.product=this.options.product,this._calculateBitrates(),this._calculatePercentages(),this._fetchFPS(),this._calculateStartLatency(),this._calculateSeekLatency(),this._metrics.extra.playbackSrc=this.player.isHlsPlayback()?this.player.options.source:this.player.playback.el.src,this._metrics.extra.mimeType=this.player.options.mimeType,this._saveMetrics()}},{key:"_html5FetchFPS",value:function(){var e=this.player.playback.el,t=e.webkitDecodedFrameCount||e.mozDecodedFrames||0,n=e.webkitDroppedFrameCount||e.mozParsedFrames-e.mozDecodedFrames||0,r=t-(this._lastDecodedFramesCount||0);this._metrics.counters.decodedFrames=t,this._metrics.counters.droppedFrames=n,this._metrics.counters.fps=r/(Sa/1e3),this._lastDecodedFramesCount=t}},{key:"name",get:function(){return"StatsPlugin"}},{key:"defaultOptions",get:function(){return{trackingApi:["https://zplayer-trk.zdn.vn/track"]}}},{key:"_playbackName",get:function(){return this.player.playback.name}},{key:"_playbackType",get:function(){return this.player.getPlaybackType()}},{key:"listenEvents",get:function(){return[{once:!0,name:C.PLAYER_PLAY_INTENT,handler:this._onPlayIntent},{once:!0,name:C.PLAYER_PLAY,handler:this._onFirstPlaying},{name:C.PLAYER_QUALITY_LEVELS_SELECTED,handler:this._onBitrate},{name:C.PLAYER_CANPLAYTHROUGH,handler:this._onCanPlayThrough},{name:C.PLAYER_PLAY,handler:this.onPlay},{name:C.PLAYER_PAUSE,handler:this.onPause},{once:!0,name:C.PLAYER_ERROR,handler:this._onPlayerError},{name:C.PLAYER_ENDED,handler:this._onPlayerEnded},{name:C.PLAYER_SEEKING,handler:this._onSeeking},{name:C.PLAYER_SEEK,handler:this.onSeek},{name:C.PLAYER_WAITING,handler:this._onWaiting},{name:C.PLAYER_FULLSCREEN,handler:this.onFullScreen},{name:C.PLAYER_PROGRESS,handler:this.onProgress},{name:C.PLAYER_TIMEUPDATE,handler:this.onTimeUpdate},{once:!0,name:C.PLAYER_BUFFERING,handler:this.onBuffering},{once:!0,name:C.PLAYER_BUFFERFULL,handler:this.onBufferfull}]}}])&&ba(n.prototype,r),i&&ba(n,i),t}();function La(e){return e&&0===e.indexOf(Aa)}n(26);function Pa(e){return(Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ca(e,t){return!t||"object"!==Pa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ra(e){return(Ra=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Da(e,t){return(Da=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ia=["PosterPlugin","LoadingSpinnerPlugin","BigPlayButtonPlugin","ClickToPausePlugin","PauseAdPlugin","PlayPauseFaceoutPlugin","HotKeysPlugin"],xa=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ca(this,Ra(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Da(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){var e=this;if(this.defaultOptions.disabled)return this.disable();this.shouldRender=!0,this.interferedPlugins=Ia.map(function(t){return e.player.getPlugin(t)})}},{key:"bindReload",value:function(){this.reloadButton=this.$el.find(".player-error-screen__reload"),this.reloadButton&&this.reloadButton.on("click",this.reload.bind(this))}},{key:"reload",value:function(){var e=this;this.listenToOnce(this.player,C.PLAYER_READY,function(){return e.player.play()}),this.unbindReload()}},{key:"unbindReload",value:function(){this.reloadButton&&this.reloadButton.off("click")}},{key:"onError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.err=e,this.player.mediaControl.disable(),this._disableInterferedPlugins(),this.render(),this.show(),this.shouldRender=!1}},{key:"_disableInterferedPlugins",value:function(){this.interferedPlugins.forEach(function(e){return e&&e.disable()})}},{key:"render",value:function(){if(this.err&&this.shouldRender){var e=Te("div",{innerHTML:'\n            <div class="player-error-screen__title" data-error-screen>'.concat(this.pluginOptions.message,'.</div>\n            <div class="player-error-screen__code" data-error-screen>Error code: ').concat(this.err.code,"</div>\n            ")},{"data-error-screen":"",class:"player-error-screen__content"});return this.el.append(e),this.player.el.append(this.el),this.bindReload(),this}}},{key:"name",get:function(){return"ErrorScreenPlugin"}},{key:"attributes",get:function(){return{class:"player-error-screen","data-error-screen":""}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_ERROR,handler:this.onError}]}},{key:"defaultOptions",get:function(){return{message:"Có lỗi xảy ra!"}}}])&&Oa(n.prototype,r),i&&Oa(n,i),t}();function Ma(e){return(Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Na(e,t){return!t||"object"!==Ma(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ua(e){return(Ua=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ba(e,t){return(Ba=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ja={disableHotKeys:!1},Ha=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Na(this,Ua(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ba(e,t)}(t,oe),n=t,(r=[{key:"playPauseKey",value:function(e){return 32===e.which||179===e.which}},{key:"rewindKey",value:function(e){return 37===e.which||177===e.which}},{key:"forwardKey",value:function(e){return 39===e.which||176===e.which}},{key:"volumeUpKey",value:function(e){return 38===e.which}},{key:"volumeDownKey",value:function(e){return 40===e.which}},{key:"muteKey",value:function(e){return 77===e.which}},{key:"fullscreenKey",value:function(e){return 70===e.which}},{key:"numberKey",value:function(e){return e.which>47&&e.which<59||e.which>95&&e.which<106}},{key:"getNumberKey",value:function(e){var t=48;return e.which>95&&(t=96),e.which-t}},{key:"getKey",value:function(e){return!(e.metaKey||e.ctrlKey||e.altKey)&&(this.playPauseKey(e)?1:this.volumeUpKey(e)?2:this.volumeDownKey(e)?3:this.muteKey(e)?8:this.fullscreenKey(e)?4:this.rewindKey(e)?5:this.forwardKey(e)?6:this.numberKey(e)?9:void 0)}},{key:"_onPlayerKeydown",value:function(e){if(this.player.mediaControl.disabled)return!0;var t=this.getKey(e);if(!t)return!0;e.preventDefault(),e.stopPropagation(),this.player.mediaControl.show();var n=this.player.getCurrentTime(),r=100*this.player.getVolume(),i=this.player.getDuration(),o=this.getNumberKey(e);switch(t){case 1:this.player.togglePlay();break;case 2:this.player.setVolume(r+5,!0);break;case 3:this.player.setVolume(r-5,!0);break;case 8:this.player.isMuted()?this.player.unmute(!0):this.player.mute(!0);break;case 4:this.player.toggleFullscreen();break;case 5:this.player.seek(n-5);break;case 6:this.player.seek(n+5);break;case 9:this.player.seek(i*o*.1)}}},{key:"name",get:function(){return"HotKeysPlugin"}},{key:"defaultOptions",get:function(){return ja}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_KEYDOWN,handler:this._onPlayerKeydown}]}}])&&Fa(n.prototype,r),i&&Fa(n,i),t}();function Ga(e){return(Ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Va(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ya(e,t){return!t||"object"!==Ga(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ka(e){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function za(e,t){return(za=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wa=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ya(this,Ka(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&za(e,t)}(t,oe),n=t,(r=[{key:"setUp",value:function(){this.userInteractive=!1}},{key:"_onPlayerClickEvent",value:function(){this.player.isMenuOpen||(_t?(this.userInteractive&&this.player.togglePlay(),this.userInteractive=!0):this.player.togglePlay())}},{key:"_onHideMediaControl",value:function(){this.userInteractive=!1}},{key:"name",get:function(){return"ClickToPausePlugin"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_CLICK,handler:this._onPlayerClickEvent},{name:C.PLAYER_MEDIACONTROL_HIDE,handler:this._onHideMediaControl}]}}])&&Va(n.prototype,r),i&&Va(n,i),t}();function qa(e){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $a(e,t){return!t||"object"!==qa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qa(e){return(Qa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ja(e,t){return(Ja=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Za=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),$a(this,Qa(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ja(e,t)}(t,oe),n=t,(r=[{key:"_onDblClicked",value:function(){this.options.dblClickToFullScreen&&!_t&&this.player.toggleFullscreen()}},{key:"name",get:function(){return"DoubleClickToFullscreen"}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_DBLCLICK,handler:this._onDblClicked}]}}])&&Xa(n.prototype,r),i&&Xa(n,i),t}(),es=n(4),ts=n(2),ns=n.n(ts),rs=function(){return new Promise(function(e,t){var n=new XMLHttpRequest;n.open("HEAD","//zjs-znews.zingcdn.me/zplayer/ads.js?ad",!0),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e():t(new Error("Ad Blocker is enabled")))},n.send()})};function is(){var e=Array.prototype.slice.call(arguments);if(window.fetch)return window.fetch.apply(window,e);function t(e){if("string"!=typeof e&&(e=e.toString()),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=e.toString()),e}function r(e){var t=this;this.map={},e instanceof r?e.forEach(function(e,n){n.forEach(function(n){t.append(e,n)})}):e&&Object.getOwnPropertyNames(e).forEach(function(n){t.append(n,e[n])})}function i(e){if(e.bodyUsed)return fetch.Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function o(e){return new fetch.Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader;return t.readAsArrayBuffer(e),o(t)}r.prototype.append=function(e,r){e=t(e),r=n(r);var i=this.map[e];i||(i=[],this.map[e]=i),i.push(r)},r.prototype.delete=function(e){delete this.map[t(e)]},r.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},r.prototype.getAll=function(e){return this.map[t(e)]||[]},r.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},r.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},r.prototype.forEach=function(e){var t=this;Object.getOwnPropertyNames(this.map).forEach(function(n){e(n,t.map[n])})};var s={blob:"FileReader"in window&&"Blob"in window&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in window};function u(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(s.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(s.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else{if(e)throw new Error("unsupported BodyInit type");this._bodyText=""}},s.blob?(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return fetch.Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return fetch.Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var e,t,n=i(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,(t=new FileReader).readAsText(e),o(t);if(this._bodyFormData)throw new Error("could not read FormData body as text");return fetch.Promise.resolve(this._bodyText)}):this.text=function(){return i(this)||fetch.Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(f)}),this.json=function(){return this.text().then(function(e){return JSON.parse(e)})},this}var l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function c(e,t){var n,i;if(t=t||{},this.url=e,this.credentials=t.credentials||"omit",this.headers=new r(t.headers),this.method=(i=(n=t.method||"GET").toUpperCase(),l.indexOf(i)>-1?i:n),this.mode=t.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&t.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(t.body)}function f(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function h(e){var t=new r;return e.getAllResponseHeaders().trim().split("\n").forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),i=n.join(":").trim();t.append(r,i)}),t}var d=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);function p(e,t){t||(t={}),this._initBody(e),this.type="default",this.url=null,this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof r?t.headers:new r(t.headers),this.url=t.url||""}return u.call(c.prototype),u.call(p.prototype),window.Headers=r,window.Request=c,window.Response=p,window.fetch=function(e,t){var n;return n=c.prototype.isPrototypeOf(e)&&!t?e:new c(e,t),new fetch.Promise(function(e,t){var r=function(){return d&&!/^(get|post|head|put|delete|options)$/i.test(this.method)?(this.usingActiveXhr=!0,new window.ActiveXObject("Microsoft.XMLHTTP")):new XMLHttpRequest}.call(this);function i(){if(4===r.readyState){var n=1223===r.status?204:r.status;if(n<100||n>599)t(new TypeError("Network request failed"));else{var i={status:n,statusText:r.statusText,headers:h(r),url:"responseURL"in r?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):void 0},o="response"in r?r.response:r.responseText;e(new p(o,i))}}}"cors"===n.credentials&&(r.withCredentials=!0),r.onreadystatechange=i,this.usingActiveXhr||(r.onload=i,r.onerror=function(){t(new TypeError("Network request failed"))}),r.open(n.method,n.url,!0),"responseType"in r&&s.blob&&(r.responseType="blob"),n.headers.forEach(function(e,t){t.forEach(function(t){r.setRequestHeader(e,t)})}),r.send(void 0===n._bodyInit?null:n._bodyInit)})},fetch.Promise=window.Promise,window.fetch.polyfill=!0,window.fetch.apply(window,e)}var os={load:function(e,t){return Promise.resolve().then(rs).then(function(){return function(e){if("function"==typeof e)return e();return e}(e)}).then(as).then(function(e){return function(e,t){var n;k.debug("AdLoader","loading ad from source:",e);var r=is(e,{credentials:"include"}).then(function(e){return e.json()}).then(function(e){return clearTimeout(n),e&&e.ads?e.ads.schedule:[]}),i=new Promise(function(e,r){n=setTimeout(function(){return r(new Error("Timeout reached: ".concat(t)))},t)});return Promise.race([r,i])}(e,t)})}};function as(e){if(!e)throw new Error("no ad source");return e}function ss(e){return(ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function us(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ls(e,t){return!t||"object"!==ss(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cs(e,t,n){return(cs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fs(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function fs(e){return(fs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hs(e,t){return(hs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ds=["PosterPlugin","ClickToPausePlugin","DoubleClickToFullscreen","PauseAdPlugin","HotKeysPlugin"],ps=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ls(this,fs(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hs(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){this.interferedPlugins=[],this.pauseContentRequested=!1,this.interferedPluginNames=ds.slice(0),k.debug(this.name,"initializing"),this._loadSource()}},{key:"addInterferedPlugin",value:function(e){this.interferedPluginNames.push(e)}},{key:"getPluginOptions",value:function(){return Q(this.defaultOptions,q(this._options,"pluginsOptions.ads")||this.defaultOptions)}},{key:"render",value:function(){cs(fs(t.prototype),"render",this).call(this),this.$el.hide()}},{key:"init",value:function(){throw new Error("this must be overridden")}},{key:"canHandle",value:function(e){throw new Error("this must be overridden")}},{key:"onAdsDataLoaded",value:function(e){throw new Error("this must be overridden")}},{key:"onAdWillStart",value:function(){k.info(this.name,"ad will start"),this.player.trigger(C.PLAYER_AD_WILL_START)}},{key:"onAdStarted",value:function(){k.info(this.name,"ad started"),this.player.trigger(C.PLAYER_AD_STARTED)}},{key:"onAdStopped",value:function(e){k.info(this.name,"ad stopped:",e),this.player.trigger(C.PLAYER_AD_STOPPED,{reason:e})}},{key:"onAdSkipped",value:function(){k.info(this.name,"ad skipped"),this.player.trigger(C.PLAYER_AD_SKIPPED)}},{key:"pauseForAd",value:function(){return this.pauseContentRequested?ns.a.resolve():(k.debug(this.name,"pauseForAd"),this.pauseContentRequested=!0,this._disableMediaControl(),this._disableInterferedPlugins(),this.$el.show(),this._pausePlayback())}},{key:"resumeAfterAd",value:function(){return k.debug(this.name,"resumeAfterAd"),this.pauseContentRequested?(this.pauseContentRequested=!1,this._enableMediaControl(),this._enableInterferedPlugins(),this.$el.hide(),this._resumePlayback()):ns.a.resolve()}},{key:"_pausePlayback",value:function(){return this.player.pause()}},{key:"_resumePlayback",value:function(){return this.player.playback.ended?ns.a.resolve():this.player.play()}},{key:"_disableInterferedPlugins",value:function(){var e=this;this.interferedPlugins=this.interferedPluginNames.map(function(t){return function(e){if(!e||!e.enabled)return{enable:function(){},disable:function(){}};return{enable:e.enable.bind(e),disable:e.disable.bind(e)}}(e.player.getPlugin(t))}),this.interferedPlugins.forEach(function(e){return e.disable()})}},{key:"_enableInterferedPlugins",value:function(){this.interferedPlugins.forEach(function(e){return e.enable()})}},{key:"_disableMediaControl",value:function(){this.mediaControlDisabled=this.player.mediaControl.disabled,this.mediaControlDisabled||this.player.mediaControl.disable()}},{key:"_enableMediaControl",value:function(){this.mediaControlDisabled||this.player.mediaControl.enable()}},{key:"_loadSource",value:function(){var e=this,t=this.pluginOptions,n=t.source,r=t.loadTimeout,i=void 0===r?3e3:r;(this.pluginOptions.adLoadFn||os.load)(n,i).then(function(t){return e.onAdsDataLoaded(t)},function(t){/timeout reached/.test(t.message)&&e.player.trigger(C.PLAYER_AD_LOAD_TIMEOUT),k.error(e.name,"Cannot load ad:",t),e.onAdsDataLoaded(null)})}},{key:"name",get:function(){return"AdsBase"}},{key:"attributes",get:function(){return{class:this.name}}}])&&us(n.prototype,r),i&&us(n,i),t}();n(27);function vs(e){return(vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ys(e,t){return!t||"object"!==vs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ms(e,t,n){return(ms="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bs(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function bs(e){return(bs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Es(e,t){return(Es=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ys(this,bs(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Es(e,t)}(t,ps),n=t,(r=[{key:"setUp",value:function(){k.debug(this.name,"setUp"),ms(bs(t.prototype),"setUp",this).call(this),this.metadataDeferred=Tt(),this.runnerDeferred=Tt(),this.runnerDeferredPromise=this.runnerDeferred.promise,this.rootPosterConfig=this.pluginOptions.poster,this._onResize=this._onResize.bind(this),window.on("resize.ads",this._onResize,!1),this.player.$el.append(this.$el),this.nonLinearAdContainer=Te("div",{},{class:"AdsPluginNonLinear"}),this.player.$el.append(this.nonLinearAdContainer),this.runner=null}},{key:"onAdsDataLoaded",value:function(e){var t=this;this._transformAdsData(e).then(function(e){e&&e.length?t._runnerProxy(function(){t.runner.onAdsDataLoaded(e)}):(k.info(t.name,"empty ad data, destroying plugin..."),t.destroy())})}},{key:"destroy",value:function(){var e=this;ms(bs(t.prototype),"destroy",this).call(this),window.off("resize.ads",this._onResize,!1),Re(this.nonLinearAdContainer),this._runnerProxy(function(){e.runner.destroy(),e.runner=null}),k.debug(this.name,"destroyed")}},{key:"getPoster",value:function(){var e=this.player.getPlayerSize().width;if(this.pluginOptions.poster=!(e<=400)&&this.rootPosterConfig,!this.pluginOptions.poster)return Promise.resolve();var t=this.player.getPlugin("PosterPlugin");return t?Promise.resolve(t.getPosterUrl()):Promise.resolve()}},{key:"getContentPlayer",value:function(){return this.player.playback.el}},{key:"getContentVolume",value:function(){return this.player.isMuted()?0:100*this.player.getVolume()}},{key:"getContentMetadata",value:function(){return this.metadataDeferred.promise}},{key:"getAdContainers",value:function(){var e=this.player.mediaControl.getControl("SeekBarControl");return{linear:this.el,nonLinear:this.nonLinearAdContainer,notification:this.player.el,adMark:e&&e.el}}},{key:"getLogger",value:function(){return k}},{key:"onAdStarted",value:function(){var e=this;ms(bs(t.prototype),"onAdStarted",this).call(this),!this.player.options.customIosFullscreen&&lt&&Bi.isFullscreen()&&(k.info(this.name,"player in fullscreen mode on iOS, skipping ad..."),this._runnerProxy(function(){e.runner.stopAd()}))}},{key:"_onUserActionEvent",value:function(){var e=this;this._runnerProxy(function(){e.runner.onUserAction()})}},{key:"_onPlaybackEnded",value:function(){var e=this;this._runnerProxy(function(){e.runner.onContentEnded()}),this.pluginOptions.replayAds&&this._loadSource()}},{key:"_onPlayerError",value:function(){this.destroy()}},{key:"_onTimeUpdate",value:function(e){var t=this;this.player.mediaControl.draggingSeekBar||this._runnerProxy(function(){t.runner.onContentProgress(e)})}},{key:"_onLoadedMetadata",value:function(e){this.player.getDuration()<this.pluginOptions.minDurationShowAd&&this.destroy(),this.metadataDeferred.resolve(e)}},{key:"_onAdPauseRequest",value:function(){this._pauseAd()}},{key:"_onAdResumeRequest",value:function(){this._resumeAd()}},{key:"_onResize",value:function(e){var t=this,n=arguments,r=this.player.getPlayerSize().width,i=this.rootPosterConfig&&r>400;this._runnerProxy(function(){var r=t.runner;z.nullOrUndefined(r)||(r.showPosterAndPlayIcon(i),"resize"===e.type?r.resize():r.resize.apply(r,n))})}},{key:"_pauseAd",value:function(){var e=this;this._runnerProxy(function(){e.runner.pauseAd()})}},{key:"_resumeAd",value:function(){var e=this;this._runnerProxy(function(){e.runner.resumeAd()})}},{key:"_transformAdsData",value:function(e){var t=this.pluginOptions.transform;return"function"!=typeof t?Promise.resolve(e):(k.debug(this.name,"transforming ad data..."),this.getContentMetadata().then(function(n){return t(e,n)}))}},{key:"_runnerProxy",value:function(e){this.runnerDeferred&&this.runnerDeferredPromise.then(e)}},{key:"_toggleMediaControls",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._runnerProxy(function(){var n=t?"addClass":"removeClass";e.runner.adUi.countdownToPlay[n]("has_controls_bar"),e.runner.adUi.$uiLoading[n]("has_controls_bar")})}},{key:"_onPlayerControlShow",value:function(){this._toggleMediaControls()}},{key:"_onPlayerControlHide",value:function(){this._toggleMediaControls(!1)}},{key:"_onPlayerControlReady",value:function(){this.runner||(this.runnerOptions={startTimeout:this.pluginOptions.startTimeout/1e3,skipTimeout:this.pluginOptions.skipTimeout/1e3,countdownPlay:!this.pluginOptions.noCountdownPlay,showSlideBlack:this.pluginOptions.showSlideBlack,removeAdmarkOnError:this.pluginOptions.removeAdmarkOnError,autoPlayAdBreaks:this.pluginOptions.autoPlayAdBreaks,autoPlay:!!this.player.options.autoPlay,mute:!!this.player.options.mute},this.runner=new es.Runner(this,this.runnerOptions),this.runnerDeferred.resolve())}},{key:"_onPlayerFullscreen",value:function(){this._onResize("resize")}},{key:"name",get:function(){return"AdsPlugin"}},{key:"defaultOptions",get:function(){return{replayAds:!1,showSlideBlack:!0,removeAdmarkOnError:!0,startTimeout:1e4,skipTimeout:3e3,autoPlayAdBreaks:!0,minDurationShowAd:5}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_PLAY_INTENT,handler:this._onUserActionEvent},{name:C.PLAYER_TIMEUPDATE,handler:this._onTimeUpdate},{once:!0,name:C.PLAYER_LOADEDMETADATA,handler:this._onLoadedMetadata},{once:!this.pluginOptions.replayAds,name:C.PLAYER_ENDED,handler:this._onPlaybackEnded},{name:C.PLAYER_ERROR,handler:this._onPlayerError},{name:C.PLAYER_AD_PAUSE_REQUEST,handler:this._onAdPauseRequest},{name:C.PLAYER_AD_RESUME_REQUEST,handler:this._onAdResumeRequest},{name:C.PLAYER_UPDATE_SIZE,handler:this._onResize},{name:C.PLAYER_MEDIACONTROL_SHOW,handler:this._onPlayerControlShow},{name:C.PLAYER_MEDIACONTROL_HIDE,handler:this._onPlayerControlHide},{once:!0,name:C.PLAYER_MEDIACONTROL_READY,handler:this._onPlayerControlReady},{name:C.PLAYER_FULLSCREEN,handler:this._onPlayerFullscreen}]}}])&&gs(n.prototype,r),i&&gs(n,i),t}();n(28);function Ts(e){return(Ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ks(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function As(e,t){return!t||"object"!==Ts(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ss(e){return(Ss=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ws(e,t){return(ws=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ls=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),As(this,Ss(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ws(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){this.pluginOptions.disabled&&this.disable()}},{key:"handleClick",value:function(e){return e.stopPropagation(),this.player.play(),this.player.el.focus(),!1}},{key:"_onPlayerPlay",value:function(){this.hide()}},{key:"_onPlayerPause",value:function(){this.pluginOptions.showOnPauseMobile&&this.show()}},{key:"render",value:function(){var e=Te("span",{},{class:"--z--icon pl-ic-play_arrow"});return pe(e,this.pluginOptions.iconStyles),pe(this.el,this.pluginOptions.buttonStyles),this.setAttribute("title","Phát"),this.el.append(e),this.player.el.append(this.el),this}},{key:"name",get:function(){return"BigPlayButtonPlugin"}},{key:"tagName",get:function(){return"button"}},{key:"className",get:function(){return"--z--big-play-button"}},{key:"attributes",get:function(){return{class:this.className,type:"button"}}},{key:"events",get:function(){return{click:"handleClick",touch:"handleClick"}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_PLAY,handler:this._onPlayerPlay},{name:C.PLAYER_PLAY_INTENT,handler:this._onPlayerPlay},{name:C.PLAYER_PAUSE,handler:this._onPlayerPause}]}},{key:"defaultOptions",get:function(){return{showOnPauseMobile:!0}}}])&&ks(n.prototype,r),i&&ks(n,i),t}();n(29);function Ps(e){return(Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Os(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cs(e,t){return!t||"object"!==Ps(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rs(e){return(Rs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ds(e,t){return(Ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Is=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Cs(this,Rs(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ds(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){this.pluginOptions.disabled||_t?this.disable():(this.bigPlayButtonPlugin=this.player.getPlugin("BigPlayButtonPlugin"),this.isPlaying=!this.player.isPlaying(),this.mediaControlDisabled=this.player.mediaControl.disabled,this.bigPlayButtonEnabled=this.bigPlayButtonPlugin.enabled)}},{key:"_disableInterferedPlugins",value:function(){this.bigPlayButtonEnabled&&this.bigPlayButtonPlugin.disable()}},{key:"_onPlayerPlayIntent",value:function(){this._disableInterferedPlugins()}},{key:"_onPlayerClick",value:function(){this.player.isMenuOpen||this._togglePlayPause()}},{key:"_togglePlayPause",value:function(){var e=this;this.isPlaying=!this.isPlaying,pe(this.el,{display:"flex"}),setTimeout(function(){pe(e.el,{display:"none"})},500),he(this.iconEl,"pl-ic-play_arrow",this.isPlaying),he(this.iconEl,"pl-ic-pause",!this.isPlaying)}},{key:"_onPlayerEnded",value:function(){this.bigPlayButtonEnabled&&this.bigPlayButtonPlugin.enable(),this.mediaControlDisabled||this.player.mediaControl.enable()}},{key:"render",value:function(){return this.iconEl=Te("span",{},{class:"--z--icon pl-ic-play_arrow"}),pe(this.iconEl,this.pluginOptions.iconStyles),pe(this.el,this.pluginOptions.buttonStyles),this.el.append(this.iconEl),this.player.el.append(this.el),this}},{key:"name",get:function(){return"PlayPauseFaceoutPlugin"}},{key:"tagName",get:function(){return"button"}},{key:"className",get:function(){return"--z--playpause-fadeout"}},{key:"attributes",get:function(){return{class:this.className,type:"button"}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_CLICK,handler:this._onPlayerClick},{name:C.PLAYER_ENDED,handler:this._onPlayerEnded},{name:C.PLAYER_PLAY_INTENT,handler:this._onPlayerPlayIntent}]}}])&&Os(n.prototype,r),i&&Os(n,i),t}(),xs=new Blob([new Uint8Array([255,227,24,196,0,0,0,3,72,1,64,0,0,4,132,16,31,227,192,225,76,255,67,12,255,221,27,255,228,97,73,63,255,195,131,69,192,232,223,255,255,207,102,239,255,255,255,101,158,206,70,20,59,255,254,95,70,149,66,4,16,128,0,2,2,32,240,138,255,36,106,183,255,227,24,196,59,11,34,62,80,49,135,40,0,253,29,191,209,200,141,71,7,255,252,152,74,15,130,33,185,6,63,255,252,195,70,203,86,53,15,255,255,247,103,76,121,64,32,47,255,34,227,194,209,138,76,65,77,69,51,46,57,55,170,170,170,170,170,170,170,170,170,170,255,227,24,196,73,13,153,210,100,81,135,56,0,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170])],{type:"audio/mpeg"}),Ms=new Blob([new Uint8Array([0,0,0,28,102,116,121,112,105,115,111,109,0,0,2,0,105,115,111,109,105,115,111,50,109,112,52,49,0,0,0,8,102,114,101,101,0,0,2,239,109,100,97,116,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,0,0,2,194,109,111,111,118,0,0,0,108,109,118,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,47,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,1,236,116,114,97,107,0,0,0,92,116,107,104,100,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,47,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,101,100,116,115,0,0,0,28,101,108,115,116,0,0,0,0,0,0,0,1,0,0,0,47,0,0,0,0,0,1,0,0,0,0,1,100,109,100,105,97,0,0,0,32,109,100,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,68,0,0,8,0,85,196,0,0,0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0,0,0,1,15,109,105,110,102,0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0,0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1,0,0,0,211,115,116,98,108,0,0,0,103,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,87,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,51,101,115,100,115,0,0,0,0,3,128,128,128,34,0,2,0,4,128,128,128,20,64,21,0,0,0,0,1,244,0,0,1,243,249,5,128,128,128,2,18,16,6,128,128,128,1,2,0,0,0,24,115,116,116,115,0,0,0,0,0,0,0,1,0,0,0,2,0,0,4,0,0,0,0,28,115,116,115,99,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,28,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,115,0,0,1,116,0,0,0,20,115,116,99,111,0,0,0,0,0,0,0,1,0,0,0,44,0,0,0,98,117,100,116,97,0,0,0,90,109,101,116,97,0,0,0,0,0,0,0,33,104,100,108,114,0,0,0,0,0,0,0,0,109,100,105,114,97,112,112,108,0,0,0,0,0,0,0,0,0,0,0,0,45,105,108,115,116,0,0,0,37,169,116,111,111,0,0,0,29,100,97,116,97,0,0,0,1,0,0,0,0,76,97,118,102,53,54,46,52,48,46,49,48,49])],{type:"video/mp4"});function Fs(e){return Object.assign({muted:!1,timeout:250,inline:!1},e)}function Ns(e,t){var n=e.muted,r=e.timeout,i=e.inline,o=t(),a=o.element,s=o.source,u=void 0,l=void 0,c=void 0;return a.muted=n,!0===n&&a.setAttribute("muted","muted"),!0===i&&a.setAttribute("playsinline","playsinline"),a.src=s,new Promise(function(e){u=a.play(),l=setTimeout(function(){c(!1,new Error("Timeout "+r+" ms has been reached"))},r),c=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(l),e({result:t,error:n})},void 0!==u?u.then(function(){return c(!0)}).catch(function(e){return c(!1,e)}):c(!0)})}var Us={audio:function(e){return Ns(e=Fs(e),function(){return{element:document.createElement("audio"),source:URL.createObjectURL(xs)}})},video:function(e){return Ns(e=Fs(e),function(){return{element:document.createElement("video"),source:URL.createObjectURL(Ms)}})}};n(30);function Bs(e){return(Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function js(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hs(e,t){return!t||"object"!==Bs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gs(e,t,n){return(Gs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vs(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Vs(e){return(Vs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ys(e,t){return(Ys=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ks=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Hs(this,Vs(t).call(this,e))).pluginOptions=n,r.render(),r.bindEvents(),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ys(e,t)}(t,Ue),n=t,(r=[{key:"render",value:function(){return Gs(Vs(t.prototype),"render",this).call(this),this.el.innerHTML='<button class="--z--btn-unmute" title=\''.concat(this.pluginOptions.boxUnmute.message,'\'>\n                                <i class="--z--icon pl-ic-volume_off"></i>\n                            </button>\n                            <span>').concat(this.pluginOptions.boxUnmute.message,"</span>"),this.player.el.append(this.el),this}},{key:"handleClick",value:function(e){e.stopPropagation(),this.player.unmute(),this.remove()}},{key:"_update",value:function(){this.player.isMuted()||this.remove()}},{key:"attributes",get:function(){return{class:"--z--unmute-box"}}},{key:"listenEvents",get:function(){return[{name:C.PLAYER_VOLUMEUPDATE,handler:this._update}]}},{key:"events",get:function(){return{click:"handleClick",touch:"handleClick"}}}])&&js(n.prototype,r),i&&js(n,i),t}();function zs(e){return(zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ws(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qs(e,t){return!t||"object"!==zs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xs(e,t,n){return(Xs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function $s(e){return($s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qs(e,t){return(Qs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Js=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qs(this,$s(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qs(e,t)}(t,oe),n=t,i=[{key:"NAME_EVENTS",get:function(){return["PLUGIN_AUTOPLAY_MUTE"]}}],(r=[{key:"registerMenuCallback",value:function(e){this.menuItemEl=e}},{key:"setUp",value:function(){var e=this;if(this.options.autoPlay&&this.enabled){var t="";switch(this.player.getPlaybackType()){case nt.VOD:t="video";break;case nt.AOD:t="audio"}t&&Us[t]({timeout:this.pluginOptions.timeout,inline:!0}).then(function(n){n.result?e.player.play():(e.player.mute(),Us[t]({timeout:e.pluginOptions.timeout,muted:!0,inline:!0}).then(function(t){var n=t.result,r=t.error;n?(k.info(e.name,"autoplay muted"),e.player.play(),e.trigger(e._nameEvents.PLUGIN_AUTOPLAY_MUTE),e.pluginOptions.showBoxUnmute&&(e.boxUnmute=new Ks(e.player,e.pluginOptions))):(k.warn(e.name,"autoplay failed: ",r),e.player.unmute())}).catch(function(){e.player.unmute()}))}),this.player.getPlayerControl("SettingsControl")&&this.pluginOptions.showInSettingsMenu&&(this.pluginLabel="Tự động phát",this.autoPlayChecked=!!this.options.autoPlay,this.updateSettingsControl())}else this.disable()}},{key:"_toggleAutoPlay",value:function(e){e.stopPropagation(),this.autoPlayChecked=!this.autoPlayChecked,this.updateSettingsControl(!0)}},{key:"updateSettingsControl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"asyncRegisterMenuItem":"registerMenuItem",t=this.player.getPlayerControl("SettingsControl");t&&t.settingsMenu[e]({pluginKey:this.name,type:ro.MENU_TYPE.TOGGLE,config:{title:this.pluginLabel,checked:this.autoPlayChecked,clickCallback:this._toggleAutoPlay.bind(this)},order:0,callback:this.registerMenuCallback.bind(this)})}},{key:"destroy",value:function(){Xs($s(t.prototype),"destroy",this).call(this),this.boxUnmute&&this.boxUnmute.remove()}},{key:"name",get:function(){return"AutoPlayPlugin"}},{key:"defaultOptions",get:function(){return{showInSettingsMenu:!1,timeout:1e3,showBoxUnmute:!0,boxUnmute:{message:"Nhấn để bật tiếng"}}}}])&&Ws(n.prototype,r),i&&Ws(n,i),t}();function Zs(e,t){if(z.array(e)&&t){var n=Ht(e.filter(function(e){return!e.disabled}),"label",t);if(z.object(n)&&(n.source||n.level))return n}}function eu(e){return(eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tu(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function nu(e,t){return!t||"object"!==eu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ru(e){return(ru=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function iu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ou(e,t,n){return t&&iu(e.prototype,t),n&&iu(e,n),e}function au(e,t){return(au=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var su=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=nu(this,ru(t).call(this,e))).pluginLabel="Chất lượng",n.currentSourceLevel=null,n.autoEnabled=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&au(e,t)}(t,Ke),ou(t,[{key:"name",get:function(){return"QualityPlugin"}},{key:"defaultOptions",get:function(){return{autoText:"Auto",autoTextItem:"Auto"}}}]),ou(t,[{key:"registerMenuCallback",value:function(e){this.menuItemEl=e}},{key:"render",value:function(){if(this.player.isHlsPlayback())return this.listenTo(this.player,C.PLAYER_LEVELS_AVAILABEL,this.onPlayerLevelsAvailabel),void this.listenTo(this.player,C.PLAYER_LEVEL_SWITCHED,this.onPlayerLevelSwitched);if(this.autoEnabled=!1,this.levels=this.player.options.sources||[],this.handleDisplayName(),this.currentSourceLevel=void 0!==this.player.options.currentSourceLevel?this.findIndexFromSourceLevels(this.player.options.currentSourceLevel):0,this.levels.length<2||-1===this.currentSourceLevel)this.disable();else{this.levels=this.orderLevelsByIndex(this.levels),this.handleDisplayName();var e=this.levels[this.currentSourceLevel];this.settingBadgeLabel=this._generateHdLabel(e.label),this.updateSettingsControl()}}},{key:"updateSettingsControl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"asyncRegisterMenuItem":"registerMenuItem",t=this.player.mediaControl.getControl("SettingsControl");t&&(t.settingsButton.updateBadgeLabel(this.settingBadgeLabel),t.settingsMenu[e]({pluginKey:this.name,type:ro.MENU_TYPE.EXPAND,config:{title:this.pluginLabel,activeItemIndex:this.currentSourceLevel,clickCallback:this.handleExpandQuality.bind(this),subMenu:{type:ro.LIST_MENU_TYPE.CHECKLIST,clickCallback:this.handleQualitySelected.bind(this),titleClickCallback:this.titleClickCallback.bind(this),data:this.levels}},order:0,callback:this.registerMenuCallback.bind(this)}))}},{key:"handleDisplayName",value:function(){var e=this.pluginOptions,t=e.displayName,n=e.autoTextItem;(t||n)&&this.levels.map(function(e){if(t&&e.label){var r=t[e.label];r&&(e.displayName=r)}return"auto"==e.label.toLowerCase()&&(e.label=n),e})}},{key:"orderLevelsByIndex",value:function(e){return jt(e,"index",!1)}},{key:"onPlayerLevelsAvailabel",value:function(e){var t=this.player.options.sources||[];this.levels=this.orderLevelsByIndex([].concat(tu(e),tu(t))),this.handleDisplayName();var n=Zs(this.levels,this.player.options.quality);n&&(this.player.options.currentSourceLevel=n.index,this.settingBadgeLabel=this._generateHdLabel(n.label),this.offAuto=!0),this.currentSourceLevel=void 0!==this.player.options.currentSourceLevel?this.findIndexFromSourceLevels(this.player.options.currentSourceLevel):this.findIndexFromSourceLevels(-1);var r=this.levels[this.currentSourceLevel];r&&-1!==r.index&&this.handleHLSLevelSelect(r)}},{key:"findIndexFromSourceLevels",value:function(e){return Vt(this.levels,"index",e)}},{key:"_generateHdLabel",value:function(e){var t=parseInt(e);return this.currentLabel=e,t>=720?"HD":""}},{key:"onPlayerLevelSwitched",value:function(e){var t=e.label;this.currentSwitchedLabel=t,clearTimeout(this.playerLevelSwitchedTimeout),!this.offAuto&&(this.settingBadgeLabel=this._generateHdLabel(t)),this.updateSettingsControl(!0);var n=se()(this.menuItemEl).find(".--z--zpl-has-expand span"),r=this.pluginOptions.autoText;this.autoEnabled&&(n.empty(),n.text(r+" "+this.transformDisplayNameLabel(t)))}},{key:"titleClickCallback",value:function(){var e=se()(this.menuItemEl).find(".--z--zpl-has-expand span"),t=this.pluginOptions.autoText;this.autoEnabled&&(e.empty(),e.text(t+" "+this.transformDisplayNameLabel(this.currentLabel)))}},{key:"transformDisplayNameLabel",value:function(e){var t=this.pluginOptions.displayName;return t&&t[e]||e}},{key:"handleQualitySelected",value:function(e,t){e.stopPropagation();var n=t.data;if(this.player.trigger(C.PLAYER_QUALITY_LEVELS_SELECTED,n,t),this.player.trigger(C.PLAYER_SETTINGS_MENU_HIDE),n&&!n.disabled){var r=this.findIndexFromSourceLevels(n.index);if(this.currentSourceLevel===r)return!1;this.player.storage.set({quality:n.label}),this.player.isHlsPlayback()?this.handleHLSLevelSelect(n):this.handleMP4QualitySelect(n)}}},{key:"handleMP4QualitySelect",value:function(e){var t=this.player.getCurrentTime(),n=this.player.isPlaying();this.player.stop(),this.player.setupSource(e.source),this.player.setPreload("metadata"),n&&this.listenToOnce(this.player,C.PLAYER_SEEKED,this.onPlayerSeeked),this.player.seek(t),this.currentSourceLevel=this.findIndexFromSourceLevels(e.index),this.settingBadgeLabel=this._generateHdLabel(e.label),this.autoEnabled=!1,this.updateSettingsControl(!0)}},{key:"onPlayerSeeked",value:function(){this.player.play()}},{key:"handleHLSLevelSelect",value:function(e){var t=this,n=e.index,r=-1===n;r&&(this.offAuto=!1),this.currentSourceLevel=this.findIndexFromSourceLevels(n),this.autoEnabled=r,this.player.setCurrentLevel(n),this.player.setStartLevel(n),this.playerLevelSwitchedTimeout=setTimeout(function(){t.onPlayerLevelSwitched({label:t.currentSwitchedLabel})},1e3)}},{key:"handleExpandQuality",value:function(e){e.stopPropagation()}}]),t}();n(31);function uu(e){return(uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cu(e,t){return!t||"object"!==uu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fu(e){return(fu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hu(e,t){return(hu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var du=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),cu(this,fu(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hu(e,t)}(t,Ke),n=t,(r=[{key:"setUp",value:function(){this.pluginOptions.disabled&&this.disable()}},{key:"dvrChanged",value:function(){k.info(this.name,"dvrChanged"),this.addDvrToMediaControls()}},{key:"addDvrToMediaControls",value:function(){if(this.player.isLive()){var e=Te("button",{innerHTML:'<span class="icon-live"></span><span class="text">LIVE</span>'},{class:"--z--control --z--btn --z--drv-icon"});this.$el.append(e),this.player.mediaControl.leftElement.append(this.el)}}},{key:"name",get:function(){return"DVRControlsPlugin"}},{key:"attributes",get:function(){return{class:"--z--control --z--control-dvr","data-dvr-controls":""}}},{key:"listenEvents",get:function(){return[{once:!0,name:C.PLAYER_DVRSTATECHANGED,handler:this.dvrChanged}]}}])&&lu(n.prototype,r),i&&lu(n,i),t}();function pu(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var vu=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playbackPlugins=[cn,tn,Bt,gn],this.plugins=[],n&&this.plugins.push(Fo);var r=[Vo,Ls,Is,Wa,Za,Js,Qo,xa,Ha,_s,du,su];if(this.plugins=[].concat(pu(this.plugins),r),this.plugins.push(wa),!z.empty(t)){var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;z.function(l)&&this.plugins.push(l)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},gu=function(e,t,n){this.namespaces||(this.namespaces={}),this.namespaces[e]=t;var r=n||!1;return this.addEventListener(e.split(".")[0],t,r),this},yu=function(e){return this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e],this};function mu(e){return(mu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Eu(e,t){return!t||"object"!==mu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _u(e){return(_u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tu(e,t){return(Tu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}window.on=document.on=Element.prototype.on=gu,window.off=document.off=Element.prototype.off=yu;var ku=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Eu(this,_u(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tu(e,t)}(t,Ke),n=t,(r=[{key:"getControl",value:function(){return null}},{key:"show",value:function(){}},{key:"hide",value:function(){}}])&&bu(n.prototype,r),i&&bu(n,i),t}();function Au(e){return(Au="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Su(e,t,n){return(Su="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wu(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function wu(e){return(wu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pu(e,t,n){return t&&Lu(e.prototype,t),n&&Lu(e,n),e}function Ou(e,t){return(Ou=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ru={mute:!1,loop:!1,autoPlay:!1,volume:100,height:360,width:640,preload:"metadata",dblClickToFullScreen:!0,lockRotateFullscreen:!1,setStorageTheaterMode:!0},Du=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,i,o=e.storageKey,a=new ya(void 0===o?"zplayer":o);return r=this,(n=!(i=wu(t).call(this,null,Q({},Ru,e,a.get())))||"object"!==Au(i)&&"function"!=typeof i?Cu(r):i)._extendsOptions(n.options),k.debug(n.name,"player initialized with option:",e),n.storage=a,n.plugins=[],n._onFullScreenChanged=n._onFullScreenChanged.bind(Cu(Cu(n))),n.onWindowBlur=n.onWindowBlur.bind(Cu(Cu(n))),n._onOrientationChanged=n._onOrientationChanged.bind(Cu(Cu(n))),n.isMenuOpen=!1,n.theaterMode=!!n.options.theaterMode,n.toggleClass("--theater-mode",n.theaterMode),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ou(e,t)}(t,Ue),Pu(t,[{key:"name",get:function(){return"Player"}},{key:"attributes",get:function(){var e=this.options,t=e.width,n=e.height;return{class:e.className||"--z--player","data-player":"",tabindex:1,style:"\n                width: ".concat(t&&z.number(t)?t+"px":t,";\n                height: ").concat(n&&z.number(n)?n+"px":n,"\n            ")}}},{key:"events",get:function(){return{click:"onClicked",dblclick:"onDblClicked",contextmenu:"onContextMenu",keydown:"onKeydown",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchstart:"onMouseMove",touchleave:"onMouseLeave"}}},{key:"listenEvents",get:function(){return[{name:C.PLAYBACK_BUFFERING,handler:this.onBuffering},{name:C.PLAYBACK_BUFFERING_CHANGE,handler:this.onBufferingChange},{name:C.PLAYBACK_BUFFERFULL,handler:this.onBufferfull},{name:C.PLAYBACK_LOADEDMETADATA,handler:this.onLoadedMetadata},{name:C.PLAYBACK_TIMEUPDATE,handler:this.onTimeUpdated},{name:C.PLAYBACK_PROGRESS,handler:this.onProgress},{name:C.PLAYBACK_SEEKED,handler:this.onSeeked},{name:C.PLAYBACK_SEEKING,handler:this.onSeeking},{name:C.PLAYBACK_ENDED,handler:this.onEnded},{name:C.PLAYBACK_PLAY,handler:this.onPlay},{name:C.PLAYBACK_PAUSE,handler:this.onPaused},{name:C.PLAYBACK_STOP,handler:this.onStopped},{name:C.PLAYBACK_ERROR,handler:this.onError},{name:C.PLAYBACK_VOLUMEUPDATE,handler:this.onVolumeUpdated},{name:C.PLAYBACK_LEVELS_AVAILABLE,handler:this.onLevelsAvailabel},{name:C.PLAYBACK_LEVEL_SWITCHED,handler:this.onLevelSwitched},{name:C.PLAYBACK_FULLSCREEN_IOS,handler:this._onFullScreenIosChanged},{name:C.PLAYBACK_CANPLAYTHROUGH,handler:this.onCanPlayThrough},{name:C.PLAYBACK_WAITING,handler:this.onWaiting},{once:!0,name:C.PLAYBACK_DVRSTATECHANGED,handler:this.onDrvChanged},{once:!0,name:C.PLAYBACK_PLAY,handler:this.onDrvChanged}]}},{key:"buffering",get:function(){return this.playback.buffering}},{key:"loader",set:function(e){this.loader=e},get:function(){return this._loader||(this._loader=new vu(this.options.plugins,this.options.useDefaultControl)),this._loader}},{key:"mediaControl",get:function(){return this.getPlugin("ControlsPlugin")||this.dummyMediaControl}},{key:"dummyMediaControl",get:function(){return this._dummyMediaControl?this._dummyMediaControl:(this._dummyMediaControl=new ku(this),this._dummyMediaControl)}}]),Pu(t,[{key:"bindEvents",value:function(){Su(wu(t.prototype),"bindEvents",this).call(this,this.playback),this._addEventsFullScreen(),window.on("orientationchange",this._onOrientationChanged,!1),window.on("blur",this.onWindowBlur,!1)}},{key:"unbindEvents",value:function(){Su(wu(t.prototype),"unbindEvents",this).call(this,this.playback),this._removeEventsFullScreen(),window.off("orientationchange",this._onOrientationChanged,!1),window.off("blur",this.onWindowBlur,!1)}},{key:"hasPlugin",value:function(e){return!!this.getPlugin(e)}},{key:"getPlugin",value:function(e){return this.plugins.find(function(t){return t.name===e})}},{key:"removePlugin",value:function(e){this.plugins=this.plugins.filter(function(t){return t.name!==e})}},{key:"getPlaybackType",value:function(){return this.playback.getPlaybackType()}},{key:"getPlaybackName",value:function(){return this.playback.name}},{key:"appendToParent",value:function(){if(!this.el)return null;this.options.parentElement.appendChild(this.el)}},{key:"render",value:function(){if(!this.el)return null;this.$el.append(this.playback.render().el)}},{key:"destroy",value:function(){this.plugins.forEach(function(e){return e.destroy()}),this.playback.destroy(),this.unbindEvents(),this.remove()}},{key:"attachTo",value:function(e){var t=this;this.options.parentElement=e,this._initPlayback(),this.bindEvents(),this.render(),this._initPlugins(),this.appendToParent(),this.playback.isReady().then(function(){return t._initConfig()}).then(function(){return Promise.all(t.plugins.map(function(e){return e.initialize()}))}).then(function(){k.info(t.name,"IS LIVE",t.isLive()),t.trigger(C.PLAYER_READY,t.name)}).catch(function(e){k.error(t.name,"error while initializing player:",e)}),this.setPlayerFontSizeBase()}},{key:"getDuration",value:function(){return this.playback.getDuration()}},{key:"isPlaying",value:function(){return this.playback.isPlaying()}},{key:"play",value:function(){this.isPlaying()||(this.trigger(C.PLAYER_PLAY_INTENT),this.playback.play())}},{key:"pause",value:function(){this.isPlaying()&&this.playback.pause()}},{key:"togglePlay",value:function(){this.buffering||(this.isPlaying()?this.pause():this.play())}},{key:"stop",value:function(){this.playback.stop()}},{key:"pauseAd",value:function(){this.trigger(C.PLAYER_AD_PAUSE_REQUEST)}},{key:"resumeAd",value:function(){this.trigger(C.PLAYER_AD_RESUME_REQUEST)}},{key:"getVolume",value:function(){return this.playback.getVolume()}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!z.number(e)||e<0||e>100)k.debug(this.name,"setVolume fail , volume = ",e);else{var n=this.getVolume();this.playback.volume(e),t&&this.storage.set({volume:e,beforeMuteVolume:n})}}},{key:"mute",value:function(e){return this.setVolume(0,e),this}},{key:"unmute",value:function(e){var t=this.storage.get("beforeMuteVolume");return(!z.number(t)||t<=0)&&(t=1),this.setVolume(100*t,e),this}},{key:"isMuted",value:function(){return this.playback.isMuted()}},{key:"seek",value:function(e){this.isLive()||e<0||e>this.getDuration()||(this.trigger(C.PLAYER_SEEK,e,this.name),this.playback.seek(e))}},{key:"isFullscreen",value:function(){return Bi.isFullscreen()}},{key:"isTheaterMode",value:function(){return this.theaterMode}},{key:"setupSource",value:function(e){this.playback.setupSource(e)}},{key:"getSource",value:function(){this.playback.getSource()}},{key:"setCurrentLevel",value:function(e){this.playback.currentLevel=e}},{key:"setStartLevel",value:function(e){this.playback.startLevel=e}},{key:"setPreload",value:function(e){this.playback.setPreload(e)}},{key:"getPlayerControl",value:function(e){return this.mediaControl&&this.mediaControl.getControl(e)}},{key:"setPlaybackRate",value:function(e){this.playback.setPlaybackRate(e)}},{key:"isHlsPlayback",value:function(){return this.playback.isHlsPlayback()}},{key:"isMp4Playback",value:function(){return!this.isHlsPlayback()}},{key:"seekPercentage",value:function(e){var t=this.getDuration();if(e>=0&&e<=100){var n=t*(e/100);this.seek(n)}}},{key:"setPlayerFontSizeBase",value:function(){_t&&pe(this.el,{fontSize:(this.isFullscreen()?70:60)+"%"})}},{key:"toggleFullscreen",value:function(){var e=this.options,t=e.customIosFullscreen;e.lockRotateFullscreen&&(this.isLandscapeScreen()?lt&&this.removeClass("is-portrait"):(lt&&this.addClass("--z--orient-lock-fullscreen"),lt&&this.addClass("is-portrait"),setTimeout(function(){screen&&screen.orientation.lock("landscape")},300)),this.isFullscreen()&&(lt&&this.removeClass("--z--orient-lock-fullscreen"),lt&&this.removeClass("is-portrait"),setTimeout(function(){return screen&&screen.orientation.unlock()},300))),t?this._toggleFullScreenIos():this._toggleFullScreenNative()}},{key:"isLandscapeScreen",value:function(){return window.innerWidth>window.innerHeight}},{key:"getPlayBack",value:function(){return function(e,t,n){var r=null,i=n.mimeType;z.object(t)?(r=t.source.toString(),t.mimeType&&(i=t.mimeType)):r=t.toString(),r.match(/^\/\//)&&(r=window.location.protocol+r);var o=Q({},n,{src:r,mimeType:i}),a=e.filter(function(e){return e.canPlay(t,i)})[0];return"no_op"===a.name&&n.fallbackSrc&&(a=e.filter(function(e){return e.canPlay(n.fallbackSrc,i)})[0]),new a(o)}(this.loader.playbackPlugins,this.options.source,this.options)}},{key:"isLive",value:function(){return this.getPlaybackType()===nt.LIVE}},{key:"getCurrentTime",value:function(){return this.playback.el.currentTime}},{key:"getPlayerSize",value:function(){return{width:this.el.offsetWidth,height:this.el.offsetHeight}}},{key:"updateSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"px",r={};e&&(r.width=e+n),t&&(r.height=t+n),pe(this.el,r),this.trigger(C.PLAYER_UPDATE_SIZE,this.el.offsetWidth,this.el.offsetHeight,this.isFullscreen())}},{key:"onClicked",value:function(){k.debug(this.name,"onClicked"),this.trigger(C.PLAYER_CLICK,this,this.name)}},{key:"onDblClicked",value:function(){this.trigger(C.PLAYER_DBLCLICK,this,this.name)}},{key:"onKeydown",value:function(e){this.trigger(C.PLAYER_KEYDOWN,e,this.name)}},{key:"onMouseEnter",value:function(){this.trigger(C.PLAYER_MOUSE_ENTER)}},{key:"onMouseLeave",value:function(){this.trigger(C.PLAYER_MOUSE_LEAVE)}},{key:"onMouseMove",value:function(){this.trigger(C.PLAYER_MOUSE_MOVE)}},{key:"onContextMenu",value:function(e){this.trigger(C.PLAYER_CONTEXTMENU,e,this.name)}},{key:"onBuffering",value:function(){this.trigger(C.PLAYER_BUFFERING,this.name)}},{key:"onBufferingChange",value:function(e){this.trigger(C.PLAYER_BUFFERING_CHANGE,e)}},{key:"onBufferfull",value:function(){this.trigger(C.PLAYER_BUFFERFULL,this.name)}},{key:"onLoadedMetadata",value:function(e){this.trigger(C.PLAYER_LOADEDMETADATA,e)}},{key:"onTimeUpdated",value:function(e){this.currentTime=e.current,this.trigger(C.PLAYER_TIMEUPDATE,e,this.name)}},{key:"onSeeked",value:function(){this.trigger(C.PLAYER_SEEKED,this.name)}},{key:"onSeeking",value:function(e){this.currentTime=e.data.target.currentTime,this.trigger(C.PLAYER_SEEKING,e)}},{key:"onWaiting",value:function(e){this.trigger(C.PLAYER_WAITING,e)}},{key:"onPlay",value:function(){k.debug(this.name,"PLAYER_PLAY"),this.trigger(C.PLAYER_PLAY,this.name)}},{key:"onPaused",value:function(){k.debug(this.name,"PLAYER_PAUSE"),this.trigger(C.PLAYER_PAUSE,this.name)}},{key:"onError",value:function(e){k.error(this.name,"player error:",e),this.trigger(C.PLAYER_ERROR,e,this.name)}},{key:"onStopped",value:function(){this.trigger(C.PLAYER_STOP)}},{key:"onEnded",value:function(){this.trigger(C.PLAYER_ENDED,this.name),this.currentTime=0}},{key:"onVolumeUpdated",value:function(e){this.trigger(C.PLAYER_VOLUMEUPDATE,e)}},{key:"onLevelsAvailabel",value:function(e){this.trigger(C.PLAYER_LEVELS_AVAILABEL,e)}},{key:"onLevelSwitched",value:function(e){this.trigger(C.PLAYER_LEVEL_SWITCHED,e)}},{key:"onCanPlayThrough",value:function(e){this.trigger(C.PLAYER_CANPLAYTHROUGH,e)}},{key:"onProgress",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.trigger.apply(this,[C.PLAYER_PROGRESS].concat(t,[this.name]))}},{key:"onDrvChanged",value:function(){this.trigger(C.PLAYER_DVRSTATECHANGED)}},{key:"onWindowBlur",value:function(){_t&&this.options.pauseOnBlur&&this.pause()}},{key:"_addEventsFullScreen",value:function(){document.on("webkitfullscreenchange",this._onFullScreenChanged,!1),document.on("mozfullscreenchange",this._onFullScreenChanged,!1),document.on("fullscreenchange",this._onFullScreenChanged,!1),document.on("MSFullscreenChange",this._onFullScreenChanged,!1)}},{key:"_removeEventsFullScreen",value:function(){document.off("webkitfullscreenchange",this._onFullScreenChanged,!1),document.off("mozfullscreenchange",this._onFullScreenChanged,!1),document.off("fullscreenchange",this._onFullScreenChanged,!1),document.off("MSFullscreenChange",this._onFullScreenChanged,!1)}},{key:"_onFullScreenIosChanged",value:function(e){k.debug(this.name,"fullscreen status changed on iOS:",e),Bi.isFullscreenIos=e,this._onFullScreenChanged()}},{key:"_onFullScreenChanged",value:function(){k.debug(this.name,"fullscreen status changed:",this.isFullscreen()),this.isFullscreen()?this.$el.addClass("--z--full-screen"):this.$el.removeClass("--z--full-screen"),this.setPlayerFontSizeBase(),this.trigger(C.PLAYER_FULLSCREEN,this.isFullscreen(),this.name)}},{key:"_onOrientationChanged",value:function(){var e=this,t=this.options,n=t.customIosFullscreen,r=t.lockRotateFullscreen;this.setPlayerFontSizeBase(),n&&this.isFullscreen()&&this.backdropEl&&pe(this.backdropEl,{height:window.innerHeight+"px"}),r&&this.isFullscreen()&&lt&&setTimeout(function(){e.isLandscapeScreen()?(e.removeClass("--z--orient-lock-fullscreen"),e.removeClass("is-portrait")):(e.addClass("is-portrait"),e.addClass("--z--orient-lock-fullscreen"))},300),this.trigger(C.PLAYER_ORIENTATION_CHANGE,this.isFullscreen())}},{key:"_initPlayback",value:function(){this.playback=this.getPlayBack(),k.debug(this.name,"found playback",this.getPlaybackName()),k.debug(this.name,"found playbacktype",this.getPlaybackType())}},{key:"_initConfig",value:function(){var e=this.options.mute?0:this.options.volume;this.setVolume(e)}},{key:"_initPlugins",value:function(){var e=this;z.empty(this.loader.plugins)||this.loader.plugins.forEach(function(t){e.plugins.push(new t(e))})}},{key:"_extendsOptions",value:function(e){var t=Zs(e.sources,e.quality);t&&(e.source=t.source,e.currentSourceLevel=t.index)}},{key:"_onTouchMove",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_toggleFullScreenIos",value:function(){this.backdropEl=this.backdropEl||Te("div",{},{class:"--z--player-backdrop"}),this.isFullscreen()?(this.removeClass("--z--custom-ios-fullscreen"),this.options.parentElement.append(this.el),this.backdropEl.innerHTML="",he(this.backdropEl,"--z--show"),Bi.isFullscreenIos=!1,this.scrollTopPos&&window.scrollTo(0,this.scrollTopPos)):(this.scrollTopPos=this.scrollTopPos||window.scrollY,window.scrollTo(0,0),this.addClass("--z--custom-ios-fullscreen"),pe(this.backdropEl,{height:window.innerHeight+"px"}),this.backdropEl.append(this.el),document.body.append(this.backdropEl),he(this.backdropEl,"--z--show"),Bi.isFullscreenIos=!0),this.setPlayerFontSizeBase(),this.trigger(C.PLAYER_FULLSCREEN,this.isFullscreen())}},{key:"_toggleFullScreenNative",value:function(){this.isFullscreen()?Bi.cancelFullscreen():Bi.requestFullscreen(this.el)}},{key:"toggleTheaterMode",value:function(){this.theaterMode=!this.theaterMode,this.toggleClass("--theater-mode",this.theaterMode),this.options.setStorageTheaterMode&&this.storage.set({theaterMode:this.theaterMode}),this.trigger(C.PLAYER_THEATER_MODE_CHANGE,this.theaterMode)}},{key:"mediaControlReady",value:function(){k.debug(this.name,"mediaControlReady"),this.trigger(C.PLAYER_MEDIACONTROL_READY,this.name)}},{key:"disableMediaControl",value:function(){this.trigger(C.PLAYER_MEDIACONTROL_DISABLE,this.name)}},{key:"enableMediaControl",value:function(){this.trigger(C.PLAYER_MEDIACONTROL_ENABLE,this.name)}},{key:"showMediaControl",value:function(){this.trigger(C.PLAYER_MEDIACONTROL_SHOW,this.name)}},{key:"hideMediaControl",value:function(){this.trigger(C.PLAYER_MEDIACONTROL_HIDE,this.name)}}]),t}();function Iu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=arguments.length>2?arguments[2]:void 0;e.style.opacity||(e.style.opacity=1);var r=null;window.requestAnimationFrame(function i(o){var a=o-(r=r||o),s=parseFloat(1-a/t,2);e.style.opacity=s<0?0:s,a>t?z.function(n)&&n():window.requestAnimationFrame(i)})}function xu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=arguments.length>2?arguments[2]:void 0;e.style.opacity||(e.style.opacity=0);var r=null;window.requestAnimationFrame(function i(o){var a=o-(r=r||o),s=parseFloat(a/t,2);e.style.opacity=s>1?1:s,a>t?z.function(n)&&n():window.requestAnimationFrame(i)})}n.d(t,"AdRunner",function(){return Mu}),n.d(t,"Constant",function(){return Fu}),n.d(t,"PromiseUtils",function(){return a}),n.d(t,"AdUtils",function(){return c}),n.d(t,"AnimationUtils",function(){return h}),n.d(t,"ArraysUtils",function(){return s}),n.d(t,"BaseObject",function(){return N}),n.d(t,"BasePlugin",function(){return oe}),n.d(t,"BrowserUtils",function(){return o}),n.d(t,"DomUtils",function(){return i}),n.d(t,"Events",function(){return C}),n.d(t,"HttpUtils",function(){return f}),n.d(t,"IsUtils",function(){return z}),n.d(t,"Log",function(){return k}),n.d(t,"ObjectUtils",function(){return r}),n.d(t,"Player",function(){return Du}),n.d(t,"Storage",function(){return ya}),n.d(t,"StringsUtils",function(){return l}),n.d(t,"TimeUtils",function(){return u}),n.d(t,"UIObject",function(){return Ue}),n.d(t,"UIPlugin",function(){return Ke});var Mu=null;Mu=n(4);var Fu={MediaControlConst:{BG_TYPE_TRANSPARENT:"transparent",BG_TYPE_GRADIENT:"gradient",THEME:{RED:"red",BLUE:"blue",PURPLE:"purple",GREEN:"green",LIGHT_BLUE:"light_blue"},MAP_THEME_COLOR:{RED:"#f00",BLUE:"#2FA1B3",PURPLE:"#721799",GREEN:"#6cd936",LIGHT_BLUE:"#2196F3"}},SettingsMenuConst:ro};k.setLevel(k.LEVEL_DISABLED)}])});